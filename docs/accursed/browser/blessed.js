require=function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){},{}],2:[function(require,module,exports){(function(global){"use strict";function compare(a,b){if(a===b){return 0}var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y){return-1}if(y<x){return 1}return 0}function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==="function"){return global.Buffer.isBuffer(b)}return!!(b!=null&&b._isBuffer)}var util=require("util/");var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=function(){return function foo(){}.name==="foo"}();function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf)){return false}if(typeof global.ArrayBuffer!=="function"){return false}if(typeof ArrayBuffer.isView==="function"){return ArrayBuffer.isView(arrbuf)}if(!arrbuf){return false}if(arrbuf instanceof DataView){return true}if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return true}return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}if(functionsHaveNames){return func.name}var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==="string"){return s.length<n?s:s.slice(0,n)}else{return s}}function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,false)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,true)){fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return true}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=="object")&&(expected===null||typeof expected!=="object")){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return false}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return true}}memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,false)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,true)){fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}}assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}try{if(actual instanceof expected){return true}}catch(e){}if(Error.isPrototypeOf(expected)){return false}return expected.call({},actual)===true}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=="function"){throw new TypeError('"block" argument must be a function')}if(typeof expected==="string"){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}var userProvidedMessage=typeof message==="string";var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"util/":5}],3:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],4:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],5:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":4,_process:30,inherits:3}],6:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;for(var i=0;i<len;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")}return parts.join("")}},{}],7:[function(require,module,exports){arguments[4][1][0].apply(exports,arguments)},{dup:1}],8:[function(require,module,exports){(function(process,Buffer){"use strict";var assert=require("assert");var Zstream=require("pako/lib/zlib/zstream");var zlib_deflate=require("pako/lib/zlib/deflate.js");var zlib_inflate=require("pako/lib/zlib/inflate.js");var constants=require("pako/lib/zlib/constants");for(var key in constants){exports[key]=constants[key]}exports.NONE=0;exports.DEFLATE=1;exports.INFLATE=2;exports.GZIP=3;exports.GUNZIP=4;exports.DEFLATERAW=5;exports.INFLATERAW=6;exports.UNZIP=7;var GZIP_HEADER_ID1=31;var GZIP_HEADER_ID2=139;function Zlib(mode){if(typeof mode!=="number"||mode<exports.DEFLATE||mode>exports.UNZIP){throw new TypeError("Bad argument")}this.dictionary=null;this.err=0;this.flush=0;this.init_done=false;this.level=0;this.memLevel=0;this.mode=mode;this.strategy=0;this.windowBits=0;this.write_in_progress=false;this.pending_close=false;this.gzip_id_bytes_read=0}Zlib.prototype.close=function(){if(this.write_in_progress){this.pending_close=true;return}this.pending_close=false;assert(this.init_done,"close before init");assert(this.mode<=exports.UNZIP);if(this.mode===exports.DEFLATE||this.mode===exports.GZIP||this.mode===exports.DEFLATERAW){zlib_deflate.deflateEnd(this.strm)}else if(this.mode===exports.INFLATE||this.mode===exports.GUNZIP||this.mode===exports.INFLATERAW||this.mode===exports.UNZIP){zlib_inflate.inflateEnd(this.strm)}this.mode=exports.NONE;this.dictionary=null};Zlib.prototype.write=function(flush,input,in_off,in_len,out,out_off,out_len){return this._write(true,flush,input,in_off,in_len,out,out_off,out_len)};Zlib.prototype.writeSync=function(flush,input,in_off,in_len,out,out_off,out_len){return this._write(false,flush,input,in_off,in_len,out,out_off,out_len)};Zlib.prototype._write=function(async,flush,input,in_off,in_len,out,out_off,out_len){assert.equal(arguments.length,8);assert(this.init_done,"write before init");assert(this.mode!==exports.NONE,"already finalized");assert.equal(false,this.write_in_progress,"write already in progress");assert.equal(false,this.pending_close,"close is pending");this.write_in_progress=true;assert.equal(false,flush===undefined,"must provide flush value");this.write_in_progress=true;if(flush!==exports.Z_NO_FLUSH&&flush!==exports.Z_PARTIAL_FLUSH&&flush!==exports.Z_SYNC_FLUSH&&flush!==exports.Z_FULL_FLUSH&&flush!==exports.Z_FINISH&&flush!==exports.Z_BLOCK){throw new Error("Invalid flush value")}if(input==null){input=Buffer.alloc(0);in_len=0;in_off=0}this.strm.avail_in=in_len;this.strm.input=input;this.strm.next_in=in_off;this.strm.avail_out=out_len;this.strm.output=out;this.strm.next_out=out_off;this.flush=flush;if(!async){this._process();if(this._checkError()){return this._afterSync()}return}var self=this;process.nextTick(function(){self._process();self._after()});return this};Zlib.prototype._afterSync=function(){var avail_out=this.strm.avail_out;var avail_in=this.strm.avail_in;this.write_in_progress=false;return[avail_in,avail_out]};Zlib.prototype._process=function(){var next_expected_header_byte=null;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:this.err=zlib_deflate.deflate(this.strm,this.flush);break;case exports.UNZIP:if(this.strm.avail_in>0){next_expected_header_byte=this.strm.next_in}switch(this.gzip_id_bytes_read){case 0:if(next_expected_header_byte===null){break}if(this.strm.input[next_expected_header_byte]===GZIP_HEADER_ID1){this.gzip_id_bytes_read=1;next_expected_header_byte++;if(this.strm.avail_in===1){break}}else{this.mode=exports.INFLATE;break}case 1:if(next_expected_header_byte===null){break}if(this.strm.input[next_expected_header_byte]===GZIP_HEADER_ID2){this.gzip_id_bytes_read=2;this.mode=exports.GUNZIP}else{this.mode=exports.INFLATE}break;default:throw new Error("invalid number of gzip magic number bytes read")}case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:this.err=zlib_inflate.inflate(this.strm,this.flush);if(this.err===exports.Z_NEED_DICT&&this.dictionary){this.err=zlib_inflate.inflateSetDictionary(this.strm,this.dictionary);if(this.err===exports.Z_OK){this.err=zlib_inflate.inflate(this.strm,this.flush)}else if(this.err===exports.Z_DATA_ERROR){this.err=exports.Z_NEED_DICT}}while(this.strm.avail_in>0&&this.mode===exports.GUNZIP&&this.err===exports.Z_STREAM_END&&this.strm.next_in[0]!==0){this.reset();this.err=zlib_inflate.inflate(this.strm,this.flush)}break;default:throw new Error("Unknown mode "+this.mode)}};Zlib.prototype._checkError=function(){switch(this.err){case exports.Z_OK:case exports.Z_BUF_ERROR:if(this.strm.avail_out!==0&&this.flush===exports.Z_FINISH){this._error("unexpected end of file");return false}break;case exports.Z_STREAM_END:break;case exports.Z_NEED_DICT:if(this.dictionary==null){this._error("Missing dictionary")}else{this._error("Bad dictionary")}return false;default:this._error("Zlib error");return false}return true};Zlib.prototype._after=function(){if(!this._checkError()){return}var avail_out=this.strm.avail_out;var avail_in=this.strm.avail_in;this.write_in_progress=false;this.callback(avail_in,avail_out);if(this.pending_close){this.close()}};Zlib.prototype._error=function(message){if(this.strm.msg){message=this.strm.msg}this.onerror(message,this.err);this.write_in_progress=false;if(this.pending_close){this.close()}};Zlib.prototype.init=function(windowBits,level,memLevel,strategy,dictionary){assert(arguments.length===4||arguments.length===5,"init(windowBits, level, memLevel, strategy, [dictionary])");assert(windowBits>=8&&windowBits<=15,"invalid windowBits");assert(level>=-1&&level<=9,"invalid compression level");assert(memLevel>=1&&memLevel<=9,"invalid memlevel");assert(strategy===exports.Z_FILTERED||strategy===exports.Z_HUFFMAN_ONLY||strategy===exports.Z_RLE||strategy===exports.Z_FIXED||strategy===exports.Z_DEFAULT_STRATEGY,"invalid strategy");this._init(level,windowBits,memLevel,strategy,dictionary);this._setDictionary()};Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")};Zlib.prototype.reset=function(){this._reset();this._setDictionary()};Zlib.prototype._init=function(level,windowBits,memLevel,strategy,dictionary){this.level=level;this.windowBits=windowBits;this.memLevel=memLevel;this.strategy=strategy;this.flush=exports.Z_NO_FLUSH;this.err=exports.Z_OK;if(this.mode===exports.GZIP||this.mode===exports.GUNZIP){this.windowBits+=16}if(this.mode===exports.UNZIP){this.windowBits+=32}if(this.mode===exports.DEFLATERAW||this.mode===exports.INFLATERAW){this.windowBits=-1*this.windowBits}this.strm=new Zstream;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:this.err=zlib_deflate.deflateInit2(this.strm,this.level,exports.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:case exports.UNZIP:this.err=zlib_inflate.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(this.err!==exports.Z_OK){this._error("Init error")}this.dictionary=dictionary;this.write_in_progress=false;this.init_done=true};Zlib.prototype._setDictionary=function(){if(this.dictionary==null){return}this.err=exports.Z_OK;switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:this.err=zlib_deflate.deflateSetDictionary(this.strm,this.dictionary);break;default:break}if(this.err!==exports.Z_OK){this._error("Failed to set dictionary")}};Zlib.prototype._reset=function(){this.err=exports.Z_OK;switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:case exports.GZIP:this.err=zlib_deflate.deflateReset(this.strm);break;case exports.INFLATE:case exports.INFLATERAW:case exports.GUNZIP:this.err=zlib_inflate.inflateReset(this.strm);break;default:break}if(this.err!==exports.Z_OK){this._error("Failed to reset stream")}};exports.Zlib=Zlib}).call(this,require("_process"),require("buffer").Buffer)},{_process:30,assert:2,buffer:10,"pako/lib/zlib/constants":19,"pako/lib/zlib/deflate.js":21,"pako/lib/zlib/inflate.js":23,"pako/lib/zlib/zstream":27}],9:[function(require,module,exports){(function(process){"use strict";var Buffer=require("buffer").Buffer;var Transform=require("stream").Transform;var binding=require("./binding");var util=require("util");var assert=require("assert").ok;var kMaxLength=require("buffer").kMaxLength;var kRangeErrorMessage="Cannot create final Buffer. It would be larger "+"than 0x"+kMaxLength.toString(16)+" bytes";binding.Z_MIN_WINDOWBITS=8;binding.Z_MAX_WINDOWBITS=15;binding.Z_DEFAULT_WINDOWBITS=15;binding.Z_MIN_CHUNK=64;binding.Z_MAX_CHUNK=Infinity;binding.Z_DEFAULT_CHUNK=16*1024;binding.Z_MIN_MEMLEVEL=1;binding.Z_MAX_MEMLEVEL=9;binding.Z_DEFAULT_MEMLEVEL=8;binding.Z_MIN_LEVEL=-1;binding.Z_MAX_LEVEL=9;binding.Z_DEFAULT_LEVEL=binding.Z_DEFAULT_COMPRESSION;var bkeys=Object.keys(binding);for(var bk=0;bk<bkeys.length;bk++){var bkey=bkeys[bk];if(bkey.match(/^Z/)){Object.defineProperty(exports,bkey,{enumerable:true,value:binding[bkey],writable:false})}}var codes={Z_OK:binding.Z_OK,Z_STREAM_END:binding.Z_STREAM_END,Z_NEED_DICT:binding.Z_NEED_DICT,Z_ERRNO:binding.Z_ERRNO,Z_STREAM_ERROR:binding.Z_STREAM_ERROR,Z_DATA_ERROR:binding.Z_DATA_ERROR,Z_MEM_ERROR:binding.Z_MEM_ERROR,Z_BUF_ERROR:binding.Z_BUF_ERROR,Z_VERSION_ERROR:binding.Z_VERSION_ERROR};var ckeys=Object.keys(codes);for(var ck=0;ck<ckeys.length;ck++){var ckey=ckeys[ck];codes[codes[ckey]]=ckey}Object.defineProperty(exports,"codes",{enumerable:true,value:Object.freeze(codes),writable:false});exports.Deflate=Deflate;exports.Inflate=Inflate;exports.Gzip=Gzip;exports.Gunzip=Gunzip;exports.DeflateRaw=DeflateRaw;exports.InflateRaw=InflateRaw;exports.Unzip=Unzip;exports.createDeflate=function(o){return new Deflate(o)};exports.createInflate=function(o){return new Inflate(o)};exports.createDeflateRaw=function(o){return new DeflateRaw(o)};exports.createInflateRaw=function(o){return new InflateRaw(o)};exports.createGzip=function(o){return new Gzip(o)};exports.createGunzip=function(o){return new Gunzip(o)};exports.createUnzip=function(o){return new Unzip(o)};exports.deflate=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Deflate(opts),buffer,callback)};exports.deflateSync=function(buffer,opts){return zlibBufferSync(new Deflate(opts),buffer)};exports.gzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Gzip(opts),buffer,callback)};exports.gzipSync=function(buffer,opts){return zlibBufferSync(new Gzip(opts),buffer)};exports.deflateRaw=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new DeflateRaw(opts),buffer,callback)};exports.deflateRawSync=function(buffer,opts){return zlibBufferSync(new DeflateRaw(opts),buffer)};exports.unzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Unzip(opts),buffer,callback)};exports.unzipSync=function(buffer,opts){return zlibBufferSync(new Unzip(opts),buffer)};exports.inflate=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Inflate(opts),buffer,callback)};exports.inflateSync=function(buffer,opts){return zlibBufferSync(new Inflate(opts),buffer)};exports.gunzip=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new Gunzip(opts),buffer,callback)};exports.gunzipSync=function(buffer,opts){return zlibBufferSync(new Gunzip(opts),buffer)};exports.inflateRaw=function(buffer,opts,callback){if(typeof opts==="function"){callback=opts;opts={}}return zlibBuffer(new InflateRaw(opts),buffer,callback)};exports.inflateRawSync=function(buffer,opts){return zlibBufferSync(new InflateRaw(opts),buffer)};function zlibBuffer(engine,buffer,callback){var buffers=[];var nread=0;engine.on("error",onError);engine.on("end",onEnd);engine.end(buffer);flow();function flow(){var chunk;while(null!==(chunk=engine.read())){buffers.push(chunk);nread+=chunk.length}engine.once("readable",flow)}function onError(err){engine.removeListener("end",onEnd);engine.removeListener("readable",flow);callback(err)}function onEnd(){var buf;var err=null;if(nread>=kMaxLength){err=new RangeError(kRangeErrorMessage)}else{buf=Buffer.concat(buffers,nread)}buffers=[];engine.close();callback(err,buf)}}function zlibBufferSync(engine,buffer){if(typeof buffer==="string")buffer=Buffer.from(buffer);if(!Buffer.isBuffer(buffer))throw new TypeError("Not a string or buffer");var flushFlag=engine._finishFlushFlag;return engine._processChunk(buffer,flushFlag)}function Deflate(opts){if(!(this instanceof Deflate))return new Deflate(opts);Zlib.call(this,opts,binding.DEFLATE)}function Inflate(opts){if(!(this instanceof Inflate))return new Inflate(opts);Zlib.call(this,opts,binding.INFLATE)}function Gzip(opts){if(!(this instanceof Gzip))return new Gzip(opts);Zlib.call(this,opts,binding.GZIP)}function Gunzip(opts){if(!(this instanceof Gunzip))return new Gunzip(opts);Zlib.call(this,opts,binding.GUNZIP)}function DeflateRaw(opts){if(!(this instanceof DeflateRaw))return new DeflateRaw(opts);Zlib.call(this,opts,binding.DEFLATERAW)}function InflateRaw(opts){if(!(this instanceof InflateRaw))return new InflateRaw(opts);Zlib.call(this,opts,binding.INFLATERAW)}function Unzip(opts){if(!(this instanceof Unzip))return new Unzip(opts);Zlib.call(this,opts,binding.UNZIP)}function isValidFlushFlag(flag){return flag===binding.Z_NO_FLUSH||flag===binding.Z_PARTIAL_FLUSH||flag===binding.Z_SYNC_FLUSH||flag===binding.Z_FULL_FLUSH||flag===binding.Z_FINISH||flag===binding.Z_BLOCK}function Zlib(opts,mode){var _this=this;this._opts=opts=opts||{};this._chunkSize=opts.chunkSize||exports.Z_DEFAULT_CHUNK;Transform.call(this,opts);if(opts.flush&&!isValidFlushFlag(opts.flush)){throw new Error("Invalid flush flag: "+opts.flush)}if(opts.finishFlush&&!isValidFlushFlag(opts.finishFlush)){throw new Error("Invalid flush flag: "+opts.finishFlush)}this._flushFlag=opts.flush||binding.Z_NO_FLUSH;this._finishFlushFlag=typeof opts.finishFlush!=="undefined"?opts.finishFlush:binding.Z_FINISH;if(opts.chunkSize){if(opts.chunkSize<exports.Z_MIN_CHUNK||opts.chunkSize>exports.Z_MAX_CHUNK){throw new Error("Invalid chunk size: "+opts.chunkSize)}}if(opts.windowBits){if(opts.windowBits<exports.Z_MIN_WINDOWBITS||opts.windowBits>exports.Z_MAX_WINDOWBITS){throw new Error("Invalid windowBits: "+opts.windowBits)}}if(opts.level){if(opts.level<exports.Z_MIN_LEVEL||opts.level>exports.Z_MAX_LEVEL){throw new Error("Invalid compression level: "+opts.level)}}if(opts.memLevel){if(opts.memLevel<exports.Z_MIN_MEMLEVEL||opts.memLevel>exports.Z_MAX_MEMLEVEL){throw new Error("Invalid memLevel: "+opts.memLevel)}}if(opts.strategy){if(opts.strategy!=exports.Z_FILTERED&&opts.strategy!=exports.Z_HUFFMAN_ONLY&&opts.strategy!=exports.Z_RLE&&opts.strategy!=exports.Z_FIXED&&opts.strategy!=exports.Z_DEFAULT_STRATEGY){throw new Error("Invalid strategy: "+opts.strategy)}}if(opts.dictionary){if(!Buffer.isBuffer(opts.dictionary)){throw new Error("Invalid dictionary: it should be a Buffer instance")}}this._handle=new binding.Zlib(mode);var self=this;this._hadError=false;this._handle.onerror=function(message,errno){_close(self);self._hadError=true;var error=new Error(message);error.errno=errno;error.code=exports.codes[errno];self.emit("error",error)};var level=exports.Z_DEFAULT_COMPRESSION;if(typeof opts.level==="number")level=opts.level;var strategy=exports.Z_DEFAULT_STRATEGY;if(typeof opts.strategy==="number")strategy=opts.strategy;this._handle.init(opts.windowBits||exports.Z_DEFAULT_WINDOWBITS,level,opts.memLevel||exports.Z_DEFAULT_MEMLEVEL,strategy,opts.dictionary);this._buffer=Buffer.allocUnsafe(this._chunkSize);this._offset=0;this._level=level;this._strategy=strategy;this.once("end",this.close);Object.defineProperty(this,"_closed",{get:function(){return!_this._handle},configurable:true,enumerable:true})}util.inherits(Zlib,Transform);Zlib.prototype.params=function(level,strategy,callback){if(level<exports.Z_MIN_LEVEL||level>exports.Z_MAX_LEVEL){throw new RangeError("Invalid compression level: "+level)}if(strategy!=exports.Z_FILTERED&&strategy!=exports.Z_HUFFMAN_ONLY&&strategy!=exports.Z_RLE&&strategy!=exports.Z_FIXED&&strategy!=exports.Z_DEFAULT_STRATEGY){throw new TypeError("Invalid strategy: "+strategy)}if(this._level!==level||this._strategy!==strategy){var self=this;this.flush(binding.Z_SYNC_FLUSH,function(){assert(self._handle,"zlib binding closed");self._handle.params(level,strategy);if(!self._hadError){self._level=level;self._strategy=strategy;if(callback)callback()}})}else{process.nextTick(callback)}};Zlib.prototype.reset=function(){assert(this._handle,"zlib binding closed");return this._handle.reset()};Zlib.prototype._flush=function(callback){this._transform(Buffer.alloc(0),"",callback)};Zlib.prototype.flush=function(kind,callback){var _this2=this;var ws=this._writableState;if(typeof kind==="function"||kind===undefined&&!callback){callback=kind;kind=binding.Z_FULL_FLUSH}if(ws.ended){if(callback)process.nextTick(callback)}else if(ws.ending){if(callback)this.once("end",callback)}else if(ws.needDrain){if(callback){this.once("drain",function(){return _this2.flush(kind,callback)})}}else{this._flushFlag=kind;this.write(Buffer.alloc(0),"",callback)}};Zlib.prototype.close=function(callback){_close(this,callback);process.nextTick(emitCloseNT,this)};function _close(engine,callback){if(callback)process.nextTick(callback);if(!engine._handle)return;engine._handle.close();engine._handle=null}function emitCloseNT(self){self.emit("close")}Zlib.prototype._transform=function(chunk,encoding,cb){var flushFlag;var ws=this._writableState;var ending=ws.ending||ws.ended;var last=ending&&(!chunk||ws.length===chunk.length);if(chunk!==null&&!Buffer.isBuffer(chunk))return cb(new Error("invalid input"));if(!this._handle)return cb(new Error("zlib binding closed"));if(last)flushFlag=this._finishFlushFlag;else{flushFlag=this._flushFlag;if(chunk.length>=ws.length){this._flushFlag=this._opts.flush||binding.Z_NO_FLUSH}}this._processChunk(chunk,flushFlag,cb)};Zlib.prototype._processChunk=function(chunk,flushFlag,cb){var availInBefore=chunk&&chunk.length;var availOutBefore=this._chunkSize-this._offset;var inOff=0;var self=this;var async=typeof cb==="function";if(!async){var buffers=[];var nread=0;var error;this.on("error",function(er){error=er});assert(this._handle,"zlib binding closed");do{var res=this._handle.writeSync(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore)}while(!this._hadError&&callback(res[0],res[1]));if(this._hadError){throw error}if(nread>=kMaxLength){_close(this);throw new RangeError(kRangeErrorMessage)}var buf=Buffer.concat(buffers,nread);_close(this);return buf}assert(this._handle,"zlib binding closed");var req=this._handle.write(flushFlag,chunk,inOff,availInBefore,this._buffer,this._offset,availOutBefore);req.buffer=chunk;req.callback=callback;function callback(availInAfter,availOutAfter){if(this){this.buffer=null;this.callback=null}if(self._hadError)return;var have=availOutBefore-availOutAfter;assert(have>=0,"have should not go down");if(have>0){var out=self._buffer.slice(self._offset,self._offset+have);self._offset+=have;if(async){self.push(out)}else{buffers.push(out);nread+=out.length}}if(availOutAfter===0||self._offset>=self._chunkSize){availOutBefore=self._chunkSize;self._offset=0;self._buffer=Buffer.allocUnsafe(self._chunkSize)}if(availOutAfter===0){inOff+=availInBefore-availInAfter;availInBefore=availInAfter;if(!async)return true;var newReq=self._handle.write(flushFlag,chunk,inOff,availInBefore,self._buffer,self._offset,self._chunkSize);newReq.callback=callback;newReq.buffer=chunk;return}if(!async)return false;cb()}};util.inherits(Deflate,Zlib);util.inherits(Inflate,Zlib);util.inherits(Gzip,Zlib);util.inherits(Gunzip,Zlib);util.inherits(DeflateRaw,Zlib);util.inherits(InflateRaw,Zlib);util.inherits(Unzip,Zlib)}).call(this,require("_process"))},{"./binding":8,_process:30,assert:2,buffer:10,stream:50,util:57}],10:[function(require,module,exports){(function(Buffer){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}Object.defineProperty(Buffer.prototype,"parent",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(Buffer.prototype,"offset",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.byteOffset}});function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError('The value "'+length+'" is invalid for option "size"')}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="string"){return fromString(value,encodingOrOffset)}if(ArrayBuffer.isView(value)){return fromArrayLike(value)}if(value==null){throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var valueOf=value.valueOf&&value.valueOf();if(valueOf!=null&&valueOf!==value){return Buffer.from(valueOf,encodingOrOffset,length)}var b=fromObject(value);if(b)return b;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof value[Symbol.toPrimitive]==="function"){return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be of type number')}else if(size<0){throw new RangeError('The value "'+size+'" is invalid for option "size"')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError('"offset" is outside of buffer bounds')}if(array.byteLength<byteOffset+(length||0)){throw new RangeError('"length" is outside of buffer bounds')}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj.length!==undefined){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true&&b!==Buffer.prototype};Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array))a=Buffer.from(a,a.offset,a.byteLength);if(isInstance(b,Uint8Array))b=Buffer.from(b,b.offset,b.byteLength);if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)){buf=Buffer.from(buf)}if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof string)}var len=string.length;var mustMatch=arguments.length>2&&arguments[2]===true;if(!mustMatch&&len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase){return mustMatch?-1:utf8ToBytes(string).length}encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.toLocaleString=Buffer.prototype.toString;Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();if(this.length>max)str+=" ... ";return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)){target=Buffer.from(target,target.offset,target.byteLength)}if(!Buffer.isBuffer(target)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof target)}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(this===target&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(targetStart,start,end)}else if(this===target&&start<targetStart&&targetStart<end){for(var i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}if(val.length===1){var code=val.charCodeAt(0);if(encoding==="utf8"&&code<128||encoding==="latin1"){val=code}}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding);var len=bytes.length;if(len===0){throw new TypeError('The value "'+val+'" is invalid for argument "value"')}for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=str.split("=")[0];str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isInstance(obj,type){return obj instanceof type||obj!=null&&obj.constructor!=null&&obj.constructor.name!=null&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}}).call(this,require("buffer").Buffer)},{"base64-js":6,buffer:10,ieee754:13}],11:[function(require,module,exports){(function(Buffer){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=Buffer.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,{isBuffer:require("../../is-buffer/index.js")})},{"../../is-buffer/index.js":15}],12:[function(require,module,exports){var objectCreate=Object.create||objectCreatePolyfill;var objectKeys=Object.keys||objectKeysPolyfill;var bind=Function.prototype.bind||functionBindPolyfill;function EventEmitter(){if(!this._events||!Object.prototype.hasOwnProperty.call(this,"_events")){this._events=objectCreate(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;var hasDefineProperty;try{var o={};if(Object.defineProperty)Object.defineProperty(o,"x",{value:0});hasDefineProperty=o.x===0}catch(err){hasDefineProperty=false}if(hasDefineProperty){Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function(){return defaultMaxListeners},set:function(arg){if(typeof arg!=="number"||arg<0||arg!==arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}})}else{EventEmitter.defaultMaxListeners=defaultMaxListeners}EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');this._maxListeners=n;return this};function $getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)};function emitNone(handler,isFn,self){if(isFn)handler.call(self);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self)}}function emitOne(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1)}}function emitTwo(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}}function emitThree(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}}function emitMany(handler,isFn,self,args){if(isFn)handler.apply(self,args);else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)listeners[i].apply(self,args)}}EventEmitter.prototype.emit=function emit(type){var er,handler,len,args,i,events;var doError=type==="error";events=this._events;if(events)doError=doError&&events.error==null;else if(!doError)return false;if(doError){if(arguments.length>1)er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Unhandled "error" event. ('+er+")");err.context=er;throw err}return false}handler=events[type];if(!handler)return false;var isFn=typeof handler==="function";len=arguments.length;switch(len){case 1:emitNone(handler,isFn,this);break;case 2:emitOne(handler,isFn,this,arguments[1]);break;case 3:emitTwo(handler,isFn,this,arguments[1],arguments[2]);break;case 4:emitThree(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];emitMany(handler,isFn,this,args)}return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=target._events;if(!events){events=target._events=objectCreate(null);target._eventsCount=0}else{if(events.newListener){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(!existing){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else{if(prepend){existing.unshift(listener)}else{existing.push(listener)}}if(!existing.warned){m=$getMaxListeners(target);if(m&&m>0&&existing.length>m){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners '+"added. Use emitter.setMaxListeners() to "+"increase limit.");w.name="MaxListenersExceededWarning";w.emitter=target;w.type=type;w.count=existing.length;if(typeof console==="object"&&console.warn){console.warn("%s: %s",w.name,w.message)}}}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;switch(arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:var args=new Array(arguments.length);for(var i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=bind.call(onceWrapper,state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}EventEmitter.prototype.once=function once(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;if(typeof listener!=="function")throw new TypeError('"listener" argument must be a function');events=this._events;if(!events)return this;list=events[type];if(!list)return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)this._events=objectCreate(null);else{delete events[type];if(events.removeListener)this.emit("removeListener",type,list.listener||listener)}}else if(typeof list!=="function"){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0)return this;if(position===0)list.shift();else spliceOne(list,position);if(list.length===1)events[type]=list[0];if(events.removeListener)this.emit("removeListener",type,originalListener||listener)}return this};EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(!events)return this;if(!events.removeListener){if(arguments.length===0){this._events=objectCreate(null);this._eventsCount=0}else if(events[type]){if(--this._eventsCount===0)this._events=objectCreate(null);else delete events[type]}return this}if(arguments.length===0){var keys=objectKeys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=objectCreate(null);this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else if(listeners){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}return this};function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];if(!evlistener)return[];if(typeof evlistener==="function")return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else if(evlistener){return evlistener.length}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function spliceOne(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i)copy[i]=arr[i];return copy}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}return ret}function objectCreatePolyfill(proto){var F=function(){};F.prototype=proto;return new F}function objectKeysPolyfill(obj){var keys=[];for(var k in obj)if(Object.prototype.hasOwnProperty.call(obj,k)){keys.push(k)}return k}function functionBindPolyfill(context){var fn=this;return function(){return fn.apply(context,arguments)}}},{}],13:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],14:[function(require,module,exports){arguments[4][3][0].apply(exports,arguments)},{dup:3}],15:[function(require,module,exports){module.exports=function(obj){return obj!=null&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&typeof obj.constructor.isBuffer==="function"&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return typeof obj.readFloatLE==="function"&&typeof obj.slice==="function"&&isBuffer(obj.slice(0,0))}},{}],16:[function(require,module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},{}],17:[function(require,module,exports){"use strict";var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";function _has(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)}exports.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=="object"){throw new TypeError(source+"must be non-object")}for(var p in source){if(_has(source,p)){obj[p]=source[p]}}}return obj};exports.shrinkBuf=function(buf,size){if(buf.length===size){return buf}if(buf.subarray){return buf.subarray(0,size)}buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){var i,l,len,pos,chunk,result;len=0;for(i=0,l=chunks.length;i<l;i++){len+=chunks[i].length}result=new Uint8Array(len);pos=0;for(i=0,l=chunks.length;i<l;i++){chunk=chunks[i];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i=0;i<len;i++){dest[dest_offs+i]=src[src_offs+i]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports.setTyped=function(on){if(on){exports.Buf8=Uint8Array;exports.Buf16=Uint16Array;exports.Buf32=Int32Array;exports.assign(exports,fnTyped)}else{exports.Buf8=Array;exports.Buf16=Array;exports.Buf32=Array;exports.assign(exports,fnUntyped)}};exports.setTyped(TYPED_OK)},{}],18:[function(require,module,exports){"use strict";function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module.exports=adler32},{}],19:[function(require,module,exports){"use strict";module.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],20:[function(require,module,exports){"use strict";function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t=crcTable,end=pos+len;crc^=-1;for(var i=pos;i<end;i++){crc=crc>>>8^t[(crc^buf[i])&255]}return crc^-1}module.exports=crc32},{}],21:[function(require,module,exports){"use strict";var utils=require("../utils/common");var trees=require("./trees");var adler32=require("./adler32");var crc32=require("./crc32");var msg=require("./messages");var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;var Z_OK=0;var Z_STREAM_END=1;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_BUF_ERROR=-5;var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=4;var Z_DEFAULT_STRATEGY=0;var Z_UNKNOWN=2;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=MAX_MATCH+MIN_MATCH+1;var PRESET_DICT=32;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=3;function err(strm,errorCode){strm.msg=msg[errorCode];return errorCode}function rank(f){return(f<<1)-(f>4?9:0)}function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}function flush_pending(strm){var s=strm.state;var len=s.pending;if(len>strm.avail_out){len=strm.avail_out}if(len===0){return}utils.arraySet(strm.output,s.pending_buf,s.pending_out,len,strm.next_out);strm.next_out+=len;s.pending_out+=len;strm.total_out+=len;strm.avail_out-=len;s.pending-=len;if(s.pending===0){s.pending_out=0}}function flush_block_only(s,last){trees._tr_flush_block(s,s.block_start>=0?s.block_start:-1,s.strstart-s.block_start,last);s.block_start=s.strstart;flush_pending(s.strm)}function put_byte(s,b){s.pending_buf[s.pending++]=b}function putShortMSB(s,b){s.pending_buf[s.pending++]=b>>>8&255;s.pending_buf[s.pending++]=b&255}function read_buf(strm,buf,start,size){var len=strm.avail_in;if(len>size){len=size}if(len===0){return 0}strm.avail_in-=len;utils.arraySet(buf,strm.input,strm.next_in,len,start);if(strm.state.wrap===1){strm.adler=adler32(strm.adler,buf,len,start)}else if(strm.state.wrap===2){strm.adler=crc32(strm.adler,buf,len,start)}strm.next_in+=len;strm.total_in+=len;return len}function longest_match(s,cur_match){var chain_length=s.max_chain_length;var scan=s.strstart;var match;var len;var best_len=s.prev_length;var nice_match=s.nice_match;var limit=s.strstart>s.w_size-MIN_LOOKAHEAD?s.strstart-(s.w_size-MIN_LOOKAHEAD):0;var _win=s.window;var wmask=s.w_mask;var prev=s.prev;var strend=s.strstart+MAX_MATCH;var scan_end1=_win[scan+best_len-1];var scan_end=_win[scan+best_len];if(s.prev_length>=s.good_match){chain_length>>=2}if(nice_match>s.lookahead){nice_match=s.lookahead}do{match=cur_match;if(_win[match+best_len]!==scan_end||_win[match+best_len-1]!==scan_end1||_win[match]!==_win[scan]||_win[++match]!==_win[scan+1]){continue}scan+=2;match++;do{}while(_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&_win[++scan]===_win[++match]&&scan<strend);len=MAX_MATCH-(strend-scan);scan=strend-MAX_MATCH;if(len>best_len){s.match_start=cur_match;best_len=len;if(len>=nice_match){break}scan_end1=_win[scan+best_len-1];scan_end=_win[scan+best_len]}}while((cur_match=prev[cur_match&wmask])>limit&&--chain_length!==0);if(best_len<=s.lookahead){return best_len}return s.lookahead}function fill_window(s){var _w_size=s.w_size;var p,n,m,more,str;do{more=s.window_size-s.lookahead-s.strstart;if(s.strstart>=_w_size+(_w_size-MIN_LOOKAHEAD)){utils.arraySet(s.window,s.window,_w_size,_w_size,0);s.match_start-=_w_size;s.strstart-=_w_size;s.block_start-=_w_size;n=s.hash_size;p=n;do{m=s.head[--p];s.head[p]=m>=_w_size?m-_w_size:0}while(--n);n=_w_size;p=n;do{m=s.prev[--p];s.prev[p]=m>=_w_size?m-_w_size:0}while(--n);more+=_w_size}if(s.strm.avail_in===0){break}n=read_buf(s.strm,s.window,s.strstart+s.lookahead,more);s.lookahead+=n;if(s.lookahead+s.insert>=MIN_MATCH){str=s.strstart-s.insert;s.ins_h=s.window[str];s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+1])&s.hash_mask;while(s.insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++;s.insert--;if(s.lookahead+s.insert<MIN_MATCH){break}}}}while(s.lookahead<MIN_LOOKAHEAD&&s.strm.avail_in!==0)}function deflate_stored(s,flush){var max_block_size=65535;if(max_block_size>s.pending_buf_size-5){max_block_size=s.pending_buf_size-5}for(;;){if(s.lookahead<=1){fill_window(s);if(s.lookahead===0&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.strstart+=s.lookahead;s.lookahead=0;var max_start=s.block_start+max_block_size;if(s.strstart===0||s.strstart>=max_start){s.lookahead=s.strstart-max_start;s.strstart=max_start;flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}if(s.strstart-s.block_start>=s.w_size-MIN_LOOKAHEAD){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.strstart>s.block_start){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_NEED_MORE}function deflate_fast(s,flush){var hash_head;var bflush;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}if(hash_head!==0&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head)}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,s.strstart-s.match_start,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;if(s.match_length<=s.max_lazy_match&&s.lookahead>=MIN_MATCH){s.match_length--;do{s.strstart++;s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}while(--s.match_length!==0);s.strstart++}else{s.strstart+=s.match_length;s.match_length=0;s.ins_h=s.window[s.strstart];s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+1])&s.hash_mask}}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_slow(s,flush){var hash_head;var bflush;var max_insert;for(;;){if(s.lookahead<MIN_LOOKAHEAD){fill_window(s);if(s.lookahead<MIN_LOOKAHEAD&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}hash_head=0;if(s.lookahead>=MIN_MATCH){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}s.prev_length=s.match_length;s.prev_match=s.match_start;s.match_length=MIN_MATCH-1;if(hash_head!==0&&s.prev_length<s.max_lazy_match&&s.strstart-hash_head<=s.w_size-MIN_LOOKAHEAD){s.match_length=longest_match(s,hash_head);if(s.match_length<=5&&(s.strategy===Z_FILTERED||s.match_length===MIN_MATCH&&s.strstart-s.match_start>4096)){s.match_length=MIN_MATCH-1}}if(s.prev_length>=MIN_MATCH&&s.match_length<=s.prev_length){max_insert=s.strstart+s.lookahead-MIN_MATCH;bflush=trees._tr_tally(s,s.strstart-1-s.prev_match,s.prev_length-MIN_MATCH);s.lookahead-=s.prev_length-1;s.prev_length-=2;do{if(++s.strstart<=max_insert){s.ins_h=(s.ins_h<<s.hash_shift^s.window[s.strstart+MIN_MATCH-1])&s.hash_mask;hash_head=s.prev[s.strstart&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=s.strstart}}while(--s.prev_length!==0);s.match_available=0;s.match_length=MIN_MATCH-1;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}else if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);if(bflush){flush_block_only(s,false)}s.strstart++;s.lookahead--;if(s.strm.avail_out===0){return BS_NEED_MORE}}else{s.match_available=1;s.strstart++;s.lookahead--}}if(s.match_available){bflush=trees._tr_tally(s,0,s.window[s.strstart-1]);s.match_available=0}s.insert=s.strstart<MIN_MATCH-1?s.strstart:MIN_MATCH-1;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_rle(s,flush){var bflush;var prev;var scan,strend;var _win=s.window;for(;;){if(s.lookahead<=MAX_MATCH){fill_window(s);if(s.lookahead<=MAX_MATCH&&flush===Z_NO_FLUSH){return BS_NEED_MORE}if(s.lookahead===0){break}}s.match_length=0;if(s.lookahead>=MIN_MATCH&&s.strstart>0){scan=s.strstart-1;prev=_win[scan];if(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]){strend=s.strstart+MAX_MATCH;do{}while(prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&prev===_win[++scan]&&scan<strend);s.match_length=MAX_MATCH-(strend-scan);if(s.match_length>s.lookahead){s.match_length=s.lookahead}}}if(s.match_length>=MIN_MATCH){bflush=trees._tr_tally(s,1,s.match_length-MIN_MATCH);s.lookahead-=s.match_length;s.strstart+=s.match_length;s.match_length=0}else{bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++}if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_huff(s,flush){var bflush;for(;;){if(s.lookahead===0){fill_window(s);if(s.lookahead===0){if(flush===Z_NO_FLUSH){return BS_NEED_MORE}break}}s.match_length=0;bflush=trees._tr_tally(s,0,s.window[s.strstart]);s.lookahead--;s.strstart++;if(bflush){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}}s.insert=0;if(flush===Z_FINISH){flush_block_only(s,true);if(s.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(s.last_lit){flush_block_only(s,false);if(s.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function Config(good_length,max_lazy,nice_length,max_chain,func){this.good_length=good_length;this.max_lazy=max_lazy;this.nice_length=nice_length;this.max_chain=max_chain;this.func=func}var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(s){s.window_size=2*s.w_size;zero(s.head);s.max_lazy_match=configuration_table[s.level].max_lazy;s.good_match=configuration_table[s.level].good_length;s.nice_match=configuration_table[s.level].nice_length;s.max_chain_length=configuration_table[s.level].max_chain;s.strstart=0;s.block_start=0;s.lookahead=0;s.insert=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;s.ins_h=0}function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new utils.Buf16(MAX_BITS+1);this.heap=new utils.Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new utils.Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function deflateResetKeep(strm){var s;if(!strm||!strm.state){return err(strm,Z_STREAM_ERROR)}strm.total_in=strm.total_out=0;strm.data_type=Z_UNKNOWN;s=strm.state;s.pending=0;s.pending_out=0;if(s.wrap<0){s.wrap=-s.wrap}s.status=s.wrap?INIT_STATE:BUSY_STATE;strm.adler=s.wrap===2?0:1;s.last_flush=Z_NO_FLUSH;trees._tr_init(s);return Z_OK}function deflateReset(strm){var ret=deflateResetKeep(strm);if(ret===Z_OK){lm_init(strm.state)}return ret}function deflateSetHeader(strm,head){if(!strm||!strm.state){return Z_STREAM_ERROR}if(strm.state.wrap!==2){return Z_STREAM_ERROR}strm.state.gzhead=head;return Z_OK}function deflateInit2(strm,level,method,windowBits,memLevel,strategy){if(!strm){return Z_STREAM_ERROR}var wrap=1;if(level===Z_DEFAULT_COMPRESSION){level=6}if(windowBits<0){wrap=0;windowBits=-windowBits}else if(windowBits>15){wrap=2;windowBits-=16}if(memLevel<1||memLevel>MAX_MEM_LEVEL||method!==Z_DEFLATED||windowBits<8||windowBits>15||level<0||level>9||strategy<0||strategy>Z_FIXED){return err(strm,Z_STREAM_ERROR)}if(windowBits===8){windowBits=9}var s=new DeflateState;strm.state=s;s.strm=strm;s.wrap=wrap;s.gzhead=null;s.w_bits=windowBits;s.w_size=1<<s.w_bits;s.w_mask=s.w_size-1;s.hash_bits=memLevel+7;s.hash_size=1<<s.hash_bits;s.hash_mask=s.hash_size-1;s.hash_shift=~~((s.hash_bits+MIN_MATCH-1)/MIN_MATCH);s.window=new utils.Buf8(s.w_size*2);s.head=new utils.Buf16(s.hash_size);s.prev=new utils.Buf16(s.w_size);s.lit_bufsize=1<<memLevel+6;s.pending_buf_size=s.lit_bufsize*4;s.pending_buf=new utils.Buf8(s.pending_buf_size);s.d_buf=1*s.lit_bufsize;s.l_buf=(1+2)*s.lit_bufsize;s.level=level;s.strategy=strategy;s.method=method;return deflateReset(strm)}function deflateInit(strm,level){return deflateInit2(strm,level,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(strm,flush){var old_flush,s;var beg,val;if(!strm||!strm.state||flush>Z_BLOCK||flush<0){return strm?err(strm,Z_STREAM_ERROR):Z_STREAM_ERROR}s=strm.state;if(!strm.output||!strm.input&&strm.avail_in!==0||s.status===FINISH_STATE&&flush!==Z_FINISH){return err(strm,strm.avail_out===0?Z_BUF_ERROR:Z_STREAM_ERROR)}s.strm=strm;old_flush=s.last_flush;s.last_flush=flush;if(s.status===INIT_STATE){if(s.wrap===2){strm.adler=0;put_byte(s,31);put_byte(s,139);put_byte(s,8);if(!s.gzhead){put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,0);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,OS_CODE);s.status=BUSY_STATE}else{put_byte(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(!s.gzhead.extra?0:4)+(!s.gzhead.name?0:8)+(!s.gzhead.comment?0:16));put_byte(s,s.gzhead.time&255);put_byte(s,s.gzhead.time>>8&255);put_byte(s,s.gzhead.time>>16&255);put_byte(s,s.gzhead.time>>24&255);put_byte(s,s.level===9?2:s.strategy>=Z_HUFFMAN_ONLY||s.level<2?4:0);put_byte(s,s.gzhead.os&255);if(s.gzhead.extra&&s.gzhead.extra.length){put_byte(s,s.gzhead.extra.length&255);put_byte(s,s.gzhead.extra.length>>8&255)}if(s.gzhead.hcrc){strm.adler=crc32(strm.adler,s.pending_buf,s.pending,0)}s.gzindex=0;s.status=EXTRA_STATE}}else{var header=Z_DEFLATED+(s.w_bits-8<<4)<<8;var level_flags=-1;if(s.strategy>=Z_HUFFMAN_ONLY||s.level<2){level_flags=0}else if(s.level<6){level_flags=1}else if(s.level===6){level_flags=2}else{level_flags=3}header|=level_flags<<6;if(s.strstart!==0){header|=PRESET_DICT}header+=31-header%31;s.status=BUSY_STATE;putShortMSB(s,header);if(s.strstart!==0){putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}strm.adler=1}}if(s.status===EXTRA_STATE){if(s.gzhead.extra){beg=s.pending;while(s.gzindex<(s.gzhead.extra.length&65535)){if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){break}}put_byte(s,s.gzhead.extra[s.gzindex]&255);s.gzindex++}if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(s.gzindex===s.gzhead.extra.length){s.gzindex=0;s.status=NAME_STATE}}else{s.status=NAME_STATE}}if(s.status===NAME_STATE){if(s.gzhead.name){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.name.length){val=s.gzhead.name.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.gzindex=0;s.status=COMMENT_STATE}}else{s.status=COMMENT_STATE}}if(s.status===COMMENT_STATE){if(s.gzhead.comment){beg=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}flush_pending(strm);beg=s.pending;if(s.pending===s.pending_buf_size){val=1;break}}if(s.gzindex<s.gzhead.comment.length){val=s.gzhead.comment.charCodeAt(s.gzindex++)&255}else{val=0}put_byte(s,val)}while(val!==0);if(s.gzhead.hcrc&&s.pending>beg){strm.adler=crc32(strm.adler,s.pending_buf,s.pending-beg,beg)}if(val===0){s.status=HCRC_STATE}}else{s.status=HCRC_STATE}}if(s.status===HCRC_STATE){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size){flush_pending(strm)}if(s.pending+2<=s.pending_buf_size){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);strm.adler=0;s.status=BUSY_STATE}}else{s.status=BUSY_STATE}}if(s.pending!==0){flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}else if(strm.avail_in===0&&rank(flush)<=rank(old_flush)&&flush!==Z_FINISH){return err(strm,Z_BUF_ERROR)}if(s.status===FINISH_STATE&&strm.avail_in!==0){return err(strm,Z_BUF_ERROR)}if(strm.avail_in!==0||s.lookahead!==0||flush!==Z_NO_FLUSH&&s.status!==FINISH_STATE){var bstate=s.strategy===Z_HUFFMAN_ONLY?deflate_huff(s,flush):s.strategy===Z_RLE?deflate_rle(s,flush):configuration_table[s.level].func(s,flush);if(bstate===BS_FINISH_STARTED||bstate===BS_FINISH_DONE){s.status=FINISH_STATE}if(bstate===BS_NEED_MORE||bstate===BS_FINISH_STARTED){if(strm.avail_out===0){s.last_flush=-1}return Z_OK}if(bstate===BS_BLOCK_DONE){if(flush===Z_PARTIAL_FLUSH){trees._tr_align(s)}else if(flush!==Z_BLOCK){trees._tr_stored_block(s,0,0,false);if(flush===Z_FULL_FLUSH){zero(s.head);if(s.lookahead===0){s.strstart=0;s.block_start=0;s.insert=0}}}flush_pending(strm);if(strm.avail_out===0){s.last_flush=-1;return Z_OK}}}if(flush!==Z_FINISH){return Z_OK}if(s.wrap<=0){return Z_STREAM_END}if(s.wrap===2){put_byte(s,strm.adler&255);put_byte(s,strm.adler>>8&255);put_byte(s,strm.adler>>16&255);put_byte(s,strm.adler>>24&255);put_byte(s,strm.total_in&255);put_byte(s,strm.total_in>>8&255);put_byte(s,strm.total_in>>16&255);put_byte(s,strm.total_in>>24&255)}else{putShortMSB(s,strm.adler>>>16);putShortMSB(s,strm.adler&65535)}flush_pending(strm);if(s.wrap>0){s.wrap=-s.wrap}return s.pending!==0?Z_OK:Z_STREAM_END}function deflateEnd(strm){var status;if(!strm||!strm.state){return Z_STREAM_ERROR}status=strm.state.status;if(status!==INIT_STATE&&status!==EXTRA_STATE&&status!==NAME_STATE&&status!==COMMENT_STATE&&status!==HCRC_STATE&&status!==BUSY_STATE&&status!==FINISH_STATE){return err(strm,Z_STREAM_ERROR)}strm.state=null;return status===BUSY_STATE?err(strm,Z_DATA_ERROR):Z_OK}function deflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var s;var str,n;var wrap;var avail;var next;var input;var tmpDict;if(!strm||!strm.state){return Z_STREAM_ERROR}s=strm.state;wrap=s.wrap;if(wrap===2||wrap===1&&s.status!==INIT_STATE||s.lookahead){return Z_STREAM_ERROR}if(wrap===1){strm.adler=adler32(strm.adler,dictionary,dictLength,0)}s.wrap=0;if(dictLength>=s.w_size){if(wrap===0){zero(s.head);s.strstart=0;s.block_start=0;s.insert=0}tmpDict=new utils.Buf8(s.w_size);utils.arraySet(tmpDict,dictionary,dictLength-s.w_size,s.w_size,0);dictionary=tmpDict;dictLength=s.w_size}avail=strm.avail_in;next=strm.next_in;input=strm.input;strm.avail_in=dictLength;strm.next_in=0;strm.input=dictionary;fill_window(s);while(s.lookahead>=MIN_MATCH){str=s.strstart;n=s.lookahead-(MIN_MATCH-1);do{s.ins_h=(s.ins_h<<s.hash_shift^s.window[str+MIN_MATCH-1])&s.hash_mask;s.prev[str&s.w_mask]=s.head[s.ins_h];s.head[s.ins_h]=str;str++}while(--n);s.strstart=str;s.lookahead=MIN_MATCH-1;fill_window(s)}s.strstart+=s.lookahead;s.block_start=s.strstart;s.insert=s.lookahead;s.lookahead=0;s.match_length=s.prev_length=MIN_MATCH-1;s.match_available=0;strm.next_in=next;strm.input=input;strm.avail_in=avail;s.wrap=wrap;return Z_OK}exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateSetDictionary=deflateSetDictionary;exports.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":17,"./adler32":18,"./crc32":20,"./messages":25,"./trees":26}],22:[function(require,module,exports){"use strict";var BAD=30;var TYPE=12;module.exports=function inflate_fast(strm,start){var state;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state.dmax;wsize=state.wsize;whave=state.whave;wnext=state.wnext;s_window=state.window;hold=state.hold;bits=state.bits;lcode=state.lencode;dcode=state.distcode;lmask=(1<<state.lenbits)-1;dmask=(1<<state.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break top}}from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state.mode=BAD;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state.hold=hold;state.bits=bits;return}},{}],23:[function(require,module,exports){"use strict";var utils=require("../utils/common");var adler32=require("./adler32");var crc32=require("./crc32");var inflate_fast=require("./inffast");var inflate_table=require("./inftrees");var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;strm.total_in=strm.total_out=state.total=0;strm.msg="";if(state.wrap){strm.adler=state.wrap&1}state.mode=HEAD;state.last=0;state.havedict=0;state.dmax=32768;state.head=null;state.hold=0;state.bits=0;state.lencode=state.lendyn=new utils.Buf32(ENOUGH_LENS);state.distcode=state.distdyn=new utils.Buf32(ENOUGH_DISTS);state.sane=1;state.back=-1;return Z_OK}function inflateReset(strm){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;state.wsize=0;state.whave=0;state.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state.window!==null&&state.wbits!==windowBits){state.window=null}state.wrap=wrap;state.wbits=windowBits;return inflateReset(strm)}function inflateInit2(strm,windowBits){var ret;var state;if(!strm){return Z_STREAM_ERROR}state=new InflateState;strm.state=state;state.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state.lens[sym++]=8}while(sym<256){state.lens[sym++]=9}while(sym<280){state.lens[sym++]=7}while(sym<288){state.lens[sym++]=8}inflate_table(LENS,state.lens,0,288,lenfix,0,state.work,{bits:9});sym=0;while(sym<32){state.lens[sym++]=5}inflate_table(DISTS,state.lens,0,32,distfix,0,state.work,{bits:5});virgin=false}state.lencode=lenfix;state.lenbits=9;state.distcode=distfix;state.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state=strm.state;if(state.window===null){state.wsize=1<<state.wbits;state.wnext=0;state.whave=0;state.window=new utils.Buf8(state.wsize)}if(copy>=state.wsize){utils.arraySet(state.window,src,end-state.wsize,state.wsize,0);state.wnext=0;state.whave=state.wsize}else{dist=state.wsize-state.wnext;if(dist>copy){dist=copy}utils.arraySet(state.window,src,end-copy,dist,state.wnext);copy-=dist;if(copy){utils.arraySet(state.window,src,end-copy,copy,0);state.wnext=copy;state.whave=state.wsize}else{state.wnext+=dist;if(state.wnext===state.wsize){state.wnext=0}if(state.whave<state.wsize){state.whave+=dist}}}return 0}function inflate(strm,flush){var state;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR}state=strm.state;if(state.mode===TYPE){state.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state.mode){case HEAD:if(state.wrap===0){state.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.wrap&2&&hold===35615){state.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0);hold=0;bits=0;state.mode=FLAGS;break}state.flags=0;if(state.head){state.head.done=false}if(!(state.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state.wbits===0){state.wbits=len}else if(len>state.wbits){strm.msg="invalid window size";state.mode=BAD;break}state.dmax=1<<len;strm.adler=state.check=1;state.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.flags=hold;if((state.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state.mode=BAD;break}if(state.flags&57344){strm.msg="unknown header flags set";state.mode=BAD;break}if(state.head){state.head.text=hold>>8&1}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.time=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state.check=crc32(state.check,hbuf,4,0)}hold=0;bits=0;state.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state.head){state.head.xflags=hold&255;state.head.os=hold>>8}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0;state.mode=EXLEN;case EXLEN:if(state.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length=hold;if(state.head){state.head.extra_len=hold}if(state.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state.check=crc32(state.check,hbuf,2,0)}hold=0;bits=0}else if(state.head){state.head.extra=null}state.mode=EXTRA;case EXTRA:if(state.flags&1024){copy=state.length;if(copy>have){copy=have}if(copy){if(state.head){len=state.head.extra_len-state.length;if(!state.head.extra){state.head.extra=new Array(state.head.extra_len)}utils.arraySet(state.head.extra,input,next,copy,len)}if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;state.length-=copy}if(state.length){break inf_leave}}state.length=0;state.mode=NAME;case NAME:if(state.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.name=null}state.length=0;state.mode=COMMENT;case COMMENT:if(state.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state.head&&len&&state.length<65536){state.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state.flags&512){state.check=crc32(state.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state.head){state.head.comment=null}state.mode=HCRC;case HCRC:if(state.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.check&65535)){strm.msg="header crc mismatch";state.mode=BAD;break}hold=0;bits=0}if(state.head){state.head.hcrc=state.flags>>9&1;state.head.done=true}strm.adler=state.check=0;state.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state.check=zswap32(hold);hold=0;bits=0;state.mode=DICT;case DICT:if(state.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;return Z_NEED_DICT}strm.adler=state.check=1;state.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}case TYPEDO:if(state.last){hold>>>=bits&7;bits-=bits&7;state.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state.mode=STORED;break;case 1:fixedtables(state);state.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state.mode=TABLE;break;case 3:strm.msg="invalid block type";state.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state.mode=BAD;break}state.length=hold&65535;hold=0;bits=0;state.mode=COPY_;if(flush===Z_TREES){break inf_leave}case COPY_:state.mode=COPY;case COPY:copy=state.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state.length-=copy;break}state.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.nlen=(hold&31)+257;hold>>>=5;bits-=5;state.ndist=(hold&31)+1;hold>>>=5;bits-=5;state.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state.nlen>286||state.ndist>30){strm.msg="too many length or distance symbols";state.mode=BAD;break}state.have=0;state.mode=LENLENS;case LENLENS:while(state.have<state.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.lens[order[state.have++]]=hold&7;hold>>>=3;bits-=3}while(state.have<19){state.lens[order[state.have++]]=0}state.lencode=state.lendyn;state.lenbits=7;opts={bits:state.lenbits};ret=inflate_table(CODES,state.lens,0,19,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state.mode=BAD;break}state.have=0;state.mode=CODELENS;case CODELENS:while(state.have<state.nlen+state.ndist){for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state.lens[state.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state.have===0){strm.msg="invalid bit length repeat";state.mode=BAD;break}len=state.lens[state.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state.have+copy>state.nlen+state.ndist){strm.msg="invalid bit length repeat";state.mode=BAD;break}while(copy--){state.lens[state.have++]=len}}}if(state.mode===BAD){break}if(state.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state.mode=BAD;break}state.lenbits=9;opts={bits:state.lenbits};ret=inflate_table(LENS,state.lens,0,state.nlen,state.lencode,0,state.work,opts);state.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state.mode=BAD;break}state.distbits=6;state.distcode=state.distdyn;opts={bits:state.distbits};ret=inflate_table(DISTS,state.lens,state.nlen,state.ndist,state.distcode,0,state.work,opts);state.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state.mode=BAD;break}state.mode=LEN_;if(flush===Z_TREES){break inf_leave}case LEN_:state.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state.hold;bits=state.bits;if(state.mode===TYPE){state.back=-1}break}state.back=0;for(;;){here=state.lencode[hold&(1<<state.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;state.length=here_val;if(here_op===0){state.mode=LIT;break}if(here_op&32){state.back=-1;state.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state.mode=BAD;break}state.extra=here_op&15;state.mode=LENEXT;case LENEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.length+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}state.was=state.length;state.mode=DIST;case DIST:for(;;){here=state.distcode[hold&(1<<state.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state.mode=BAD;break}state.offset=here_val;state.extra=here_op&15;state.mode=DISTEXT;case DISTEXT:if(state.extra){n=state.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state.offset+=hold&(1<<state.extra)-1;hold>>>=state.extra;bits-=state.extra;state.back+=state.extra}if(state.offset>state.dmax){strm.msg="invalid distance too far back";state.mode=BAD;break}state.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state.offset>copy){copy=state.offset-copy;if(copy>state.whave){if(state.sane){strm.msg="invalid distance too far back";state.mode=BAD;break}}if(copy>state.wnext){copy-=state.wnext;from=state.wsize-copy}else{from=state.wnext-copy}if(copy>state.length){copy=state.length}from_source=state.window}else{from_source=output;from=put-state.offset;copy=state.length}if(copy>left){copy=left}left-=copy;state.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state.length===0){state.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state.length;left--;state.mode=LEN;break;case CHECK:if(state.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state.total+=_out;if(_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,put-_out):adler32(state.check,output,_out,put-_out)}_out=left;if((state.flags?hold:zswap32(hold))!==state.check){strm.msg="incorrect data check";state.mode=BAD;break}hold=0;bits=0}state.mode=LENGTH;case LENGTH:if(state.wrap&&state.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state.total&4294967295)){strm.msg="incorrect length check";state.mode=BAD;break}hold=0;bits=0}state.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state.hold=hold;state.bits=bits;if(state.wsize||_out!==strm.avail_out&&state.mode<BAD&&(state.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state.mode=MEM;return Z_MEM_ERROR}}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state.total+=_out;if(state.wrap&&_out){strm.adler=state.check=state.flags?crc32(state.check,output,_out,strm.next_out-_out):adler32(state.check,output,_out,strm.next_out-_out)}strm.data_type=state.bits+(state.last?64:0)+(state.mode===TYPE?128:0)+(state.mode===LEN_||state.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}return ret}function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}var state=strm.state;if(state.window){state.window=null}strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if((state.wrap&2)===0){return Z_STREAM_ERROR}state.head=head;head.done=false;return Z_OK}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state;var dictid;var ret;if(!strm||!strm.state){return Z_STREAM_ERROR}state=strm.state;if(state.wrap!==0&&state.mode!==DICT){return Z_STREAM_ERROR}if(state.mode===DICT){dictid=1;dictid=adler32(dictid,dictionary,dictLength,0);if(dictid!==state.check){return Z_DATA_ERROR}}ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state.mode=MEM;return Z_MEM_ERROR}state.havedict=1;return Z_OK}exports.inflateReset=inflateReset;exports.inflateReset2=inflateReset2;exports.inflateResetKeep=inflateResetKeep;exports.inflateInit=inflateInit;exports.inflateInit2=inflateInit2;exports.inflate=inflate;exports.inflateEnd=inflateEnd;exports.inflateGetHeader=inflateGetHeader;exports.inflateSetDictionary=inflateSetDictionary;exports.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":17,"./adler32":18,"./crc32":20,"./inffast":22,"./inftrees":24}],24:[function(require,module,exports){"use strict";var utils=require("../utils/common");var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}for(;;){here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0}},{"../utils/common":17}],25:[function(require,module,exports){"use strict";module.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],26:[function(require,module,exports){"use strict";var utils=require("../utils/common");var Z_FIXED=4;var Z_BINARY=0;var Z_TEXT=1;var Z_UNKNOWN=2;function zero(buf){var len=buf.length;while(--len>=0){buf[len]=0}}var STORED_BLOCK=0;var STATIC_TREES=1;var DYN_TREES=2;var MIN_MATCH=3;var MAX_MATCH=258;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var Buf_size=16;var MAX_BL_BITS=7;var END_BLOCK=256;var REP_3_6=16;var REPZ_3_10=17;var REPZ_11_138=18;var extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0];var extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7];var bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var DIST_CODE_LEN=512;var static_ltree=new Array((L_CODES+2)*2);zero(static_ltree);var static_dtree=new Array(D_CODES*2);zero(static_dtree);var _dist_code=new Array(DIST_CODE_LEN);zero(_dist_code);var _length_code=new Array(MAX_MATCH-MIN_MATCH+1);zero(_length_code);var base_length=new Array(LENGTH_CODES);zero(base_length);var base_dist=new Array(D_CODES);zero(base_dist);function StaticTreeDesc(static_tree,extra_bits,extra_base,elems,max_length){this.static_tree=static_tree;this.extra_bits=extra_bits;this.extra_base=extra_base;this.elems=elems;this.max_length=max_length;this.has_stree=static_tree&&static_tree.length}var static_l_desc;var static_d_desc;var static_bl_desc;function TreeDesc(dyn_tree,stat_desc){this.dyn_tree=dyn_tree;this.max_code=0;this.stat_desc=stat_desc}function d_code(dist){return dist<256?_dist_code[dist]:_dist_code[256+(dist>>>7)]}function put_short(s,w){s.pending_buf[s.pending++]=w&255;s.pending_buf[s.pending++]=w>>>8&255}function send_bits(s,value,length){if(s.bi_valid>Buf_size-length){s.bi_buf|=value<<s.bi_valid&65535;put_short(s,s.bi_buf);s.bi_buf=value>>Buf_size-s.bi_valid;s.bi_valid+=length-Buf_size}else{s.bi_buf|=value<<s.bi_valid&65535;s.bi_valid+=length}}function send_code(s,c,tree){send_bits(s,tree[c*2],tree[c*2+1])}function bi_reverse(code,len){var res=0;do{res|=code&1;code>>>=1;res<<=1}while(--len>0);return res>>>1}function bi_flush(s){if(s.bi_valid===16){put_short(s,s.bi_buf);s.bi_buf=0;s.bi_valid=0}else if(s.bi_valid>=8){s.pending_buf[s.pending++]=s.bi_buf&255;s.bi_buf>>=8;s.bi_valid-=8}}function gen_bitlen(s,desc){var tree=desc.dyn_tree;var max_code=desc.max_code;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var extra=desc.stat_desc.extra_bits;var base=desc.stat_desc.extra_base;var max_length=desc.stat_desc.max_length;var h;var n,m;var bits;var xbits;var f;var overflow=0;for(bits=0;bits<=MAX_BITS;bits++){s.bl_count[bits]=0}tree[s.heap[s.heap_max]*2+1]=0;for(h=s.heap_max+1;h<HEAP_SIZE;h++){n=s.heap[h];bits=tree[tree[n*2+1]*2+1]+1;if(bits>max_length){bits=max_length;overflow++}tree[n*2+1]=bits;if(n>max_code){continue}s.bl_count[bits]++;xbits=0;if(n>=base){xbits=extra[n-base]}f=tree[n*2];s.opt_len+=f*(bits+xbits);if(has_stree){s.static_len+=f*(stree[n*2+1]+xbits)}}if(overflow===0){return}do{bits=max_length-1;while(s.bl_count[bits]===0){bits--}s.bl_count[bits]--;s.bl_count[bits+1]+=2;s.bl_count[max_length]--;overflow-=2}while(overflow>0);for(bits=max_length;bits!==0;bits--){n=s.bl_count[bits];while(n!==0){m=s.heap[--h];if(m>max_code){continue}if(tree[m*2+1]!==bits){s.opt_len+=(bits-tree[m*2+1])*tree[m*2];tree[m*2+1]=bits}n--}}}function gen_codes(tree,max_code,bl_count){var next_code=new Array(MAX_BITS+1);var code=0;var bits;var n;for(bits=1;bits<=MAX_BITS;bits++){next_code[bits]=code=code+bl_count[bits-1]<<1}for(n=0;n<=max_code;n++){var len=tree[n*2+1];if(len===0){continue}tree[n*2]=bi_reverse(next_code[len]++,len)}}function tr_static_init(){var n;var bits;var length;var code;var dist;var bl_count=new Array(MAX_BITS+1);length=0;for(code=0;code<LENGTH_CODES-1;code++){base_length[code]=length;for(n=0;n<1<<extra_lbits[code];n++){_length_code[length++]=code}}_length_code[length-1]=code;dist=0;for(code=0;code<16;code++){base_dist[code]=dist;for(n=0;n<1<<extra_dbits[code];n++){_dist_code[dist++]=code}}dist>>=7;for(;code<D_CODES;code++){base_dist[code]=dist<<7;for(n=0;n<1<<extra_dbits[code]-7;n++){_dist_code[256+dist++]=code}}for(bits=0;bits<=MAX_BITS;bits++){bl_count[bits]=0}n=0;while(n<=143){static_ltree[n*2+1]=8;n++;bl_count[8]++}while(n<=255){static_ltree[n*2+1]=9;n++;bl_count[9]++}while(n<=279){static_ltree[n*2+1]=7;n++;bl_count[7]++}while(n<=287){static_ltree[n*2+1]=8;n++;bl_count[8]++}gen_codes(static_ltree,L_CODES+1,bl_count);for(n=0;n<D_CODES;n++){static_dtree[n*2+1]=5;static_dtree[n*2]=bi_reverse(n,5)}static_l_desc=new StaticTreeDesc(static_ltree,extra_lbits,LITERALS+1,L_CODES,MAX_BITS);static_d_desc=new StaticTreeDesc(static_dtree,extra_dbits,0,D_CODES,MAX_BITS);static_bl_desc=new StaticTreeDesc(new Array(0),extra_blbits,0,BL_CODES,MAX_BL_BITS)}function init_block(s){var n;for(n=0;n<L_CODES;n++){s.dyn_ltree[n*2]=0}for(n=0;n<D_CODES;n++){s.dyn_dtree[n*2]=0}for(n=0;n<BL_CODES;n++){s.bl_tree[n*2]=0}s.dyn_ltree[END_BLOCK*2]=1;s.opt_len=s.static_len=0;s.last_lit=s.matches=0}function bi_windup(s){if(s.bi_valid>8){put_short(s,s.bi_buf)}else if(s.bi_valid>0){s.pending_buf[s.pending++]=s.bi_buf}s.bi_buf=0;s.bi_valid=0}function copy_block(s,buf,len,header){bi_windup(s);if(header){put_short(s,len);put_short(s,~len)}utils.arraySet(s.pending_buf,s.window,buf,len,s.pending);s.pending+=len}function smaller(tree,n,m,depth){var _n2=n*2;var _m2=m*2;return tree[_n2]<tree[_m2]||tree[_n2]===tree[_m2]&&depth[n]<=depth[m]}function pqdownheap(s,tree,k){var v=s.heap[k];var j=k<<1;while(j<=s.heap_len){if(j<s.heap_len&&smaller(tree,s.heap[j+1],s.heap[j],s.depth)){j++}if(smaller(tree,v,s.heap[j],s.depth)){break}s.heap[k]=s.heap[j];k=j;j<<=1}s.heap[k]=v}function compress_block(s,ltree,dtree){var dist;var lc;var lx=0;var code;var extra;if(s.last_lit!==0){do{dist=s.pending_buf[s.d_buf+lx*2]<<8|s.pending_buf[s.d_buf+lx*2+1];lc=s.pending_buf[s.l_buf+lx];lx++;if(dist===0){send_code(s,lc,ltree)}else{code=_length_code[lc];send_code(s,code+LITERALS+1,ltree);extra=extra_lbits[code];if(extra!==0){lc-=base_length[code];send_bits(s,lc,extra)}dist--;code=d_code(dist);send_code(s,code,dtree);extra=extra_dbits[code];if(extra!==0){dist-=base_dist[code];send_bits(s,dist,extra)}}}while(lx<s.last_lit)}send_code(s,END_BLOCK,ltree)}function build_tree(s,desc){var tree=desc.dyn_tree;var stree=desc.stat_desc.static_tree;var has_stree=desc.stat_desc.has_stree;var elems=desc.stat_desc.elems;var n,m;var max_code=-1;var node;s.heap_len=0;s.heap_max=HEAP_SIZE;for(n=0;n<elems;n++){if(tree[n*2]!==0){s.heap[++s.heap_len]=max_code=n;s.depth[n]=0}else{tree[n*2+1]=0}}while(s.heap_len<2){node=s.heap[++s.heap_len]=max_code<2?++max_code:0;tree[node*2]=1;s.depth[node]=0;s.opt_len--;if(has_stree){s.static_len-=stree[node*2+1]}}desc.max_code=max_code;for(n=s.heap_len>>1;n>=1;n--){pqdownheap(s,tree,n)}node=elems;do{n=s.heap[1];s.heap[1]=s.heap[s.heap_len--];pqdownheap(s,tree,1);m=s.heap[1];s.heap[--s.heap_max]=n;s.heap[--s.heap_max]=m;tree[node*2]=tree[n*2]+tree[m*2];s.depth[node]=(s.depth[n]>=s.depth[m]?s.depth[n]:s.depth[m])+1;tree[n*2+1]=tree[m*2+1]=node;s.heap[1]=node++;pqdownheap(s,tree,1)}while(s.heap_len>=2);s.heap[--s.heap_max]=s.heap[1];gen_bitlen(s,desc);gen_codes(tree,max_code,s.bl_count)}function scan_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}tree[(max_code+1)*2+1]=65535;for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){s.bl_tree[curlen*2]+=count}else if(curlen!==0){if(curlen!==prevlen){s.bl_tree[curlen*2]++}s.bl_tree[REP_3_6*2]++}else if(count<=10){s.bl_tree[REPZ_3_10*2]++}else{s.bl_tree[REPZ_11_138*2]++}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function send_tree(s,tree,max_code){var n;var prevlen=-1;var curlen;var nextlen=tree[0*2+1];var count=0;var max_count=7;var min_count=4;if(nextlen===0){max_count=138;min_count=3}for(n=0;n<=max_code;n++){curlen=nextlen;nextlen=tree[(n+1)*2+1];if(++count<max_count&&curlen===nextlen){continue}else if(count<min_count){do{send_code(s,curlen,s.bl_tree)}while(--count!==0)}else if(curlen!==0){if(curlen!==prevlen){send_code(s,curlen,s.bl_tree);count--}send_code(s,REP_3_6,s.bl_tree);send_bits(s,count-3,2)}else if(count<=10){send_code(s,REPZ_3_10,s.bl_tree);send_bits(s,count-3,3)}else{send_code(s,REPZ_11_138,s.bl_tree);send_bits(s,count-11,7)}count=0;prevlen=curlen;if(nextlen===0){max_count=138;min_count=3}else if(curlen===nextlen){max_count=6;min_count=3}else{max_count=7;min_count=4}}}function build_bl_tree(s){var max_blindex;scan_tree(s,s.dyn_ltree,s.l_desc.max_code);scan_tree(s,s.dyn_dtree,s.d_desc.max_code);build_tree(s,s.bl_desc);for(max_blindex=BL_CODES-1;max_blindex>=3;max_blindex--){if(s.bl_tree[bl_order[max_blindex]*2+1]!==0){break}}s.opt_len+=3*(max_blindex+1)+5+5+4;return max_blindex}function send_all_trees(s,lcodes,dcodes,blcodes){var rank;send_bits(s,lcodes-257,5);send_bits(s,dcodes-1,5);send_bits(s,blcodes-4,4);for(rank=0;rank<blcodes;rank++){send_bits(s,s.bl_tree[bl_order[rank]*2+1],3)}send_tree(s,s.dyn_ltree,lcodes-1);send_tree(s,s.dyn_dtree,dcodes-1)}function detect_data_type(s){var black_mask=4093624447;var n;for(n=0;n<=31;n++,black_mask>>>=1){if(black_mask&1&&s.dyn_ltree[n*2]!==0){return Z_BINARY}}if(s.dyn_ltree[9*2]!==0||s.dyn_ltree[10*2]!==0||s.dyn_ltree[13*2]!==0){return Z_TEXT}for(n=32;n<LITERALS;n++){if(s.dyn_ltree[n*2]!==0){return Z_TEXT}}return Z_BINARY}var static_init_done=false;function _tr_init(s){if(!static_init_done){tr_static_init();static_init_done=true}s.l_desc=new TreeDesc(s.dyn_ltree,static_l_desc);s.d_desc=new TreeDesc(s.dyn_dtree,static_d_desc);s.bl_desc=new TreeDesc(s.bl_tree,static_bl_desc);s.bi_buf=0;s.bi_valid=0;init_block(s)}function _tr_stored_block(s,buf,stored_len,last){send_bits(s,(STORED_BLOCK<<1)+(last?1:0),3);copy_block(s,buf,stored_len,true)}function _tr_align(s){send_bits(s,STATIC_TREES<<1,3);send_code(s,END_BLOCK,static_ltree);bi_flush(s)}function _tr_flush_block(s,buf,stored_len,last){var opt_lenb,static_lenb;var max_blindex=0;if(s.level>0){if(s.strm.data_type===Z_UNKNOWN){s.strm.data_type=detect_data_type(s)}build_tree(s,s.l_desc);build_tree(s,s.d_desc);max_blindex=build_bl_tree(s);opt_lenb=s.opt_len+3+7>>>3;static_lenb=s.static_len+3+7>>>3;if(static_lenb<=opt_lenb){opt_lenb=static_lenb}}else{opt_lenb=static_lenb=stored_len+5}if(stored_len+4<=opt_lenb&&buf!==-1){_tr_stored_block(s,buf,stored_len,last)}else if(s.strategy===Z_FIXED||static_lenb===opt_lenb){send_bits(s,(STATIC_TREES<<1)+(last?1:0),3);compress_block(s,static_ltree,static_dtree)}else{send_bits(s,(DYN_TREES<<1)+(last?1:0),3);send_all_trees(s,s.l_desc.max_code+1,s.d_desc.max_code+1,max_blindex+1);compress_block(s,s.dyn_ltree,s.dyn_dtree)}init_block(s);if(last){bi_windup(s)}}function _tr_tally(s,dist,lc){s.pending_buf[s.d_buf+s.last_lit*2]=dist>>>8&255;s.pending_buf[s.d_buf+s.last_lit*2+1]=dist&255;s.pending_buf[s.l_buf+s.last_lit]=lc&255;s.last_lit++;if(dist===0){s.dyn_ltree[lc*2]++}else{s.matches++;dist--;s.dyn_ltree[(_length_code[lc]+LITERALS+1)*2]++;s.dyn_dtree[d_code(dist)*2]++}return s.last_lit===s.lit_bufsize-1}exports._tr_init=_tr_init;exports._tr_stored_block=_tr_stored_block;exports._tr_flush_block=_tr_flush_block;exports._tr_tally=_tr_tally;exports._tr_align=_tr_align},{"../utils/common":17}],27:[function(require,module,exports){"use strict";function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module.exports=ZStream},{}],28:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){if(typeof path!=="string")path=path+"";if(path.length===0)return".";var code=path.charCodeAt(0);var hasRoot=code===47;var end=-1;var matchedSlash=true;for(var i=path.length-1;i>=1;--i){code=path.charCodeAt(i);if(code===47){if(!matchedSlash){end=i;break}}else{matchedSlash=false}}if(end===-1)return hasRoot?"/":".";if(hasRoot&&end===1){return"/"}return path.slice(0,end)};function basename(path){if(typeof path!=="string")path=path+"";var start=0;var end=-1;var matchedSlash=true;var i;for(i=path.length-1;i>=0;--i){if(path.charCodeAt(i)===47){if(!matchedSlash){start=i+1;break}}else if(end===-1){matchedSlash=false;end=i+1}}if(end===-1)return"";return path.slice(start,end)}exports.basename=function(path,ext){var f=basename(path);if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){if(typeof path!=="string")path=path+"";var startDot=-1;var startPart=0;var end=-1;var matchedSlash=true;var preDotState=0;for(var i=path.length-1;i>=0;--i){var code=path.charCodeAt(i);if(code===47){if(!matchedSlash){startPart=i+1;break}continue}if(end===-1){matchedSlash=false;end=i+1}if(code===46){if(startDot===-1)startDot=i;else if(preDotState!==1)preDotState=1}else if(startDot!==-1){preDotState=-1}}if(startDot===-1||end===-1||preDotState===0||preDotState===1&&startDot===end-1&&startDot===startPart+1){return""}return path.slice(startDot,end)};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:30}],29:[function(require,module,exports){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module.exports={nextTick:nextTick}}else{module.exports=process}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError('"callback" argument must be a function')}var len=arguments.length;var args,i;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i=0;while(i<args.length){args[i++]=arguments[i]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(this,require("_process"))},{_process:30}],30:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],31:[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=="object"&&module&&!module.nodeType&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],32:[function(require,module,exports){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},{}],33:[function(require,module,exports){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}}).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},{}],34:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode");exports.encode=exports.stringify=require("./encode")},{"./decode":32,"./encode":33}],35:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":36}],36:[function(require,module,exports){"use strict";var pna=require("process-nextick-args");var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);{var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:false,get:function(){return this._writableState.highWaterMark}});function onend(){if(this.allowHalfOpen||this._writableState.ended)return;pna.nextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){if(this._readableState===undefined||this._writableState===undefined){return false}return this._readableState.destroyed&&this._writableState.destroyed},set:function(value){if(this._readableState===undefined||this._writableState===undefined){return}this._readableState.destroyed=value;this._writableState.destroyed=value}});Duplex.prototype._destroy=function(err,cb){this.push(null);this.end();pna.nextTick(cb,err)}},{"./_stream_readable":38,"./_stream_writable":40,"core-util-is":11,inherits:14,"process-nextick-args":29}],37:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":39,"core-util-is":11,inherits:14}],38:[function(require,module,exports){(function(process,global){"use strict";var pna=require("process-nextick-args");module.exports=Readable;var isArray=require("isarray");var Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("./internal/streams/stream");var Buffer=require("safe-buffer").Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}var util=require("core-util-is");util.inherits=require("inherits");var debugUtil=require("util");var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var BufferList=require("./internal/streams/BufferList");var destroyImpl=require("./internal/streams/destroy");var StringDecoder;util.inherits(Readable,Stream);var kProxyEvents=["error","close","destroy","pause","resume"];function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function")return emitter.prependListener(event,fn);if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}function ReadableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var readableHwm=options.readableHighWaterMark;var defaultHwm=this.objectMode?16:16*1024;if(hwm||hwm===0)this.highWaterMark=hwm;else if(isDuplex&&(readableHwm||readableHwm===0))this.highWaterMark=readableHwm;else this.highWaterMark=defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.destroyed=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options){if(typeof options.read==="function")this._read=options.read;if(typeof options.destroy==="function")this._destroy=options.destroy}Stream.call(this)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){if(this._readableState===undefined){return false}return this._readableState.destroyed},set:function(value){if(!this._readableState){return}this._readableState.destroyed=value}});Readable.prototype.destroy=destroyImpl.destroy;Readable.prototype._undestroy=destroyImpl.undestroy;Readable.prototype._destroy=function(err,cb){this.push(null);cb(err)};Readable.prototype.push=function(chunk,encoding){var state=this._readableState;var skipChunkCheck;if(!state.objectMode){if(typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding=""}skipChunkCheck=true}}else{skipChunkCheck=true}return readableAddChunk(this,chunk,encoding,false,skipChunkCheck)};Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,true,false)};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){var state=stream._readableState;if(chunk===null){state.reading=false;onEofChunk(stream,state)}else{var er;if(!skipChunkCheck)er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(state.objectMode||chunk&&chunk.length>0){if(typeof chunk!=="string"&&!state.objectMode&&Object.getPrototypeOf(chunk)!==Buffer.prototype){chunk=_uint8ArrayToBuffer(chunk)}if(addToFront){if(state.endEmitted)stream.emit("error",new Error("stream.unshift() after end event"));else addChunk(stream,state,chunk,true)}else if(state.ended){stream.emit("error",new Error("stream.push() after EOF"))}else{state.reading=false;if(state.decoder&&!encoding){chunk=state.decoder.write(chunk);if(state.objectMode||chunk.length!==0)addChunk(stream,state,chunk,false);else maybeReadMore(stream,state)}else{addChunk(stream,state,chunk,false)}}}else if(!addToFront){state.reading=false}}return needMoreData(state)}function addChunk(stream,state,chunk,addToFront){if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}function chunkInvalid(state,chunk){var er;if(!_isUint8Array(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.isPaused=function(){return this._readableState.flowing===false};Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}else{state.length-=n}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function onEofChunk(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)pna.nextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;pna.nextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:unpipe;if(state.endEmitted)pna.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable,unpipeInfo){debug("onunpipe");if(readable===src){if(unpipeInfo&&unpipeInfo.hasUnpiped===false){unpipeInfo.hasUnpiped=true;cleanup()}}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",unpipe);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;var unpipeInfo={hasUnpiped:false};if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this,unpipeInfo);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit("unpipe",this,unpipeInfo)}return this}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this,unpipeInfo);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev==="readable"){var state=this._readableState;if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.emittedReadable=false;if(!state.reading){pna.nextTick(nReadingNextTick,this)}else if(state.length){emitReadable(this)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;pna.nextTick(resume_,stream,state)}}function resume_(stream,state){if(!state.reading){debug("resume read 0");stream.read(0)}state.resumeScheduled=false;state.awaitDrain=0;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var _this=this;var state=this._readableState;var paused=false;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)_this.push(chunk)}_this.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=_this.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}for(var n=0;n<kProxyEvents.length;n++){stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]))}this._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return this};Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:false,get:function(){return this._readableState.highWaterMark}});Readable._fromList=fromList;function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.head.data;else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=fromListPartial(n,state.buffer,state.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p=list.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=str.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=Buffer.allocUnsafe(n);var p=list.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)list.head=p.next;else list.head=list.tail=null}else{list.head=p;p.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error('"endReadable()" called on non-empty stream');if(!state.endEmitted){state.ended=true;pna.nextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./_stream_duplex":36,"./internal/streams/BufferList":41,"./internal/streams/destroy":42,"./internal/streams/stream":43,_process:30,"core-util-is":11,events:12,inherits:14,isarray:16,"process-nextick-args":29,"safe-buffer":49,"string_decoder/":44,util:7}],39:[function(require,module,exports){"use strict";module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function afterTransform(er,data){var ts=this._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb){return this.emit("error",new Error("write callback called multiple times"))}ts.writechunk=null;ts.writecb=null;if(data!=null)this.push(data);cb(er);var rs=this._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){this._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState={afterTransform:afterTransform.bind(this),needTransform:false,transforming:false,writecb:null,writechunk:null,writeencoding:null};this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.on("prefinish",prefinish)}function prefinish(){var _this=this;if(typeof this._flush==="function"){this._flush(function(er,data){done(_this,er,data)})}else{done(this,null,null)}}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};Transform.prototype._destroy=function(err,cb){var _this2=this;Duplex.prototype._destroy.call(this,err,function(err2){cb(err2);_this2.emit("close")})};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!=null)stream.push(data);if(stream._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(stream._transformState.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":36,"core-util-is":11,inherits:14}],40:[function(require,module,exports){(function(process,global,setImmediate){"use strict";var pna=require("process-nextick-args");module.exports=Writable;function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(_this,state)}}var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:pna.nextTick;var Duplex;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var internalUtil={deprecate:require("util-deprecate")};var Stream=require("./internal/streams/stream");var Buffer=require("safe-buffer").Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}var destroyImpl=require("./internal/streams/destroy");util.inherits(Writable,Stream);function nop(){}function WritableState(options,stream){Duplex=Duplex||require("./_stream_duplex");options=options||{};var isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var writableHwm=options.writableHighWaterMark;var defaultHwm=this.objectMode?16:16*1024;if(hwm||hwm===0)this.highWaterMark=hwm;else if(isDuplex&&(writableHwm||writableHwm===0))this.highWaterMark=writableHwm;else this.highWaterMark=defaultHwm;this.highWaterMark=Math.floor(this.highWaterMark);this.finalCalled=false;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;this.destroyed=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;if(this!==Writable)return false;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}function Writable(options){Duplex=Duplex||require("./_stream_duplex");if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev;if(typeof options.destroy==="function")this._destroy=options.destroy;if(typeof options.final==="function")this._final=options.final}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);pna.nextTick(cb,er)}function validChunk(stream,state,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);pna.nextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;var isBuf=!state.objectMode&&_isUint8Array(chunk);if(isBuf&&!Buffer.isBuffer(chunk)){chunk=_uint8ArrayToBuffer(chunk)}if(typeof encoding==="function"){cb=encoding;encoding=null}if(isBuf)encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ended)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=Buffer.from(chunk,encoding)}return chunk}Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:false,get:function(){return this._writableState.highWaterMark}});function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);if(chunk!==newChunk){isBuf=true;encoding="buffer";chunk=newChunk}}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null};if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync){pna.nextTick(cb,er);pna.nextTick(finishMaybe,stream,state);stream._writableState.errorEmitted=true;stream.emit("error",er)}else{cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er);finishMaybe(stream,state)}}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){asyncWrite(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;var allBuffers=true;while(entry){buffer[count]=entry;if(!entry.isBuf)allBuffers=false;entry=entry.next;count+=1}buffer.allBuffers=allBuffers;doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}state.bufferedRequestCount=0}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;state.bufferedRequestCount--;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--;if(err){stream.emit("error",err)}state.prefinished=true;stream.emit("prefinish");finishMaybe(stream,state)})}function prefinish(stream,state){if(!state.prefinished&&!state.finalCalled){if(typeof stream._final==="function"){state.pendingcb++;state.finalCalled=true;pna.nextTick(callFinal,stream,state)}else{state.prefinished=true;stream.emit("prefinish")}}}function finishMaybe(stream,state){var need=needFinish(state);if(need){prefinish(stream,state);if(state.pendingcb===0){state.finished=true;stream.emit("finish")}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)pna.nextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}if(state.corkedRequestsFree){state.corkedRequestsFree.next=corkReq}else{state.corkedRequestsFree=corkReq}}Object.defineProperty(Writable.prototype,"destroyed",{get:function(){if(this._writableState===undefined){return false}return this._writableState.destroyed},set:function(value){if(!this._writableState){return}this._writableState.destroyed=value}});Writable.prototype.destroy=destroyImpl.destroy;Writable.prototype._undestroy=destroyImpl.undestroy;Writable.prototype._destroy=function(err,cb){this.end();cb(err)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("timers").setImmediate)},{"./_stream_duplex":36,"./internal/streams/destroy":42,"./internal/streams/stream":43,_process:30,"core-util-is":11,inherits:14,"process-nextick-args":29,"safe-buffer":49,timers:52,"util-deprecate":55}],41:[function(require,module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Buffer=require("safe-buffer").Buffer;var util=require("util");function copyBuffer(src,target,offset){src.copy(target,offset)}module.exports=function(){function BufferList(){_classCallCheck(this,BufferList);this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function push(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function unshift(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function shift(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function clear(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function join(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret};BufferList.prototype.concat=function concat(n){if(this.length===0)return Buffer.alloc(0);if(this.length===1)return this.head.data;var ret=Buffer.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){copyBuffer(p.data,ret,i);i+=p.data.length;p=p.next}return ret};return BufferList}();if(util&&util.inspect&&util.inspect.custom){module.exports.prototype[util.inspect.custom]=function(){var obj=util.inspect({length:this.length});return this.constructor.name+" "+obj}}},{"safe-buffer":49,util:7}],42:[function(require,module,exports){"use strict";var pna=require("process-nextick-args");function destroy(err,cb){var _this=this;var readableDestroyed=this._readableState&&this._readableState.destroyed;var writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed){if(cb){cb(err)}else if(err&&(!this._writableState||!this._writableState.errorEmitted)){pna.nextTick(emitErrorNT,this,err)}return this}if(this._readableState){this._readableState.destroyed=true}if(this._writableState){this._writableState.destroyed=true}this._destroy(err||null,function(err){if(!cb&&err){pna.nextTick(emitErrorNT,_this,err);if(_this._writableState){_this._writableState.errorEmitted=true}}else if(cb){cb(err)}});return this}function undestroy(){if(this._readableState){this._readableState.destroyed=false;this._readableState.reading=false;this._readableState.ended=false;this._readableState.endEmitted=false}if(this._writableState){this._writableState.destroyed=false;this._writableState.ended=false;this._writableState.ending=false;this._writableState.finished=false;this._writableState.errorEmitted=false}}function emitErrorNT(self,err){self.emit("error",err)}module.exports={destroy:destroy,undestroy:undestroy}},{"process-nextick-args":29}],43:[function(require,module,exports){module.exports=require("events").EventEmitter},{events:12}],44:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer;var isEncoding=Buffer.isEncoding||function(encoding){encoding=""+encoding;switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function _normalizeEncoding(enc){if(!enc)return"utf8";var retried;while(true){switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase();retried=true}}}function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if(typeof nenc!=="string"&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}exports.StringDecoder=StringDecoder;function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text;this.end=utf16End;nb=4;break;case"utf8":this.fillLast=utf8FillLast;nb=4;break;case"base64":this.text=base64Text;this.end=base64End;nb=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return}this.lastNeed=0;this.lastTotal=0;this.lastChar=Buffer.allocUnsafe(nb)}StringDecoder.prototype.write=function(buf){if(buf.length===0)return"";var r;var i;if(this.lastNeed){r=this.fillLast(buf);if(r===undefined)return"";i=this.lastNeed;this.lastNeed=0}else{i=0}if(i<buf.length)return r?r+this.text(buf,i):this.text(buf,i);return r||""};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length){buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length);this.lastNeed-=buf.length};function utf8CheckByte(byte){if(byte<=127)return 0;else if(byte>>5===6)return 2;else if(byte>>4===14)return 3;else if(byte>>3===30)return 4;return byte>>6===2?-1:-2}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-1;return nb}if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-2;return nb}if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0){if(nb===2)nb=0;else self.lastNeed=nb-3}return nb}return 0}function utf8CheckExtraBytes(self,buf,p){if((buf[0]&192)!==128){self.lastNeed=0;return"�"}if(self.lastNeed>1&&buf.length>1){if((buf[1]&192)!==128){self.lastNeed=1;return"�"}if(self.lastNeed>2&&buf.length>2){if((buf[2]&192)!==128){self.lastNeed=2;return"�"}}}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,buf,p);if(r!==undefined)return r;if(this.lastNeed<=buf.length){buf.copy(this.lastChar,p,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,p,0,buf.length);this.lastNeed-=buf.length}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);buf.copy(this.lastChar,0,end);return buf.toString("utf8",i,end)}function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+"�";return r}function utf16Text(buf,i){if((buf.length-i)%2===0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];return r.slice(0,-1)}}return r}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=buf[buf.length-1];return buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;if(n===0)return buf.toString("base64",i);this.lastNeed=3-n;this.lastTotal=3;if(n===1){this.lastChar[0]=buf[buf.length-1]}else{this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1]}return buf.toString("base64",i,buf.length-n)}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+this.lastChar.toString("base64",0,3-this.lastNeed);return r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}},{"safe-buffer":49}],45:[function(require,module,exports){module.exports=require("./readable").PassThrough},{"./readable":46}],46:[function(require,module,exports){exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=exports;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":36,"./lib/_stream_passthrough.js":37,"./lib/_stream_readable.js":38,"./lib/_stream_transform.js":39,"./lib/_stream_writable.js":40}],47:[function(require,module,exports){module.exports=require("./readable").Transform},{"./readable":46}],48:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":40}],49:[function(require,module,exports){var buffer=require("buffer");var Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src){dst[key]=src[key]}}if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer}else{copyProps(buffer,exports);exports.Buffer=SafeBuffer}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}copyProps(Buffer,SafeBuffer);SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==="number"){throw new TypeError("Argument must not be a number")}return Buffer(arg,encodingOrOffset,length)};SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}var buf=Buffer(size);if(fill!==undefined){if(typeof encoding==="string"){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}return buf};SafeBuffer.allocUnsafe=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return Buffer(size)};SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return buffer.SlowBuffer(size)}},{buffer:10}],50:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:12,inherits:14,"readable-stream/duplex.js":35,"readable-stream/passthrough.js":45,"readable-stream/readable.js":46,"readable-stream/transform.js":47,"readable-stream/writable.js":48}],51:[function(require,module,exports){arguments[4][44][0].apply(exports,arguments)},{dup:44,"safe-buffer":49}],52:[function(require,module,exports){(function(setImmediate,clearImmediate){var nextTick=require("process/browser.js").nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?false:slice.call(arguments,1);immediateIds[id]=true;nextTick(function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}exports.clearImmediate(id)}});return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(this,require("timers").setImmediate,require("timers").clearImmediate)},{"process/browser.js":30,timers:52}],53:[function(require,module,exports){"use strict";var punycode=require("punycode");var util=require("./util");exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=require("querystring");function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var queryIndex=url.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/");url=uSplit.join(splitter);var rest=url;rest=rest.trim();if(!slashesDenoteHost&&url.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];if(parseQueryString){this.query=querystring.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(parseQueryString){this.search="";this.query={}}return this}}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){this.hostname=punycode.toASCII(this.hostname)}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)===-1)continue;var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(util.isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&util.isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)});search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,false,true);relative=rel}var result=new Url;var tkeys=Object.keys(this);for(var tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){var rkeys=Object.keys(relative);for(var rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];if(rkey!=="protocol")result[rkey]=relative[rkey]}if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){var keys=Object.keys(relative);for(var v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last==="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host}},{"./util":54,punycode:31,querystring:34}],54:[function(require,module,exports){"use strict";module.exports={isString:function(arg){return typeof arg==="string"},isObject:function(arg){return typeof arg==="object"&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}}},{}],55:[function(require,module,exports){(function(global){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],56:[function(require,module,exports){arguments[4][4][0].apply(exports,arguments)},{dup:4}],57:[function(require,module,exports){arguments[4][5][0].apply(exports,arguments)},{"./support/isBuffer":56,_process:30,dup:5,inherits:14}],58:[function(require,module,exports){var alias=exports;alias.bools={auto_left_margin:["bw","bw"],auto_right_margin:["am","am"],back_color_erase:["bce","ut"],can_change:["ccc","cc"],ceol_standout_glitch:["xhp","xs"],col_addr_glitch:["xhpa","YA"],cpi_changes_res:["cpix","YF"],cr_cancels_micro_mode:["crxm","YB"],dest_tabs_magic_smso:["xt","xt"],eat_newline_glitch:["xenl","xn"],erase_overstrike:["eo","eo"],generic_type:["gn","gn"],hard_copy:["hc","hc"],hard_cursor:["chts","HC"],has_meta_key:["km","km"],has_print_wheel:["daisy","YC"],has_status_line:["hs","hs"],hue_lightness_saturation:["hls","hl"],insert_null_glitch:["in","in"],lpi_changes_res:["lpix","YG"],memory_above:["da","da"],memory_below:["db","db"],move_insert_mode:["mir","mi"],move_standout_mode:["msgr","ms"],needs_xon_xoff:["nxon","nx"],no_esc_ctlc:["xsb","xb"],no_pad_char:["npc","NP"],non_dest_scroll_region:["ndscr","ND"],non_rev_rmcup:["nrrmc","NR"],over_strike:["os","os"],prtr_silent:["mc5i","5i"],row_addr_glitch:["xvpa","YD"],semi_auto_right_margin:["sam","YE"],status_line_esc_ok:["eslok","es"],tilde_glitch:["hz","hz"],transparent_underline:["ul","ul"],xon_xoff:["xon","xo"]};alias.numbers={columns:["cols","co"],init_tabs:["it","it"],label_height:["lh","lh"],label_width:["lw","lw"],lines:["lines","li"],lines_of_memory:["lm","lm"],magic_cookie_glitch:["xmc","sg"],max_attributes:["ma","ma"],max_colors:["colors","Co"],max_pairs:["pairs","pa"],maximum_windows:["wnum","MW"],no_color_video:["ncv","NC"],num_labels:["nlab","Nl"],padding_baud_rate:["pb","pb"],virtual_terminal:["vt","vt"],width_status_line:["wsl","ws"],bit_image_entwining:["bitwin","Yo"],bit_image_type:["bitype","Yp"],buffer_capacity:["bufsz","Ya"],buttons:["btns","BT"],dot_horz_spacing:["spinh","Yc"],dot_vert_spacing:["spinv","Yb"],max_micro_address:["maddr","Yd"],max_micro_jump:["mjump","Ye"],micro_col_size:["mcs","Yf"],micro_line_size:["mls","Yg"],number_of_pins:["npins","Yh"],output_res_char:["orc","Yi"],output_res_horz_inch:["orhi","Yk"],output_res_line:["orl","Yj"],output_res_vert_inch:["orvi","Yl"],print_rate:["cps","Ym"],wide_char_size:["widcs","Yn"]};alias.strings={acs_chars:["acsc","ac"],back_tab:["cbt","bt"],bell:["bel","bl"],carriage_return:["cr","cr"],change_char_pitch:["cpi","ZA"],change_line_pitch:["lpi","ZB"],change_res_horz:["chr","ZC"],change_res_vert:["cvr","ZD"],change_scroll_region:["csr","cs"],char_padding:["rmp","rP"],clear_all_tabs:["tbc","ct"],clear_margins:["mgc","MC"],clear_screen:["clear","cl"],clr_bol:["el1","cb"],clr_eol:["el","ce"],clr_eos:["ed","cd"],column_address:["hpa","ch"],command_character:["cmdch","CC"],create_window:["cwin","CW"],cursor_address:["cup","cm"],cursor_down:["cud1","do"],cursor_home:["home","ho"],cursor_invisible:["civis","vi"],cursor_left:["cub1","le"],cursor_mem_address:["mrcup","CM"],cursor_normal:["cnorm","ve"],cursor_right:["cuf1","nd"],cursor_to_ll:["ll","ll"],cursor_up:["cuu1","up"],cursor_visible:["cvvis","vs"],define_char:["defc","ZE"],delete_character:["dch1","dc"],delete_line:["dl1","dl"],dial_phone:["dial","DI"],dis_status_line:["dsl","ds"],display_clock:["dclk","DK"],down_half_line:["hd","hd"],ena_acs:["enacs","eA"],enter_alt_charset_mode:["smacs","as"],enter_am_mode:["smam","SA"],enter_blink_mode:["blink","mb"],enter_bold_mode:["bold","md"],enter_ca_mode:["smcup","ti"],enter_delete_mode:["smdc","dm"],enter_dim_mode:["dim","mh"],enter_doublewide_mode:["swidm","ZF"],enter_draft_quality:["sdrfq","ZG"],enter_insert_mode:["smir","im"],enter_italics_mode:["sitm","ZH"],enter_leftward_mode:["slm","ZI"],enter_micro_mode:["smicm","ZJ"],enter_near_letter_quality:["snlq","ZK"],enter_normal_quality:["snrmq","ZL"],enter_protected_mode:["prot","mp"],enter_reverse_mode:["rev","mr"],enter_secure_mode:["invis","mk"],enter_shadow_mode:["sshm","ZM"],enter_standout_mode:["smso","so"],enter_subscript_mode:["ssubm","ZN"],enter_superscript_mode:["ssupm","ZO"],enter_underline_mode:["smul","us"],enter_upward_mode:["sum","ZP"],enter_xon_mode:["smxon","SX"],erase_chars:["ech","ec"],exit_alt_charset_mode:["rmacs","ae"],exit_am_mode:["rmam","RA"],exit_attribute_mode:["sgr0","me"],exit_ca_mode:["rmcup","te"],exit_delete_mode:["rmdc","ed"],exit_doublewide_mode:["rwidm","ZQ"],exit_insert_mode:["rmir","ei"],exit_italics_mode:["ritm","ZR"],exit_leftward_mode:["rlm","ZS"],exit_micro_mode:["rmicm","ZT"],exit_shadow_mode:["rshm","ZU"],exit_standout_mode:["rmso","se"],exit_subscript_mode:["rsubm","ZV"],exit_superscript_mode:["rsupm","ZW"],exit_underline_mode:["rmul","ue"],exit_upward_mode:["rum","ZX"],exit_xon_mode:["rmxon","RX"],fixed_pause:["pause","PA"],flash_hook:["hook","fh"],flash_screen:["flash","vb"],form_feed:["ff","ff"],from_status_line:["fsl","fs"],goto_window:["wingo","WG"],hangup:["hup","HU"],init_1string:["is1","i1"],init_2string:["is2","is"],init_3string:["is3","i3"],init_file:["if","if"],init_prog:["iprog","iP"],initialize_color:["initc","Ic"],initialize_pair:["initp","Ip"],insert_character:["ich1","ic"],insert_line:["il1","al"],insert_padding:["ip","ip"],key_a1:["ka1","K1"],key_a3:["ka3","K3"],key_b2:["kb2","K2"],key_backspace:["kbs","kb"],key_beg:["kbeg","@1"],key_btab:["kcbt","kB"],key_c1:["kc1","K4"],key_c3:["kc3","K5"],key_cancel:["kcan","@2"],key_catab:["ktbc","ka"],key_clear:["kclr","kC"],key_close:["kclo","@3"],key_command:["kcmd","@4"],key_copy:["kcpy","@5"],key_create:["kcrt","@6"],key_ctab:["kctab","kt"],key_dc:["kdch1","kD"],key_dl:["kdl1","kL"],key_down:["kcud1","kd"],key_eic:["krmir","kM"],key_end:["kend","@7"],key_enter:["kent","@8"],key_eol:["kel","kE"],key_eos:["ked","kS"],key_exit:["kext","@9"],key_f0:["kf0","k0"],key_f1:["kf1","k1"],key_f10:["kf10","k;"],key_f11:["kf11","F1"],key_f12:["kf12","F2"],key_f13:["kf13","F3"],key_f14:["kf14","F4"],key_f15:["kf15","F5"],key_f16:["kf16","F6"],key_f17:["kf17","F7"],key_f18:["kf18","F8"],key_f19:["kf19","F9"],key_f2:["kf2","k2"],key_f20:["kf20","FA"],key_f21:["kf21","FB"],key_f22:["kf22","FC"],key_f23:["kf23","FD"],key_f24:["kf24","FE"],key_f25:["kf25","FF"],key_f26:["kf26","FG"],key_f27:["kf27","FH"],key_f28:["kf28","FI"],key_f29:["kf29","FJ"],key_f3:["kf3","k3"],key_f30:["kf30","FK"],key_f31:["kf31","FL"],key_f32:["kf32","FM"],key_f33:["kf33","FN"],key_f34:["kf34","FO"],key_f35:["kf35","FP"],key_f36:["kf36","FQ"],key_f37:["kf37","FR"],key_f38:["kf38","FS"],key_f39:["kf39","FT"],key_f4:["kf4","k4"],key_f40:["kf40","FU"],key_f41:["kf41","FV"],key_f42:["kf42","FW"],key_f43:["kf43","FX"],key_f44:["kf44","FY"],key_f45:["kf45","FZ"],key_f46:["kf46","Fa"],key_f47:["kf47","Fb"],key_f48:["kf48","Fc"],key_f49:["kf49","Fd"],key_f5:["kf5","k5"],key_f50:["kf50","Fe"],key_f51:["kf51","Ff"],key_f52:["kf52","Fg"],key_f53:["kf53","Fh"],key_f54:["kf54","Fi"],key_f55:["kf55","Fj"],key_f56:["kf56","Fk"],key_f57:["kf57","Fl"],key_f58:["kf58","Fm"],key_f59:["kf59","Fn"],key_f6:["kf6","k6"],key_f60:["kf60","Fo"],key_f61:["kf61","Fp"],key_f62:["kf62","Fq"],key_f63:["kf63","Fr"],key_f7:["kf7","k7"],key_f8:["kf8","k8"],key_f9:["kf9","k9"],key_find:["kfnd","@0"],key_help:["khlp","%1"],key_home:["khome","kh"],key_ic:["kich1","kI"],key_il:["kil1","kA"],key_left:["kcub1","kl"],key_ll:["kll","kH"],key_mark:["kmrk","%2"],key_message:["kmsg","%3"],key_move:["kmov","%4"],key_next:["knxt","%5"],key_npage:["knp","kN"],key_open:["kopn","%6"],key_options:["kopt","%7"],key_ppage:["kpp","kP"],key_previous:["kprv","%8"],key_print:["kprt","%9"],key_redo:["krdo","%0"],key_reference:["kref","&1"],key_refresh:["krfr","&2"],key_replace:["krpl","&3"],key_restart:["krst","&4"],key_resume:["kres","&5"],key_right:["kcuf1","kr"],key_save:["ksav","&6"],key_sbeg:["kBEG","&9"],key_scancel:["kCAN","&0"],key_scommand:["kCMD","*1"],key_scopy:["kCPY","*2"],key_screate:["kCRT","*3"],key_sdc:["kDC","*4"],key_sdl:["kDL","*5"],key_select:["kslt","*6"],key_send:["kEND","*7"],key_seol:["kEOL","*8"],key_sexit:["kEXT","*9"],key_sf:["kind","kF"],key_sfind:["kFND","*0"],key_shelp:["kHLP","#1"],key_shome:["kHOM","#2"],key_sic:["kIC","#3"],key_sleft:["kLFT","#4"],key_smessage:["kMSG","%a"],key_smove:["kMOV","%b"],key_snext:["kNXT","%c"],key_soptions:["kOPT","%d"],key_sprevious:["kPRV","%e"],key_sprint:["kPRT","%f"],key_sr:["kri","kR"],key_sredo:["kRDO","%g"],key_sreplace:["kRPL","%h"],key_sright:["kRIT","%i"],key_srsume:["kRES","%j"],key_ssave:["kSAV","!1"],key_ssuspend:["kSPD","!2"],key_stab:["khts","kT"],key_sundo:["kUND","!3"],key_suspend:["kspd","&7"],key_undo:["kund","&8"],key_up:["kcuu1","ku"],keypad_local:["rmkx","ke"],keypad_xmit:["smkx","ks"],lab_f0:["lf0","l0"],lab_f1:["lf1","l1"],lab_f10:["lf10","la"],lab_f2:["lf2","l2"],lab_f3:["lf3","l3"],lab_f4:["lf4","l4"],lab_f5:["lf5","l5"],lab_f6:["lf6","l6"],lab_f7:["lf7","l7"],lab_f8:["lf8","l8"],lab_f9:["lf9","l9"],label_format:["fln","Lf"],label_off:["rmln","LF"],label_on:["smln","LO"],meta_off:["rmm","mo"],meta_on:["smm","mm"],micro_column_address:["mhpa","ZY"],micro_down:["mcud1","ZZ"],micro_left:["mcub1","Za"],micro_right:["mcuf1","Zb"],micro_row_address:["mvpa","Zc"],micro_up:["mcuu1","Zd"],newline:["nel","nw"],order_of_pins:["porder","Ze"],orig_colors:["oc","oc"],orig_pair:["op","op"],pad_char:["pad","pc"],parm_dch:["dch","DC"],parm_delete_line:["dl","DL"],parm_down_cursor:["cud","DO"],parm_down_micro:["mcud","Zf"],parm_ich:["ich","IC"],parm_index:["indn","SF"],parm_insert_line:["il","AL"],parm_left_cursor:["cub","LE"],parm_left_micro:["mcub","Zg"],parm_right_cursor:["cuf","RI"],parm_right_micro:["mcuf","Zh"],parm_rindex:["rin","SR"],parm_up_cursor:["cuu","UP"],parm_up_micro:["mcuu","Zi"],pkey_key:["pfkey","pk"],pkey_local:["pfloc","pl"],pkey_xmit:["pfx","px"],plab_norm:["pln","pn"],print_screen:["mc0","ps"],prtr_non:["mc5p","pO"],prtr_off:["mc4","pf"],prtr_on:["mc5","po"],pulse:["pulse","PU"],quick_dial:["qdial","QD"],remove_clock:["rmclk","RC"],repeat_char:["rep","rp"],req_for_input:["rfi","RF"],reset_1string:["rs1","r1"],reset_2string:["rs2","r2"],reset_3string:["rs3","r3"],reset_file:["rf","rf"],restore_cursor:["rc","rc"],row_address:["vpa","cv"],save_cursor:["sc","sc"],scroll_forward:["ind","sf"],scroll_reverse:["ri","sr"],select_char_set:["scs","Zj"],set_attributes:["sgr","sa"],set_background:["setb","Sb"],set_bottom_margin:["smgb","Zk"],set_bottom_margin_parm:["smgbp","Zl"],set_clock:["sclk","SC"],set_color_pair:["scp","sp"],set_foreground:["setf","Sf"],set_left_margin:["smgl","ML"],set_left_margin_parm:["smglp","Zm"],set_right_margin:["smgr","MR"],set_right_margin_parm:["smgrp","Zn"],set_tab:["hts","st"],set_top_margin:["smgt","Zo"],set_top_margin_parm:["smgtp","Zp"],set_window:["wind","wi"],start_bit_image:["sbim","Zq"],start_char_set_def:["scsd","Zr"],stop_bit_image:["rbim","Zs"],stop_char_set_def:["rcsd","Zt"],subscript_characters:["subcs","Zu"],superscript_characters:["supcs","Zv"],tab:["ht","ta"],these_cause_cr:["docr","Zw"],to_status_line:["tsl","ts"],tone:["tone","TO"],underline_char:["uc","uc"],up_half_line:["hu","hu"],user0:["u0","u0"],user1:["u1","u1"],user2:["u2","u2"],user3:["u3","u3"],user4:["u4","u4"],user5:["u5","u5"],user6:["u6","u6"],user7:["u7","u7"],user8:["u8","u8"],user9:["u9","u9"],wait_tone:["wait","WA"],xoff_character:["xoffc","XF"],xon_character:["xonc","XN"],zero_motion:["zerom","Zx"],alt_scancode_esc:["scesa","S8"],bit_image_carriage_return:["bicr","Yv"],bit_image_newline:["binel","Zz"],bit_image_repeat:["birep","Xy"],char_set_names:["csnm","Zy"],code_set_init:["csin","ci"],color_names:["colornm","Yw"],define_bit_image_region:["defbi","Yx"],device_type:["devt","dv"],display_pc_char:["dispc","S1"],end_bit_image_region:["endbi","Yy"],enter_pc_charset_mode:["smpch","S2"],enter_scancode_mode:["smsc","S4"],exit_pc_charset_mode:["rmpch","S3"],exit_scancode_mode:["rmsc","S5"],get_mouse:["getm","Gm"],key_mouse:["kmous","Km"],mouse_info:["minfo","Mi"],pc_term_options:["pctrm","S6"],pkey_plab:["pfxl","xl"],req_mouse_pos:["reqmp","RQ"],scancode_escape:["scesc","S7"],set0_des_seq:["s0ds","s0"],set1_des_seq:["s1ds","s1"],set2_des_seq:["s2ds","s2"],set3_des_seq:["s3ds","s3"],set_a_background:["setab","AB"],set_a_foreground:["setaf","AF"],set_color_band:["setcolor","Yz"],set_lr_margin:["smglr","ML"],set_page_length:["slines","YZ"],set_tb_margin:["smgtb","MT"],enter_horizontal_hl_mode:["ehhlm","Xh"],enter_left_hl_mode:["elhlm","Xl"],enter_low_hl_mode:["elohlm","Xo"],enter_right_hl_mode:["erhlm","Xr"],enter_top_hl_mode:["ethlm","Xt"],enter_vertical_hl_mode:["evhlm","Xv"],set_a_attributes:["sgr1","sA"],set_pglen_inch:["slength","sL"]}},{}],59:[function(require,module,exports){exports.match=function(r1,g1,b1){if(typeof r1==="string"){var hex=r1;if(hex[0]!=="#"){return-1}hex=exports.hexToRGB(hex);r1=hex[0],g1=hex[1],b1=hex[2]}else if(Array.isArray(r1)){b1=r1[2],g1=r1[1],r1=r1[0]}var hash=r1<<16|g1<<8|b1;if(exports._cache[hash]!=null){return exports._cache[hash]}var ldiff=Infinity,li=-1,i=0,c,r2,g2,b2,diff;for(;i<exports.vcolors.length;i++){c=exports.vcolors[i];r2=c[0];g2=c[1];b2=c[2];diff=colorDistance(r1,g1,b1,r2,g2,b2);if(diff===0){li=i;break}if(diff<ldiff){ldiff=diff;li=i}}return exports._cache[hash]=li};exports.RGBToHex=function(r,g,b){if(Array.isArray(r)){b=r[2],g=r[1],r=r[0]}function hex(n){n=n.toString(16);if(n.length<2)n="0"+n;return n}return"#"+hex(r)+hex(g)+hex(b)};exports.hexToRGB=function(hex){if(hex.length===4){hex=hex[0]+hex[1]+hex[1]+hex[2]+hex[2]+hex[3]+hex[3]}var col=parseInt(hex.substring(1),16),r=col>>16&255,g=col>>8&255,b=col&255;return[r,g,b]};function colorDistance(r1,g1,b1,r2,g2,b2){return Math.pow(30*(r1-r2),2)+Math.pow(59*(g1-g2),2)+Math.pow(11*(b1-b2),2)}exports.mixColors=function(c1,c2,alpha){if(c1===511)c1=0;if(c2===511)c2=0;if(alpha==null)alpha=.5;c1=exports.vcolors[c1];var r1=c1[0];var g1=c1[1];var b1=c1[2];c2=exports.vcolors[c2];var r2=c2[0];var g2=c2[1];var b2=c2[2];r1+=(r2-r1)*alpha|0;g1+=(g2-g1)*alpha|0;b1+=(b2-b1)*alpha|0;return exports.match([r1,g1,b1])};exports.blend=function blend(attr,attr2,alpha){var name,i,c,nc;var bg=attr&511;if(attr2!=null){var bg2=attr2&511;if(bg===511)bg=0;if(bg2===511)bg2=0;bg=exports.mixColors(bg,bg2,alpha)}else{if(blend._cache[bg]!=null){bg=blend._cache[bg]}else if(bg>=8&&bg<=15){bg-=8}else{name=exports.ncolors[bg];if(name){for(i=0;i<exports.ncolors.length;i++){if(name===exports.ncolors[i]&&i!==bg){c=exports.vcolors[bg];nc=exports.vcolors[i];if(nc[0]+nc[1]+nc[2]<c[0]+c[1]+c[2]){blend._cache[bg]=i;bg=i;break}}}}}}attr&=~511;attr|=bg;var fg=attr>>9&511;if(attr2!=null){var fg2=attr2>>9&511;if(fg===511){fg=248}else{if(fg===511)fg=7;if(fg2===511)fg2=7;fg=exports.mixColors(fg,fg2,alpha)}}else{if(blend._cache[fg]!=null){fg=blend._cache[fg]}else if(fg>=8&&fg<=15){fg-=8}else{name=exports.ncolors[fg];if(name){for(i=0;i<exports.ncolors.length;i++){if(name===exports.ncolors[i]&&i!==fg){c=exports.vcolors[fg];nc=exports.vcolors[i];if(nc[0]+nc[1]+nc[2]<c[0]+c[1]+c[2]){blend._cache[fg]=i;fg=i;break}}}}}}attr&=~(511<<9);attr|=fg<<9;return attr};exports.blend._cache={};exports._cache={};exports.reduce=function(color,total){if(color>=16&&total<=16){color=exports.ccolors[color]}else if(color>=8&&total<=8){color-=8}else if(color>=2&&total<=2){color%=2}return color};exports.xterm=["#000000","#cd0000","#00cd00","#cdcd00","#0000ee","#cd00cd","#00cdcd","#e5e5e5","#7f7f7f","#ff0000","#00ff00","#ffff00","#5c5cff","#ff00ff","#00ffff","#ffffff"];exports.colors=function(){var cols=exports.colors=[],_cols=exports.vcolors=[],r,g,b,i,l;function hex(n){n=n.toString(16);if(n.length<2)n="0"+n;return n}function push(i,r,g,b){cols[i]="#"+hex(r)+hex(g)+hex(b);_cols[i]=[r,g,b]}exports.xterm.forEach(function(c,i){c=parseInt(c.substring(1),16);push(i,c>>16&255,c>>8&255,c&255)});for(r=0;r<6;r++){for(g=0;g<6;g++){for(b=0;b<6;b++){i=16+r*36+g*6+b;push(i,r?r*40+55:0,g?g*40+55:0,b?b*40+55:0)}}}for(g=0;g<24;g++){l=g*10+8;i=232+g;push(i,l,l,l)}return cols}();exports.ccolors=function(){var _cols=exports.vcolors.slice(),cols=exports.colors.slice(),out;exports.vcolors=exports.vcolors.slice(0,8);exports.colors=exports.colors.slice(0,8);out=cols.map(exports.match);exports.colors=cols;exports.vcolors=_cols;exports.ccolors=out;return out}();var colorNames=exports.colorNames={default:-1,normal:-1,bg:-1,fg:-1,black:0,red:1,green:2,yellow:3,blue:4,magenta:5,cyan:6,white:7,lightblack:8,lightred:9,lightgreen:10,lightyellow:11,lightblue:12,lightmagenta:13,lightcyan:14,lightwhite:15,brightblack:8,brightred:9,brightgreen:10,brightyellow:11,brightblue:12,brightmagenta:13,brightcyan:14,brightwhite:15,grey:8,gray:8,lightgrey:7,lightgray:7,brightgrey:7,brightgray:7};exports.convert=function(color){if(typeof color==="number"){}else if(typeof color==="string"){color=color.replace(/[\- ]/g,"");if(colorNames[color]!=null){color=colorNames[color]}else{color=exports.match(color)}}else if(Array.isArray(color)){color=exports.match(color)}else{color=-1}return color!==-1?color:511};exports.ccolors={blue:[4,12,[17,21],[24,27],[31,33],[38,39],45,[54,57],[60,63],[67,69],[74,75],81,[91,93],[97,99],[103,105],[110,111],117,[128,129],[134,135],[140,141],[146,147],153,165,171,177,183,189],green:[2,10,22,[28,29],[34,36],[40,43],[46,50],[64,65],[70,72],[76,79],[82,86],[106,108],[112,115],[118,122],[148,151],[154,158],[190,194]],cyan:[6,14,23,30,37,44,51,66,73,80,87,109,116,123,152,159,195],red:[1,9,52,[88,89],[94,95],[124,126],[130,132],[136,138],[160,163],[166,169],[172,175],[178,181],[196,200],[202,206],[208,212],[214,218],[220,224]],magenta:[5,13,53,90,96,127,133,139,164,170,176,182,201,207,213,219,225],yellow:[3,11,58,[100,101],[142,144],[184,187],[226,230]],black:[0,8,16,59,102,[232,243]],white:[7,15,145,188,231,[244,255]]};exports.ncolors=[];Object.keys(exports.ccolors).forEach(function(name){exports.ccolors[name].forEach(function(offset){if(typeof offset==="number"){exports.ncolors[offset]=name;exports.ccolors[offset]=exports.colorNames[name];return}for(var i=offset[0],l=offset[1];i<=l;i++){exports.ncolors[i]=name;exports.ccolors[i]=exports.colorNames[name]}});delete exports.ccolors[name]})},{}],60:[function(require,module,exports){var slice=Array.prototype.slice;function EventEmitter(){if(!this._events)this._events={}}EventEmitter.prototype.setMaxListeners=function(n){this._maxListeners=n};EventEmitter.prototype.addListener=function(type,listener){if(!this._events[type]){this._events[type]=listener}else if(typeof this._events[type]==="function"){this._events[type]=[this._events[type],listener]}else{this._events[type].push(listener)}this._emit("newListener",[type,listener])};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.removeListener=function(type,listener){var handler=this._events[type];if(!handler)return;if(typeof handler==="function"||handler.length===1){delete this._events[type];this._emit("removeListener",[type,listener]);return}for(var i=0;i<handler.length;i++){if(handler[i]===listener||handler[i].listener===listener){handler.splice(i,1);this._emit("removeListener",[type,listener]);return}}};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function(type){if(type){delete this._events[type]}else{this._events={}}};EventEmitter.prototype.once=function(type,listener){function on(){this.removeListener(type,on);return listener.apply(this,arguments)}on.listener=listener;return this.on(type,on)};EventEmitter.prototype.listeners=function(type){return typeof this._events[type]==="function"?[this._events[type]]:this._events[type]||[]};EventEmitter.prototype._emit=function(type,args){var handler=this._events[type],ret;if(!handler){if(type==="error"){throw new args[0]}return}if(typeof handler==="function"){return handler.apply(this,args)}for(var i=0;i<handler.length;i++){if(handler[i].apply(this,args)===false){ret=false}}return ret!==false};EventEmitter.prototype.emit=function(type){var args=slice.call(arguments,1),params=slice.call(arguments),el=this;this._emit("event",params);if(this.type==="screen"){return this._emit(type,args)}if(this._emit(type,args)===false){return false}type="element "+type;args.unshift(this);do{if(!el._events[type])continue;if(el._emit(type,args)===false){return false}}while(el=el.parent);return true};exports=EventEmitter;exports.EventEmitter=EventEmitter;module.exports=exports},{}],61:[function(require,module,exports){(function(process,Buffer){var net=require("net");var fs=require("fs");var EventEmitter=require("events").EventEmitter;var GPM_USE_MAGIC=false;var GPM_MOVE=1,GPM_DRAG=2,GPM_DOWN=4,GPM_UP=8;var GPM_DOUBLE=32,GPM_MFLAG=128;var GPM_REQ_NOPASTE=3,GPM_HARD=256;var GPM_MAGIC=1198550348;var GPM_SOCKET="/dev/gpmctl";function send_config(socket,Gpm_Connect,callback){var buffer;if(GPM_USE_MAGIC){buffer=new Buffer(20);buffer.writeUInt32LE(GPM_MAGIC,0);buffer.writeUInt16LE(Gpm_Connect.eventMask,4);buffer.writeUInt16LE(Gpm_Connect.defaultMask,6);buffer.writeUInt16LE(Gpm_Connect.minMod,8);buffer.writeUInt16LE(Gpm_Connect.maxMod,10);buffer.writeInt16LE(process.pid,12);buffer.writeInt16LE(Gpm_Connect.vc,16)}else{buffer=new Buffer(16);buffer.writeUInt16LE(Gpm_Connect.eventMask,0);buffer.writeUInt16LE(Gpm_Connect.defaultMask,2);buffer.writeUInt16LE(Gpm_Connect.minMod,4);buffer.writeUInt16LE(Gpm_Connect.maxMod,6);buffer.writeInt16LE(Gpm_Connect.pid,8);buffer.writeInt16LE(Gpm_Connect.vc,12)}socket.write(buffer,function(){if(callback)callback()})}function parseEvent(raw){var evnt={};evnt.buttons=raw[0];evnt.modifiers=raw[1];evnt.vc=raw.readUInt16LE(2);evnt.dx=raw.readInt16LE(4);evnt.dy=raw.readInt16LE(6);evnt.x=raw.readInt16LE(8);evnt.y=raw.readInt16LE(10);evnt.type=raw.readInt16LE(12);evnt.clicks=raw.readInt32LE(16);evnt.margin=raw.readInt32LE(20);evnt.wdx=raw.readInt16LE(24);evnt.wdy=raw.readInt16LE(26);return evnt}function GpmClient(options){if(!(this instanceof GpmClient)){return new GpmClient(options)}EventEmitter.call(this);var pid=process.pid;var path;try{path=fs.readlinkSync("/proc/"+pid+"/fd/0")}catch(e){}var tty=/tty[0-9]+$/.exec(path);if(tty===null){}var vc;if(tty){tty=tty[0];vc=+/[0-9]+$/.exec(tty)[0]}var self=this;if(tty){fs.stat(GPM_SOCKET,function(err,stat){if(err||!stat.isSocket()){return}var conf={eventMask:65535,defaultMask:GPM_MOVE|GPM_HARD,minMod:0,maxMod:65535,pid:pid,vc:vc};var gpm=net.createConnection(GPM_SOCKET);this.gpm=gpm;gpm.on("connect",function(){send_config(gpm,conf,function(){conf.pid=0;conf.vc=GPM_REQ_NOPASTE})});gpm.on("data",function(packet){var evnt=parseEvent(packet);switch(evnt.type&15){case GPM_MOVE:if(evnt.dx||evnt.dy){self.emit("move",evnt.buttons,evnt.modifiers,evnt.x,evnt.y)}if(evnt.wdx||evnt.wdy){self.emit("mousewheel",evnt.buttons,evnt.modifiers,evnt.x,evnt.y,evnt.wdx,evnt.wdy)}break;case GPM_DRAG:if(evnt.dx||evnt.dy){self.emit("drag",evnt.buttons,evnt.modifiers,evnt.x,evnt.y)}if(evnt.wdx||evnt.wdy){self.emit("mousewheel",evnt.buttons,evnt.modifiers,evnt.x,evnt.y,evnt.wdx,evnt.wdy)}break;case GPM_DOWN:self.emit("btndown",evnt.buttons,evnt.modifiers,evnt.x,evnt.y);if(evnt.type&GPM_DOUBLE){self.emit("dblclick",evnt.buttons,evnt.modifiers,evnt.x,evnt.y)}break;case GPM_UP:self.emit("btnup",evnt.buttons,evnt.modifiers,evnt.x,evnt.y);if(!(evnt.type&GPM_MFLAG)){self.emit("click",evnt.buttons,evnt.modifiers,evnt.x,evnt.y)}break}});gpm.on("error",function(){self.stop()})})}}GpmClient.prototype.__proto__=EventEmitter.prototype;GpmClient.prototype.stop=function(){if(this.gpm){this.gpm.end()}delete this.gpm};GpmClient.prototype.ButtonName=function(btn){if(btn&4)return"left";if(btn&2)return"middle";if(btn&1)return"right";return""};GpmClient.prototype.hasShiftKey=function(mod){return mod&1?true:false};GpmClient.prototype.hasCtrlKey=function(mod){return mod&4?true:false};GpmClient.prototype.hasMetaKey=function(mod){return mod&8?true:false};module.exports=GpmClient}).call(this,require("_process"),require("buffer").Buffer)},{_process:30,buffer:10,events:12,fs:1,net:1}],62:[function(require,module,exports){var fs=require("fs");var unicode=require("./unicode");var helpers=exports;helpers.merge=function(a,b){Object.keys(b).forEach(function(key){a[key]=b[key]});return a};helpers.asort=function(obj){return obj.sort(function(a,b){a=a.name.toLowerCase();b=b.name.toLowerCase();if(a[0]==="."&&b[0]==="."){a=a[1];b=b[1]}else{a=a[0];b=b[0]}return a>b?1:a<b?-1:0})};helpers.hsort=function(obj){return obj.sort(function(a,b){return b.index-a.index})};helpers.findFile=function(start,target){return function read(dir){var files,file,stat,out;if(dir==="/dev"||dir==="/sys"||dir==="/proc"||dir==="/net"){return null}try{files=fs.readdirSync(dir)}catch(e){files=[]}for(var i=0;i<files.length;i++){file=files[i];if(file===target){return(dir==="/"?"":dir)+"/"+file}try{stat=fs.lstatSync((dir==="/"?"":dir)+"/"+file)}catch(e){stat=null}if(stat&&stat.isDirectory()&&!stat.isSymbolicLink()){out=read((dir==="/"?"":dir)+"/"+file);if(out)return out}}return null}(start)};helpers.escape=function(text){return text.replace(/[{}]/g,function(ch){return ch==="{"?"{open}":"{close}"})};helpers.parseTags=function(text,screen){return helpers.Element.prototype._parseTags.call({parseTags:true,screen:screen||helpers.Screen.global},text)};helpers.generateTags=function(style,text){var open="",close="";Object.keys(style||{}).forEach(function(key){var val=style[key];if(typeof val==="string"){val=val.replace(/^light(?!-)/,"light-");val=val.replace(/^bright(?!-)/,"bright-");open="{"+val+"-"+key+"}"+open;close+="{/"+val+"-"+key+"}"}else{if(val===true){open="{"+key+"}"+open;close+="{/"+key+"}"}}});if(text!=null){return open+text+close}return{open:open,close:close}};helpers.attrToBinary=function(style,element){return helpers.Element.prototype.sattr.call(element||{},style)};helpers.stripTags=function(text){if(!text)return"";return text.replace(/{(\/?)([\w\-,;!#]*)}/g,"").replace(/\x1b\[[\d;]*m/g,"")};helpers.cleanTags=function(text){return helpers.stripTags(text).trim()};helpers.dropUnicode=function(text){if(!text)return"";return text.replace(unicode.chars.all,"??").replace(unicode.chars.combining,"").replace(unicode.chars.surrogate,"?")};helpers.__defineGetter__("Screen",function(){if(!helpers._screen){helpers._screen=require("./widgets/screen")}return helpers._screen});helpers.__defineGetter__("Element",function(){if(!helpers._element){helpers._element=require("./widgets/element")}return helpers._element})},{"./unicode":66,"./widgets/element":73,"./widgets/screen":93,fs:1}],63:[function(require,module,exports){(function(Buffer){var EventEmitter=require("events").EventEmitter;function listenerCount(stream,event){return EventEmitter.listenerCount?EventEmitter.listenerCount(stream,event):stream.listeners(event).length}function emitKeypressEvents(stream){if(stream._keypressDecoder)return;var StringDecoder=require("string_decoder").StringDecoder;stream._keypressDecoder=new StringDecoder("utf8");function onData(b){if(listenerCount(stream,"keypress")>0){var r=stream._keypressDecoder.write(b);if(r)emitKeys(stream,r)}else{stream.removeListener("data",onData);stream.on("newListener",onNewListener)}}function onNewListener(event){if(event==="keypress"){stream.on("data",onData);stream.removeListener("newListener",onNewListener)}}if(listenerCount(stream,"keypress")>0){stream.on("data",onData)}else{stream.on("newListener",onNewListener)}}exports.emitKeypressEvents=emitKeypressEvents;var metaKeyCodeReAnywhere=/(?:\x1b)([a-zA-Z0-9])/;var metaKeyCodeRe=new RegExp("^"+metaKeyCodeReAnywhere.source+"$");var functionKeyCodeReAnywhere=new RegExp("(?:+)(O|N|\\[|\\[\\[)(?:"+["(\\d+)(?:;(\\d+))?([~^$])","(?:M([@ #!a`])(.)(.))","(?:1;)?(\\d+)?([a-zA-Z])"].join("|")+")");var functionKeyCodeRe=new RegExp("^"+functionKeyCodeReAnywhere.source);var escapeCodeReAnywhere=new RegExp([functionKeyCodeReAnywhere.source,metaKeyCodeReAnywhere.source,/\x1b./.source].join("|"));function emitKeys(stream,s){if(Buffer.isBuffer(s)){if(s[0]>127&&s[1]===undefined){s[0]-=128;s=""+s.toString(stream.encoding||"utf-8")}else{s=s.toString(stream.encoding||"utf-8")}}if(isMouse(s))return;var buffer=[];var match;while(match=escapeCodeReAnywhere.exec(s)){buffer=buffer.concat(s.slice(0,match.index).split(""));buffer.push(match[0]);s=s.slice(match.index+match[0].length)}buffer=buffer.concat(s.split(""));buffer.forEach(function(s){var ch,key={sequence:s,name:undefined,ctrl:false,meta:false,shift:false},parts;if(s==="\r"){key.name="return"}else if(s==="\n"){key.name="enter"}else if(s==="\t"){key.name="tab"}else if(s==="\b"||s===""||s===""||s==="\b"){key.name="backspace";key.meta=s.charAt(0)===""}else if(s===""||s===""){key.name="escape";key.meta=s.length===2}else if(s===" "||s===" "){key.name="space";key.meta=s.length===2}else if(s.length===1&&s<=""){key.name=String.fromCharCode(s.charCodeAt(0)+"a".charCodeAt(0)-1);key.ctrl=true}else if(s.length===1&&s>="a"&&s<="z"){key.name=s}else if(s.length===1&&s>="A"&&s<="Z"){key.name=s.toLowerCase();key.shift=true}else if(parts=metaKeyCodeRe.exec(s)){key.name=parts[1].toLowerCase();key.meta=true;key.shift=/^[A-Z]$/.test(parts[1])}else if(parts=functionKeyCodeRe.exec(s)){var code=(parts[1]||"")+(parts[2]||"")+(parts[4]||"")+(parts[9]||""),modifier=(parts[3]||parts[8]||1)-1;key.ctrl=!!(modifier&4);key.meta=!!(modifier&10);key.shift=!!(modifier&1);key.code=code;switch(code){case"OP":key.name="f1";break;case"OQ":key.name="f2";break;case"OR":key.name="f3";break;case"OS":key.name="f4";break;case"[11~":key.name="f1";break;case"[12~":key.name="f2";break;case"[13~":key.name="f3";break;case"[14~":key.name="f4";break;case"[[A":key.name="f1";break;case"[[B":key.name="f2";break;case"[[C":key.name="f3";break;case"[[D":key.name="f4";break;case"[[E":key.name="f5";break;case"[15~":key.name="f5";break;case"[17~":key.name="f6";break;case"[18~":key.name="f7";break;case"[19~":key.name="f8";break;case"[20~":key.name="f9";break;case"[21~":key.name="f10";break;case"[23~":key.name="f11";break;case"[24~":key.name="f12";break;case"[A":key.name="up";break;case"[B":key.name="down";break;case"[C":key.name="right";break;case"[D":key.name="left";break;case"[E":key.name="clear";break;case"[F":key.name="end";break;case"[H":key.name="home";break;case"OA":key.name="up";break;case"OB":key.name="down";break;case"OC":key.name="right";break;case"OD":key.name="left";break;case"OE":key.name="clear";break;case"OF":key.name="end";break;case"OH":key.name="home";break;case"[1~":key.name="home";break;case"[2~":key.name="insert";break;case"[3~":key.name="delete";break;case"[4~":key.name="end";break;case"[5~":key.name="pageup";break;case"[6~":key.name="pagedown";break;case"[[5~":key.name="pageup";break;case"[[6~":key.name="pagedown";break;case"[7~":key.name="home";break;case"[8~":key.name="end";break;case"[a":key.name="up";key.shift=true;break;case"[b":key.name="down";key.shift=true;break;case"[c":key.name="right";key.shift=true;break;case"[d":key.name="left";key.shift=true;break;case"[e":key.name="clear";key.shift=true;break;case"[2$":key.name="insert";key.shift=true;break;case"[3$":key.name="delete";key.shift=true;break;case"[5$":key.name="pageup";key.shift=true;break;case"[6$":key.name="pagedown";key.shift=true;break;case"[7$":key.name="home";key.shift=true;break;case"[8$":key.name="end";key.shift=true;break;case"Oa":key.name="up";key.ctrl=true;break;case"Ob":key.name="down";key.ctrl=true;break;case"Oc":key.name="right";key.ctrl=true;break;case"Od":key.name="left";key.ctrl=true;break;case"Oe":key.name="clear";key.ctrl=true;break;case"[2^":key.name="insert";key.ctrl=true;break;case"[3^":key.name="delete";key.ctrl=true;break;case"[5^":key.name="pageup";key.ctrl=true;break;case"[6^":key.name="pagedown";key.ctrl=true;break;case"[7^":key.name="home";key.ctrl=true;break;case"[8^":key.name="end";key.ctrl=true;break;case"[Z":key.name="tab";key.shift=true;break;default:key.name="undefined";break}}if(key.name===undefined){key=undefined}if(s.length===1){ch=s}if(key||ch){stream.emit("keypress",ch,key)}})}function isMouse(s){return/\x1b\[M/.test(s)||/\x1b\[M([\x00\u0020-\uffff]{3})/.test(s)||/\x1b\[(\d+;\d+;\d+)M/.test(s)||/\x1b\[<(\d+;\d+;\d+)([mM])/.test(s)||/\x1b\[<(\d+;\d+;\d+;\d+)&w/.test(s)||/\x1b\[24([0135])~\[(\d+),(\d+)\]\r/.test(s)||/\x1b\[(O|I)/.test(s)}}).call(this,{isBuffer:require("../../../../../.npm-prefix/lib/node_modules/browserify/node_modules/is-buffer/index.js")})},{"../../../../../.npm-prefix/lib/node_modules/browserify/node_modules/is-buffer/index.js":15,events:12,string_decoder:51}],64:[function(require,module,exports){(function(Buffer,process,global){var EventEmitter=require("events").EventEmitter,StringDecoder=require("string_decoder").StringDecoder,cp=require("child_process"),util=require("util"),fs=require("fs");var Tput=require("./tput"),colors=require("./colors"),slice=Array.prototype.slice;var nextTick=global.setImmediate||process.nextTick.bind(process);function Program(options){var self=this;if(!(this instanceof Program)){return new Program(options)}Program.bind(this);EventEmitter.call(this);if(!options||options.__proto__!==Object.prototype){options={input:arguments[0],output:arguments[1]}}this.options=options;this.input=options.input||process.stdin;this.output=options.output||process.stdout;options.log=options.log||options.dump;if(options.log){this._logger=fs.createWriteStream(options.log);if(options.dump)this.setupDump()}this.zero=options.zero!==false;this.useBuffer=options.buffer;this.x=0;this.y=0;this.savedX=0;this.savedY=0;this.cols=this.output.columns||1;this.rows=this.output.rows||1;this.scrollTop=0;this.scrollBottom=this.rows-1;this._terminal=options.terminal||options.term||process.env.TERM||(process.platform==="win32"?"windows-ansi":"xterm");this._terminal=this._terminal.toLowerCase();this.isOSXTerm=process.env.TERM_PROGRAM==="Apple_Terminal";this.isiTerm2=process.env.TERM_PROGRAM==="iTerm.app"||!!process.env.ITERM_SESSION_ID;this.isXFCE=/xfce/i.test(process.env.COLORTERM);this.isTerminator=!!process.env.TERMINATOR_UUID;this.isLXDE=false;this.isVTE=!!process.env.VTE_VERSION||this.isXFCE||this.isTerminator||this.isLXDE;this.isRxvt=/rxvt/i.test(process.env.COLORTERM);this.isXterm=false;this.tmux=!!process.env.TMUX;this.tmuxVersion=function(){if(!self.tmux)return 2;try{var version=cp.execFileSync("tmux",["-V"],{encoding:"utf8"});return+/^tmux ([\d.]+)/i.exec(version.trim().split("\n")[0])[1]}catch(e){return 2}}();this._buf="";this._flush=this.flush.bind(this);if(options.tput!==false){this.setupTput()}this.listen()}Program.global=null;Program.total=0;Program.instances=[];Program.bind=function(program){if(!Program.global){Program.global=program}if(!~Program.instances.indexOf(program)){Program.instances.push(program);program.index=Program.total;Program.total++}if(Program._bound)return;Program._bound=true;unshiftEvent(process,"exit",Program._exitHandler=function(){Program.instances.forEach(function(program){program.flush();program._exiting=true})})};Program.prototype.__proto__=EventEmitter.prototype;Program.prototype.type="program";Program.prototype.log=function(){return this._log("LOG",util.format.apply(util,arguments))};Program.prototype.debug=function(){if(!this.options.debug)return;return this._log("DEBUG",util.format.apply(util,arguments))};Program.prototype._log=function(pre,msg){if(!this._logger)return;return this._logger.write(pre+": "+msg+"\n-\n")};Program.prototype.setupDump=function(){var self=this,write=this.output.write,decoder=new StringDecoder("utf8");function stringify(data){return caret(data.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")).replace(/[^ -~]/g,function(ch){if(ch.charCodeAt(0)>255)return ch;ch=ch.charCodeAt(0).toString(16);if(ch.length>2){if(ch.length<4)ch="0"+ch;return"\\u"+ch}if(ch.length<2)ch="0"+ch;return"\\x"+ch})}function caret(data){return data.replace(/[\0\x80\x1b-\x1f\x7f\x01-\x1a]/g,function(ch){switch(ch){case"\0":case"":ch="@";break;case"":ch="[";break;case"":ch="\\";break;case"":ch="]";break;case"":ch="^";break;case"":ch="_";break;case"":ch="?";break;default:ch=ch.charCodeAt(0);if(ch>=1&&ch<=26){ch=String.fromCharCode(ch+64)}else{return String.fromCharCode(ch)}break}return"^"+ch})}this.input.on("data",function(data){self._log("IN",stringify(decoder.write(data)))});this.output.write=function(data){self._log("OUT",stringify(data));return write.apply(this,arguments)}};Program.prototype.setupTput=function(){if(this._tputSetup)return;this._tputSetup=true;var self=this,options=this.options,write=this._write.bind(this);var tput=this.tput=new Tput({terminal:this.terminal,padding:options.padding,extended:options.extended,printf:options.printf,termcap:options.termcap,forceUnicode:options.forceUnicode});if(tput.error){nextTick(function(){self.emit("warning",tput.error.message)})}if(tput.padding){nextTick(function(){self.emit("warning","Terminfo padding has been enabled.")})}this.put=function(){var args=slice.call(arguments),cap=args.shift();if(tput[cap]){return this._write(tput[cap].apply(tput,args))}};Object.keys(tput).forEach(function(key){if(self[key]==null){self[key]=tput[key]}if(typeof tput[key]!=="function"){self.put[key]=tput[key];return}if(tput.padding){self.put[key]=function(){return tput._print(tput[key].apply(tput,arguments),write)}}else{self.put[key]=function(){return self._write(tput[key].apply(tput,arguments))}}})};Program.prototype.__defineGetter__("terminal",function(){return this._terminal});Program.prototype.__defineSetter__("terminal",function(terminal){this.setTerminal(terminal);return this.terminal});Program.prototype.setTerminal=function(terminal){this._terminal=terminal.toLowerCase();delete this._tputSetup;this.setupTput()};Program.prototype.has=function(name){return this.tput?this.tput.has(name):false};Program.prototype.term=function(is){return this.terminal.indexOf(is)===0};Program.prototype.listen=function(){var self=this;if(!this.input._blessedInput){this.input._blessedInput=1;this._listenInput()}else{this.input._blessedInput++}this.on("newListener",this._newHandler=function fn(type){if(type==="keypress"||type==="mouse"){self.removeListener("newListener",fn);if(self.input.setRawMode&&!self.input.isRaw){self.input.setRawMode(true);self.input.resume()}}});this.on("newListener",function fn(type){if(type==="mouse"){self.removeListener("newListener",fn);self.bindMouse()}});if(!this.output._blessedOutput){this.output._blessedOutput=1;this._listenOutput()}else{this.output._blessedOutput++}};Program.prototype._listenInput=function(){var keys=require("./keys"),self=this;this.input.on("keypress",this.input._keypressHandler=function(ch,key){key=key||{ch:ch};if(key.name==="undefined"&&(key.code==="[M"||key.code==="[I"||key.code==="[O")){return}if(key.name==="undefined"){return}if(key.name==="enter"&&key.sequence==="\n"){key.name="linefeed"}if(key.name==="return"&&key.sequence==="\r"){self.input.emit("keypress",ch,merge({},key,{name:"enter"}))}var name=(key.ctrl?"C-":"")+(key.meta?"M-":"")+(key.shift&&key.name?"S-":"")+(key.name||ch);key.full=name;Program.instances.forEach(function(program){if(program.input!==self.input)return;program.emit("keypress",ch,key);program.emit("key "+name,ch,key)})});this.input.on("data",this.input._dataHandler=function(data){Program.instances.forEach(function(program){if(program.input!==self.input)return;program.emit("data",data)})});keys.emitKeypressEvents(this.input)};Program.prototype._listenOutput=function(){var self=this;if(!this.output.isTTY){nextTick(function(){self.emit("warning","Output is not a TTY")})}function resize(){Program.instances.forEach(function(program){if(program.output!==self.output)return;program.cols=program.output.columns;program.rows=program.output.rows;program.emit("resize")})}this.output.on("resize",this.output._resizeHandler=function(){Program.instances.forEach(function(program){if(program.output!==self.output)return;if(!program.options.resizeTimeout){return resize()}if(program._resizeTimer){clearTimeout(program._resizeTimer);delete program._resizeTimer}var time=typeof program.options.resizeTimeout==="number"?program.options.resizeTimeout:300;program._resizeTimer=setTimeout(resize,time)})})};Program.prototype.destroy=function(){var index=Program.instances.indexOf(this);if(~index){Program.instances.splice(index,1);Program.total--;this.flush();this._exiting=true;Program.global=Program.instances[0];if(Program.total===0){Program.global=null;process.removeListener("exit",Program._exitHandler);delete Program._exitHandler;delete Program._bound}this.input._blessedInput--;this.output._blessedOutput--;if(this.input._blessedInput===0){this.input.removeListener("keypress",this.input._keypressHandler);this.input.removeListener("data",this.input._dataHandler);delete this.input._keypressHandler;delete this.input._dataHandler;if(this.input.setRawMode){if(this.input.isRaw){this.input.setRawMode(false)}if(!this.input.destroyed){this.input.pause()}}}if(this.output._blessedOutput===0){this.output.removeListener("resize",this.output._resizeHandler);delete this.output._resizeHandler}this.removeListener("newListener",this._newHandler);delete this._newHandler;this.destroyed=true;this.emit("destroy")}};Program.prototype.key=function(key,listener){if(typeof key==="string")key=key.split(/\s*,\s*/);key.forEach(function(key){return this.on("key "+key,listener)},this)};Program.prototype.onceKey=function(key,listener){if(typeof key==="string")key=key.split(/\s*,\s*/);key.forEach(function(key){return this.once("key "+key,listener)},this)};Program.prototype.unkey=Program.prototype.removeKey=function(key,listener){if(typeof key==="string")key=key.split(/\s*,\s*/);key.forEach(function(key){return this.removeListener("key "+key,listener)},this)};Program.prototype.bindMouse=function(){if(this._boundMouse)return;this._boundMouse=true;var decoder=new StringDecoder("utf8"),self=this;this.on("data",function(data){var text=decoder.write(data);if(!text)return;self._bindMouse(text,data)})};Program.prototype._bindMouse=function(s,buf){var self=this,key,parts,b,x,y,mod,params,down,page,button;key={name:undefined,ctrl:false,meta:false,shift:false};if(Buffer.isBuffer(s)){if(s[0]>127&&s[1]===undefined){s[0]-=128;s=""+s.toString("utf-8")}else{s=s.toString("utf-8")}}var bx=s.charCodeAt(4);var by=s.charCodeAt(5);if(buf[0]===27&&buf[1]===91&&buf[2]===77&&(this.isVTE||bx>=65533||by>=65533||bx>0&&bx<32||by>0&&by<32||buf[4]>223&&buf[4]<248&&buf.length===6||buf[5]>223&&buf[5]<248&&buf.length===6)){b=buf[3];x=buf[4];y=buf[5];if(x<32)x+=255;if(y<32)y+=255;s="[M"+String.fromCharCode(b)+String.fromCharCode(x)+String.fromCharCode(y)}if(parts=/^\x1b\[M([\x00\u0020-\uffff]{3})/.exec(s)){b=parts[1].charCodeAt(0);x=parts[1].charCodeAt(1);y=parts[1].charCodeAt(2);key.name="mouse";key.type="X10";key.raw=[b,x,y,parts[0]];key.buf=buf;key.x=x-32;key.y=y-32;if(this.zero)key.x--,key.y--;if(x===0)key.x=255;if(y===0)key.y=255;mod=b>>2;key.shift=!!(mod&1);key.meta=!!(mod>>1&1);key.ctrl=!!(mod>>2&1);b-=32;if(b>>6&1){key.action=b&1?"wheeldown":"wheelup";key.button="middle"}else if(b===3){key.action="mouseup";key.button=this._lastButton||"unknown";delete this._lastButton}else{key.action="mousedown";button=b&3;key.button=button===0?"left":button===1?"middle":button===2?"right":"unknown";this._lastButton=key.button}if(b===35||b===39||b===51||b===43||this.isVTE&&(b===32||b===36||b===48||b===40)){delete key.button;key.action="mousemove"}self.emit("mouse",key);return}if(parts=/^\x1b\[(\d+;\d+;\d+)M/.exec(s)){params=parts[1].split(";");b=+params[0];x=+params[1];y=+params[2];key.name="mouse";key.type="urxvt";key.raw=[b,x,y,parts[0]];key.buf=buf;key.x=x;key.y=y;if(this.zero)key.x--,key.y--;mod=b>>2;key.shift=!!(mod&1);key.meta=!!(mod>>1&1);key.ctrl=!!(mod>>2&1);if(b===128||b===129){b=67}b-=32;if(b>>6&1){key.action=b&1?"wheeldown":"wheelup";key.button="middle"}else if(b===3){key.action="mouseup";key.button=this._lastButton||"unknown";delete this._lastButton}else{key.action="mousedown";button=b&3;key.button=button===0?"left":button===1?"middle":button===2?"right":"unknown";this._lastButton=key.button}if(b===35||b===39||b===51||b===43||this.isVTE&&(b===32||b===36||b===48||b===40)){delete key.button;key.action="mousemove"}self.emit("mouse",key);return}if(parts=/^\x1b\[<(\d+;\d+;\d+)([mM])/.exec(s)){down=parts[2]==="M";params=parts[1].split(";");b=+params[0];x=+params[1];y=+params[2];key.name="mouse";key.type="sgr";key.raw=[b,x,y,parts[0]];key.buf=buf;key.x=x;key.y=y;if(this.zero)key.x--,key.y--;mod=b>>2;key.shift=!!(mod&1);key.meta=!!(mod>>1&1);key.ctrl=!!(mod>>2&1);if(b>>6&1){key.action=b&1?"wheeldown":"wheelup";key.button="middle"}else{key.action=down?"mousedown":"mouseup";button=b&3;key.button=button===0?"left":button===1?"middle":button===2?"right":"unknown"}if(b===35||b===39||b===51||b===43||this.isVTE&&(b===32||b===36||b===48||b===40)){delete key.button;key.action="mousemove"}self.emit("mouse",key);return}if(parts=/^\x1b\[<(\d+;\d+;\d+;\d+)&w/.exec(s)){params=parts[1].split(";");b=+params[0];x=+params[1];y=+params[2];page=+params[3];key.name="mouse";key.type="dec";key.raw=[b,x,y,parts[0]];key.buf=buf;key.x=x;key.y=y;key.page=page;if(this.zero)key.x--,key.y--;key.action=b===3?"mouseup":"mousedown";key.button=b===2?"left":b===4?"middle":b===6?"right":"unknown";self.emit("mouse",key);return}if(parts=/^\x1b\[24([0135])~\[(\d+),(\d+)\]\r/.exec(s)){b=+parts[1];x=+parts[2];y=+parts[3];key.name="mouse";key.type="vt300";key.raw=[b,x,y,parts[0]];key.buf=buf;key.x=x;key.y=y;if(this.zero)key.x--,key.y--;key.action="mousedown";key.button=b===1?"left":b===2?"middle":b===5?"right":"unknown";self.emit("mouse",key);return}if(parts=/^\x1b\[(O|I)/.exec(s)){key.action=parts[1]==="I"?"focus":"blur";self.emit("mouse",key);self.emit(key.action);return}};Program.prototype.enableGpm=function(){var self=this;var gpmclient=require("./gpmclient");if(this.gpm)return;this.gpm=gpmclient();this.gpm.on("btndown",function(btn,modifier,x,y){x--,y--;var key={name:"mouse",type:"GPM",action:"mousedown",button:self.gpm.ButtonName(btn),raw:[btn,modifier,x,y],x:x,y:y,shift:self.gpm.hasShiftKey(modifier),meta:self.gpm.hasMetaKey(modifier),ctrl:self.gpm.hasCtrlKey(modifier)};self.emit("mouse",key)});this.gpm.on("btnup",function(btn,modifier,x,y){x--,y--;var key={name:"mouse",type:"GPM",action:"mouseup",button:self.gpm.ButtonName(btn),raw:[btn,modifier,x,y],x:x,y:y,shift:self.gpm.hasShiftKey(modifier),meta:self.gpm.hasMetaKey(modifier),ctrl:self.gpm.hasCtrlKey(modifier)};self.emit("mouse",key)});this.gpm.on("move",function(btn,modifier,x,y){x--,y--;var key={name:"mouse",type:"GPM",action:"mousemove",button:self.gpm.ButtonName(btn),raw:[btn,modifier,x,y],x:x,y:y,shift:self.gpm.hasShiftKey(modifier),meta:self.gpm.hasMetaKey(modifier),ctrl:self.gpm.hasCtrlKey(modifier)};self.emit("mouse",key)});this.gpm.on("drag",function(btn,modifier,x,y){x--,y--;var key={name:"mouse",type:"GPM",action:"mousemove",button:self.gpm.ButtonName(btn),raw:[btn,modifier,x,y],x:x,y:y,shift:self.gpm.hasShiftKey(modifier),meta:self.gpm.hasMetaKey(modifier),ctrl:self.gpm.hasCtrlKey(modifier)};self.emit("mouse",key)});this.gpm.on("mousewheel",function(btn,modifier,x,y,dx,dy){var key={name:"mouse",type:"GPM",action:dy>0?"wheelup":"wheeldown",button:self.gpm.ButtonName(btn),raw:[btn,modifier,x,y,dx,dy],x:x,y:y,shift:self.gpm.hasShiftKey(modifier),meta:self.gpm.hasMetaKey(modifier),ctrl:self.gpm.hasCtrlKey(modifier)};self.emit("mouse",key)})};Program.prototype.disableGpm=function(){if(this.gpm){this.gpm.stop();delete this.gpm}};Program.prototype.bindResponse=function(){if(this._boundResponse)return;this._boundResponse=true;var decoder=new StringDecoder("utf8"),self=this;this.on("data",function(data){data=decoder.write(data);if(!data)return;self._bindResponse(data)})};Program.prototype._bindResponse=function(s){var out={},parts;if(Buffer.isBuffer(s)){if(s[0]>127&&s[1]===undefined){s[0]-=128;s=""+s.toString("utf-8")}else{s=s.toString("utf-8")}}if(parts=/^\x1b\[(\?|>)(\d*(?:;\d*)*)c/.exec(s)){parts=parts[2].split(";").map(function(ch){return+ch||0});out.event="device-attributes";out.code="DA";if(parts[1]==="?"){out.type="primary-attribute";if(parts[0]===1&&parts[2]===2){out.term="vt100";out.advancedVideo=true}else if(parts[0]===1&&parts[2]===0){out.term="vt101"}else if(parts[0]===6){out.term="vt102"}else if(parts[0]===60&&parts[1]===1&&parts[2]===2&&parts[3]===6&&parts[4]===8&&parts[5]===9&&parts[6]===15){out.term="vt220"}else{parts.forEach(function(attr){switch(attr){case 1:out.cols132=true;break;case 2:out.printer=true;break;case 6:out.selectiveErase=true;break;case 8:out.userDefinedKeys=true;break;case 9:out.nationalReplacementCharsets=true;break;case 15:out.technicalCharacters=true;break;case 18:out.userWindows=true;break;case 21:out.horizontalScrolling=true;break;case 22:out.ansiColor=true;break;case 29:out.ansiTextLocator=true;break}})}}else{out.type="secondary-attribute";switch(parts[0]){case 0:out.term="vt100";break;case 1:out.term="vt220";break;case 2:out.term="vt240";break;case 18:out.term="vt330";break;case 19:out.term="vt340";break;case 24:out.term="vt320";break;case 41:out.term="vt420";break;case 61:out.term="vt510";break;case 64:out.term="vt520";break;case 65:out.term="vt525";break}out.firmwareVersion=parts[1];out.romCartridgeRegistrationNumber=parts[2]}out.deviceAttributes=out;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts=/^\x1b\[(\?)?(\d+)(?:;(\d+);(\d+);(\d+))?n/.exec(s)){out.event="device-status";out.code="DSR";if(!parts[1]&&parts[2]==="0"&&!parts[3]){out.type="device-status";out.status="OK";out.deviceStatus=out.status;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]&&(parts[2]==="10"||parts[2]==="11")&&!parts[3]){out.type="printer-status";out.status=parts[2]==="10"?"ready":"not ready";out.printerStatus=out.status;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]&&(parts[2]==="20"||parts[2]==="21")&&!parts[3]){out.type="udk-status";out.status=parts[2]==="20"?"unlocked":"locked";out.UDKStatus=out.status;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]&&parts[2]==="27"&&parts[3]==="1"&&parts[4]==="0"&&parts[5]==="0"){out.type="keyboard-status";out.status="OK";out.keyboardStatus=out.status;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]&&(parts[2]==="53"||parts[2]==="50")&&!parts[3]){out.type="locator-status";out.status=parts[2]==="53"?"available":"unavailable";out.locator=out.status;this.emit("response",out);this.emit("response "+out.event,out);return}out.type="error";out.text="Unhandled: "+JSON.stringify(parts);out.error=out.text;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts=/^\x1b\[(\?)?(\d+);(\d+)R/.exec(s)){out.event="device-status";out.code="DSR";out.type="cursor-status";out.status={x:+parts[3],y:+parts[2],page:!parts[1]?undefined:0};out.x=out.status.x;out.y=out.status.y;out.page=out.status.page;out.cursor=out.status;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts=/^\x1b\[(\d+)(?:;(\d+);(\d+))?t/.exec(s)){out.event="window-manipulation";out.code="";if((parts[1]==="1"||parts[1]==="2")&&!parts[2]){out.type="window-state";out.state=parts[1]==="1"?"non-iconified":"iconified";out.windowState=out.state;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]==="3"&&parts[2]){out.type="window-position";out.position={x:+parts[2],y:+parts[3]};out.x=out.position.x;out.y=out.position.y;out.windowPosition=out.position;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]==="4"&&parts[2]){out.type="window-size-pixels";out.size={height:+parts[2],width:+parts[3]};out.height=out.size.height;out.width=out.size.width;out.windowSizePixels=out.size;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]==="8"&&parts[2]){out.type="textarea-size";out.size={height:+parts[2],width:+parts[3]};out.height=out.size.height;out.width=out.size.width;out.textAreaSizeCharacters=out.size;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]==="9"&&parts[2]){out.type="screen-size";out.size={height:+parts[2],width:+parts[3]};out.height=out.size.height;out.width=out.size.width;out.screenSizeCharacters=out.size;this.emit("response",out);this.emit("response "+out.event,out);return}out.type="error";out.text="Unhandled: "+JSON.stringify(parts);out.error=out.text;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts=/^\x1b\](l|L)([^\x07\x1b]*)$/.exec(s)){parts[2]="rxvt";s="]"+parts[1]+parts[2]+"\\"}if(parts=/^\x1b\](l|L)([^\x07\x1b]*)(?:\x07|\x1b\\)/.exec(s)){out.event="window-manipulation";out.code="";if(parts[1]==="L"){out.type="window-icon-label";out.text=parts[2];out.windowIconLabel=out.text;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts[1]==="l"){out.type="window-title";out.text=parts[2];out.windowTitle=out.text;this.emit("response",out);this.emit("response "+out.event,out);return}out.type="error";out.text="Unhandled: "+JSON.stringify(parts);out.error=out.text;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts=/^\x1b\[(\d+(?:;\d+){4})&w/.exec(s)){parts=parts[1].split(";").map(function(ch){return+ch});out.event="locator-position";out.code="DECRQLP";switch(parts[0]){case 0:out.status="locator-unavailable";break;case 1:out.status="request";break;case 2:out.status="left-button-down";break;case 3:out.status="left-button-up";break;case 4:out.status="middle-button-down";break;case 5:out.status="middle-button-up";break;case 6:out.status="right-button-down";break;case 7:out.status="right-button-up";break;case 8:out.status="m4-button-down";break;case 9:out.status="m4-button-up";break;case 10:out.status="locator-outside";break}out.mask=parts[1];out.row=parts[2];out.col=parts[3];out.page=parts[4];out.locatorPosition=out;this.emit("response",out);this.emit("response "+out.event,out);return}if(parts=/^\x1b\](\d+);([^\x07\x1b]+)(?:\x07|\x1b\\)/.exec(s)){out.event="text-params";out.code="Set Text Parameters";out.ps=+s[1];out.pt=s[2];this.emit("response",out);this.emit("response "+out.event,out)}};Program.prototype.response=function(name,text,callback,noBypass){var self=this;if(arguments.length===2){callback=text;text=name;name=null}if(!callback){callback=function(){}}this.bindResponse();name=name?"response "+name:"response";var onresponse;this.once(name,onresponse=function(event){if(timeout)clearTimeout(timeout);if(event.type==="error"){return callback(new Error(event.event+": "+event.text))}return callback(null,event)});var timeout=setTimeout(function(){self.removeListener(name,onresponse);return callback(new Error("Timeout."))},2e3);return noBypass?this._write(text):this._twrite(text)};Program.prototype._owrite=Program.prototype.write=function(text){if(!this.output.writable)return;return this.output.write(text)};Program.prototype._buffer=function(text){if(this._exiting){this.flush();this._owrite(text);return}if(this._buf){this._buf+=text;return}this._buf=text;nextTick(this._flush);return true};Program.prototype.flush=function(){if(!this._buf)return;this._owrite(this._buf);this._buf=""};Program.prototype._write=function(text){if(this.ret)return text;if(this.useBuffer){return this._buffer(text)}return this._owrite(text)};Program.prototype._twrite=function(data){var self=this,iterations=0,timer;if(this.tmux){data=data.replace(/\x1b\\/g,"");data="Ptmux;"+data+"\\";if(this.output.bytesWritten===0){timer=setInterval(function(){if(self.output.bytesWritten>0||++iterations===50){clearInterval(timer);self.flush();self._owrite(data)}},100);return true}this.flush();return this._owrite(data)}return this._write(data)};Program.prototype.echo=Program.prototype.print=function(text,attr){return attr?this._write(this.text(text,attr)):this._write(text)};Program.prototype._ncoords=function(){if(this.x<0)this.x=0;else if(this.x>=this.cols)this.x=this.cols-1;if(this.y<0)this.y=0;else if(this.y>=this.rows)this.y=this.rows-1};Program.prototype.setx=function(x){return this.cursorCharAbsolute(x)};Program.prototype.sety=function(y){return this.linePosAbsolute(y)};Program.prototype.move=function(x,y){return this.cursorPos(y,x)};Program.prototype.omove=function(x,y){if(!this.zero){x=(x||1)-1;y=(y||1)-1}else{x=x||0;y=y||0}if(y===this.y&&x===this.x){return}if(y===this.y){if(x>this.x){this.cuf(x-this.x)}else if(x<this.x){this.cub(this.x-x)}}else if(x===this.x){if(y>this.y){this.cud(y-this.y)}else if(y<this.y){this.cuu(this.y-y)}}else{if(!this.zero)x++,y++;this.cup(y,x)}};Program.prototype.rsetx=function(x){if(!x)return;return x>0?this.forward(x):this.back(-x)};Program.prototype.rsety=function(y){if(!y)return;return y>0?this.up(y):this.down(-y)};Program.prototype.rmove=function(x,y){this.rsetx(x);this.rsety(y)};Program.prototype.simpleInsert=function(ch,i,attr){return this._write(this.repeat(ch,i),attr)};Program.prototype.repeat=function(ch,i){if(!i||i<0)i=0;return Array(i+1).join(ch)};Program.prototype.__defineGetter__("title",function(){return this._title});Program.prototype.__defineSetter__("title",function(title){this.setTitle(title);return this._title});Program.prototype.copyToClipboard=function(text){if(this.isiTerm2){this._twrite("]50;CopyToCliboard="+text+"");return true}return false};Program.prototype.cursorShape=function(shape,blink){if(this.isiTerm2){switch(shape){case"block":if(!blink){this._twrite("]50;CursorShape=0;BlinkingCursorEnabled=0")}else{this._twrite("]50;CursorShape=0;BlinkingCursorEnabled=1")}break;case"underline":if(!blink){}else{}break;case"line":if(!blink){this._twrite("]50;CursorShape=1;BlinkingCursorEnabled=0")}else{this._twrite("]50;CursorShape=1;BlinkingCursorEnabled=1")}break}return true}else if(this.term("xterm")||this.term("screen")){switch(shape){case"block":if(!blink){this._twrite("[0 q")}else{this._twrite("[1 q")}break;case"underline":if(!blink){this._twrite("[2 q")}else{this._twrite("[3 q")}break;case"line":if(!blink){this._twrite("[4 q")}else{this._twrite("[5 q")}break}return true}return false};Program.prototype.cursorColor=function(color){if(this.term("xterm")||this.term("rxvt")||this.term("screen")){this._twrite("]12;"+color+"");return true}return false};Program.prototype.cursorReset=Program.prototype.resetCursor=function(){if(this.term("xterm")||this.term("rxvt")||this.term("screen")){this._twrite("[0 q");this._twrite("]112");this._twrite("]12;white");return true}return false};Program.prototype.getTextParams=function(param,callback){return this.response("text-params","]"+param+";?",function(err,data){if(err)return callback(err);return callback(null,data.pt)})};Program.prototype.getCursorColor=function(callback){return this.getTextParams(12,callback)};Program.prototype.nul=function(){return this._write("")};Program.prototype.bel=Program.prototype.bell=function(){if(this.has("bel"))return this.put.bel();return this._write("")};Program.prototype.vtab=function(){this.y++;this._ncoords();return this._write("\v")};Program.prototype.ff=Program.prototype.form=function(){if(this.has("ff"))return this.put.ff();return this._write("\f")};Program.prototype.kbs=Program.prototype.backspace=function(){this.x--;this._ncoords();if(this.has("kbs"))return this.put.kbs();return this._write("\b")};Program.prototype.ht=Program.prototype.tab=function(){this.x+=8;this._ncoords();if(this.has("ht"))return this.put.ht();return this._write("\t")};Program.prototype.shiftOut=function(){return this._write("")};Program.prototype.shiftIn=function(){return this._write("")};Program.prototype.cr=Program.prototype.return=function(){this.x=0;if(this.has("cr"))return this.put.cr();return this._write("\r")};Program.prototype.nel=Program.prototype.newline=Program.prototype.feed=function(){if(this.tput&&this.tput.bools.eat_newline_glitch&&this.x>=this.cols){return}this.x=0;this.y++;this._ncoords();if(this.has("nel"))return this.put.nel();return this._write("\n")};Program.prototype.ind=Program.prototype.index=function(){this.y++;this._ncoords();if(this.tput)return this.put.ind();return this._write("D")};Program.prototype.ri=Program.prototype.reverse=Program.prototype.reverseIndex=function(){this.y--;this._ncoords();if(this.tput)return this.put.ri();return this._write("M")};Program.prototype.nextLine=function(){this.y++;this.x=0;this._ncoords();if(this.has("nel"))return this.put.nel();return this._write("E")};Program.prototype.reset=function(){this.x=this.y=0;if(this.has("rs1")||this.has("ris")){return this.has("rs1")?this.put.rs1():this.put.ris()}return this._write("c")};Program.prototype.tabSet=function(){if(this.tput)return this.put.hts();return this._write("H")};Program.prototype.sc=Program.prototype.saveCursor=function(key){if(key)return this.lsaveCursor(key);this.savedX=this.x||0;this.savedY=this.y||0;if(this.tput)return this.put.sc();return this._write("7")};Program.prototype.rc=Program.prototype.restoreCursor=function(key,hide){if(key)return this.lrestoreCursor(key,hide);this.x=this.savedX||0;this.y=this.savedY||0;if(this.tput)return this.put.rc();return this._write("8")};Program.prototype.lsaveCursor=function(key){key=key||"local";this._saved=this._saved||{};this._saved[key]=this._saved[key]||{};this._saved[key].x=this.x;this._saved[key].y=this.y;this._saved[key].hidden=this.cursorHidden};Program.prototype.lrestoreCursor=function(key,hide){var pos;key=key||"local";if(!this._saved||!this._saved[key])return;pos=this._saved[key];this.cup(pos.y,pos.x);if(hide&&pos.hidden!==this.cursorHidden){if(pos.hidden){this.hideCursor()}else{this.showCursor()}}};Program.prototype.lineHeight=function(){return this._write("#")};Program.prototype.charset=function(val,level){level=level||0;switch(level){case 0:level="(";break;case 1:level=")";break;case 2:level="*";break;case 3:level="+";break}var name=typeof val==="string"?val.toLowerCase():val;switch(name){case"acs":case"scld":if(this.tput)return this.put.smacs();val="0";break;case"uk":val="A";break;case"us":case"usascii":case"ascii":if(this.tput)return this.put.rmacs();val="B";break;case"dutch":val="4";break;case"finnish":val="C";val="5";break;case"french":val="R";break;case"frenchcanadian":val="Q";break;case"german":val="K";break;case"italian":val="Y";break;case"norwegiandanish":val="E";val="6";break;case"spanish":val="Z";break;case"swedish":val="H";val="7";break;case"swiss":val="=";break;case"isolatin":val="/A";break;default:if(this.tput)return this.put.rmacs();val="B";break}return this._write("("+val)};Program.prototype.enter_alt_charset_mode=Program.prototype.as=Program.prototype.smacs=function(){return this.charset("acs")};Program.prototype.exit_alt_charset_mode=Program.prototype.ae=Program.prototype.rmacs=function(){return this.charset("ascii")};Program.prototype.setG=function(val){switch(val){case 1:val="~";break;case 2:val="n";val="}";val="N";break;case 3:val="o";val="|";val="O";break}return this._write(""+val)};Program.prototype.setTitle=function(title){this._title=title;return this._twrite("]0;"+title+"")};Program.prototype.resetColors=function(param){if(this.has("Cr")){return this.put.Cr(param)}return this._twrite("]112")};Program.prototype.dynamicColors=function(param){if(this.has("Cs")){return this.put.Cs(param)}return this._twrite("]12;"+param+"")};Program.prototype.selData=function(a,b){if(this.has("Ms")){return this.put.Ms(a,b)}return this._twrite("]52;"+a+";"+b+"")};Program.prototype.cuu=Program.prototype.up=Program.prototype.cursorUp=function(param){this.y-=param||1;this._ncoords();if(this.tput){if(!this.tput.strings.parm_up_cursor){return this._write(this.repeat(this.tput.cuu1(),param))}return this.put.cuu(param)}return this._write("["+(param||"")+"A")};Program.prototype.cud=Program.prototype.down=Program.prototype.cursorDown=function(param){this.y+=param||1;this._ncoords();if(this.tput){if(!this.tput.strings.parm_down_cursor){return this._write(this.repeat(this.tput.cud1(),param))}return this.put.cud(param)}return this._write("["+(param||"")+"B")};Program.prototype.cuf=Program.prototype.right=Program.prototype.forward=Program.prototype.cursorForward=function(param){this.x+=param||1;this._ncoords();if(this.tput){if(!this.tput.strings.parm_right_cursor){return this._write(this.repeat(this.tput.cuf1(),param))}return this.put.cuf(param)}return this._write("["+(param||"")+"C")};Program.prototype.cub=Program.prototype.left=Program.prototype.back=Program.prototype.cursorBackward=function(param){this.x-=param||1;this._ncoords();if(this.tput){if(!this.tput.strings.parm_left_cursor){return this._write(this.repeat(this.tput.cub1(),param))}return this.put.cub(param)}return this._write("["+(param||"")+"D")};Program.prototype.cup=Program.prototype.pos=Program.prototype.cursorPos=function(row,col){if(!this.zero){row=(row||1)-1;col=(col||1)-1}else{row=row||0;col=col||0}this.x=col;this.y=row;this._ncoords();if(this.tput)return this.put.cup(row,col);return this._write("["+(row+1)+";"+(col+1)+"H")};Program.prototype.ed=Program.prototype.eraseInDisplay=function(param){if(this.tput){switch(param){case"above":param=1;break;case"all":param=2;break;case"saved":param=3;break;case"below":default:param=0;break}return this.put.ed(param)}switch(param){case"above":return this._write("X1b[1J");case"all":return this._write("[2J");case"saved":return this._write("[3J");case"below":default:return this._write("[J")}};Program.prototype.clear=function(){this.x=0;this.y=0;if(this.tput)return this.put.clear();return this._write("[H[J")};Program.prototype.el=Program.prototype.eraseInLine=function(param){if(this.tput){switch(param){case"left":param=1;break;case"all":param=2;break;case"right":default:param=0;break}return this.put.el(param)}switch(param){case"left":return this._write("[1K");case"all":return this._write("[2K");case"right":default:return this._write("[K")}};Program.prototype.sgr=Program.prototype.attr=Program.prototype.charAttributes=function(param,val){return this._write(this._attr(param,val))};Program.prototype.text=function(text,attr){return this._attr(attr,true)+text+this._attr(attr,false)};Program.prototype._attr=function(param,val){var self=this,parts,color,m;if(Array.isArray(param)){parts=param;param=parts[0]||"normal"}else{param=param||"normal";parts=param.split(/\s*[,;]\s*/)}if(parts.length>1){var used={},out=[];parts.forEach(function(part){part=self._attr(part,val).slice(2,-1);if(part==="")return;if(used[part])return;used[part]=true;out.push(part)});return"["+out.join(";")+"m"}if(param.indexOf("no ")===0){param=param.substring(3);val=false}else if(param.indexOf("!")===0){param=param.substring(1);val=false}switch(param){case"normal":case"default":if(val===false)return"";return"[m";case"bold":return val===false?"[22m":"[1m";case"ul":case"underline":case"underlined":return val===false?"[24m":"[4m";case"blink":return val===false?"[25m":"[5m";case"inverse":return val===false?"[27m":"[7m";case"invisible":return val===false?"[28m":"[8m";case"black fg":return val===false?"[39m":"[30m";case"red fg":return val===false?"[39m":"[31m";case"green fg":return val===false?"[39m":"[32m";case"yellow fg":return val===false?"[39m":"[33m";case"blue fg":return val===false?"[39m":"[34m";case"magenta fg":return val===false?"[39m":"[35m";case"cyan fg":return val===false?"[39m":"[36m";case"white fg":case"light grey fg":case"light gray fg":case"bright grey fg":case"bright gray fg":return val===false?"[39m":"[37m";case"default fg":if(val===false)return"";return"[39m";case"black bg":return val===false?"[49m":"[40m";case"red bg":return val===false?"[49m":"[41m";case"green bg":return val===false?"[49m":"[42m";case"yellow bg":return val===false?"[49m":"[43m";case"blue bg":return val===false?"[49m":"[44m";case"magenta bg":return val===false?"[49m":"[45m";case"cyan bg":return val===false?"[49m":"[46m";case"white bg":case"light grey bg":case"light gray bg":case"bright grey bg":case"bright gray bg":return val===false?"[49m":"[47m";case"default bg":if(val===false)return"";return"[49m";case"light black fg":case"bright black fg":case"grey fg":case"gray fg":return val===false?"[39m":"[90m";case"light red fg":case"bright red fg":return val===false?"[39m":"[91m";case"light green fg":case"bright green fg":return val===false?"[39m":"[92m";case"light yellow fg":case"bright yellow fg":return val===false?"[39m":"[93m";case"light blue fg":case"bright blue fg":return val===false?"[39m":"[94m";case"light magenta fg":case"bright magenta fg":return val===false?"[39m":"[95m";case"light cyan fg":case"bright cyan fg":return val===false?"[39m":"[96m";case"light white fg":case"bright white fg":return val===false?"[39m":"[97m";case"light black bg":case"bright black bg":case"grey bg":case"gray bg":return val===false?"[49m":"[100m";case"light red bg":case"bright red bg":return val===false?"[49m":"[101m";case"light green bg":case"bright green bg":return val===false?"[49m":"[102m";case"light yellow bg":case"bright yellow bg":return val===false?"[49m":"[103m";case"light blue bg":case"bright blue bg":return val===false?"[49m":"[104m";case"light magenta bg":case"bright magenta bg":return val===false?"[49m":"[105m";case"light cyan bg":case"bright cyan bg":return val===false?"[49m":"[106m";case"light white bg":case"bright white bg":return val===false?"[49m":"[107m";case"default fg bg":if(val===false)return"";return this.term("rxvt")?"[100m":"[39;49m";default:if(param[0]==="#"){param=param.replace(/#(?:[0-9a-f]{3}){1,2}/i,colors.match)}m=/^(-?\d+) (fg|bg)$/.exec(param);if(m){color=+m[1];if(val===false||color===-1){return this._attr("default "+m[2])}color=colors.reduce(color,this.tput.colors);if(color<16||this.tput&&this.tput.colors<=16){if(m[2]==="fg"){if(color<8){color+=30}else if(color<16){color-=8;color+=90}}else if(m[2]==="bg"){if(color<8){color+=40}else if(color<16){color-=8;color+=100}}return"["+color+"m"}if(m[2]==="fg"){return"[38;5;"+color+"m"}if(m[2]==="bg"){return"[48;5;"+color+"m"}}if(/^[\d;]*$/.test(param)){return"["+param+"m"}return null}};Program.prototype.fg=Program.prototype.setForeground=function(color,val){color=color.split(/\s*[,;]\s*/).join(" fg, ")+" fg";return this.attr(color,val)};Program.prototype.bg=Program.prototype.setBackground=function(color,val){color=color.split(/\s*[,;]\s*/).join(" bg, ")+" bg";return this.attr(color,val)};Program.prototype.dsr=Program.prototype.deviceStatus=function(param,callback,dec,noBypass){if(dec){return this.response("device-status","[?"+(param||"0")+"n",callback,noBypass)}return this.response("device-status","["+(param||"0")+"n",callback,noBypass)};Program.prototype.getCursor=function(callback){return this.deviceStatus(6,callback,false,true)};Program.prototype.saveReportedCursor=function(callback){var self=this;if(this.tput.strings.user7==="[6n"||this.term("screen")){return this.getCursor(function(err,data){if(data){self._rx=data.status.x;self._ry=data.status.y}if(!callback)return;return callback(err)})}if(!callback)return;return callback()};Program.prototype.restoreReportedCursor=function(){if(this._rx==null)return;return this.cup(this._ry,this._rx)};Program.prototype.ich=Program.prototype.insertChars=function(param){this.x+=param||1;this._ncoords();if(this.tput)return this.put.ich(param);return this._write("["+(param||1)+"@")};Program.prototype.cnl=Program.prototype.cursorNextLine=function(param){this.y+=param||1;this._ncoords();return this._write("["+(param||"")+"E")};Program.prototype.cpl=Program.prototype.cursorPrecedingLine=function(param){this.y-=param||1;this._ncoords();return this._write("["+(param||"")+"F")};Program.prototype.cha=Program.prototype.cursorCharAbsolute=function(param){if(!this.zero){param=(param||1)-1}else{param=param||0}this.x=param;this.y=0;this._ncoords();if(this.tput)return this.put.hpa(param);return this._write("["+(param+1)+"G")};Program.prototype.il=Program.prototype.insertLines=function(param){if(this.tput)return this.put.il(param);return this._write("["+(param||"")+"L")};Program.prototype.dl=Program.prototype.deleteLines=function(param){if(this.tput)return this.put.dl(param);return this._write("["+(param||"")+"M")};Program.prototype.dch=Program.prototype.deleteChars=function(param){if(this.tput)return this.put.dch(param);return this._write("["+(param||"")+"P")};Program.prototype.ech=Program.prototype.eraseChars=function(param){if(this.tput)return this.put.ech(param);return this._write("["+(param||"")+"X")};Program.prototype.hpa=Program.prototype.charPosAbsolute=function(param){this.x=param||0;this._ncoords();if(this.tput){return this.put.hpa.apply(this.put,arguments)}param=slice.call(arguments).join(";");return this._write("["+(param||"")+"`")};Program.prototype.hpr=Program.prototype.HPositionRelative=function(param){if(this.tput)return this.cuf(param);this.x+=param||1;this._ncoords();return this._write("["+(param||"")+"a")};Program.prototype.da=Program.prototype.sendDeviceAttributes=function(param,callback){return this.response("device-attributes","["+(param||"")+"c",callback)};Program.prototype.vpa=Program.prototype.linePosAbsolute=function(param){this.y=param||1;this._ncoords();if(this.tput){return this.put.vpa.apply(this.put,arguments)}param=slice.call(arguments).join(";");return this._write("["+(param||"")+"d")};Program.prototype.vpr=Program.prototype.VPositionRelative=function(param){if(this.tput)return this.cud(param);this.y+=param||1;this._ncoords();return this._write("["+(param||"")+"e")};Program.prototype.hvp=Program.prototype.HVPosition=function(row,col){if(!this.zero){row=(row||1)-1;col=(col||1)-1}else{row=row||0;col=col||0}this.y=row;this.x=col;this._ncoords();if(this.tput)return this.put.cup(row,col);return this._write("["+(row+1)+";"+(col+1)+"f")};Program.prototype.sm=Program.prototype.setMode=function(){var param=slice.call(arguments).join(";");return this._write("["+(param||"")+"h")};Program.prototype.decset=function(){var param=slice.call(arguments).join(";");return this.setMode("?"+param)};Program.prototype.dectcem=Program.prototype.cnorm=Program.prototype.cvvis=Program.prototype.showCursor=function(){this.cursorHidden=false;if(this.tput)return this.put.cnorm();return this.setMode("?25")};Program.prototype.alternate=Program.prototype.smcup=Program.prototype.alternateBuffer=function(){this.isAlt=true;if(this.tput)return this.put.smcup();if(this.term("vt")||this.term("linux"))return;this.setMode("?47");return this.setMode("?1049")};Program.prototype.rm=Program.prototype.resetMode=function(){var param=slice.call(arguments).join(";");return this._write("["+(param||"")+"l")};Program.prototype.decrst=function(){var param=slice.call(arguments).join(";");return this.resetMode("?"+param)};Program.prototype.dectcemh=Program.prototype.cursor_invisible=Program.prototype.vi=Program.prototype.civis=Program.prototype.hideCursor=function(){this.cursorHidden=true;if(this.tput)return this.put.civis();return this.resetMode("?25")};Program.prototype.rmcup=Program.prototype.normalBuffer=function(){this.isAlt=false;if(this.tput)return this.put.rmcup();this.resetMode("?47");return this.resetMode("?1049")};Program.prototype.enableMouse=function(){if(process.env.BLESSED_FORCE_MODES){var modes=process.env.BLESSED_FORCE_MODES.split(",");var options={};for(var n=0;n<modes.length;++n){var pair=modes[n].split("=");var v=pair[1]!=="0";switch(pair[0].toUpperCase()){case"SGRMOUSE":options.sgrMouse=v;break;case"UTFMOUSE":options.utfMouse=v;break;case"VT200MOUSE":options.vt200Mouse=v;break;case"URXVTMOUSE":options.urxvtMouse=v;break;case"X10MOUSE":options.x10Mouse=v;break;case"DECMOUSE":options.decMouse=v;break;case"PTERMMOUSE":options.ptermMouse=v;break;case"JSBTERMMOUSE":options.jsbtermMouse=v;break;case"VT200HILITE":options.vt200Hilite=v;break;case"GPMMOUSE":options.gpmMouse=v;break;case"CELLMOTION":options.cellMotion=v;break;case"ALLMOTION":options.allMotion=v;break;case"SENDFOCUS":options.sendFocus=v;break}}return this.setMouse(options,true)}if(this.term("rxvt-unicode")){return this.setMouse({urxvtMouse:true,cellMotion:true,allMotion:true},true)}if(this.term("rxvt")){return this.setMouse({vt200Mouse:true,x10Mouse:true,cellMotion:true,allMotion:true},true)}if(this.isVTE){return this.setMouse({sgrMouse:true,cellMotion:true,allMotion:true},true)}if(this.term("linux")){return this.setMouse({vt200Mouse:true,gpmMouse:true},true)}if(this.term("xterm")||this.term("screen")||this.tput&&this.tput.strings.key_mouse){return this.setMouse({vt200Mouse:true,utfMouse:true,cellMotion:true,allMotion:true},true)}};Program.prototype.disableMouse=function(){if(!this._currentMouse)return;var obj={};Object.keys(this._currentMouse).forEach(function(key){obj[key]=false});return this.setMouse(obj,false)};Program.prototype.setMouse=function(opt,enable){if(opt.normalMouse!=null){opt.vt200Mouse=opt.normalMouse;opt.allMotion=opt.normalMouse}if(opt.hiliteTracking!=null){opt.vt200Hilite=opt.hiliteTracking}if(enable===true){if(this._currentMouse){this.setMouse(opt);Object.keys(opt).forEach(function(key){this._currentMouse[key]=opt[key]},this);return}this._currentMouse=opt;this.mouseEnabled=true}else if(enable===false){delete this._currentMouse;this.mouseEnabled=false}if(opt.x10Mouse!=null){if(opt.x10Mouse)this.setMode("?9");else this.resetMode("?9")}if(opt.vt200Mouse!=null){if(opt.vt200Mouse)this.setMode("?1000");else this.resetMode("?1000")}if(opt.vt200Hilite!=null){if(opt.vt200Hilite)this.setMode("?1001");else this.resetMode("?1001")}if(opt.cellMotion!=null){if(opt.cellMotion)this.setMode("?1002");else this.resetMode("?1002")}if(opt.allMotion!=null){if(this.tmux&&this.tmuxVersion>=2){if(opt.allMotion)this._twrite("[?1003h");else this._twrite("[?1003l")}else{if(opt.allMotion)this.setMode("?1003");else this.resetMode("?1003")}}if(opt.sendFocus!=null){if(opt.sendFocus)this.setMode("?1004");else this.resetMode("?1004")}if(opt.utfMouse!=null){if(opt.utfMouse)this.setMode("?1005");else this.resetMode("?1005")}if(opt.sgrMouse!=null){if(opt.sgrMouse)this.setMode("?1006");else this.resetMode("?1006")}if(opt.urxvtMouse!=null){if(opt.urxvtMouse)this.setMode("?1015");else this.resetMode("?1015")}if(opt.decMouse!=null){if(opt.decMouse)this._write("[1;2'z[1;3'{");else this._write("['z")}if(opt.ptermMouse!=null){if(opt.ptermMouse)this._write("[>1h[>6h[>7h[>1h[>9l");else this._write("[>1l[>6l[>7l[>1l[>9h")}if(opt.jsbtermMouse!=null){if(opt.jsbtermMouse)this._write("[0~ZwLMRK+1Q\\");else this._write("[0~ZwQ\\")}if(opt.gpmMouse!=null){if(opt.gpmMouse)this.enableGpm();else this.disableGpm()}};Program.prototype.decstbm=Program.prototype.csr=Program.prototype.setScrollRegion=function(top,bottom){if(!this.zero){top=(top||1)-1;bottom=(bottom||this.rows)-1}else{top=top||0;bottom=bottom||this.rows-1}this.scrollTop=top;this.scrollBottom=bottom;this.x=0;this.y=0;this._ncoords();if(this.tput)return this.put.csr(top,bottom);return this._write("["+(top+1)+";"+(bottom+1)+"r")};Program.prototype.scA=Program.prototype.saveCursorA=function(){this.savedX=this.x;this.savedY=this.y;if(this.tput)return this.put.sc();return this._write("[s")};Program.prototype.rcA=Program.prototype.restoreCursorA=function(){this.x=this.savedX||0;this.y=this.savedY||0;if(this.tput)return this.put.rc();return this._write("[u")};Program.prototype.cht=Program.prototype.cursorForwardTab=function(param){this.x+=8;this._ncoords();if(this.tput)return this.put.tab(param);return this._write("["+(param||1)+"I")};Program.prototype.su=Program.prototype.scrollUp=function(param){this.y-=param||1;this._ncoords();if(this.tput)return this.put.parm_index(param);return this._write("["+(param||1)+"S")};Program.prototype.sd=Program.prototype.scrollDown=function(param){this.y+=param||1;this._ncoords();if(this.tput)return this.put.parm_rindex(param);return this._write("["+(param||1)+"T")};Program.prototype.initMouseTracking=function(){return this._write("["+slice.call(arguments).join(";")+"T")};Program.prototype.resetTitleModes=function(){return this._write("[>"+slice.call(arguments).join(";")+"T")};Program.prototype.cbt=Program.prototype.cursorBackwardTab=function(param){this.x-=8;this._ncoords();if(this.tput)return this.put.cbt(param);return this._write("["+(param||1)+"Z")};Program.prototype.rep=Program.prototype.repeatPrecedingCharacter=function(param){this.x+=param||1;this._ncoords();if(this.tput)return this.put.rep(param);return this._write("["+(param||1)+"b")};Program.prototype.tbc=Program.prototype.tabClear=function(param){if(this.tput)return this.put.tbc(param);return this._write("["+(param||0)+"g")};Program.prototype.mc=Program.prototype.mediaCopy=function(){return this._write("["+slice.call(arguments).join(";")+"i")};Program.prototype.print_screen=Program.prototype.ps=Program.prototype.mc0=function(){if(this.tput)return this.put.mc0();return this.mc("0")};Program.prototype.prtr_on=Program.prototype.po=Program.prototype.mc5=function(){if(this.tput)return this.put.mc5();return this.mc("5")};Program.prototype.prtr_off=Program.prototype.pf=Program.prototype.mc4=function(){if(this.tput)return this.put.mc4();return this.mc("4")};Program.prototype.prtr_non=Program.prototype.pO=Program.prototype.mc5p=function(){if(this.tput)return this.put.mc5p();return this.mc("?5")};Program.prototype.setResources=function(){return this._write("[>"+slice.call(arguments).join(";")+"m")};Program.prototype.disableModifiers=function(param){return this._write("[>"+(param||"")+"n")};Program.prototype.setPointerMode=function(param){return this._write("[>"+(param||"")+"p")};Program.prototype.decstr=Program.prototype.rs2=Program.prototype.softReset=function(){if(this.tput)return this.put.rs2();return this._write("[!p[?3;4l[4l>")};Program.prototype.decrqm=Program.prototype.requestAnsiMode=function(param){return this._write("["+(param||"")+"$p")};Program.prototype.decrqmp=Program.prototype.requestPrivateMode=function(param){return this._write("[?"+(param||"")+"$p")};Program.prototype.decscl=Program.prototype.setConformanceLevel=function(){return this._write("["+slice.call(arguments).join(";")+'"p')};Program.prototype.decll=Program.prototype.loadLEDs=function(param){return this._write("["+(param||"")+"q")};Program.prototype.decscusr=Program.prototype.setCursorStyle=function(param){switch(param){case"blinking block":param=1;break;case"block":case"steady block":param=2;break;case"blinking underline":param=3;break;case"underline":case"steady underline":param=4;break;case"blinking bar":param=5;break;case"bar":case"steady bar":param=6;break}if(param===2&&this.has("Se")){return this.put.Se()}if(this.has("Ss")){return this.put.Ss(param)}return this._write("["+(param||1)+" q")};Program.prototype.decsca=Program.prototype.setCharProtectionAttr=function(param){return this._write("["+(param||0)+'"q')};Program.prototype.restorePrivateValues=function(){return this._write("[?"+slice.call(arguments).join(";")+"r")};Program.prototype.deccara=Program.prototype.setAttrInRectangle=function(){return this._write("["+slice.call(arguments).join(";")+"$r")};Program.prototype.savePrivateValues=function(){return this._write("[?"+slice.call(arguments).join(";")+"s")};Program.prototype.manipulateWindow=function(){var args=slice.call(arguments);var callback=typeof args[args.length-1]==="function"?args.pop():function(){};return this.response("window-manipulation","["+args.join(";")+"t",callback)};Program.prototype.getWindowSize=function(callback){return this.manipulateWindow(18,callback)};Program.prototype.decrara=Program.prototype.reverseAttrInRectangle=function(){return this._write("["+slice.call(arguments).join(";")+"$t")};Program.prototype.setTitleModeFeature=function(){return this._twrite("[>"+slice.call(arguments).join(";")+"t")};Program.prototype.decswbv=Program.prototype.setWarningBellVolume=function(param){return this._write("["+(param||"")+" t")};Program.prototype.decsmbv=Program.prototype.setMarginBellVolume=function(param){return this._write("["+(param||"")+" u")};Program.prototype.deccra=Program.prototype.copyRectangle=function(){return this._write("["+slice.call(arguments).join(";")+"$v")};Program.prototype.decefr=Program.prototype.enableFilterRectangle=function(){return this._write("["+slice.call(arguments).join(";")+"'w")};Program.prototype.decreqtparm=Program.prototype.requestParameters=function(param){return this._write("["+(param||0)+"x")};Program.prototype.decsace=Program.prototype.selectChangeExtent=function(param){return this._write("["+(param||0)+"x")};Program.prototype.decfra=Program.prototype.fillRectangle=function(){return this._write("["+slice.call(arguments).join(";")+"$x")};Program.prototype.decelr=Program.prototype.enableLocatorReporting=function(){return this._write("["+slice.call(arguments).join(";")+"'z")};Program.prototype.decera=Program.prototype.eraseRectangle=function(){return this._write("["+slice.call(arguments).join(";")+"$z")};Program.prototype.decsle=Program.prototype.setLocatorEvents=function(){return this._write("["+slice.call(arguments).join(";")+"'{")};Program.prototype.decsera=Program.prototype.selectiveEraseRectangle=function(){return this._write("["+slice.call(arguments).join(";")+"${")};Program.prototype.decrqlp=Program.prototype.req_mouse_pos=Program.prototype.reqmp=Program.prototype.requestLocatorPosition=function(param,callback){if(this.has("req_mouse_pos")){var code=this.tput.req_mouse_pos(param);return this.response("locator-position",code,callback)}return this.response("locator-position","["+(param||"")+"'|",callback)};Program.prototype.decic=Program.prototype.insertColumns=function(){return this._write("["+slice.call(arguments).join(";")+" }")};Program.prototype.decdc=Program.prototype.deleteColumns=function(){return this._write("["+slice.call(arguments).join(";")+" ~")};Program.prototype.out=function(name){var args=Array.prototype.slice.call(arguments,1);this.ret=true;var out=this[name].apply(this,args);this.ret=false;return out};Program.prototype.sigtstp=function(callback){var resume=this.pause();process.once("SIGCONT",function(){resume();if(callback)callback()});process.kill(process.pid,"SIGTSTP")};Program.prototype.pause=function(callback){var self=this,isAlt=this.isAlt,mouseEnabled=this.mouseEnabled;this.lsaveCursor("pause");if(isAlt)this.normalBuffer();this.showCursor();if(mouseEnabled)this.disableMouse();var write=this.output.write;this.output.write=function(){};if(this.input.setRawMode){this.input.setRawMode(false)}this.input.pause();return this._resume=function(){delete self._resume;if(self.input.setRawMode){self.input.setRawMode(true)}self.input.resume();self.output.write=write;if(isAlt)self.alternateBuffer();if(mouseEnabled)self.enableMouse();self.lrestoreCursor("pause",true);if(callback)callback()}};Program.prototype.resume=function(){if(this._resume)return this._resume()};function unshiftEvent(obj,event,listener){var listeners=obj.listeners(event);obj.removeAllListeners(event);obj.on(event,listener);listeners.forEach(function(listener){obj.on(event,listener)})}function merge(out){slice.call(arguments,1).forEach(function(obj){Object.keys(obj).forEach(function(key){out[key]=obj[key]})});return out}module.exports=Program}).call(this,{isBuffer:require("../../../../../.npm-prefix/lib/node_modules/browserify/node_modules/is-buffer/index.js")},require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../../../../.npm-prefix/lib/node_modules/browserify/node_modules/is-buffer/index.js":15,"./colors":59,"./gpmclient":61,"./keys":63,"./tput":65,_process:30,child_process:1,events:12,fs:1,string_decoder:51,util:57}],65:[function(require,module,exports){(function(process,Buffer,__dirname){var assert=require("assert"),path=require("path"),fs=require("fs"),cp=require("child_process");function Tput(options){if(!(this instanceof Tput)){return new Tput(options)}options=options||{};if(typeof options==="string"){options={terminal:options}}this.options=options;this.terminal=options.terminal||options.term||process.env.TERM||(process.platform==="win32"?"windows-ansi":"xterm");this.terminal=this.terminal.toLowerCase();this.debug=options.debug;this.padding=options.padding;this.extended=options.extended;this.printf=options.printf;this.termcap=options.termcap;this.error=null;this.terminfoPrefix=options.terminfoPrefix;this.terminfoFile=options.terminfoFile;this.termcapFile=options.termcapFile;if(options.terminal||options.term){this.setup()}}Tput.prototype.setup=function(){this.error=null;try{if(this.termcap){try{this.injectTermcap()}catch(e){if(this.debug)throw e;this.error=new Error("Termcap parse error.");this._useInternalCap(this.terminal)}}else{try{this.injectTerminfo()}catch(e){if(this.debug)throw e;this.error=new Error("Terminfo parse error.");this._useInternalInfo(this.terminal)}}}catch(e){if(this.debug)throw e;this.error=new Error("Terminfo not found.");this._useXtermInfo()}};Tput.prototype.term=function(is){return this.terminal.indexOf(is)===0};Tput.prototype._debug=function(){if(!this.debug)return;return console.log.apply(console,arguments)};Tput.prototype._useVt102Cap=function(){return this.injectTermcap("vt102")};Tput.prototype._useXtermCap=function(){return this.injectTermcap(__dirname+"/../usr/xterm.termcap")};Tput.prototype._useXtermInfo=function(){return this.injectTerminfo(__dirname+"/../usr/xterm")};Tput.prototype._useInternalInfo=function(name){name=path.basename(name);return this.injectTerminfo(__dirname+"/../usr/"+name)};Tput.prototype._useInternalCap=function(name){name=path.basename(name);return this.injectTermcap(__dirname+"/../usr/"+name+".termcap")};Tput.ipaths=[process.env.TERMINFO||"",(process.env.TERMINFO_DIRS||"").split(":"),(process.env.HOME||"")+"/.terminfo","/usr/share/terminfo","/usr/share/lib/terminfo","/usr/lib/terminfo","/usr/local/share/terminfo","/usr/local/share/lib/terminfo","/usr/local/lib/terminfo","/usr/local/ncurses/lib/terminfo","/lib/terminfo"];Tput.prototype.readTerminfo=function(term){var data,file,info;term=term||this.terminal;file=path.normalize(this._prefix(term));data=fs.readFileSync(file);info=this.parseTerminfo(data,file);if(this.debug){this._terminfo=info}return info};Tput._prefix=Tput.prototype._prefix=function(term){if(term){if(~term.indexOf(path.sep)){return term}if(this.terminfoFile){return this.terminfoFile}}var paths=Tput.ipaths.slice(),file;if(this.terminfoPrefix){paths.unshift(this.terminfoPrefix)}file=this._tprefix(paths,term);if(file)return file;file=this._tprefix(paths,term,true);if(file)return file;throw new Error("Terminfo directory not found.")};Tput._tprefix=Tput.prototype._tprefix=function(prefix,term,soft){if(!prefix)return;var file,dir,i,sdiff,sfile,list;if(Array.isArray(prefix)){for(i=0;i<prefix.length;i++){file=this._tprefix(prefix[i],term,soft);if(file)return file}return}var find=function(word){var file,ch;file=path.resolve(prefix,word[0]);try{fs.statSync(file);return file}catch(e){}ch=word[0].charCodeAt(0).toString(16);if(ch.length<2)ch="0"+ch;file=path.resolve(prefix,ch);try{fs.statSync(file);return file}catch(e){}};if(!term){try{dir=fs.readdirSync(prefix).filter(function(file){return file.length!==1&&!/^[0-9a-fA-F]{2}$/.test(file)});if(!dir.length){return prefix}}catch(e){}return}term=path.basename(term);dir=find(term);if(!dir)return;if(soft){try{list=fs.readdirSync(dir)}catch(e){return}list.forEach(function(file){if(file.indexOf(term)===0){var diff=file.length-term.length;if(!sfile||diff<sdiff){sdiff=diff;sfile=file}}});return sfile&&(soft||sdiff===0)?path.resolve(dir,sfile):null}file=path.resolve(dir,term);try{fs.statSync(file);return file}catch(e){}};Tput.prototype.parseTerminfo=function(data,file){var info={},extended,l=data.length,i=0,v,o;var h=info.header={dataSize:data.length,headerSize:12,magicNumber:data[1]<<8|data[0],namesSize:data[3]<<8|data[2],boolCount:data[5]<<8|data[4],numCount:data[7]<<8|data[6],strCount:data[9]<<8|data[8],strTableSize:data[11]<<8|data[10]};h.total=h.headerSize+h.namesSize+h.boolCount+h.numCount*2+h.strCount*2+h.strTableSize;i+=h.headerSize;var names=data.toString("ascii",i,i+h.namesSize-1),parts=names.split("|"),name=parts[0],desc=parts.pop();info.name=name;info.names=parts;info.desc=desc;info.dir=path.resolve(file,"..","..");info.file=file;i+=h.namesSize-1;assert.equal(data[i],0);i++;info.bools={};l=i+h.boolCount;o=0;for(;i<l;i++){v=Tput.bools[o++];info.bools[v]=data[i]===1}if(i%2){assert.equal(data[i],0);i++}info.numbers={};l=i+h.numCount*2;o=0;for(;i<l;i+=2){v=Tput.numbers[o++];if(data[i+1]===255&&data[i]===255){info.numbers[v]=-1}else{info.numbers[v]=data[i+1]<<8|data[i]}}info.strings={};l=i+h.strCount*2;o=0;for(;i<l;i+=2){v=Tput.strings[o++];if(data[i+1]===255&&data[i]===255){info.strings[v]=-1}else{info.strings[v]=data[i+1]<<8|data[i]}}Object.keys(info.strings).forEach(function(key){if(info.strings[key]===-1){delete info.strings[key];return}if(info.strings[key]===65534){delete info.strings[key];return}var s=i+info.strings[key],j=s;while(data[j])j++;assert(j<data.length);info.strings[key]=data.toString("ascii",s,j)});if(this.extended!==false){i--;i+=h.strTableSize;if(i%2){assert.equal(data[i],0);i++}l=data.length;if(i<l-1){try{extended=this.parseExtended(data.slice(i))}catch(e){if(this.debug){throw e}return info}info.header.extended=extended.header;["bools","numbers","strings"].forEach(function(key){merge(info[key],extended[key])})}}return info};Tput.prototype.parseExtended=function(data){var info={},l=data.length,i=0;var h=info.header={dataSize:data.length,headerSize:10,boolCount:data[i+1]<<8|data[i+0],numCount:data[i+3]<<8|data[i+2],strCount:data[i+5]<<8|data[i+4],strTableSize:data[i+7]<<8|data[i+6],lastStrTableOffset:data[i+9]<<8|data[i+8]};h.total=h.headerSize+h.boolCount+h.numCount*2+h.strCount*2+h.strTableSize;i+=h.headerSize;var _bools=[];l=i+h.boolCount;for(;i<l;i++){_bools.push(data[i]===1)}if(i%2){assert.equal(data[i],0);i++}var _numbers=[];l=i+h.numCount*2;for(;i<l;i+=2){if(data[i+1]===255&&data[i]===255){_numbers.push(-1)}else{_numbers.push(data[i+1]<<8|data[i])}}var _strings=[];l=i+h.strCount*2;for(;i<l;i+=2){if(data[i+1]===255&&data[i]===255){_strings.push(-1)}else{_strings.push(data[i+1]<<8|data[i])}}i=data.length-h.lastStrTableOffset;var high=0;_strings.forEach(function(offset,k){if(offset===-1){_strings[k]="";return}var s=i+offset,j=s;while(data[j])j++;assert(j<data.length);if(high<j-i){high=j-i}_strings[k]=data.toString("ascii",s,j)});i+=high+1;l=data.length;var sym=[],j;for(;i<l;i++){j=i;while(data[j])j++;sym.push(data.toString("ascii",i,j));i=j}j=0;info.bools={};_bools.forEach(function(bool){info.bools[sym[j++]]=bool});info.numbers={};_numbers.forEach(function(number){info.numbers[sym[j++]]=number});info.strings={};_strings.forEach(function(string){info.strings[sym[j++]]=string});assert.equal(i,data.length);return info};Tput.prototype.compileTerminfo=function(term){return this.compile(this.readTerminfo(term))};Tput.prototype.injectTerminfo=function(term){return this.inject(this.compileTerminfo(term))};Tput.prototype.compile=function(info){var self=this;if(!info){throw new Error("Terminal not found.")}this.detectFeatures(info);this._debug(info);info.all={};info.methods={};["bools","numbers","strings"].forEach(function(type){Object.keys(info[type]).forEach(function(key){info.all[key]=info[type][key];info.methods[key]=self._compile(info,key,info.all[key])})});Tput.bools.forEach(function(key){if(info.methods[key]==null)info.methods[key]=false});Tput.numbers.forEach(function(key){if(info.methods[key]==null)info.methods[key]=-1});Tput.strings.forEach(function(key){if(!info.methods[key])info.methods[key]=noop});Object.keys(info.methods).forEach(function(key){if(!Tput.alias[key])return;Tput.alias[key].forEach(function(alias){info.methods[alias]=info.methods[key]})});return info};Tput.prototype.inject=function(info){var self=this,methods=info.methods||info;Object.keys(methods).forEach(function(key){if(typeof methods[key]!=="function"){self[key]=methods[key];return}self[key]=function(){var args=Array.prototype.slice.call(arguments);return methods[key].call(self,args)}});this.info=info;this.all=info.all;this.methods=info.methods;this.bools=info.bools;this.numbers=info.numbers;this.strings=info.strings;if(!~info.names.indexOf(this.terminal)){this.terminal=info.name}this.features=info.features;Object.keys(info.features).forEach(function(key){if(key==="padding"){if(!info.features.padding&&self.options.padding!==true){self.padding=false}return}self[key]=info.features[key]})};Tput.prototype._compile=function(info,key,str){var v;this._debug("Compiling %s: %s",key,JSON.stringify(str));switch(typeof str){case"boolean":return str;case"number":return str;case"string":break;default:return noop}if(!str){return noop}if(key==="init_file"||key==="reset_file"){try{str=fs.readFileSync(str,"utf8");if(this.debug){v=("return "+JSON.stringify(str)+";").replace(/\x1b/g,"\\x1b").replace(/\r/g,"\\r").replace(/\n/g,"\\n");process.stdout.write(v+"\n")}return function(){return str}}catch(e){return noop}}var tkey=info.name+"."+key,header="var v, dyn = {}, stat = {}, stack = [], out = [];",footer=';return out.join("");',code=header,val=str,buff="",cap,ch,fi,then,els,end;function read(regex,no){cap=regex.exec(val);if(!cap)return;val=val.substring(cap[0].length);ch=cap[1];if(!no)clear();return cap}function stmt(c){if(code[code.length-1]===","){code=code.slice(0,-1)}code+=c}function expr(c){code+=c+","}function echo(c){if(c==='""')return;expr("out.push("+c+")")}function print(c){buff+=c}function clear(){if(buff){echo(JSON.stringify(buff).replace(/\\u00([0-9a-fA-F]{2})/g,"\\x$1"));buff=""}}while(val){if(read(/^\n /,true)){continue}if(read(/^\^(.)/i,true)){if(!(ch>=" "&&ch<="~")){this._debug("%s: bad caret char.",tkey);print(cap[0]);continue}if(ch==="?"){ch=""}else{ch=ch.charCodeAt(0)&31;if(ch===0)ch=128;ch=String.fromCharCode(ch)}print(ch);continue}if(read(/^\\([0-7]{3})/,true)){print(String.fromCharCode(parseInt(ch,8)));continue}if(read(/^\\([eEnlrtbfs\^\\,:0]|.)/,true)){switch(ch){case"e":case"E":ch="";break;case"n":ch="\n";break;case"l":ch="";break;case"r":ch="\r";break;case"t":ch="\t";break;case"b":ch="\b";break;case"f":ch="\f";break;case"s":ch=" ";break;case"^":ch="^";break;case"\\":ch="\\";break;case",":ch=",";break;case":":ch=":";break;case"0":ch="";break;case"a":ch="";break;default:this._debug("%s: bad backslash char.",tkey);ch=cap[0];break}print(ch);continue}if(read(/^\$<(\d+)([*\/]{0,2})>/,true)){if(this.padding)print(cap[0]);continue}if(read(/^%%/,true)){print("%");continue}if(read(/^%((?::-|[+# ]){1,4})?(\d+(?:\.\d+)?)?([doxXsc])/)){if(this.printf||cap[1]||cap[2]||~"oxX".indexOf(cap[3])){echo('sprintf("'+cap[0].replace(":-","-")+'", stack.pop())')}else if(cap[3]==="c"){echo("(v = stack.pop(), isFinite(v) "+'? String.fromCharCode(v || 0200) : "")')}else{echo("stack.pop()")}continue}if(read(/^%p([1-9])/)){expr("(stack.push(v = params["+(ch-1)+"]), v)");continue}if(read(/^%P([a-z])/)){expr("dyn."+ch+" = stack.pop()");continue}if(read(/^%g([a-z])/)){expr("(stack.push(dyn."+ch+"), dyn."+ch+")");continue}if(read(/^%P([A-Z])/)){expr("stat."+ch+" = stack.pop()");continue}if(read(/^%g([A-Z])/)){expr("(stack.push(v = stat."+ch+"), v)");continue}if(read(/^%'(.)'/)){expr("(stack.push(v = "+ch.charCodeAt(0)+"), v)");continue}if(read(/^%\{(\d+)\}/)){expr("(stack.push(v = "+ch+"), v)");continue}if(read(/^%l/)){expr('(stack.push(v = (stack.pop() || "").length || 0), v)');continue}if(read(/^%([+\-*\/m&|\^=><])/)){if(ch==="=")ch="===";else if(ch==="m")ch="%";expr("(v = stack.pop(),"+" stack.push(v = (stack.pop() "+ch+" v) || 0),"+" v)");continue}if(read(/^%([AO])/)){expr("(stack.push(v = (stack.pop() "+(ch==="A"?"&&":"||")+" stack.pop())), v)");continue}if(read(/^%([!~])/)){expr("(stack.push(v = "+ch+"stack.pop()), v)");continue}if(read(/^%i/)){expr("(params[0]++, params[1]++)");continue}if(read(/^%\?/)){end=-1;stmt(";if (");continue}if(read(/^%t/)){end=-1;stmt(") {");continue}if(read(/^%e/)){fi=val.indexOf("%?");then=val.indexOf("%t");els=val.indexOf("%e");end=val.indexOf("%;");if(end===-1)end=Infinity;if(then!==-1&&then<end&&(fi===-1||then<fi)&&(els===-1||then<els)){stmt("} else if (")}else{stmt("} else {")}continue}if(read(/^%;/)){end=null;stmt("}");continue}buff+=val[0];val=val.substring(1)}clear();if(end!=null){stmt("}")}stmt(footer);v=code.slice(header.length,-footer.length);if(!v.length){code='return "";'}else if(v=/^out\.push\(("(?:[^"]|\\")+")\)$/.exec(v)){code="return "+v[1]+";"}else{code=code.replace(/\(stack\.push\(v = params\[(\d+)\]\), v\),out\.push\(stack\.pop\(\)\)/g,"out.push(params[$1])");v=code.slice(header.length,-footer.length);if(!~v.indexOf("v = "))code=code.replace("v, ","");if(!~v.indexOf("dyn"))code=code.replace("dyn = {}, ","");if(!~v.indexOf("stat"))code=code.replace("stat = {}, ","");if(!~v.indexOf("stack"))code=code.replace("stack = [], ","");code=code.replace(/out = \[\];out\.push\(("(?:[^"]|\\")+")\),/,"out = [$1];")}if(str==="%?"){code='return "\\x1b";'}if(this.debug){v=code.replace(/\x1b/g,"\\x1b").replace(/\r/g,"\\r").replace(/\n/g,"\\n");process.stdout.write(v+"\n")}try{if(this.options.stringify&&code.indexOf("return ")===0){return new Function("",code)()}return this.printf||~code.indexOf("sprintf(")?new Function("sprintf, params",code).bind(null,sprintf):new Function("params",code)}catch(e){console.error("");console.error("Error on %s:",tkey);console.error(JSON.stringify(str));console.error("");console.error(code.replace(/(,|;)/g,"$1\n"));e.stack=e.stack.replace(/\x1b/g,"\\x1b");throw e}};Tput.prototype._print=function(code,print,done){var xon=!this.bools.needs_xon_xoff||this.bools.xon_xoff;print=print||write;done=done||noop;if(!this.padding){print(code);return done()}var parts=code.split(/(?=\$<[\d.]+[*\/]{0,2}>)/),i=0;(function next(){if(i===parts.length){return done()}var part=parts[i++],padding=/^\$<([\d.]+)([*\/]{0,2})>/.exec(part),amount,suffix;if(!padding){print(part);return next()}part=part.substring(padding[0].length);amount=+padding[1];suffix=padding[2];if(xon&&!~suffix.indexOf("/")){print(part);return next()}if(~suffix.indexOf("*")){amount=amount}return setTimeout(function(){print(part);return next()},amount)})()};Tput.print=function(){var fake={padding:true,bools:{needs_xon_xoff:true,xon_xoff:false}};return Tput.prototype._print.apply(fake,arguments)};Tput.cpaths=[process.env.TERMCAP||"",(process.env.TERMPATH||"").split(/[: ]/),(process.env.HOME||"")+"/.termcap","/usr/share/misc/termcap","/etc/termcap"];Tput.prototype.readTermcap=function(term){var self=this,terms,term_,root,paths;term=term||this.terminal;if(~term.indexOf(path.sep)&&(terms=this._tryCap(path.resolve(term)))){term_=path.basename(term).split(".")[0];if(terms[process.env.TERM]){term=process.env.TERM}else if(terms[term_]){term=term_}else{term=Object.keys(terms)[0]}}else{paths=Tput.cpaths.slice();if(this.termcapFile){paths.unshift(this.termcapFile)}paths.push(Tput.termcap);terms=this._tryCap(paths,term)}if(!terms){throw new Error("Cannot find termcap for: "+term)}root=terms[term];if(this.debug){this._termcap=terms}(function tc(term){if(term&&term.strings.tc){root.inherits=root.inherits||[];root.inherits.push(term.strings.tc);var names=terms[term.strings.tc]?terms[term.strings.tc].names:[term.strings.tc];self._debug("%s inherits from %s.",term.names.join("/"),names.join("/"));var inherit=tc(terms[term.strings.tc]);if(inherit){["bools","numbers","strings"].forEach(function(type){merge(term[type],inherit[type])})}}return term})(root);root=this.translateTermcap(root);return root};Tput.prototype._tryCap=function(file,term){if(!file)return;var terms,data,i;if(Array.isArray(file)){for(i=0;i<file.length;i++){data=this._tryCap(file[i],term);if(data)return data}return}data=file[0]==="/"?tryRead(file):file;if(!data)return;terms=this.parseTermcap(data,file);if(term&&!terms[term]){return}return terms};Tput.prototype.parseTermcap=function(data,file){var terms={},parts,term,entries,fields,field,names,i,j,k;data=data.replace(/\\\n[ \t]*/g,"");data=data.replace(/^#[^\n]+/gm,"");entries=data.trim().split(/\n+/);for(i=0;i<entries.length;i++){fields=entries[i].split(/:+/);for(j=0;j<fields.length;j++){field=fields[j].trim();if(!field)continue;if(j===0){names=field.split("|");term={name:names[0],names:names,desc:names.pop(),file:~file.indexOf(path.sep)?path.resolve(file):file,termcap:true};for(k=0;k<names.length;k++){terms[names[k]]=term}term.bools={};term.numbers={};term.strings={};continue}if(~field.indexOf("=")){parts=field.split("=");term.strings[parts[0]]=parts.slice(1).join("=")}else if(~field.indexOf("#")){parts=field.split("#");term.numbers[parts[0]]=+parts.slice(1).join("#")}else{term.bools[field]=true}}}return terms};Tput.prototype.translateTermcap=function(info){var self=this,out={};if(!info)return;this._debug(info);["name","names","desc","file","termcap"].forEach(function(key){out[key]=info[key]});var map=function(){var out={};Object.keys(Tput.alias).forEach(function(key){var aliases=Tput.alias[key];out[aliases.termcap]=key});return out}();["bools","numbers","strings"].forEach(function(key){out[key]={};Object.keys(info[key]).forEach(function(cap){if(key==="strings"){info.strings[cap]=self._captoinfo(cap,info.strings[cap],1)}if(map[cap]){out[key][map[cap]]=info[key][cap]}else{out[key][cap]=info[key][cap]}})});return out};Tput.prototype.compileTermcap=function(term){return this.compile(this.readTermcap(term))};Tput.prototype.injectTermcap=function(term){return this.inject(this.compileTermcap(term))};Tput.prototype._captoinfo=function(cap,s,parameterized){var self=this;var capstart;if(parameterized==null){parameterized=0}var MAX_PUSHED=16,stack=[];var stackptr=0,onstack=0,seenm=0,seenn=0,seenr=0,param=1,i=0,out="";function warn(){var args=Array.prototype.slice.call(arguments);args[0]="captoinfo: "+(args[0]||"");return self._debug.apply(self,args)}function isdigit(ch){return ch>="0"&&ch<="9"}function isgraph(ch){return ch>" "&&ch<="~"}function cvtchar(sp){var c="\0",len;var j=i;switch(sp[j]){case"\\":switch(sp[++j]){case"'":case"$":case"\\":case"%":c=sp[j];len=2;break;case"\0":c="\\";len=1;break;case"0":case"1":case"2":case"3":len=1;while(isdigit(sp[j])){c=String.fromCharCode(8*c.charCodeAt(0)+(sp[j++].charCodeAt(0)-"0".charCodeAt(0)));len++}break;default:c=sp[j];len=2;break}break;case"^":c=String.fromCharCode(sp[++j].charCodeAt(0)&31);len=2;break;default:c=sp[j];len=1}if(isgraph(c)&&c!==","&&c!=="'"&&c!=="\\"&&c!==":"){out+="%'";out+=c;out+="'"}else{out+="%{";if(c.charCodeAt(0)>99){out+=String.fromCharCode((c.charCodeAt(0)/100|0)+"0".charCodeAt(0))}if(c.charCodeAt(0)>9){out+=String.fromCharCode((c.charCodeAt(0)/10|0)%10+"0".charCodeAt(0))}out+=String.fromCharCode(c.charCodeAt(0)%10+"0".charCodeAt(0));out+="}"}return len}function getparm(parm,n){if(seenr){if(parm===1){parm=2}else if(parm===2){parm=1}}if(onstack===parm){if(n>1){warn("string may not be optimal");out+="%Pa";while(n--){out+="%ga"}}return}if(onstack!==0){push()}onstack=parm;while(n--){out+="%p";out+=String.fromCharCode("0".charCodeAt(0)+parm)}if(seenn&&parm<3){out+="%{96}%^"}if(seenm&&parm<3){out+="%{127}%^"}}function push(){if(stackptr>=MAX_PUSHED){warn("string too complex to convert")}else{stack[stackptr++]=onstack}}function pop(){if(stackptr===0){if(onstack===0){warn("I'm confused")}else{onstack=0}}else{onstack=stack[--stackptr]}param++}function see03(){getparm(param,1);out+="%3d";pop()}function invalid(){out+="%";i--;warn("unknown %% code %s (%#x) in %s",JSON.stringify(s[i]),s[i].charCodeAt(0),cap)}capstart=null;if(s==null)s="";if(parameterized>=0&&isdigit(s[i])){for(capstart=i;;i++){if(!(isdigit(s[i])||s[i]==="*"||s[i]===".")){break}}}while(s[i]){switch(s[i]){case"%":i++;if(parameterized<1){out+="%";break}switch(s[i++]){case"%":out+="%";break;case"r":if(seenr++===1){warn("saw %%r twice in %s",cap)}break;case"m":if(seenm++===1){warn("saw %%m twice in %s",cap)}break;case"n":if(seenn++===1){warn("saw %%n twice in %s",cap)}break;case"i":out+="%i";break;case"6":case"B":getparm(param,1);out+="%{10}%/%{16}%*";getparm(param,1);out+="%{10}%m%+";break;case"8":case"D":getparm(param,2);out+="%{2}%*%-";break;case">":getparm(param,2);out+="%?";i+=cvtchar(s);out+="%>%t";i+=cvtchar(s);out+="%+%;";break;case"a":if((s[i]==="="||s[i]==="+"||s[i]==="-"||s[i]==="*"||s[i]==="/")&&(s[i+1]==="p"||s[i+1]==="c")&&s[i+2]!=="\0"&&s[i+2]){var l;l=2;if(s[i]!=="="){getparm(param,1)}if(s[i+1]==="p"){getparm(param+s[i+2].charCodeAt(0)-"@".charCodeAt(0),1);if(param!==onstack){pop();param--}l++}else{i+=2,l+=cvtchar(s),i-=2}switch(s[i]){case"+":out+="%+";break;case"-":out+="%-";break;case"*":out+="%*";break;case"/":out+="%/";break;case"=":if(seenr){if(param===1){onstack=2}else if(param===2){onstack=1}else{onstack=param}}else{onstack=param}break}i+=l;break}getparm(param,1);i+=cvtchar(s);out+="%+";break;case"+":getparm(param,1);i+=cvtchar(s);out+="%+%c";pop();break;case"s":getparm(param,1);out+="%s";pop();break;case"-":i+=cvtchar(s);getparm(param,1);out+="%-%c";pop();break;case".":getparm(param,1);out+="%c";pop();break;case"0":if(s[i]==="3"){see03();break}else if(s[i]!=="2"){invalid();break}case"2":getparm(param,1);out+="%2d";pop();break;case"3":see03();break;case"d":getparm(param,1);out+="%d";pop();break;case"f":param++;break;case"b":param--;break;case"\\":out+="%\\";break;default:invalid();break}break;default:out+=s[i++];break}}if(capstart!=null){out+="$<";for(i=capstart;;i++){if(isdigit(s[i])||s[i]==="*"||s[i]==="."){out+=s[i]}else{break}}out+="/>"}if(s!==out){warn("Translating %s from %s to %s.",cap,JSON.stringify(s),JSON.stringify(out))}return out};Tput.prototype.getAll=function(){var dir=this._prefix(),list=asort(fs.readdirSync(dir)),infos=[];list.forEach(function(letter){var terms=asort(fs.readdirSync(path.resolve(dir,letter)));infos.push.apply(infos,terms)});function asort(obj){return obj.sort(function(a,b){a=a.toLowerCase().charCodeAt(0);b=b.toLowerCase().charCodeAt(0);return a-b})}return infos};Tput.prototype.compileAll=function(start){var self=this,all={};this.getAll().forEach(function(name){if(start&&name!==start){return}else{start=null}all[name]=self.compileTerminfo(name)});return all};Tput.prototype.detectFeatures=function(info){var data=this.parseACS(info);info.features={unicode:this.detectUnicode(info),brokenACS:this.detectBrokenACS(info),PCRomSet:this.detectPCRomSet(info),magicCookie:this.detectMagicCookie(info),padding:this.detectPadding(info),setbuf:this.detectSetbuf(info),acsc:data.acsc,acscr:data.acscr};return info.features};Tput.prototype.detectUnicode=function(){if(this.options.forceUnicode!=null){return this.options.forceUnicode}var LANG=process.env.LANG+":"+process.env.LANGUAGE+":"+process.env.LC_ALL+":"+process.env.LC_CTYPE;return/utf-?8/i.test(LANG)||this.GetConsoleCP()===65001};Tput.prototype.detectBrokenACS=function(info){if(process.env.NCURSES_NO_UTF8_ACS!=null){return!!+process.env.NCURSES_NO_UTF8_ACS}if(info.numbers.U8>=0){return!!info.numbers.U8}if(info.name==="linux"){return true}if(this.detectPCRomSet(info)){return true}if(this.termcap&&info.name.indexOf("screen")===0&&process.env.TERMCAP&&~process.env.TERMCAP.indexOf("screen")&&~process.env.TERMCAP.indexOf("hhII00")){if(~info.strings.enter_alt_charset_mode.indexOf("")||~info.strings.enter_alt_charset_mode.indexOf("")||~info.strings.set_attributes.indexOf("")||~info.strings.set_attributes.indexOf("")){return true}}return false};Tput.prototype.detectPCRomSet=function(info){var s=info.strings;if(s.enter_pc_charset_mode&&s.enter_alt_charset_mode&&s.enter_pc_charset_mode===s.enter_alt_charset_mode&&s.exit_pc_charset_mode===s.exit_alt_charset_mode){return true}return false};Tput.prototype.detectMagicCookie=function(){return process.env.NCURSES_NO_MAGIC_COOKIE==null};Tput.prototype.detectPadding=function(){return process.env.NCURSES_NO_PADDING==null};Tput.prototype.detectSetbuf=function(){return process.env.NCURSES_NO_SETBUF==null};Tput.prototype.parseACS=function(info){var data={};data.acsc={};data.acscr={};if(this.detectPCRomSet(info)){return data}Object.keys(Tput.acsc).forEach(function(ch){var acs_chars=info.strings.acs_chars||"",i=acs_chars.indexOf(ch),next=acs_chars[i+1];if(!next||i===-1||!Tput.acsc[next]){return}data.acsc[ch]=Tput.acsc[next];data.acscr[Tput.acsc[next]]=ch});return data};Tput.prototype.GetConsoleCP=function(){var ccp;if(process.platform!=="win32"){return-1}if(+process.env.NCURSES_UNICODE!==0){return 65001}try{ccp=cp.execFileSync(process.env.WINDIR+"\\system32\\chcp.com",[],{stdio:["ignore","pipe","ignore"],encoding:"ascii",timeout:1500})}catch(e){}ccp=/\d+/.exec(ccp);if(!ccp){return-1}ccp=+ccp[0];return ccp};function noop(){return""}noop.unsupported=true;function merge(a,b){Object.keys(b).forEach(function(key){a[key]=b[key]});return a}function write(data){return process.stdout.write(data)}function tryRead(file){if(Array.isArray(file)){for(var i=0;i<file.length;i++){var data=tryRead(file[i]);if(data)return data}return""}if(!file)return"";file=path.resolve.apply(path,arguments);try{return fs.readFileSync(file,"utf8")}catch(e){return""}}function sprintf(src){var params=Array.prototype.slice.call(arguments,1),rule=/%([\-+# ]{1,4})?(\d+(?:\.\d+)?)?([doxXsc])/g,i=0;return src.replace(rule,function(_,flag,width,type){var flags=(flag||"").split(""),param=params[i]!=null?params[i]:"",initial=param,opt={},pre="";i++;switch(type){case"d":param=(+param).toString(10);break;case"o":param=(+param).toString(8);break;case"x":param=(+param).toString(16);break;case"X":param=(+param).toString(16).toUppercase();break;case"s":break;case"c":param=isFinite(param)?String.fromCharCode(param||128):"";break}flags.forEach(function(flag){switch(flag){case"-":opt.left=true;break;case"+":opt.signs=true;break;case"#":opt.hexpoint=true;break;case" ":opt.space=true;break}});width=+width.split(".")[0];if(width&&!opt.left){param=param+"";while(param.length<width){param="0"+param}}if(opt.signs){if(+initial>=0){pre+="+"}}if(opt.space){if(!opt.signs&&+initial>=0){pre+=" "}}if(opt.hexpoint){switch(type){case"o":pre+="0";break;case"x":pre+="0x";break;case"X":pre+="0X";break}}if(opt.left){if(width>pre.length+param.length){width-=pre.length+param.length;pre=Array(width+1).join(" ")+pre}}return pre+param})}Tput._alias=require("./alias");Tput.alias={};["bools","numbers","strings"].forEach(function(type){Object.keys(Tput._alias[type]).forEach(function(key){var aliases=Tput._alias[type][key];Tput.alias[key]=[aliases[0]];Tput.alias[key].terminfo=aliases[0];Tput.alias[key].termcap=aliases[1]})});Tput.alias.no_esc_ctlc.push("beehive_glitch");Tput.alias.dest_tabs_magic_smso.push("teleray_glitch");Tput.alias.micro_col_size.push("micro_char_size");Tput.aliasMap={};Object.keys(Tput.alias).forEach(function(key){Tput.aliasMap[key]=key;Tput.alias[key].forEach(function(k){Tput.aliasMap[k]=key})});Tput.prototype.has=function(name){name=Tput.aliasMap[name];var val=this.all[name];if(!name)return false;if(typeof val==="number"){return val!==-1}return!!val};Tput.termcap=""+"vt102|dec vt102:"+":do=^J:co#80:li#24:cl=50\\E[;H\\E[2J:"+":le=^H:bs:cm=5\\E[%i%d;%dH:nd=2\\E[C:up=2\\E[A:"+":ce=3\\E[K:cd=50\\E[J:so=2\\E[7m:se=2\\E[m:us=2\\E[4m:ue=2\\E[m:"+":md=2\\E[1m:mr=2\\E[7m:mb=2\\E[5m:me=2\\E[m:is=\\E[1;24r\\E[24;1H:"+":rs=\\E>\\E[?3l\\E[?4l\\E[?5l\\E[?7h\\E[?8h:ks=\\E[?1h\\E=:ke=\\E[?1l\\E>:"+":ku=\\EOA:kd=\\EOB:kr=\\EOC:kl=\\EOD:kb=^H:\\\n"+":ho=\\E[H:k1=\\EOP:k2=\\EOQ:k3=\\EOR:k4=\\EOS:pt:sr=5\\EM:vt#3:"+":sc=\\E7:rc=\\E8:cs=\\E[%i%d;%dr:vs=\\E[?7l:ve=\\E[?7h:"+":mi:al=\\E[L:dc=\\E[P:dl=\\E[M:ei=\\E[4l:im=\\E[4h:";Tput.bools=["auto_left_margin","auto_right_margin","no_esc_ctlc","ceol_standout_glitch","eat_newline_glitch","erase_overstrike","generic_type","hard_copy","has_meta_key","has_status_line","insert_null_glitch","memory_above","memory_below","move_insert_mode","move_standout_mode","over_strike","status_line_esc_ok","dest_tabs_magic_smso","tilde_glitch","transparent_underline","xon_xoff","needs_xon_xoff","prtr_silent","hard_cursor","non_rev_rmcup","no_pad_char","non_dest_scroll_region","can_change","back_color_erase","hue_lightness_saturation","col_addr_glitch","cr_cancels_micro_mode","has_print_wheel","row_addr_glitch","semi_auto_right_margin","cpi_changes_res","lpi_changes_res","backspaces_with_bs","crt_no_scrolling","no_correctly_working_cr","gnu_has_meta_key","linefeed_is_newline","has_hardware_tabs","return_does_clr_eol"];Tput.numbers=["columns","init_tabs","lines","lines_of_memory","magic_cookie_glitch","padding_baud_rate","virtual_terminal","width_status_line","num_labels","label_height","label_width","max_attributes","maximum_windows","max_colors","max_pairs","no_color_video","buffer_capacity","dot_vert_spacing","dot_horz_spacing","max_micro_address","max_micro_jump","micro_col_size","micro_line_size","number_of_pins","output_res_char","output_res_line","output_res_horz_inch","output_res_vert_inch","print_rate","wide_char_size","buttons","bit_image_entwining","bit_image_type","magic_cookie_glitch_ul","carriage_return_delay","new_line_delay","backspace_delay","horizontal_tab_delay","number_of_function_keys"];Tput.strings=["back_tab","bell","carriage_return","change_scroll_region","clear_all_tabs","clear_screen","clr_eol","clr_eos","column_address","command_character","cursor_address","cursor_down","cursor_home","cursor_invisible","cursor_left","cursor_mem_address","cursor_normal","cursor_right","cursor_to_ll","cursor_up","cursor_visible","delete_character","delete_line","dis_status_line","down_half_line","enter_alt_charset_mode","enter_blink_mode","enter_bold_mode","enter_ca_mode","enter_delete_mode","enter_dim_mode","enter_insert_mode","enter_secure_mode","enter_protected_mode","enter_reverse_mode","enter_standout_mode","enter_underline_mode","erase_chars","exit_alt_charset_mode","exit_attribute_mode","exit_ca_mode","exit_delete_mode","exit_insert_mode","exit_standout_mode","exit_underline_mode","flash_screen","form_feed","from_status_line","init_1string","init_2string","init_3string","init_file","insert_character","insert_line","insert_padding","key_backspace","key_catab","key_clear","key_ctab","key_dc","key_dl","key_down","key_eic","key_eol","key_eos","key_f0","key_f1","key_f10","key_f2","key_f3","key_f4","key_f5","key_f6","key_f7","key_f8","key_f9","key_home","key_ic","key_il","key_left","key_ll","key_npage","key_ppage","key_right","key_sf","key_sr","key_stab","key_up","keypad_local","keypad_xmit","lab_f0","lab_f1","lab_f10","lab_f2","lab_f3","lab_f4","lab_f5","lab_f6","lab_f7","lab_f8","lab_f9","meta_off","meta_on","newline","pad_char","parm_dch","parm_delete_line","parm_down_cursor","parm_ich","parm_index","parm_insert_line","parm_left_cursor","parm_right_cursor","parm_rindex","parm_up_cursor","pkey_key","pkey_local","pkey_xmit","print_screen","prtr_off","prtr_on","repeat_char","reset_1string","reset_2string","reset_3string","reset_file","restore_cursor","row_address","save_cursor","scroll_forward","scroll_reverse","set_attributes","set_tab","set_window","tab","to_status_line","underline_char","up_half_line","init_prog","key_a1","key_a3","key_b2","key_c1","key_c3","prtr_non","char_padding","acs_chars","plab_norm","key_btab","enter_xon_mode","exit_xon_mode","enter_am_mode","exit_am_mode","xon_character","xoff_character","ena_acs","label_on","label_off","key_beg","key_cancel","key_close","key_command","key_copy","key_create","key_end","key_enter","key_exit","key_find","key_help","key_mark","key_message","key_move","key_next","key_open","key_options","key_previous","key_print","key_redo","key_reference","key_refresh","key_replace","key_restart","key_resume","key_save","key_suspend","key_undo","key_sbeg","key_scancel","key_scommand","key_scopy","key_screate","key_sdc","key_sdl","key_select","key_send","key_seol","key_sexit","key_sfind","key_shelp","key_shome","key_sic","key_sleft","key_smessage","key_smove","key_snext","key_soptions","key_sprevious","key_sprint","key_sredo","key_sreplace","key_sright","key_srsume","key_ssave","key_ssuspend","key_sundo","req_for_input","key_f11","key_f12","key_f13","key_f14","key_f15","key_f16","key_f17","key_f18","key_f19","key_f20","key_f21","key_f22","key_f23","key_f24","key_f25","key_f26","key_f27","key_f28","key_f29","key_f30","key_f31","key_f32","key_f33","key_f34","key_f35","key_f36","key_f37","key_f38","key_f39","key_f40","key_f41","key_f42","key_f43","key_f44","key_f45","key_f46","key_f47","key_f48","key_f49","key_f50","key_f51","key_f52","key_f53","key_f54","key_f55","key_f56","key_f57","key_f58","key_f59","key_f60","key_f61","key_f62","key_f63","clr_bol","clear_margins","set_left_margin","set_right_margin","label_format","set_clock","display_clock","remove_clock","create_window","goto_window","hangup","dial_phone","quick_dial","tone","pulse","flash_hook","fixed_pause","wait_tone","user0","user1","user2","user3","user4","user5","user6","user7","user8","user9","orig_pair","orig_colors","initialize_color","initialize_pair","set_color_pair","set_foreground","set_background","change_char_pitch","change_line_pitch","change_res_horz","change_res_vert","define_char","enter_doublewide_mode","enter_draft_quality","enter_italics_mode","enter_leftward_mode","enter_micro_mode","enter_near_letter_quality","enter_normal_quality","enter_shadow_mode","enter_subscript_mode","enter_superscript_mode","enter_upward_mode","exit_doublewide_mode","exit_italics_mode","exit_leftward_mode","exit_micro_mode","exit_shadow_mode","exit_subscript_mode","exit_superscript_mode","exit_upward_mode","micro_column_address","micro_down","micro_left","micro_right","micro_row_address","micro_up","order_of_pins","parm_down_micro","parm_left_micro","parm_right_micro","parm_up_micro","select_char_set","set_bottom_margin","set_bottom_margin_parm","set_left_margin_parm","set_right_margin_parm","set_top_margin","set_top_margin_parm","start_bit_image","start_char_set_def","stop_bit_image","stop_char_set_def","subscript_characters","superscript_characters","these_cause_cr","zero_motion","char_set_names","key_mouse","mouse_info","req_mouse_pos","get_mouse","set_a_foreground","set_a_background","pkey_plab","device_type","code_set_init","set0_des_seq","set1_des_seq","set2_des_seq","set3_des_seq","set_lr_margin","set_tb_margin","bit_image_repeat","bit_image_newline","bit_image_carriage_return","color_names","define_bit_image_region","end_bit_image_region","set_color_band","set_page_length","display_pc_char","enter_pc_charset_mode","exit_pc_charset_mode","enter_scancode_mode","exit_scancode_mode","pc_term_options","scancode_escape","alt_scancode_esc","enter_horizontal_hl_mode","enter_left_hl_mode","enter_low_hl_mode","enter_right_hl_mode","enter_top_hl_mode","enter_vertical_hl_mode","set_a_attributes","set_pglen_inch","termcap_init2","termcap_reset","linefeed_if_not_lf","backspace_if_not_bs","other_non_function_keys","arrow_key_map","acs_ulcorner","acs_llcorner","acs_urcorner","acs_lrcorner","acs_ltee","acs_rtee","acs_btee","acs_ttee","acs_hline","acs_vline","acs_plus","memory_lock","memory_unlock","box_chars_1"];Tput.acsc={"`":"◆",a:"▒",b:"\t",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"\v",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"};Tput.utoa=Tput.prototype.utoa={"◆":"*","▒":" ","°":"*","±":"+","␤":"\n","┘":"+","┐":"+","┌":"+","└":"+","┼":"+","⎺":"-","⎻":"-","─":"-","⎼":"-","⎽":"_","├":"+","┤":"+","┴":"+","┬":"+","│":"|","≤":"<","≥":">","π":"?","≠":"=","£":"?","·":"*"};exports=Tput;exports.sprintf=sprintf;exports.tryRead=tryRead;module.exports=exports;Tput._infoBuffer=new Buffer("GgElACYADwCdAakFeHRlcm0tMjU2Y29sb3J8eHRlcm0gd2l0aCAyNTYgY29sb3JzAAABAAABAAAAAQAAAAABAQAAAAAAAAABAAABAAEBAAAAAAAAAAABAFAACAAYAP//////////////////////////AAH/fwAABAAGAAgAGQAeACYAKgAuAP//OQBKAEwAUABXAP//WQBmAP//agBuAHgAfAD/////gACEAIkAjgD/////lwCcAP//oQCmAKsAsAC5AL0AxAD//80A0gDYAN4A////////8AD///////8CAf//BgH///////8IAf//DQH//////////xEBFQEbAR8BIwEnAS0BMwE5AT8BRQFJAf//TgH//1IBVwFcAWABZwH//24BcgF6Af////////////////////////////+CAYsB/////5QBnQGmAa8BuAHBAcoB0wHcAeUB////////7gHyAfcB///8Af8B/////xECFAIfAiICJAInAnkC//98Av///////////////34C//////////+CAv//twL/////uwLBAv/////////////////////////////HAssC///////////////////////////////////////////////////////////////////PAv/////WAv//////////3QLkAusC//////IC///5Av///////wAD/////////////wcDDQMTAxoDIQMoAy8DNwM/A0cDTwNXA18DZwNvA3YDfQOEA4sDkwObA6MDqwOzA7sDwwPLA9ID2QPgA+cD7wP3A/8DBwQPBBcEHwQnBC4ENQQ8BEMESwRTBFsEYwRrBHMEewSDBIoEkQSYBP////////////////////////////////////////////////////////////+dBKgErQS1BLkE///CBP//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////IAX///////8kBWMF/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////6MFpgUbW1oABwANABtbJWklcDElZDslcDIlZHIAG1szZwAbW0gbWzJKABtbSwAbW0oAG1slaSVwMSVkRwAbWyVpJXAxJWQ7JXAyJWRIAAoAG1tIABtbPzI1bAAIABtbPzEybBtbPzI1aAAbW0MAG1tBABtbPzEyOzI1aAAbW1AAG1tNABsoMAAbWzVtABtbMW0AG1s/MTA0OWgAG1s0aAAbWzhtABtbN20AG1s3bQAbWzRtABtbJXAxJWRYABsoQgAbKEIbW20AG1s/MTA0OWwAG1s0bAAbWzI3bQAbWzI0bQAbWz81aCQ8MTAwLz4bWz81bAAbWyFwG1s/Mzs0bBtbNGwbPgAbW0wACAAbWzN+ABtPQgAbT1AAG1syMX4AG09RABtPUgAbT1MAG1sxNX4AG1sxN34AG1sxOH4AG1sxOX4AG1syMH4AG09IABtbMn4AG09EABtbNn4AG1s1fgAbT0MAG1sxOzJCABtbMTsyQQAbT0EAG1s/MWwbPgAbWz8xaBs9ABtbPzEwMzRsABtbPzEwMzRoABtbJXAxJWRQABtbJXAxJWRNABtbJXAxJWRCABtbJXAxJWRAABtbJXAxJWRTABtbJXAxJWRMABtbJXAxJWREABtbJXAxJWRDABtbJXAxJWRUABtbJXAxJWRBABtbaQAbWzRpABtbNWkAG2MAG1shcBtbPzM7NGwbWzRsGz4AGzgAG1slaSVwMSVkZAAbNwAKABtNACU/JXA5JXQbKDAlZRsoQiU7G1swJT8lcDYldDsxJTslPyVwMiV0OzQlOyU/JXAxJXAzJXwldDs3JTslPyVwNCV0OzUlOyU/JXA3JXQ7OCU7bQAbSAAJABtPRQBgYGFhZmZnZ2lpampra2xsbW1ubm9vcHBxcXJyc3N0dHV1dnZ3d3h4eXl6ent7fHx9fX5+ABtbWgAbWz83aAAbWz83bAAbT0YAG09NABtbMzsyfgAbWzE7MkYAG1sxOzJIABtbMjsyfgAbWzE7MkQAG1s2OzJ+ABtbNTsyfgAbWzE7MkMAG1syM34AG1syNH4AG1sxOzJQABtbMTsyUQAbWzE7MlIAG1sxOzJTABtbMTU7Mn4AG1sxNzsyfgAbWzE4OzJ+ABtbMTk7Mn4AG1syMDsyfgAbWzIxOzJ+ABtbMjM7Mn4AG1syNDsyfgAbWzE7NVAAG1sxOzVRABtbMTs1UgAbWzE7NVMAG1sxNTs1fgAbWzE3OzV+ABtbMTg7NX4AG1sxOTs1fgAbWzIwOzV+ABtbMjE7NX4AG1syMzs1fgAbWzI0OzV+ABtbMTs2UAAbWzE7NlEAG1sxOzZSABtbMTs2UwAbWzE1OzZ+ABtbMTc7Nn4AG1sxODs2fgAbWzE5OzZ+ABtbMjA7Nn4AG1syMTs2fgAbWzIzOzZ+ABtbMjQ7Nn4AG1sxOzNQABtbMTszUQAbWzE7M1IAG1sxOzNTABtbMTU7M34AG1sxNzszfgAbWzE4OzN+ABtbMTk7M34AG1syMDszfgAbWzIxOzN+ABtbMjM7M34AG1syNDszfgAbWzE7NFAAG1sxOzRRABtbMTs0UgAbWzFLABtbJWklZDslZFIAG1s2bgAbWz8xOzJjABtbYwAbWzM5OzQ5bQAbXTQ7JXAxJWQ7cmdiOiVwMiV7MjU1fSUqJXsxMDAwfSUvJTIuMlgvJXAzJXsyNTV9JSolezEwMDB9JS8lMi4yWC8lcDQlezI1NX0lKiV7MTAwMH0lLyUyLjJYG1wAG1tNABtbJT8lcDElezh9JTwldDMlcDElZCVlJXAxJXsxNn0lPCV0OSVwMSV7OH0lLSVkJWUzODs1OyVwMSVkJTttABtbJT8lcDElezh9JTwldDQlcDElZCVlJXAxJXsxNn0lPCV0MTAlcDElezh9JS0lZCVlNDg7NTslcDElZCU7bQAbbAAbbQAAAgAAAD4AfgDvAgEBAAAHABMAGQArADEAOwBCAEkAUABXAF4AZQBsAHMAegCBAIgAjwCWAJ0ApACrALIAuQDAAMcAzgDVANwA4wDqAPEA+AD/AAYBDQEUARsBIgEpATABNwE+AUUBTAFTAVoBYQFoAW8BdgF9AYQBiwGSAZkBoAH//////////wAAAwAGAAkADAAPABIAFQAYAB0AIgAnACwAMQA1ADoAPwBEAEkATgBUAFoAYABmAGwAcgB4AH4AhACKAI8AlACZAJ4AowCpAK8AtQC7AMEAxwDNANMA2QDfAOUA6wDxAPcA/QADAQkBDwEVARsBHwEkASkBLgEzATgBPAFAAUQBG10xMTIHABtdMTI7JXAxJXMHABtbMztKABtdNTI7JXAxJXM7JXAyJXMHABtbMiBxABtbJXAxJWQgcQAbWzM7M34AG1szOzR+ABtbMzs1fgAbWzM7Nn4AG1szOzd+ABtbMTsyQgAbWzE7M0IAG1sxOzRCABtbMTs1QgAbWzE7NkIAG1sxOzdCABtbMTszRgAbWzE7NEYAG1sxOzVGABtbMTs2RgAbWzE7N0YAG1sxOzNIABtbMTs0SAAbWzE7NUgAG1sxOzZIABtbMTs3SAAbWzI7M34AG1syOzR+ABtbMjs1fgAbWzI7Nn4AG1syOzd+ABtbMTszRAAbWzE7NEQAG1sxOzVEABtbMTs2RAAbWzE7N0QAG1s2OzN+ABtbNjs0fgAbWzY7NX4AG1s2OzZ+ABtbNjs3fgAbWzU7M34AG1s1OzR+ABtbNTs1fgAbWzU7Nn4AG1s1Ozd+ABtbMTszQwAbWzE7NEMAG1sxOzVDABtbMTs2QwAbWzE7N0MAG1sxOzJBABtbMTszQQAbWzE7NEEAG1sxOzVBABtbMTs2QQAbWzE7N0EAQVgAWFQAQ3IAQ3MARTMATXMAU2UAU3MAa0RDMwBrREM0AGtEQzUAa0RDNgBrREM3AGtETgBrRE4zAGtETjQAa0RONQBrRE42AGtETjcAa0VORDMAa0VORDQAa0VORDUAa0VORDYAa0VORDcAa0hPTTMAa0hPTTQAa0hPTTUAa0hPTTYAa0hPTTcAa0lDMwBrSUM0AGtJQzUAa0lDNgBrSUM3AGtMRlQzAGtMRlQ0AGtMRlQ1AGtMRlQ2AGtMRlQ3AGtOWFQzAGtOWFQ0AGtOWFQ1AGtOWFQ2AGtOWFQ3AGtQUlYzAGtQUlY0AGtQUlY1AGtQUlY2AGtQUlY3AGtSSVQzAGtSSVQ0AGtSSVQ1AGtSSVQ2AGtSSVQ3AGtVUABrVVAzAGtVUDQAa1VQNQBrVVA2AGtVUDcAa2EyAGtiMQBrYjMAa2MyAA==","base64");Tput.prototype.readTerminfo=function(){this.terminal="xterm-256color";return this.parseTerminfo(Tput._infoBuffer,"/usr/share/terminfo/x/xterm-256color")};Tput.cpaths=[];Tput.termcap='# $XTermId: termcap,v 1.80 2012/06/10 14:30:37 tom Exp $\n#\n# These are termcap entries that correspond to xterm\'s terminfo file.\n# The file is formatted using ncurses\' "tic -CNx", but is not mechanically\n# derived from the terminfo.\n#\n#------------------------------------------------------------------------------\n# Copyright 1996-2011,2012 by Thomas E. Dickey\n#\n#                         All Rights Reserved\n#\n# Permission is hereby granted, free of charge, to any person obtaining a\n# copy of this software and associated documentation files (the\n# "Software"), to deal in the Software without restriction, including\n# without limitation the rights to use, copy, modify, merge, publish,\n# distribute, sublicense, and/or sell copies of the Software, and to\n# permit persons to whom the Software is furnished to do so, subject to\n# the following conditions:\n#\n# The above copyright notice and this permission notice shall be included\n# in all copies or substantial portions of the Software.\n#\n# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n# OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n# IN NO EVENT SHALL THE ABOVE LISTED COPYRIGHT HOLDER(S) BE LIABLE FOR ANY\n# CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n# TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n# SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n#\n# Except as contained in this notice, the name(s) of the above copyright\n# holders shall not be used in advertising or otherwise to promote the\n# sale, use or other dealings in this Software without prior written\n# authorization.\n#------------------------------------------------------------------------------\n#\n# Note:\n#\ttermcap format is limited to 1023 characters.  This set of descriptions\n#\tis a subset of the terminfo, since not all features can be fit into\n#\tthat limit.  The \'xterm\' description supports color.  The monochrome\n#\t\'xterm-mono\' drops color in favor of additional function keys.  If you\n#\tneed both, use terminfo.\n#\n#\tThe 1023-character limit applies to each entry after resolving the\n#\t"tc=" strings.  Some implementations may discount all or part of the\n#\tformatting characters in the entry (i.e., the backslash newline tab\n#\tcolon).  GNU termcap does not have this limit.\n#\n#\tI checked the limits using ncurses "captoinfo -CrTUvx", which prints\n#\tthe resolved length of each entry in a comment at the end - T.Dickey\n#\nxf|xterm-new|modern xterm:\\\n\t:*6=\\EOF:@7=\\EOF:F1=\\E[23~:F2=\\E[24~:K2=\\EOE:Km=\\E[M:\\\n\t:k1=\\EOP:k2=\\EOQ:k3=\\EOR:k4=\\EOS:k5=\\E[15~:k6=\\E[17~:\\\n\t:k7=\\E[18~:k8=\\E[19~:k9=\\E[20~:k;=\\E[21~:kB=\\E[Z:kH=\\EOF:\\\n\t:kI=\\E[2~:kN=\\E[6~:kP=\\E[5~:kd=\\EOB:kh=\\EOH:kl=\\EOD:\\\n\t:kr=\\EOC:ku=\\EOA:tc=xterm-basic:\n#\n# This chunk is used for building the VT220/Sun/PC keyboard variants.\nxb|xterm-basic|modern xterm common:\\\n\t:am:bs:km:mi:ms:ut:xn:AX:\\\n\t:Co#8:co#80:kn#12:li#24:pa#64:\\\n\t:AB=\\E[4%dm:AF=\\E[3%dm:AL=\\E[%dL:DC=\\E[%dP:DL=\\E[%dM:\\\n\t:DO=\\E[%dB:LE=\\E[%dD:RI=\\E[%dC:UP=\\E[%dA:ae=\\E(B:al=\\E[L:\\\n\t:as=\\E(0:bl=^G:cd=\\E[J:ce=\\E[K:cl=\\E[H\\E[2J:\\\n\t:cm=\\E[%i%d;%dH:cs=\\E[%i%d;%dr:ct=\\E[3g:dc=\\E[P:dl=\\E[M:\\\n\t:ei=\\E[4l:ho=\\E[H:im=\\E[4h:is=\\E[!p\\E[?3;4l\\E[4l\\E>:\\\n\t:kD=\\E[3~:ke=\\E[?1l\\E>:ks=\\E[?1h\\E=:le=^H:md=\\E[1m:\\\n\t:me=\\E[m:ml=\\El:mr=\\E[7m:mu=\\Em:nd=\\E[C:op=\\E[39;49m:\\\n\t:rc=\\E8:rs=\\E[!p\\E[?3;4l\\E[4l\\E>:sc=\\E7:se=\\E[27m:sf=^J:\\\n\t:so=\\E[7m:sr=\\EM:st=\\EH:te=\\E[?1049l:ti=\\E[?1049h:\\\n\t:ue=\\E[24m:up=\\E[A:us=\\E[4m:ve=\\E[?12l\\E[?25h:vi=\\E[?25l:\\\n\t:vs=\\E[?12;25h:tc=xterm+kbs:\n\n# The xterm-new description has all of the features, but is not completely\n# compatible with vt220.  If you are using a Sun or PC keyboard, set the\n# sunKeyboard resource to true:\n#\t+ maps the editing keypad\n#\t+ interprets control-function-key as a second array of keys, so a\n#\t  12-fkey keyboard can support vt220\'s 20-fkeys.\n#\t+ maps numeric keypad "+" to ",".\n#\t+ uses DEC-style control sequences for the application keypad.\n#\nvt|xterm-vt220|xterm emulating vt220:\\\n\t:*6=\\E[4~:@7=\\E[4~:K2=\\EOu:Km=\\E[M:kB=\\E[Z:kH=\\E[4~:\\\n\t:kh=\\E[1~:tc=xterm-basic:\n\nv1|xterm-24|xterms|vs100|24x80 xterm:\\\n\t:li#24:tc=xterm-old:\nv2|xterm-65|65x80 xterm:\\\n\t:li#65:tc=xterm-old:\nvb|xterm-bold|xterm with bold for underline:\\\n\t:so=\\E[7m:us=\\E[1m:tc=xterm-old:\nvB|xterm-boldso|xterm with bold for standout:\\\n\t:se=\\E[m:so=\\E[1m:tc=xterm-old:\nvm|xterm-mono|monochrome xterm:\\\n\t:ut@:\\\n\t:Co@:NC@:kn#20:pa@:\\\n\t:AB@:AF@:Sb@:Sf@:op@:st@:tc=xterm-old:\n#\n# Alternate terminal description that "works" for interactive shells such as\n# tcsh and bash.\nxn|xterm-noapp|xterm with cursor keys in normal mode:\\\n\t:kd=\\E[B:ke=\\E>:kl=\\E[D:kr=\\E[C:ks=\\E=:ku=\\E[A:te@:ti@:\\\n\t:tc=xterm:\n#\n# This should work for the commonly used "color xterm" variations (XFree86\n# xterm, color_xterm, nxterm, rxvt).  Note that it does not set \'bce\', so for\n# XFree86 and rxvt, some applications that use colors will be less efficient,\n# and in a few special cases (with "smart" optimization) the wrong color will\n# be painted in spots.\nvc|xterm-color|generic "ANSI" color xterm:\\\n\t:Co#8:NC@:pa#64:\\\n\t:AB=\\E[4%dm:AF=\\E[3%dm:ac=:op=\\E[m:tc=xterm-r6:\n#\n# These aliases are for compatibility with the terminfo; termcap cannot provide\n# the extra features such as color initialization, but termcap applications\n# still want the names.\nx1|xterm-16color|xterm alias:\\\n\t:tc=xterm-new:\n\nx2|xterm-88color|xterm alias:\\\n\t:Co#88:pa#7744:tc=xterm-256color:\n\nx3|xterm-256color|xterm alias:\\\n\t:Co#256:pa#32767:\\\n\t:AB=\\E[48;5;%dm:AF=\\E[38;5;%dm:tc=xterm-new:\n\nxi|xterm-nrc|xterm alias:\\\n\t:tc=xterm:\nxr|xterm-rep|xterm alias:\\\n\t:tc=xterm:\nxx|xterm-xmc|xterm alias:\\\n\t:sg#1:tc=xterm:\n#\n# An 8-bit description is doable with termcap, but there are probably no\n# termcap (or BSD curses) applications that are able to use it.\nx8|xterm-8bit|xterm terminal emulator 8-bit controls (X Window System):\\\n\t:am:km:mi:ms:xn:\\\n\t:co#80:it#8:li#24:\\\n\t:AL=\\233%dL:DC=\\233%dP:DL=\\233%dM:DO=\\233%dB:IC=\\233%d@:\\\n\t:K2=\\217y:Km=\\233M:LE=\\233%dD:RI=\\233%dC:UP=\\233%dA:\\\n\t:ae=\\E(B:al=\\233L:as=\\E(0:bl=^G:bt=\\233Z:cd=\\233J:ce=\\233K:\\\n\t:cl=\\233H\\2332J:cm=\\233%i%d;%dH:cr=^M:cs=\\233%i%d;%dr:\\\n\t:ct=\\2333g:dc=\\233P:dl=\\233M:do=^J:ei=\\2334l:ho=\\233H:\\\n\t:im=\\2334h:\\\n\t:is=\\E[62"p\\E G\\233m\\233?7h\\E>\\E7\\233?1;3;4;6l\\2334l\\233r\\E8:\\\n\t:k1=\\23311~:k2=\\23312~:k3=\\23313~:k4=\\23314~:k5=\\23315~:\\\n\t:k6=\\23317~:k7=\\23318~:k8=\\23319~:k9=\\23320~:kD=\\2333~:\\\n\t:kI=\\2332~:kN=\\2336~:kP=\\2335~:kd=\\217B:ke=\\233?1l\\E>:\\\n\t:kh=\\2331~:kl=\\217D:kr=\\217C:ks=\\233?1h\\E=:ku=\\217A:le=^H:\\\n\t:mb=\\2335m:md=\\2331m:me=\\233m:mr=\\2337m:nd=\\233C:rc=\\E8:\\\n\t:sc=\\E7:se=\\23327m:sf=^J:so=\\2337m:sr=\\215:st=\\210:ta=^I:\\\n\t:te=\\233?1049l:ti=\\233?1049h:ue=\\23324m:up=\\233A:\\\n\t:us=\\2334m:vb=\\233?5h\\233?5l:ve=\\233?25l\\233?25h:\\\n\t:vi=\\233?25l:vs=\\233?12;25h:tc=xterm+kbs:\n#\nhp|xterm-hp|xterm with hpterm function keys:\\\n\t:@7=\\EF:k1=\\Ep:k2=\\Eq:k3=\\Er:k4=\\Es:k5=\\Et:k6=\\Eu:k7=\\Ev:\\\n\t:k8=\\Ew:kC=\\EJ:kD=\\EP:kI=\\EQ:kN=\\ES:kP=\\ET:kd=\\EB:kh=\\Eh:\\\n\t:kl=\\ED:kr=\\EC:ku=\\EA:tc=xterm-basic:\n#\nxS|xterm-sco|xterm with SCO function keys:\\\n\t:@7=\\E[F:F1=\\E[W:F2=\\E[X:F3=\\E[Y:F5=\\E[a:F6=\\E[b:F7=\\E[c:\\\n\t:F8=\\E[d:F9=\\E[e:FA=\\E[f:FB=\\E[g:FC=\\E[h:FD=\\E[i:FE=\\E[j:\\\n\t:FF=\\E[k:ac=:k1=\\E[M:k2=\\E[N:k3=\\E[O:k4=\\E[P:k5=\\E[Q:\\\n\t:k6=\\E[R:k7=\\E[S:k8=\\E[T:k9=\\E[U:k;=\\E[V:kD=\\177:kI=\\E[L:\\\n\t:kN=\\E[G:kP=\\E[I:kd=\\E[B:kh=\\E[H:kl=\\E[D:kr=\\E[C:ku=\\E[A:\\\n\t:tc=xterm-basic:\n#\nv5|xterm-vt52|xterm emulating vt52:\\\n\t:bs:\\\n\t:co#80:it#8:li#24:\\\n\t:ae=\\EG:as=\\EF:bl=^G:cd=\\EJ:ce=\\EK:cl=\\EH\\EJ:cm=\\EY%+ %+ :\\\n\t:cr=^M:do=\\EB:ho=\\EH:kd=\\EB:kl=\\ED:kr=\\EC:ku=\\EA:le=\\ED:\\\n\t:nd=\\EC:nw=^M^J:sf=^J:sr=\\EI:ta=^I:up=\\EA:tc=xterm+kbs:\n#\nxs|xterm-sun|xterm with Sun functionkeys:\\\n\t:%1=\\E[196z:&8=\\E[195z:@0=\\E[200z:@5=\\E[197z:@7=\\E[220z:\\\n\t:F1=\\E[192z:F2=\\E[193z:K2=\\E[218z:Km=\\E[M:k1=\\E[224z:\\\n\t:k2=\\E[225z:k3=\\E[226z:k4=\\E[227z:k5=\\E[228z:k6=\\E[229z:\\\n\t:k7=\\E[230z:k8=\\E[231z:k9=\\E[232z:k;=\\E[233z:kD=\\E[3z:\\\n\t:kI=\\E[2z:kN=\\E[222z:kP=\\E[216z:kh=\\E[214z:\\\n\t:tc=xterm-basic:\n#\n# vi may work better with this entry, because vi doesn\'t use insert mode much.\n# |xterm-ic|xterm-vi|xterm with insert character instead of insert mode:\\\nvi|xterm-ic|xterm-vi|xterm with insert char:\\\n\t:mi@:\\\n\t:IC=\\E[%d@:ei@:ic=\\E[@:im@:tc=xterm:\n#\n# Compatible with the X11R6.3 xterm\nr6|xterm-r6|xterm-old|X11R6 xterm:\\\n\t:am:bs:km:mi:ms:pt:xn:\\\n\t:co#80:kn#20:li#24:\\\n\t:*6=\\E[4~:@0=\\E[1~:@7=\\E[4~:AL=\\E[%dL:DC=\\E[%dP:DL=\\E[%dM:\\\n\t:DO=\\E[%dB:F1=\\E[23~:F2=\\E[24~:F3=\\E[25~:F4=\\E[26~:\\\n\t:F5=\\E[28~:F6=\\E[29~:F7=\\E[31~:F8=\\E[32~:F9=\\E[33~:\\\n\t:FA=\\E[34~:LE=\\E[%dD:RI=\\E[%dC:UP=\\E[%dA:ae=^O:al=\\E[L:\\\n\t:as=^N:bl=^G:cd=\\E[J:ce=\\E[K:cl=\\E[H\\E[2J:cm=\\E[%i%d;%dH:\\\n\t:cs=\\E[%i%d;%dr:ct=\\E[3g:dc=\\E[P:dl=\\E[M:eA=\\E)0:ei=\\E[4l:\\\n\t:ho=\\E[H:im=\\E[4h:\\\n\t:is=\\E[m\\E[?7h\\E[4l\\E>\\E7\\E[r\\E[?1;3;4;6l\\E8:\\\n\t:k1=\\E[11~:k2=\\E[12~:k3=\\E[13~:k4=\\E[14~:k5=\\E[15~:\\\n\t:k6=\\E[17~:k7=\\E[18~:k8=\\E[19~:k9=\\E[20~:k;=\\E[21~:\\\n\t:kD=\\E[3~:kI=\\E[2~:kN=\\E[6~:kP=\\E[5~:kd=\\EOB:ke=\\E[?1l\\E>:\\\n\t:kh=\\E[1~:kl=\\EOD:kr=\\EOC:ks=\\E[?1h\\E=:ku=\\EOA:md=\\E[1m:\\\n\t:me=\\E[m:ml=\\El:mr=\\E[7m:mu=\\Em:nd=\\E[C:rc=\\E8:\\\n\t:rs=\\E[m\\E[?7h\\E[4l\\E>\\E7\\E[r\\E[?1;3;4;6l\\E8:sc=\\E7:\\\n\t:se=\\E[m:sf=^J:so=\\E[7m:sr=\\EM:te=\\E[2J\\E[?47l\\E8:\\\n\t:ti=\\E7\\E[?47h:ue=\\E[m:up=\\E[A:us=\\E[4m:tc=xterm+kbs:\n#\n# Compatible with the R5 xterm\nr5|xterm-r5|X11R5 xterm X11R5:\\\n\t:am:bs:km:mi:ms:pt:xn:\\\n\t:co#80:kn#4:li#24:\\\n\t:@7=\\E[4~:AL=\\E[%dL:DC=\\E[%dP:DL=\\E[%dM:DO=\\E[%dB:\\\n\t:IC=\\E[%d@:UP=\\E[%dA:al=\\E[L:cd=\\E[J:ce=\\E[K:cl=\\E[H\\E[2J:\\\n\t:cm=\\E[%i%d;%dH:cs=\\E[%i%d;%dr:ct=\\E[3g:dc=\\E[P:dl=\\E[M:\\\n\t:ei=\\E[4l:ho=\\E[H:im=\\E[4h:\\\n\t:is=\\E[r\\E[m\\E[2J\\E[H\\E[?7h\\E[?1;3;4;6l\\E[4l:\\\n\t:k1=\\E[11~:k2=\\E[12~:k3=\\E[13~:k4=\\E[14~:kd=\\EOB:\\\n\t:ke=\\E[?1l\\E>:kh=\\E[1~:kl=\\EOD:kr=\\EOC:ks=\\E[?1h\\E=:\\\n\t:ku=\\EOA:md=\\E[1m:me=\\E[m:mr=\\E[7m:nd=\\E[C:rc=\\E8:\\\n\t:rs=\\E>\\E[?1;3;4;5;6l\\E[4l\\E[?7h\\E[m\\E[r\\E[2J\\E[H:\\\n\t:sc=\\E7:se=\\E[m:sf=^J:so=\\E[7m:sr=\\EM:te=\\E[2J\\E[?47l\\E8:\\\n\t:ti=\\E7\\E[?47h:ue=\\E[m:up=\\E[A:us=\\E[4m:tc=xterm+kbs:\n#\n# Customization begins here.\nx0|xterm-xfree86|xterm terminal emulator (XFree86):\\\n\t:tc=xterm-new:\n#\n# This is the only entry which you should have to customize, since "xterm"\n# is widely used for a variety of incompatible terminal emulations including\n# color_xterm and rxvt.\nv0|xterm|X11 terminal emulator:\\\n\t:tc=xterm-new:\n#\t:tc=xterm-r6:\n\n# This fragment is for people who cannot agree on what the backspace key\n# should send.\nxterm+kbs|fragment for backspace key:\\\n\t:kb=^H:\n';Tput.prototype._readTermcap=Tput.prototype.readTermcap;Tput.prototype.readTermcap=function(){this.terminal="xterm";return this._readTermcap(this.terminal)};Tput.prototype.detectUnicode=function(){return true}}).call(this,require("_process"),require("buffer").Buffer,"/node_modules/blessed/lib")},{"./alias":58,_process:30,assert:2,buffer:10,child_process:1,fs:1,path:28}],66:[function(require,module,exports){(function(process){var stringFromCharCode=String.fromCharCode;var floor=Math.floor;exports.charWidth=function(str,i){var point=typeof str!=="number"?exports.codePointAt(str,i||0):str;if(point===0)return 0;if(point===9){if(!exports.blessed){exports.blessed=require("../")}return exports.blessed.screen.global?exports.blessed.screen.global.tabc.length:8}if(point<32||point>=127&&point<160){return 0}if(exports.combining[point]){return 0}if(12288===point||65281<=point&&point<=65376||65504<=point&&point<=65510){return 2}if(4352<=point&&point<=4447||4515<=point&&point<=4519||4602<=point&&point<=4607||9001<=point&&point<=9002||11904<=point&&point<=11929||11931<=point&&point<=12019||12032<=point&&point<=12245||12272<=point&&point<=12283||12289<=point&&point<=12350||12353<=point&&point<=12438||12441<=point&&point<=12543||12549<=point&&point<=12589||12593<=point&&point<=12686||12688<=point&&point<=12730||12736<=point&&point<=12771||12784<=point&&point<=12830||12832<=point&&point<=12871||12880<=point&&point<=13054||13056<=point&&point<=19903||19968<=point&&point<=42124||42128<=point&&point<=42182||43360<=point&&point<=43388||44032<=point&&point<=55203||55216<=point&&point<=55238||55243<=point&&point<=55291||63744<=point&&point<=64255||65040<=point&&point<=65049||65072<=point&&point<=65106||65108<=point&&point<=65126||65128<=point&&point<=65131||110592<=point&&point<=110593||127488<=point&&point<=127490||127504<=point&&point<=127546||127552<=point&&point<=127560||127568<=point&&point<=127569||131072<=point&&point<=194367||177984<=point&&point<=196605||196608<=point&&point<=262141){return 2}if(process.env.NCURSES_CJK_WIDTH){if(161===point||164===point||167<=point&&point<=168||170===point||173<=point&&point<=174||176<=point&&point<=180||182<=point&&point<=186||188<=point&&point<=191||198===point||208===point||215<=point&&point<=216||222<=point&&point<=225||230===point||232<=point&&point<=234||236<=point&&point<=237||240===point||242<=point&&point<=243||247<=point&&point<=250||252===point||254===point||257===point||273===point||275===point||283===point||294<=point&&point<=295||299===point||305<=point&&point<=307||312===point||319<=point&&point<=322||324===point||328<=point&&point<=331||333===point||338<=point&&point<=339||358<=point&&point<=359||363===point||462===point||464===point||466===point||468===point||470===point||472===point||474===point||476===point||593===point||609===point||708===point||711===point||713<=point&&point<=715||717===point||720===point||728<=point&&point<=731||733===point||735===point||768<=point&&point<=879||913<=point&&point<=929||931<=point&&point<=937||945<=point&&point<=961||963<=point&&point<=969||1025===point||1040<=point&&point<=1103||1105===point||8208===point||8211<=point&&point<=8214||8216<=point&&point<=8217||8220<=point&&point<=8221||8224<=point&&point<=8226||8228<=point&&point<=8231||8240===point||8242<=point&&point<=8243||8245===point||8251===point||8254===point||8308===point||8319===point||8321<=point&&point<=8324||8364===point||8451===point||8453===point||8457===point||8467===point||8470===point||8481<=point&&point<=8482||8486===point||8491===point||8531<=point&&point<=8532||8539<=point&&point<=8542||8544<=point&&point<=8555||8560<=point&&point<=8569||8585===point||8592<=point&&point<=8601||8632<=point&&point<=8633||8658===point||8660===point||8679===point||8704===point||8706<=point&&point<=8707||8711<=point&&point<=8712||8715===point||8719===point||8721===point||8725===point||8730===point||8733<=point&&point<=8736||8739===point||8741===point||8743<=point&&point<=8748||8750===point||8756<=point&&point<=8759||8764<=point&&point<=8765||8776===point||8780===point||8786===point||8800<=point&&point<=8801||8804<=point&&point<=8807||8810<=point&&point<=8811||8814<=point&&point<=8815||8834<=point&&point<=8835||8838<=point&&point<=8839||8853===point||8857===point||8869===point||8895===point||8978===point||9312<=point&&point<=9449||9451<=point&&point<=9547||9552<=point&&point<=9587||9600<=point&&point<=9615||9618<=point&&point<=9621||9632<=point&&point<=9633||9635<=point&&point<=9641||9650<=point&&point<=9651||9654<=point&&point<=9655||9660<=point&&point<=9661||9664<=point&&point<=9665||9670<=point&&point<=9672||9675===point||9678<=point&&point<=9681||9698<=point&&point<=9701||9711===point||9733<=point&&point<=9734||9737===point||9742<=point&&point<=9743||9748<=point&&point<=9749||9756===point||9758===point||9792===point||9794===point||9824<=point&&point<=9825||9827<=point&&point<=9829||9831<=point&&point<=9834||9836<=point&&point<=9837||9839===point||9886<=point&&point<=9887||9918<=point&&point<=9919||9924<=point&&point<=9933||9935<=point&&point<=9953||9955===point||9960<=point&&point<=9983||10045===point||10071===point||10102<=point&&point<=10111||11093<=point&&point<=11097||12872<=point&&point<=12879||57344<=point&&point<=63743||65024<=point&&point<=65039||65533===point||127232<=point&&point<=127242||127248<=point&&point<=127277||127280<=point&&point<=127337||127344<=point&&point<=127386||917760<=point&&point<=917999||983040<=point&&point<=1048573||1048576<=point&&point<=1114109){return+process.env.NCURSES_CJK_WIDTH||1}}return 1};exports.strWidth=function(str){var width=0;for(var i=0;i<str.length;i++){width+=exports.charWidth(str,i);if(exports.isSurrogate(str,i))i++}return width};exports.isSurrogate=function(str,i){var point=typeof str!=="number"?exports.codePointAt(str,i||0):str;return point>65535};exports.combiningTable=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];exports.combining=exports.combiningTable.reduce(function(out,row){for(var i=row[0];i<=row[1];i++){out[i]=true}return out},{});exports.isCombining=function(str,i){var point=typeof str!=="number"?exports.codePointAt(str,i||0):str;return exports.combining[point]===true};exports.codePointAt=function(str,position){if(str==null){throw TypeError()}var string=String(str);if(string.codePointAt){return string.codePointAt(position)}var size=string.length;var index=position?Number(position):0;if(index!==index){index=0}if(index<0||index>=size){return undefined}var first=string.charCodeAt(index);var second;if(first>=55296&&first<=56319&&size>index+1){second=string.charCodeAt(index+1);if(second>=56320&&second<=57343){return(first-55296)*1024+second-56320+65536}}return first};exports.fromCodePoint=function(){if(String.fromCodePoint){return String.fromCodePoint.apply(String,arguments)}var MAX_SIZE=16384;var codeUnits=[];var highSurrogate;var lowSurrogate;var index=-1;var length=arguments.length;if(!length){return""}var result="";while(++index<length){var codePoint=Number(arguments[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>1114111||floor(codePoint)!==codePoint){throw RangeError("Invalid code point: "+codePoint)}if(codePoint<=65535){codeUnits.push(codePoint)}else{codePoint-=65536;highSurrogate=(codePoint>>10)+55296;lowSurrogate=codePoint%1024+56320;codeUnits.push(highSurrogate,lowSurrogate)}if(index+1===length||codeUnits.length>MAX_SIZE){result+=stringFromCharCode.apply(null,codeUnits);codeUnits.length=0}}return result};exports.chars={};exports.chars.wide=new RegExp("(["+"\\u1100-\\u115f"+"\\u2329\\u232a"+"\\u2e80-\\u303e\\u3040-\\ua4cf"+"\\uac00-\\ud7a3"+"\\uf900-\\ufaff"+"\\ufe10-\\ufe19"+"\\ufe30-\\ufe6f"+"\\uff00-\\uff60"+"\\uffe0-\\uffe6"+"])","g");exports.chars.swide=new RegExp("("+"[\\ud840-\\ud87f][\\udc00-\\udffd]"+"|"+"[\\ud880-\\ud8bf][\\udc00-\\udffd]"+")","g");exports.chars.all=new RegExp("("+exports.chars.swide.source.slice(1,-1)+"|"+exports.chars.wide.source.slice(1,-1)+")","g");exports.chars.surrogate=/[\ud800-\udbff][\udc00-\udfff]/g;exports.chars.combining=exports.combiningTable.reduce(function(out,row){var low,high,range;if(row[0]>65535){low=exports.fromCodePoint(row[0]);low=[hexify(low.charCodeAt(0)),hexify(low.charCodeAt(1))];high=exports.fromCodePoint(row[1]);high=[hexify(high.charCodeAt(0)),hexify(high.charCodeAt(1))];range="[\\u"+low[0]+"-"+"\\u"+high[0]+"]"+"[\\u"+low[1]+"-"+"\\u"+high[1]+"]";if(!~out.indexOf("|"))out+="]";out+="|"+range}else{low=hexify(row[0]);high=hexify(row[1]);low="\\u"+low;high="\\u"+high;out+=low+"-"+high}return out},"[");exports.chars.combining=new RegExp(exports.chars.combining,"g");function hexify(n){n=n.toString(16);while(n.length<4)n="0"+n;return n}}).call(this,require("_process"))},{"../":"blessed",_process:30}],67:[function(require,module,exports){var widget=exports;widget.classes=["Node","Screen","Element","Box","Text","Line","ScrollableBox","ScrollableText","BigText","List","Form","Input","Textarea","Textbox","Button","ProgressBar","FileManager","Checkbox","RadioSet","RadioButton","Prompt","Question","Message","Loading","Listbar","Log","Table","ListTable","Terminal","Image","ANSIImage","OverlayImage","Video","Layout"];widget.classes.forEach(function(name){var file=name.toLowerCase();widget[name]=widget[file]=require("./widgets/"+file)});widget.aliases={ListBar:"Listbar",PNG:"ANSIImage"};Object.keys(widget.aliases).forEach(function(key){var name=widget.aliases[key];widget[key]=widget[name];widget[key.toLowerCase()]=widget[name]});require("./widgets/ansiimage");require("./widgets/bigtext");require("./widgets/box");require("./widgets/button");require("./widgets/checkbox");require("./widgets/element");require("./widgets/filemanager");require("./widgets/form");require("./widgets/image");require("./widgets/input");require("./widgets/layout");require("./widgets/line");require("./widgets/list");require("./widgets/listbar");require("./widgets/listtable");require("./widgets/loading");require("./widgets/log");require("./widgets/message");require("./widgets/node");require("./widgets/overlayimage");require("./widgets/progressbar");require("./widgets/prompt");require("./widgets/question");require("./widgets/radiobutton");require("./widgets/radioset");require("./widgets/screen");require("./widgets/scrollablebox");require("./widgets/scrollabletext");require("./widgets/table");require("./widgets/terminal");require("./widgets/text");require("./widgets/textarea");require("./widgets/textbox");require("./widgets/video")},{"./widgets/ansiimage":68,"./widgets/bigtext":69,"./widgets/box":70,"./widgets/button":71,"./widgets/checkbox":72,"./widgets/element":73,"./widgets/filemanager":74,"./widgets/form":75,"./widgets/image":76,"./widgets/input":77,"./widgets/layout":78,"./widgets/line":79,"./widgets/list":80,"./widgets/listbar":81,"./widgets/listtable":82,"./widgets/loading":83,"./widgets/log":84,"./widgets/message":85,"./widgets/node":86,"./widgets/overlayimage":87,"./widgets/progressbar":88,"./widgets/prompt":89,"./widgets/question":90,"./widgets/radiobutton":91,"./widgets/radioset":92,"./widgets/screen":93,"./widgets/scrollablebox":94,"./widgets/scrollabletext":95,"./widgets/table":96,"./widgets/terminal":97,"./widgets/text":98,"./widgets/textarea":99,"./widgets/textbox":100,"./widgets/video":101}],68:[function(require,module,exports){var cp=require("child_process");var colors=require("../colors");var Node=require("./node");var Box=require("./box");var tng=require("../../vendor/tng");function ANSIImage(options){var self=this;if(!(this instanceof Node)){return new ANSIImage(options)}options=options||{};options.shrink=true;Box.call(this,options);this.scale=this.options.scale||1;this.options.animate=this.options.animate!==false;this._noFill=true;if(this.options.file){this.setImage(this.options.file)}this.screen.on("prerender",function(){var lpos=self.lpos;if(!lpos)return;self.screen.clearRegion(lpos.xi,lpos.xl,lpos.yi,lpos.yl)});this.on("destroy",function(){self.stop()})}ANSIImage.prototype.__proto__=Box.prototype;ANSIImage.prototype.type="ansiimage";ANSIImage.curl=function(url){try{return cp.execFileSync("curl",["-s","-A","",url],{stdio:["ignore","pipe","ignore"]})}catch(e){}try{return cp.execFileSync("wget",["-U","","-O","-",url],{stdio:["ignore","pipe","ignore"]})}catch(e){}throw new Error("curl or wget failed.")};ANSIImage.prototype.setImage=function(file){this.file=typeof file==="string"?file:null;if(/^https?:/.test(file)){file=ANSIImage.curl(file)}var width=this.position.width;var height=this.position.height;if(width!=null){width=this.width}if(height!=null){height=this.height}try{this.setContent("");this.img=tng(file,{colors:colors,width:width,height:height,scale:this.scale,ascii:this.options.ascii,speed:this.options.speed,filename:this.file});if(width==null||height==null){this.width=this.img.cellmap[0].length;this.height=this.img.cellmap.length}if(this.img.frames&&this.options.animate){this.play()}else{this.cellmap=this.img.cellmap}}catch(e){this.setContent("Image Error: "+e.message);this.img=null;this.cellmap=null}};ANSIImage.prototype.play=function(){var self=this;if(!this.img)return;return this.img.play(function(bmp,cellmap){self.cellmap=cellmap;self.screen.render()})};ANSIImage.prototype.pause=function(){if(!this.img)return;return this.img.pause()};ANSIImage.prototype.stop=function(){if(!this.img)return;return this.img.stop()};ANSIImage.prototype.clearImage=function(){this.stop();this.setContent("");this.img=null;this.cellmap=null};ANSIImage.prototype.render=function(){var coords=this._render();if(!coords)return;if(this.img&&this.cellmap){this.img.renderElement(this.cellmap,this)}return coords};module.exports=ANSIImage},{"../../vendor/tng":102,"../colors":59,"./box":70,"./node":86,child_process:1}],69:[function(require,module,exports){(function(__dirname){var fs=require("fs");var Node=require("./node");var Box=require("./box");function BigText(options){if(!(this instanceof Node)){return new BigText(options)}options=options||{};options.font=options.font||__dirname+"/../../usr/fonts/ter-u14n.json";options.fontBold=options.font||__dirname+"/../../usr/fonts/ter-u14b.json";this.fch=options.fch;this.ratio={};this.font=this.loadFont(options.font);this.fontBold=this.loadFont(options.font);Box.call(this,options);if(this.style.bold){this.font=this.fontBold}}BigText.prototype.__proto__=Box.prototype;BigText.prototype.type="bigtext";BigText.prototype.loadFont=function(filename){var self=this,data,font;data=JSON.parse(fs.readFileSync(filename,"utf8"));this.ratio.width=data.width;this.ratio.height=data.height;function convertLetter(ch,lines){var line,i;while(lines.length>self.ratio.height){lines.shift();lines.pop()}lines=lines.map(function(line){var chs=line.split("");chs=chs.map(function(ch){return ch===" "?0:1});while(chs.length<self.ratio.width){chs.push(0)}return chs});while(lines.length<self.ratio.height){line=[];for(i=0;i<self.ratio.width;i++){line.push(0)}lines.push(line)}return lines}font=Object.keys(data.glyphs).reduce(function(out,ch){var lines=data.glyphs[ch].map;out[ch]=convertLetter(ch,lines);return out},{});delete font[" "];return font};BigText.prototype.setContent=function(content){this.content="";this.text=content||""};BigText.prototype.render=function(){if(this.position.width==null||this._shrinkWidth){this.position.width=this.ratio.width*this.text.length+1;this._shrinkWidth=true}if(this.position.height==null||this._shrinkHeight){this.position.height=this.ratio.height+0;this._shrinkHeight=true}var coords=this._render();if(!coords)return;var lines=this.screen.lines,left=coords.xi+this.ileft,top=coords.yi+this.itop,right=coords.xl-this.iright,bottom=coords.yl-this.ibottom;var dattr=this.sattr(this.style),bg=dattr&511,fg=dattr>>9&511,flags=dattr>>18&511,attr=flags<<18|bg<<9|fg;for(var x=left,i=0;x<right;x+=this.ratio.width,i++){var ch=this.text[i];if(!ch)break;var map=this.font[ch];if(!map)continue;for(var y=top;y<Math.min(bottom,top+this.ratio.height);y++){if(!lines[y])continue;var mline=map[y-top];if(!mline)continue;for(var mx=0;mx<this.ratio.width;mx++){var mcell=mline[mx];if(mcell==null)break;if(this.fch&&this.fch!==" "){lines[y][x+mx][0]=dattr;lines[y][x+mx][1]=mcell===1?this.fch:this.ch}else{lines[y][x+mx][0]=mcell===1?attr:dattr;lines[y][x+mx][1]=mcell===1?" ":this.ch}}lines[y].dirty=true}}return coords};module.exports=BigText}).call(this,"/node_modules/blessed/lib/widgets")},{"./box":70,"./node":86,fs:1}],70:[function(require,module,exports){var Node=require("./node");var Element=require("./element");function Box(options){if(!(this instanceof Node)){return new Box(options)}options=options||{};Element.call(this,options)}Box.prototype.__proto__=Element.prototype;Box.prototype.type="box";module.exports=Box},{"./element":73,"./node":86}],71:[function(require,module,exports){var Node=require("./node");var Input=require("./input");function Button(options){var self=this;if(!(this instanceof Node)){return new Button(options)}options=options||{};if(options.autoFocus==null){options.autoFocus=false}Input.call(this,options);this.on("keypress",function(ch,key){if(key.name==="enter"||key.name==="space"){return self.press()}});if(this.options.mouse){this.on("click",function(){return self.press()})}}Button.prototype.__proto__=Input.prototype;Button.prototype.type="button";Button.prototype.press=function(){this.focus();this.value=true;var result=this.emit("press");delete this.value;return result};module.exports=Button},{"./input":77,"./node":86}],72:[function(require,module,exports){var Node=require("./node");var Input=require("./input");function Checkbox(options){var self=this;if(!(this instanceof Node)){return new Checkbox(options)}options=options||{};Input.call(this,options);this.text=options.content||options.text||"";this.checked=this.value=options.checked||false;this.on("keypress",function(ch,key){if(key.name==="enter"||key.name==="space"){self.toggle();self.screen.render()}});if(options.mouse){this.on("click",function(){self.toggle();self.screen.render()})}this.on("focus",function(){var lpos=self.lpos;if(!lpos)return;self.screen.program.lsaveCursor("checkbox");self.screen.program.cup(lpos.yi,lpos.xi+1);self.screen.program.showCursor()});this.on("blur",function(){self.screen.program.lrestoreCursor("checkbox",true)})}Checkbox.prototype.__proto__=Input.prototype;Checkbox.prototype.type="checkbox";Checkbox.prototype.render=function(){this.clearPos(true);this.setContent("["+(this.checked?"x":" ")+"] "+this.text,true);return this._render()};Checkbox.prototype.check=function(){if(this.checked)return;this.checked=this.value=true;this.emit("check")};Checkbox.prototype.uncheck=function(){if(!this.checked)return;this.checked=this.value=false;this.emit("uncheck")};Checkbox.prototype.toggle=function(){return this.checked?this.uncheck():this.check()};module.exports=Checkbox},{"./input":77,"./node":86}],73:[function(require,module,exports){(function(process,global){var assert=require("assert");var colors=require("../colors"),unicode=require("../unicode");var nextTick=global.setImmediate||process.nextTick.bind(process);var helpers=require("../helpers");var Node=require("./node");function Element(options){var self=this;if(!(this instanceof Node)){return new Element(options)}options=options||{};if(options.scrollable&&!this._ignore&&this.type!=="scrollable-box"){var ScrollableBox=require("./scrollablebox");Object.getOwnPropertyNames(ScrollableBox.prototype).forEach(function(key){if(key==="type")return;Object.defineProperty(this,key,Object.getOwnPropertyDescriptor(ScrollableBox.prototype,key))},this);this._ignore=true;ScrollableBox.call(this,options);delete this._ignore;return this}Node.call(this,options);this.name=options.name;options.position=options.position||{left:options.left,right:options.right,top:options.top,bottom:options.bottom,width:options.width,height:options.height};if(options.position.width==="shrink"||options.position.height==="shrink"){if(options.position.width==="shrink"){delete options.position.width}if(options.position.height==="shrink"){delete options.position.height}options.shrink=true}this.position=options.position;this.noOverflow=options.noOverflow;this.dockBorders=options.dockBorders;this.shadow=options.shadow;this.style=options.style;if(!this.style){this.style={};this.style.fg=options.fg;this.style.bg=options.bg;this.style.bold=options.bold;this.style.underline=options.underline;this.style.blink=options.blink;this.style.inverse=options.inverse;this.style.invisible=options.invisible;this.style.transparent=options.transparent}this.hidden=options.hidden||false;this.fixed=options.fixed||false;this.align=options.align||"left";this.valign=options.valign||"top";this.wrap=options.wrap!==false;this.shrink=options.shrink;this.fixed=options.fixed;this.ch=options.ch||" ";if(typeof options.padding==="number"||!options.padding){options.padding={left:options.padding,top:options.padding,right:options.padding,bottom:options.padding}}this.padding={left:options.padding.left||0,top:options.padding.top||0,right:options.padding.right||0,bottom:options.padding.bottom||0};this.border=options.border;if(this.border){if(typeof this.border==="string"){this.border={type:this.border}}this.border.type=this.border.type||"bg";if(this.border.type==="ascii")this.border.type="line";this.border.ch=this.border.ch||" ";this.style.border=this.style.border||this.border.style;if(!this.style.border){this.style.border={};this.style.border.fg=this.border.fg;this.style.border.bg=this.border.bg}if(this.border.left==null)this.border.left=true;if(this.border.top==null)this.border.top=true;if(this.border.right==null)this.border.right=true;if(this.border.bottom==null)this.border.bottom=true}if(options.clickable){this.screen._listenMouse(this)}if(options.input||options.keyable){this.screen._listenKeys(this)}this.parseTags=options.parseTags||options.tags;this.setContent(options.content||"",true);if(options.label){this.setLabel(options.label)}if(options.hoverText){this.setHover(options.hoverText)}this.on("newListener",function fn(type){if(type==="mouse"||type==="click"||type==="mouseover"||type==="mouseout"||type==="mousedown"||type==="mouseup"||type==="mousewheel"||type==="wheeldown"||type==="wheelup"||type==="mousemove"){self.screen._listenMouse(self)}else if(type==="keypress"||type.indexOf("key ")===0){self.screen._listenKeys(self)}});this.on("resize",function(){self.parseContent()});this.on("attach",function(){self.parseContent()});this.on("detach",function(){delete self.lpos});if(options.hoverBg!=null){options.hoverEffects=options.hoverEffects||{};options.hoverEffects.bg=options.hoverBg}if(this.style.hover){options.hoverEffects=this.style.hover}if(this.style.focus){options.focusEffects=this.style.focus}if(options.effects){if(options.effects.hover)options.hoverEffects=options.effects.hover;if(options.effects.focus)options.focusEffects=options.effects.focus}[["hoverEffects","mouseover","mouseout","_htemp"],["focusEffects","focus","blur","_ftemp"]].forEach(function(props){var pname=props[0],over=props[1],out=props[2],temp=props[3];self.screen.setEffects(self,self,over,out,self.options[pname],temp)});if(this.options.draggable){this.draggable=true}if(options.focused){this.focus()}}Element.prototype.__proto__=Node.prototype;Element.prototype.type="element";Element.prototype.__defineGetter__("focused",function(){return this.screen.focused===this});Element.prototype.sattr=function(style,fg,bg){var bold=style.bold,underline=style.underline,blink=style.blink,inverse=style.inverse,invisible=style.invisible;if(fg==null&&bg==null){fg=style.fg;bg=style.bg}if(typeof bold==="function")bold=bold(this);if(typeof underline==="function")underline=underline(this);if(typeof blink==="function")blink=blink(this);if(typeof inverse==="function")inverse=inverse(this);if(typeof invisible==="function")invisible=invisible(this);if(typeof fg==="function")fg=fg(this);if(typeof bg==="function")bg=bg(this);return(invisible?16:0)<<18|(inverse?8:0)<<18|(blink?4:0)<<18|(underline?2:0)<<18|(bold?1:0)<<18|colors.convert(fg)<<9|colors.convert(bg)};Element.prototype.onScreenEvent=function(type,handler){var listeners=this._slisteners=this._slisteners||[];listeners.push({type:type,handler:handler});this.screen.on(type,handler)};Element.prototype.onceScreenEvent=function(type,handler){var listeners=this._slisteners=this._slisteners||[];var entry={type:type,handler:handler};listeners.push(entry);this.screen.once(type,function(){var i=listeners.indexOf(entry);if(~i)listeners.splice(i,1);return handler.apply(this,arguments)})};Element.prototype.removeScreenEvent=function(type,handler){var listeners=this._slisteners=this._slisteners||[];for(var i=0;i<listeners.length;i++){var listener=listeners[i];if(listener.type===type&&listener.handler===handler){listeners.splice(i,1);if(this._slisteners.length===0){delete this._slisteners}break}}this.screen.removeListener(type,handler)};Element.prototype.free=function(){var listeners=this._slisteners=this._slisteners||[];for(var i=0;i<listeners.length;i++){var listener=listeners[i];this.screen.removeListener(listener.type,listener.handler)}delete this._slisteners};Element.prototype.hide=function(){if(this.hidden)return;this.clearPos();this.hidden=true;this.emit("hide");if(this.screen.focused===this){this.screen.rewindFocus()}};Element.prototype.show=function(){if(!this.hidden)return;this.hidden=false;this.emit("show")};Element.prototype.toggle=function(){return this.hidden?this.show():this.hide()};Element.prototype.focus=function(){return this.screen.focused=this};Element.prototype.setContent=function(content,noClear,noTags){if(!noClear)this.clearPos();this.content=content||"";this.parseContent(noTags);this.emit("set content")};Element.prototype.getContent=function(){if(!this._clines)return"";return this._clines.fake.join("\n")};Element.prototype.setText=function(content,noClear){content=content||"";content=content.replace(/\x1b\[[\d;]*m/g,"");return this.setContent(content,noClear,true)};Element.prototype.getText=function(){return this.getContent().replace(/\x1b\[[\d;]*m/g,"")};Element.prototype.parseContent=function(noTags){if(this.detached)return false;var width=this.width-this.iwidth;if(this._clines==null||this._clines.width!==width||this._clines.content!==this.content){var content=this.content;content=content.replace(/[\x00-\x08\x0b-\x0c\x0e-\x1a\x1c-\x1f\x7f]/g,"").replace(/\x1b(?!\[[\d;]*m)/g,"").replace(/\r\n|\r/g,"\n").replace(/\t/g,this.screen.tabc);if(this.screen.fullUnicode){content=content.replace(unicode.chars.all,"$1");if(this.screen.program.isiTerm2){content=content.replace(unicode.chars.combining,"")}}else{content=content.replace(unicode.chars.all,"??");content=content.replace(unicode.chars.combining,"");content=content.replace(unicode.chars.surrogate,"?")}if(!noTags){content=this._parseTags(content)}this._clines=this._wrapContent(content,width);this._clines.width=width;this._clines.content=this.content;this._clines.attr=this._parseAttr(this._clines);this._clines.ci=[];this._clines.reduce(function(total,line){this._clines.ci.push(total);return total+line.length+1}.bind(this),0);this._pcontent=this._clines.join("\n");this.emit("parsed content");return true}this._clines.attr=this._parseAttr(this._clines)||this._clines.attr;return false};Element.prototype._parseTags=function(text){if(!this.parseTags)return text;if(!/{\/?[\w\-,;!#]*}/.test(text))return text;var program=this.screen.program,out="",state,bg=[],fg=[],flag=[],cap,slash,param,attr,esc;for(;;){if(!esc&&(cap=/^{escape}/.exec(text))){text=text.substring(cap[0].length);esc=true;continue}if(esc&&(cap=/^([\s\S]+?){\/escape}/.exec(text))){text=text.substring(cap[0].length);out+=cap[1];esc=false;continue}if(esc){out+=text;break}if(cap=/^{(\/?)([\w\-,;!#]*)}/.exec(text)){text=text.substring(cap[0].length);slash=cap[1]==="/";param=cap[2].replace(/-/g," ");if(param==="open"){out+="{";continue}else if(param==="close"){out+="}";continue}if(param.slice(-3)===" bg")state=bg;else if(param.slice(-3)===" fg")state=fg;else state=flag;if(slash){if(!param){out+=program._attr("normal");bg.length=0;fg.length=0;flag.length=0}else{attr=program._attr(param,false);if(attr==null){out+=cap[0]}else{state.pop();if(state.length){out+=program._attr(state[state.length-1])}else{out+=attr}}}}else{if(!param){out+=cap[0]}else{attr=program._attr(param);if(attr==null){out+=cap[0]}else{state.push(param);out+=attr}}}continue}if(cap=/^[\s\S]+?(?={\/?[\w\-,;!#]*})/.exec(text)){text=text.substring(cap[0].length);out+=cap[0];continue}out+=text;break}return out};Element.prototype._parseAttr=function(lines){var dattr=this.sattr(this.style),attr=dattr,attrs=[],line,i,j,c;if(lines[0].attr===attr){return}for(j=0;j<lines.length;j++){line=lines[j];attrs[j]=attr;for(i=0;i<line.length;i++){if(line[i]===""){if(c=/^\x1b\[[\d;]*m/.exec(line.substring(i))){attr=this.screen.attrCode(c[0],attr,dattr);i+=c[0].length-1}}}}return attrs};Element.prototype._align=function(line,width,align){if(!align)return line;var cline=line.replace(/\x1b\[[\d;]*m/g,""),len=cline.length,s=width-len;if(this.shrink){s=0}if(len===0)return line;if(s<0)return line;if(align==="center"){s=Array((s/2|0)+1).join(" ");return s+line+s}else if(align==="right"){s=Array(s+1).join(" ");return s+line}else if(this.parseTags&&~line.indexOf("{|}")){var parts=line.split("{|}");var cparts=cline.split("{|}");s=Math.max(width-cparts[0].length-cparts[1].length,0);s=Array(s+1).join(" ");return parts[0]+s+parts[1]}return line};Element.prototype._wrapContent=function(content,width){var tags=this.parseTags,state=this.align,wrap=this.wrap,margin=0,rtof=[],ftor=[],out=[],no=0,line,align,cap,total,i,part,j,lines,rest;lines=content.split("\n");if(!content){out.push(content);out.rtof=[0];out.ftor=[[0]];out.fake=lines;out.real=out;out.mwidth=0;return out}if(this.scrollbar)margin++;if(this.type==="textarea")margin++;if(width>margin)width-=margin;main:for(;no<lines.length;no++){line=lines[no];align=state;ftor.push([]);if(tags){if(cap=/^{(left|center|right)}/.exec(line)){line=line.substring(cap[0].length);align=state=cap[1]!=="left"?cap[1]:null}if(cap=/{\/(left|center|right)}$/.exec(line)){line=line.slice(0,-cap[0].length);state=this.align}}while(line.length>width){for(i=0,total=0;i<line.length;i++){while(line[i]===""){while(line[i]&&line[i++]!=="m");}if(!line[i])break;if(++total===width){i++;if(!wrap){rest=line.substring(i).match(/\x1b\[[^m]*m/g);rest=rest?rest.join(""):"";out.push(this._align(line.substring(0,i)+rest,width,align));ftor[no].push(out.length-1);rtof.push(no);continue main}if(!this.screen.fullUnicode){if(i!==line.length){j=i;while(j>i-10&&j>0&&line[--j]!==" ");if(line[j]===" ")i=j+1}}else{if(i!==line.length){if(unicode.isSurrogate(line,i))i--;for(var s=0,n=0;n<i;n++){if(unicode.isSurrogate(line,n))s++,n++}i+=s;j=i;while(j>i-10&&j>0){j--;if(line[j]===" "||line[j]===""||unicode.isSurrogate(line,j-1)&&line[j+1]!==""||unicode.isCombining(line,j)){break}}if(line[j]===" "||line[j]===""||unicode.isSurrogate(line,j-1)&&line[j+1]!==""||unicode.isCombining(line,j)){i=j+1}}}break}}part=line.substring(0,i);line=line.substring(i);out.push(this._align(part,width,align));ftor[no].push(out.length-1);rtof.push(no);if(line==="")continue main;if(/^(?:\x1b[\[\d;]*m)+$/.test(line)){out[out.length-1]+=line;continue main}}out.push(this._align(line,width,align));ftor[no].push(out.length-1);rtof.push(no)}out.rtof=rtof;out.ftor=ftor;out.fake=lines;out.real=out;out.mwidth=out.reduce(function(current,line){line=line.replace(/\x1b\[[\d;]*m/g,"");return line.length>current?line.length:current},0);return out};Element.prototype.__defineGetter__("visible",function(){var el=this;do{if(el.detached)return false;if(el.hidden)return false}while(el=el.parent);return true});Element.prototype.__defineGetter__("_detached",function(){var el=this;do{if(el.type==="screen")return false;if(!el.parent)return true}while(el=el.parent);return false});Element.prototype.enableMouse=function(){this.screen._listenMouse(this)};Element.prototype.enableKeys=function(){this.screen._listenKeys(this)};Element.prototype.enableInput=function(){this.screen._listenMouse(this);this.screen._listenKeys(this)};Element.prototype.__defineGetter__("draggable",function(){return this._draggable===true});Element.prototype.__defineSetter__("draggable",function(draggable){return draggable?this.enableDrag(draggable):this.disableDrag()});Element.prototype.enableDrag=function(verify){var self=this;if(this._draggable)return true;if(typeof verify!=="function"){verify=function(){return true}}this.enableMouse();this.on("mousedown",this._dragMD=function(data){if(self.screen._dragging)return;if(!verify(data))return;self.screen._dragging=self;self._drag={x:data.x-self.aleft,y:data.y-self.atop};self.setFront()});this.onScreenEvent("mouse",this._dragM=function(data){if(self.screen._dragging!==self)return;if(data.action!=="mousedown"&&data.action!=="mousemove"){delete self.screen._dragging;delete self._drag;return}if(!self.parent)return;var ox=self._drag.x,oy=self._drag.y,px=self.parent.aleft,py=self.parent.atop,x=data.x-px-ox,y=data.y-py-oy;if(self.position.right!=null){if(self.position.left!=null){self.width="100%-"+(self.parent.width-self.width)}self.position.right=null}if(self.position.bottom!=null){if(self.position.top!=null){self.height="100%-"+(self.parent.height-self.height)}self.position.bottom=null}self.rleft=x;self.rtop=y;self.screen.render()});return this._draggable=true};Element.prototype.disableDrag=function(){if(!this._draggable)return false;delete this.screen._dragging;delete this._drag;this.removeListener("mousedown",this._dragMD);this.removeScreenEvent("mouse",this._dragM);return this._draggable=false};Element.prototype.key=function(){return this.screen.program.key.apply(this,arguments)};Element.prototype.onceKey=function(){return this.screen.program.onceKey.apply(this,arguments)};Element.prototype.unkey=Element.prototype.removeKey=function(){return this.screen.program.unkey.apply(this,arguments)};Element.prototype.setIndex=function(index){if(!this.parent)return;if(index<0){index=this.parent.children.length+index}index=Math.max(index,0);index=Math.min(index,this.parent.children.length-1);var i=this.parent.children.indexOf(this);if(!~i)return;var item=this.parent.children.splice(i,1)[0];this.parent.children.splice(index,0,item)};Element.prototype.setFront=function(){return this.setIndex(-1)};Element.prototype.setBack=function(){return this.setIndex(0)};Element.prototype.clearPos=function(get,override){if(this.detached)return;var lpos=this._getCoords(get);if(!lpos)return;this.screen.clearRegion(lpos.xi,lpos.xl,lpos.yi,lpos.yl,override)};Element.prototype.setLabel=function(options){var self=this;var Box=require("./box");if(typeof options==="string"){options={text:options}}if(this._label){this._label.setContent(options.text);if(options.side!=="right"){this._label.rleft=2+(this.border?-1:0);this._label.position.right=undefined;if(!this.screen.autoPadding){this._label.rleft=2}}else{this._label.rright=2+(this.border?-1:0);this._label.position.left=undefined;if(!this.screen.autoPadding){this._label.rright=2}}return}this._label=new Box({screen:this.screen,parent:this,content:options.text,top:-this.itop,tags:this.parseTags,shrink:true,style:this.style.label});if(options.side!=="right"){this._label.rleft=2-this.ileft}else{this._label.rright=2-this.iright}this._label._isLabel=true;if(!this.screen.autoPadding){if(options.side!=="right"){this._label.rleft=2}else{this._label.rright=2}this._label.rtop=0}var reposition=function(){self._label.rtop=(self.childBase||0)-self.itop;if(!self.screen.autoPadding){self._label.rtop=self.childBase||0}self.screen.render()};this.on("scroll",this._labelScroll=function(){reposition()});this.on("resize",this._labelResize=function(){nextTick(function(){reposition()})})};Element.prototype.removeLabel=function(){if(!this._label)return;this.removeListener("scroll",this._labelScroll);this.removeListener("resize",this._labelResize);this._label.detach();delete this._labelScroll;delete this._labelResize;delete this._label};Element.prototype.setHover=function(options){if(typeof options==="string"){options={text:options}}this._hoverOptions=options;this.enableMouse();this.screen._initHover()};Element.prototype.removeHover=function(){delete this._hoverOptions;if(!this.screen._hoverText||this.screen._hoverText.detached)return;this.screen._hoverText.detach();this.screen.render()};Element.prototype._getPos=function(){var pos=this.lpos;assert.ok(pos);if(pos.aleft!=null)return pos;pos.aleft=pos.xi;pos.atop=pos.yi;pos.aright=this.screen.cols-pos.xl;pos.abottom=this.screen.rows-pos.yl;pos.width=pos.xl-pos.xi;pos.height=pos.yl-pos.yi;return pos};Element.prototype._getWidth=function(get){var parent=get?this.parent._getPos():this.parent,width=this.position.width,left,expr;if(typeof width==="string"){if(width==="half")width="50%";expr=width.split(/(?=\+|-)/);width=expr[0];width=+width.slice(0,-1)/100;width=parent.width*width|0;width+=+(expr[1]||0);return width}if(width==null){left=this.position.left||0;if(typeof left==="string"){if(left==="center")left="50%";expr=left.split(/(?=\+|-)/);left=expr[0];left=+left.slice(0,-1)/100;left=parent.width*left|0;left+=+(expr[1]||0)}width=parent.width-(this.position.right||0)-left;if(this.screen.autoPadding){if((this.position.left!=null||this.position.right==null)&&this.position.left!=="center"){width-=this.parent.ileft}width-=this.parent.iright}}return width};Element.prototype.__defineGetter__("width",function(){return this._getWidth(false)});Element.prototype._getHeight=function(get){var parent=get?this.parent._getPos():this.parent,height=this.position.height,top,expr;if(typeof height==="string"){if(height==="half")height="50%";expr=height.split(/(?=\+|-)/);height=expr[0];height=+height.slice(0,-1)/100;height=parent.height*height|0;height+=+(expr[1]||0);return height}if(height==null){top=this.position.top||0;if(typeof top==="string"){if(top==="center")top="50%";expr=top.split(/(?=\+|-)/);top=expr[0];top=+top.slice(0,-1)/100;top=parent.height*top|0;top+=+(expr[1]||0)}height=parent.height-(this.position.bottom||0)-top;if(this.screen.autoPadding){if((this.position.top!=null||this.position.bottom==null)&&this.position.top!=="center"){height-=this.parent.itop}height-=this.parent.ibottom}}return height};Element.prototype.__defineGetter__("height",function(){return this._getHeight(false)});Element.prototype._getLeft=function(get){var parent=get?this.parent._getPos():this.parent,left=this.position.left||0,expr;if(typeof left==="string"){if(left==="center")left="50%";expr=left.split(/(?=\+|-)/);left=expr[0];left=+left.slice(0,-1)/100;left=parent.width*left|0;left+=+(expr[1]||0);if(this.position.left==="center"){left-=this._getWidth(get)/2|0}}if(this.position.left==null&&this.position.right!=null){return this.screen.cols-this._getWidth(get)-this._getRight(get)}if(this.screen.autoPadding){if((this.position.left!=null||this.position.right==null)&&this.position.left!=="center"){left+=this.parent.ileft}}return(parent.aleft||0)+left};Element.prototype.__defineGetter__("aleft",function(){return this._getLeft(false)});Element.prototype._getRight=function(get){var parent=get?this.parent._getPos():this.parent,right;if(this.position.right==null&&this.position.left!=null){right=this.screen.cols-(this._getLeft(get)+this._getWidth(get));if(this.screen.autoPadding){right+=this.parent.iright}return right}right=(parent.aright||0)+(this.position.right||0);if(this.screen.autoPadding){right+=this.parent.iright}return right};Element.prototype.__defineGetter__("aright",function(){return this._getRight(false)});Element.prototype._getTop=function(get){var parent=get?this.parent._getPos():this.parent,top=this.position.top||0,expr;if(typeof top==="string"){if(top==="center")top="50%";expr=top.split(/(?=\+|-)/);top=expr[0];top=+top.slice(0,-1)/100;top=parent.height*top|0;top+=+(expr[1]||0);if(this.position.top==="center"){top-=this._getHeight(get)/2|0}}if(this.position.top==null&&this.position.bottom!=null){return this.screen.rows-this._getHeight(get)-this._getBottom(get)}if(this.screen.autoPadding){if((this.position.top!=null||this.position.bottom==null)&&this.position.top!=="center"){top+=this.parent.itop}}return(parent.atop||0)+top};Element.prototype.__defineGetter__("atop",function(){return this._getTop(false)});Element.prototype._getBottom=function(get){var parent=get?this.parent._getPos():this.parent,bottom;if(this.position.bottom==null&&this.position.top!=null){bottom=this.screen.rows-(this._getTop(get)+this._getHeight(get));if(this.screen.autoPadding){bottom+=this.parent.ibottom}return bottom}bottom=(parent.abottom||0)+(this.position.bottom||0);if(this.screen.autoPadding){bottom+=this.parent.ibottom}return bottom};Element.prototype.__defineGetter__("abottom",function(){return this._getBottom(false)});Element.prototype.__defineGetter__("rleft",function(){return this.aleft-this.parent.aleft});Element.prototype.__defineGetter__("rright",function(){return this.aright-this.parent.aright});Element.prototype.__defineGetter__("rtop",function(){return this.atop-this.parent.atop});Element.prototype.__defineGetter__("rbottom",function(){return this.abottom-this.parent.abottom});Element.prototype.__defineSetter__("width",function(val){if(this.position.width===val)return;if(/^\d+$/.test(val))val=+val;this.emit("resize");this.clearPos();return this.position.width=val});Element.prototype.__defineSetter__("height",function(val){if(this.position.height===val)return;if(/^\d+$/.test(val))val=+val;this.emit("resize");this.clearPos();return this.position.height=val});Element.prototype.__defineSetter__("aleft",function(val){var expr;if(typeof val==="string"){if(val==="center"){val=this.screen.width/2|0;val-=this.width/2|0}else{expr=val.split(/(?=\+|-)/);val=expr[0];val=+val.slice(0,-1)/100;val=this.screen.width*val|0;val+=+(expr[1]||0)}}val-=this.parent.aleft;if(this.position.left===val)return;this.emit("move");this.clearPos();return this.position.left=val});Element.prototype.__defineSetter__("aright",function(val){val-=this.parent.aright;if(this.position.right===val)return;this.emit("move");this.clearPos();return this.position.right=val});Element.prototype.__defineSetter__("atop",function(val){var expr;if(typeof val==="string"){if(val==="center"){val=this.screen.height/2|0;val-=this.height/2|0}else{expr=val.split(/(?=\+|-)/);val=expr[0];val=+val.slice(0,-1)/100;val=this.screen.height*val|0;val+=+(expr[1]||0)}}val-=this.parent.atop;if(this.position.top===val)return;this.emit("move");this.clearPos();return this.position.top=val});Element.prototype.__defineSetter__("abottom",function(val){val-=this.parent.abottom;if(this.position.bottom===val)return;this.emit("move");this.clearPos();return this.position.bottom=val});Element.prototype.__defineSetter__("rleft",function(val){if(this.position.left===val)return;if(/^\d+$/.test(val))val=+val;this.emit("move");this.clearPos();return this.position.left=val});Element.prototype.__defineSetter__("rright",function(val){if(this.position.right===val)return;this.emit("move");this.clearPos();return this.position.right=val});Element.prototype.__defineSetter__("rtop",function(val){if(this.position.top===val)return;if(/^\d+$/.test(val))val=+val;this.emit("move");this.clearPos();return this.position.top=val});Element.prototype.__defineSetter__("rbottom",function(val){if(this.position.bottom===val)return;this.emit("move");this.clearPos();return this.position.bottom=val});Element.prototype.__defineGetter__("ileft",function(){return(this.border?1:0)+this.padding.left});Element.prototype.__defineGetter__("itop",function(){return(this.border?1:0)+this.padding.top});Element.prototype.__defineGetter__("iright",function(){return(this.border?1:0)+this.padding.right});Element.prototype.__defineGetter__("ibottom",function(){return(this.border?1:0)+this.padding.bottom});Element.prototype.__defineGetter__("iwidth",function(){return(this.border?2:0)+this.padding.left+this.padding.right});Element.prototype.__defineGetter__("iheight",function(){return(this.border?2:0)+this.padding.top+this.padding.bottom});Element.prototype.__defineGetter__("tpadding",function(){return this.padding.left+this.padding.top+this.padding.right+this.padding.bottom});Element.prototype.__defineGetter__("left",function(){return this.rleft});Element.prototype.__defineGetter__("right",function(){return this.rright});Element.prototype.__defineGetter__("top",function(){return this.rtop});Element.prototype.__defineGetter__("bottom",function(){return this.rbottom});Element.prototype.__defineSetter__("left",function(val){return this.rleft=val});Element.prototype.__defineSetter__("right",function(val){return this.rright=val});Element.prototype.__defineSetter__("top",function(val){return this.rtop=val});Element.prototype.__defineSetter__("bottom",function(val){return this.rbottom=val});Element.prototype._getShrinkBox=function(xi,xl,yi,yl,get){if(!this.children.length){return{xi:xi,xl:xi+1,yi:yi,yl:yi+1}}var i,el,ret,mxi=xi,mxl=xi+1,myi=yi,myl=yi+1;var _lpos;if(get){_lpos=this.lpos;this.lpos={xi:xi,xl:xl,yi:yi,yl:yl}}for(i=0;i<this.children.length;i++){el=this.children[i];ret=el._getCoords(get);if(!ret)continue;if(el.position.left==null&&el.position.right!=null){ret.xl=xi+(ret.xl-ret.xi);ret.xi=xi;if(this.screen.autoPadding){ret.xl+=this.ileft;ret.xi+=this.ileft}}if(el.position.top==null&&el.position.bottom!=null){ret.yl=yi+(ret.yl-ret.yi);ret.yi=yi;if(this.screen.autoPadding){ret.yl+=this.itop;ret.yi+=this.itop}}if(ret.xi<mxi)mxi=ret.xi;if(ret.xl>mxl)mxl=ret.xl;if(ret.yi<myi)myi=ret.yi;if(ret.yl>myl)myl=ret.yl}if(get){this.lpos=_lpos}if(this.position.width==null&&(this.position.left==null||this.position.right==null)){if(this.position.left==null&&this.position.right!=null){xi=xl-(mxl-mxi);if(!this.screen.autoPadding){xi-=this.padding.left+this.padding.right}else{xi-=this.ileft}}else{xl=mxl;if(!this.screen.autoPadding){xl+=this.padding.left+this.padding.right;if(this.type==="list-table"){xl-=this.padding.left+this.padding.right;xl+=this.iright}}else{xl+=this.iright}}}if(this.position.height==null&&(this.position.top==null||this.position.bottom==null)&&(!this.scrollable||this._isList)){if(this._isList){myi=0-this.itop;myl=this.items.length+this.ibottom}if(this.position.top==null&&this.position.bottom!=null){yi=yl-(myl-myi);if(!this.screen.autoPadding){yi-=this.padding.top+this.padding.bottom}else{yi-=this.itop}}else{yl=myl;if(!this.screen.autoPadding){yl+=this.padding.top+this.padding.bottom}else{yl+=this.ibottom}}}return{xi:xi,xl:xl,yi:yi,yl:yl}};Element.prototype._getShrinkContent=function(xi,xl,yi,yl){var h=this._clines.length,w=this._clines.mwidth||1;if(this.position.width==null&&(this.position.left==null||this.position.right==null)){if(this.position.left==null&&this.position.right!=null){xi=xl-w-this.iwidth}else{xl=xi+w+this.iwidth}}if(this.position.height==null&&(this.position.top==null||this.position.bottom==null)&&(!this.scrollable||this._isList)){if(this.position.top==null&&this.position.bottom!=null){yi=yl-h-this.iheight}else{yl=yi+h+this.iheight}}return{xi:xi,xl:xl,yi:yi,yl:yl}};Element.prototype._getShrink=function(xi,xl,yi,yl,get){var shrinkBox=this._getShrinkBox(xi,xl,yi,yl,get),shrinkContent=this._getShrinkContent(xi,xl,yi,yl,get),xll=xl,yll=yl;if(shrinkBox.xl-shrinkBox.xi>shrinkContent.xl-shrinkContent.xi){xi=shrinkBox.xi;xl=shrinkBox.xl}else{xi=shrinkContent.xi;xl=shrinkContent.xl}if(shrinkBox.yl-shrinkBox.yi>shrinkContent.yl-shrinkContent.yi){yi=shrinkBox.yi;yl=shrinkBox.yl}else{yi=shrinkContent.yi;yl=shrinkContent.yl}if(xl<xll&&this.position.left==="center"){xll=(xll-xl)/2|0;xi+=xll;xl+=xll}if(yl<yll&&this.position.top==="center"){yll=(yll-yl)/2|0;yi+=yll;yl+=yll}return{xi:xi,xl:xl,yi:yi,yl:yl}};Element.prototype._getCoords=function(get,noscroll){if(this.hidden)return;var xi=this._getLeft(get),xl=xi+this._getWidth(get),yi=this._getTop(get),yl=yi+this._getHeight(get),base=this.childBase||0,el=this,fixed=this.fixed,coords,v,noleft,noright,notop,nobot,ppos,b;if(this.shrink){coords=this._getShrink(xi,xl,yi,yl,get);xi=coords.xi,xl=coords.xl;yi=coords.yi,yl=coords.yl}while(el=el.parent){if(el.scrollable){if(fixed){fixed=false;continue}break}}var thisparent=el;if(el&&!noscroll){ppos=thisparent.lpos;if(!ppos)return;yi-=ppos.base;yl-=ppos.base;b=thisparent.border?1:0;if(this._isLabel){b=0}if(yi<ppos.yi+b){if(yl-1<ppos.yi+b){return}else{notop=true;v=ppos.yi-yi;if(this.border)v--;if(thisparent.border)v++;base+=v;yi+=v}}else if(yl>ppos.yl-b){if(yi>ppos.yl-1-b){return}else{nobot=true;v=yl-ppos.yl;if(this.border)v--;if(thisparent.border)v++;yl-=v}}if(yi>=yl)return;if(xi<el.lpos.xi){xi=el.lpos.xi;noleft=true;if(this.border)xi--;if(thisparent.border)xi++}if(xl>el.lpos.xl){xl=el.lpos.xl;noright=true;if(this.border)xl++;if(thisparent.border)xl--}if(xi>=xl)return}if(this.noOverflow&&this.parent.lpos){if(xi<this.parent.lpos.xi+this.parent.ileft){xi=this.parent.lpos.xi+this.parent.ileft}if(xl>this.parent.lpos.xl-this.parent.iright){xl=this.parent.lpos.xl-this.parent.iright}if(yi<this.parent.lpos.yi+this.parent.itop){yi=this.parent.lpos.yi+this.parent.itop}if(yl>this.parent.lpos.yl-this.parent.ibottom){yl=this.parent.lpos.yl-this.parent.ibottom}}return{xi:xi,xl:xl,yi:yi,yl:yl,base:base,noleft:noleft,noright:noright,notop:notop,nobot:nobot,renders:this.screen.renders}};Element.prototype.render=function(){this._emit("prerender");this.parseContent();var coords=this._getCoords(true);if(!coords){delete this.lpos;return}if(coords.xl-coords.xi<=0){coords.xl=Math.max(coords.xl,coords.xi);return}if(coords.yl-coords.yi<=0){coords.yl=Math.max(coords.yl,coords.yi);return}var lines=this.screen.lines,xi=coords.xi,xl=coords.xl,yi=coords.yi,yl=coords.yl,x,y,cell,attr,ch,content=this._pcontent,ci=this._clines.ci[coords.base],battr,dattr,c,visible,i,bch=this.ch;if(coords.base>=this._clines.ci.length){ci=this._pcontent.length}this.lpos=coords;if(this.border&&this.border.type==="line"){this.screen._borderStops[coords.yi]=true;this.screen._borderStops[coords.yl-1]=true}dattr=this.sattr(this.style);attr=dattr;if(ci>0){attr=this._clines.attr[Math.min(coords.base,this._clines.length-1)]}if(this.border)xi++,xl--,yi++,yl--;if(this.tpadding||this.valign&&this.valign!=="top"){if(this.style.transparent){for(y=Math.max(yi,0);y<yl;y++){if(!lines[y])break;for(x=Math.max(xi,0);x<xl;x++){if(!lines[y][x])break;lines[y][x][0]=colors.blend(attr,lines[y][x][0]);lines[y].dirty=true}}}else{this.screen.fillRegion(dattr,bch,xi,xl,yi,yl)}}if(this.tpadding){xi+=this.padding.left,xl-=this.padding.right;yi+=this.padding.top,yl-=this.padding.bottom}if(this.valign==="middle"||this.valign==="bottom"){visible=yl-yi;if(this._clines.length<visible){if(this.valign==="middle"){visible=visible/2|0;visible-=this._clines.length/2|0}else if(this.valign==="bottom"){visible-=this._clines.length}ci-=visible*(xl-xi)}}for(y=yi;y<yl;y++){if(!lines[y]){if(y>=this.screen.height||yl<this.ibottom){break}else{continue}}for(x=xi;x<xl;x++){cell=lines[y][x];if(!cell){if(x>=this.screen.width||xl<this.iright){break}else{continue}}ch=content[ci++]||bch;while(ch===""){if(c=/^\x1b\[[\d;]*m/.exec(content.substring(ci-1))){ci+=c[0].length-1;attr=this.screen.attrCode(c[0],attr,dattr);if(this.parent._isList&&this.parent.interactive&&this.parent.items[this.parent.selected]===this&&this.parent.options.invertSelected!==false){attr=attr&~(511<<9)|dattr&511<<9}ch=content[ci]||bch;ci++}else{break}}if(ch==="\t")ch=bch;if(ch==="\n"){if(x===xi&&y!==yi&&content[ci-2]!=="\n"){x--;continue}ch=bch;for(;x<xl;x++){cell=lines[y][x];if(!cell)break;if(this.style.transparent){lines[y][x][0]=colors.blend(attr,lines[y][x][0]);if(content[ci])lines[y][x][1]=ch;lines[y].dirty=true}else{if(attr!==cell[0]||ch!==cell[1]){lines[y][x][0]=attr;lines[y][x][1]=ch;lines[y].dirty=true}}}continue}if(this.screen.fullUnicode&&content[ci-1]){var point=unicode.codePointAt(content,ci-1);if(unicode.combining[point]){if(point>65535){ch=content[ci-1]+content[ci];ci++}if(x-1>=xi){lines[y][x-1][1]+=ch}else if(y-1>=yi){lines[y-1][xl-1][1]+=ch}x--;continue}if(point>65535){ch=content[ci-1]+content[ci];ci++}}if(this._noFill)continue;if(this.style.transparent){lines[y][x][0]=colors.blend(attr,lines[y][x][0]);if(content[ci])lines[y][x][1]=ch;lines[y].dirty=true}else{if(attr!==cell[0]||ch!==cell[1]){lines[y][x][0]=attr;lines[y][x][1]=ch;lines[y].dirty=true}}}}if(this.scrollbar){i=Math.max(this._clines.length,this._scrollBottom())}if(coords.notop||coords.nobot)i=-Infinity;if(this.scrollbar&&yl-yi<i){x=xl-1;if(this.scrollbar.ignoreBorder&&this.border)x++;if(this.alwaysScroll){y=this.childBase/(i-(yl-yi))}else{y=(this.childBase+this.childOffset)/(i-1)}y=yi+((yl-yi)*y|0);if(y>=yl)y=yl-1;cell=lines[y]&&lines[y][x];if(cell){if(this.track){ch=this.track.ch||" ";attr=this.sattr(this.style.track,this.style.track.fg||this.style.fg,this.style.track.bg||this.style.bg);this.screen.fillRegion(attr,ch,x,x+1,yi,yl)}ch=this.scrollbar.ch||" ";attr=this.sattr(this.style.scrollbar,this.style.scrollbar.fg||this.style.fg,this.style.scrollbar.bg||this.style.bg);if(attr!==cell[0]||ch!==cell[1]){lines[y][x][0]=attr;lines[y][x][1]=ch;lines[y].dirty=true}}}if(this.border)xi--,xl++,yi--,yl++;if(this.tpadding){xi-=this.padding.left,xl+=this.padding.right;yi-=this.padding.top,yl+=this.padding.bottom}if(this.border){battr=this.sattr(this.style.border);y=yi;if(coords.notop)y=-1;for(x=xi;x<xl;x++){if(!lines[y])break;if(coords.noleft&&x===xi)continue;if(coords.noright&&x===xl-1)continue;cell=lines[y][x];if(!cell)continue;if(this.border.type==="line"){if(x===xi){ch="┌";if(!this.border.left){if(this.border.top){ch="─"}else{continue}}else{if(!this.border.top){ch="│"}}}else if(x===xl-1){ch="┐";if(!this.border.right){if(this.border.top){ch="─"}else{continue}}else{if(!this.border.top){ch="│"}}}else{ch="─"}}else if(this.border.type==="bg"){ch=this.border.ch}if(!this.border.top&&x!==xi&&x!==xl-1){ch=" ";if(dattr!==cell[0]||ch!==cell[1]){lines[y][x][0]=dattr;lines[y][x][1]=ch;lines[y].dirty=true;continue}}if(battr!==cell[0]||ch!==cell[1]){lines[y][x][0]=battr;lines[y][x][1]=ch;lines[y].dirty=true}}y=yi+1;for(;y<yl-1;y++){if(!lines[y])continue;cell=lines[y][xi];if(cell){if(this.border.left){if(this.border.type==="line"){ch="│"}else if(this.border.type==="bg"){ch=this.border.ch}if(!coords.noleft)if(battr!==cell[0]||ch!==cell[1]){lines[y][xi][0]=battr;lines[y][xi][1]=ch;lines[y].dirty=true}}else{ch=" ";if(dattr!==cell[0]||ch!==cell[1]){lines[y][xi][0]=dattr;lines[y][xi][1]=ch;lines[y].dirty=true}}}cell=lines[y][xl-1];if(cell){if(this.border.right){if(this.border.type==="line"){ch="│"}else if(this.border.type==="bg"){ch=this.border.ch}if(!coords.noright)if(battr!==cell[0]||ch!==cell[1]){lines[y][xl-1][0]=battr;lines[y][xl-1][1]=ch;lines[y].dirty=true}}else{ch=" ";if(dattr!==cell[0]||ch!==cell[1]){lines[y][xl-1][0]=dattr;lines[y][xl-1][1]=ch;lines[y].dirty=true}}}}y=yl-1;if(coords.nobot)y=-1;for(x=xi;x<xl;x++){if(!lines[y])break;if(coords.noleft&&x===xi)continue;if(coords.noright&&x===xl-1)continue;cell=lines[y][x];if(!cell)continue;if(this.border.type==="line"){if(x===xi){ch="└";if(!this.border.left){if(this.border.bottom){ch="─"}else{continue}}else{if(!this.border.bottom){ch="│"}}}else if(x===xl-1){ch="┘";if(!this.border.right){if(this.border.bottom){ch="─"}else{continue}}else{if(!this.border.bottom){ch="│"}}}else{ch="─"}}else if(this.border.type==="bg"){ch=this.border.ch}if(!this.border.bottom&&x!==xi&&x!==xl-1){ch=" ";if(dattr!==cell[0]||ch!==cell[1]){lines[y][x][0]=dattr;lines[y][x][1]=ch;lines[y].dirty=true}continue}if(battr!==cell[0]||ch!==cell[1]){lines[y][x][0]=battr;lines[y][x][1]=ch;lines[y].dirty=true}}}if(this.shadow){y=Math.max(yi+1,0);for(;y<yl+1;y++){if(!lines[y])break;x=xl;for(;x<xl+2;x++){if(!lines[y][x])break;lines[y][x][0]=colors.blend(lines[y][x][0]);lines[y].dirty=true}}y=yl;for(;y<yl+1;y++){if(!lines[y])break;for(x=Math.max(xi+1,0);x<xl;x++){if(!lines[y][x])break;lines[y][x][0]=colors.blend(lines[y][x][0]);lines[y].dirty=true}}}this.children.forEach(function(el){if(el.screen._ci!==-1){el.index=el.screen._ci++}el.render()});this._emit("render",[coords]);return coords};Element.prototype._render=Element.prototype.render;Element.prototype.insertLine=function(i,line){if(typeof line==="string")line=line.split("\n");if(i!==i||i==null){i=this._clines.ftor.length}i=Math.max(i,0);while(this._clines.fake.length<i){this._clines.fake.push("");this._clines.ftor.push([this._clines.push("")-1]);this._clines.rtof(this._clines.fake.length-1)}var start=this._clines.length,diff,real;if(i>=this._clines.ftor.length){real=this._clines.ftor[this._clines.ftor.length-1];real=real[real.length-1]+1}else{real=this._clines.ftor[i][0]}for(var j=0;j<line.length;j++){this._clines.fake.splice(i+j,0,line[j])}this.setContent(this._clines.fake.join("\n"),true);diff=this._clines.length-start;if(diff>0){var pos=this._getCoords();if(!pos)return;var height=pos.yl-pos.yi-this.iheight,base=this.childBase||0,visible=real>=base&&real-base<height;if(pos&&visible&&this.screen.cleanSides(this)){this.screen.insertLine(diff,pos.yi+this.itop+real-base,pos.yi,pos.yl-this.ibottom-1)}}};Element.prototype.deleteLine=function(i,n){n=n||1;if(i!==i||i==null){i=this._clines.ftor.length-1}i=Math.max(i,0);i=Math.min(i,this._clines.ftor.length-1);var start=this._clines.length,diff,real=this._clines.ftor[i][0];while(n--){this._clines.fake.splice(i,1)}this.setContent(this._clines.fake.join("\n"),true);diff=start-this._clines.length;var height=0;if(diff>0){var pos=this._getCoords();if(!pos)return;height=pos.yl-pos.yi-this.iheight;var base=this.childBase||0,visible=real>=base&&real-base<height;if(pos&&visible&&this.screen.cleanSides(this)){this.screen.deleteLine(diff,pos.yi+this.itop+real-base,pos.yi,pos.yl-this.ibottom-1)}}if(this._clines.length<height){this.clearPos()}};Element.prototype.insertTop=function(line){var fake=this._clines.rtof[this.childBase||0];return this.insertLine(fake,line)};Element.prototype.insertBottom=function(line){var h=(this.childBase||0)+this.height-this.iheight,i=Math.min(h,this._clines.length),fake=this._clines.rtof[i-1]+1;return this.insertLine(fake,line)};Element.prototype.deleteTop=function(n){var fake=this._clines.rtof[this.childBase||0];return this.deleteLine(fake,n)};Element.prototype.deleteBottom=function(n){var h=(this.childBase||0)+this.height-1-this.iheight,i=Math.min(h,this._clines.length-1),fake=this._clines.rtof[i];n=n||1;return this.deleteLine(fake-(n-1),n)};Element.prototype.setLine=function(i,line){i=Math.max(i,0);while(this._clines.fake.length<i){this._clines.fake.push("")}this._clines.fake[i]=line;return this.setContent(this._clines.fake.join("\n"),true)};Element.prototype.setBaseLine=function(i,line){var fake=this._clines.rtof[this.childBase||0];return this.setLine(fake+i,line)};Element.prototype.getLine=function(i){i=Math.max(i,0);i=Math.min(i,this._clines.fake.length-1);return this._clines.fake[i]};Element.prototype.getBaseLine=function(i){var fake=this._clines.rtof[this.childBase||0];return this.getLine(fake+i)};Element.prototype.clearLine=function(i){i=Math.min(i,this._clines.fake.length-1);return this.setLine(i,"")};Element.prototype.clearBaseLine=function(i){var fake=this._clines.rtof[this.childBase||0];return this.clearLine(fake+i)};Element.prototype.unshiftLine=function(line){return this.insertLine(0,line)};Element.prototype.shiftLine=function(n){return this.deleteLine(0,n)};Element.prototype.pushLine=function(line){if(!this.content)return this.setLine(0,line);return this.insertLine(this._clines.fake.length,line)};Element.prototype.popLine=function(n){return this.deleteLine(this._clines.fake.length-1,n)};Element.prototype.getLines=function(){return this._clines.fake.slice()};Element.prototype.getScreenLines=function(){return this._clines.slice()};Element.prototype.strWidth=function(text){text=this.parseTags?helpers.stripTags(text):text;return this.screen.fullUnicode?unicode.strWidth(text):helpers.dropUnicode(text).length};Element.prototype.screenshot=function(xi,xl,yi,yl){xi=this.lpos.xi+this.ileft+(xi||0);if(xl!=null){xl=this.lpos.xi+this.ileft+(xl||0)}else{xl=this.lpos.xl-this.iright}yi=this.lpos.yi+this.itop+(yi||0);if(yl!=null){yl=this.lpos.yi+this.itop+(yl||0)}else{yl=this.lpos.yl-this.ibottom}return this.screen.screenshot(xi,xl,yi,yl)};module.exports=Element}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../colors":59,"../helpers":62,"../unicode":66,"./box":70,"./node":86,"./scrollablebox":94,_process:30,assert:2}],74:[function(require,module,exports){(function(process){var path=require("path"),fs=require("fs");var helpers=require("../helpers");var Node=require("./node");var List=require("./list");function FileManager(options){var self=this;if(!(this instanceof Node)){return new FileManager(options)}options=options||{};options.parseTags=true;List.call(this,options);this.cwd=options.cwd||process.cwd();this.file=this.cwd;this.value=this.cwd;if(options.label&&~options.label.indexOf("%path")){this._label.setContent(options.label.replace("%path",this.cwd))}this.on("select",function(item){var value=item.content.replace(/\{[^{}]+\}/g,"").replace(/@$/,""),file=path.resolve(self.cwd,value);return fs.stat(file,function(err,stat){if(err){return self.emit("error",err,file)}self.file=file;self.value=file;if(stat.isDirectory()){self.emit("cd",file,self.cwd);self.cwd=file;if(options.label&&~options.label.indexOf("%path")){self._label.setContent(options.label.replace("%path",file))}self.refresh()}else{self.emit("file",file)}})})}FileManager.prototype.__proto__=List.prototype;FileManager.prototype.type="file-manager";FileManager.prototype.refresh=function(cwd,callback){if(!callback){callback=cwd;cwd=null}var self=this;if(cwd)this.cwd=cwd;else cwd=this.cwd;return fs.readdir(cwd,function(err,list){if(err&&err.code==="ENOENT"){self.cwd=cwd!==process.env.HOME?process.env.HOME:"/";return self.refresh(callback)}if(err){if(callback)return callback(err);return self.emit("error",err,cwd)}var dirs=[],files=[];list.unshift("..");list.forEach(function(name){var f=path.resolve(cwd,name),stat;try{stat=fs.lstatSync(f)}catch(e){}if(stat&&stat.isDirectory()||name===".."){dirs.push({name:name,text:"{light-blue-fg}"+name+"{/light-blue-fg}/",dir:true})}else if(stat&&stat.isSymbolicLink()){files.push({name:name,text:"{light-cyan-fg}"+name+"{/light-cyan-fg}@",dir:false})}else{files.push({name:name,text:name,dir:false})}});dirs=helpers.asort(dirs);files=helpers.asort(files);list=dirs.concat(files).map(function(data){return data.text});self.setItems(list);self.select(0);self.screen.render();self.emit("refresh");if(callback)callback()})};FileManager.prototype.pick=function(cwd,callback){if(!callback){callback=cwd;cwd=null}var self=this,focused=this.screen.focused===this,hidden=this.hidden,onfile,oncancel;function resume(){self.removeListener("file",onfile);self.removeListener("cancel",oncancel);if(hidden){self.hide()}if(!focused){self.screen.restoreFocus()}self.screen.render()}this.on("file",onfile=function(file){resume();return callback(null,file)});this.on("cancel",oncancel=function(){resume();return callback()});this.refresh(cwd,function(err){if(err)return callback(err);if(hidden){self.show()}if(!focused){self.screen.saveFocus();self.focus()}self.screen.render()})};FileManager.prototype.reset=function(cwd,callback){if(!callback){callback=cwd;cwd=null}this.cwd=cwd||this.options.cwd;this.refresh(callback)};module.exports=FileManager}).call(this,require("_process"))},{"../helpers":62,"./list":80,"./node":86,_process:30,fs:1,path:28}],75:[function(require,module,exports){var Node=require("./node");var Box=require("./box");function Form(options){var self=this;if(!(this instanceof Node)){return new Form(options)}options=options||{};options.ignoreKeys=true;Box.call(this,options);if(options.keys){this.screen._listenKeys(this);this.on("element keypress",function(el,ch,key){if(key.name==="tab"&&!key.shift||el.type==="textbox"&&options.autoNext&&key.name==="enter"||key.name==="down"||options.vi&&key.name==="j"){if(el.type==="textbox"||el.type==="textarea"){if(key.name==="j")return;if(key.name==="tab"){el.emit("keypress",null,{name:"backspace"})}el.emit("keypress","",{name:"escape"})}self.focusNext();return}if(key.name==="tab"&&key.shift||key.name==="up"||options.vi&&key.name==="k"){if(el.type==="textbox"||el.type==="textarea"){if(key.name==="k")return;el.emit("keypress","",{name:"escape"})}self.focusPrevious();return}if(key.name==="escape"){self.focus();return}})}}Form.prototype.__proto__=Box.prototype;Form.prototype.type="form";Form.prototype._refresh=function(){if(!this._children){var out=[];this.children.forEach(function fn(el){if(el.keyable)out.push(el);el.children.forEach(fn)});this._children=out}};Form.prototype._visible=function(){return!!this._children.filter(function(el){return el.visible}).length};Form.prototype.next=function(){this._refresh();if(!this._visible())return;if(!this._selected){this._selected=this._children[0];if(!this._selected.visible)return this.next();if(this.screen.focused!==this._selected)return this._selected}var i=this._children.indexOf(this._selected);if(!~i||!this._children[i+1]){this._selected=this._children[0];if(!this._selected.visible)return this.next();return this._selected}this._selected=this._children[i+1];if(!this._selected.visible)return this.next();return this._selected};Form.prototype.previous=function(){this._refresh();if(!this._visible())return;if(!this._selected){this._selected=this._children[this._children.length-1];if(!this._selected.visible)return this.previous();if(this.screen.focused!==this._selected)return this._selected}var i=this._children.indexOf(this._selected);if(!~i||!this._children[i-1]){this._selected=this._children[this._children.length-1];if(!this._selected.visible)return this.previous();return this._selected}this._selected=this._children[i-1];if(!this._selected.visible)return this.previous();return this._selected};Form.prototype.focusNext=function(){var next=this.next();if(next)next.focus()};Form.prototype.focusPrevious=function(){var previous=this.previous();if(previous)previous.focus()};Form.prototype.resetSelected=function(){this._selected=null};Form.prototype.focusFirst=function(){this.resetSelected();this.focusNext()};Form.prototype.focusLast=function(){this.resetSelected();this.focusPrevious()};Form.prototype.submit=function(){var out={};this.children.forEach(function fn(el){if(el.value!=null){var name=el.name||el.type;if(Array.isArray(out[name])){out[name].push(el.value)}else if(out[name]){out[name]=[out[name],el.value]}else{out[name]=el.value}}el.children.forEach(fn)});this.emit("submit",out);return this.submission=out};Form.prototype.cancel=function(){this.emit("cancel")};Form.prototype.reset=function(){this.children.forEach(function fn(el){switch(el.type){case"screen":break;case"box":break;case"text":break;case"line":break;case"scrollable-box":break;case"list":el.select(0);return;case"form":break;case"input":break;case"textbox":el.clearInput();return;case"textarea":el.clearInput();return;case"button":delete el.value;break;case"progress-bar":el.setProgress(0);break;case"file-manager":el.refresh(el.options.cwd);return;case"checkbox":el.uncheck();return;case"radio-set":break;case"radio-button":el.uncheck();return;case"prompt":break;case"question":break;case"message":break;case"info":break;case"loading":break;case"list-bar":break;case"dir-manager":el.refresh(el.options.cwd);return;case"terminal":el.write("");return;case"image":return}el.children.forEach(fn)});this.emit("reset")};module.exports=Form},{"./box":70,"./node":86}],76:[function(require,module,exports){var Node=require("./node");var Box=require("./box");function Image(options){if(!(this instanceof Node)){return new Image(options)}options=options||{};options.type=options.itype||options.type||"ansi";Box.call(this,options);if(options.type==="ansi"&&this.type!=="ansiimage"){var ANSIImage=require("./ansiimage");Object.getOwnPropertyNames(ANSIImage.prototype).forEach(function(key){if(key==="type")return;Object.defineProperty(this,key,Object.getOwnPropertyDescriptor(ANSIImage.prototype,key))},this);ANSIImage.call(this,options);return this}if(options.type==="overlay"&&this.type!=="overlayimage"){var OverlayImage=require("./overlayimage");Object.getOwnPropertyNames(OverlayImage.prototype).forEach(function(key){if(key==="type")return;Object.defineProperty(this,key,Object.getOwnPropertyDescriptor(OverlayImage.prototype,key))},this);OverlayImage.call(this,options);return this}throw new Error("`type` must either be `ansi` or `overlay`.")}Image.prototype.__proto__=Box.prototype;Image.prototype.type="image";module.exports=Image},{"./ansiimage":68,"./box":70,"./node":86,"./overlayimage":87}],77:[function(require,module,exports){var Node=require("./node");var Box=require("./box");function Input(options){if(!(this instanceof Node)){return new Input(options)}options=options||{};Box.call(this,options)}Input.prototype.__proto__=Box.prototype;Input.prototype.type="input";module.exports=Input},{"./box":70,"./node":86}],78:[function(require,module,exports){var Node=require("./node");var Element=require("./element");function Layout(options){if(!(this instanceof Node)){return new Layout(options)}options=options||{};if(options.width==null&&(options.left==null&&options.right==null)||options.height==null&&(options.top==null&&options.bottom==null)){throw new Error("`Layout` must have a width and height!")}options.layout=options.layout||"inline";Element.call(this,options);if(options.renderer){this.renderer=options.renderer}}Layout.prototype.__proto__=Element.prototype;Layout.prototype.type="layout";Layout.prototype.isRendered=function(el){if(!el.lpos)return false;return el.lpos.xl-el.lpos.xi>0&&el.lpos.yl-el.lpos.yi>0};Layout.prototype.getLast=function(i){while(this.children[--i]){var el=this.children[i];if(this.isRendered(el))return el}};Layout.prototype.getLastCoords=function(i){var last=this.getLast(i);if(last)return last.lpos};Layout.prototype._renderCoords=function(){var coords=this._getCoords(true);var children=this.children;this.children=[];this._render();this.children=children;return coords};Layout.prototype.renderer=function(coords){var self=this;var width=coords.xl-coords.xi,height=coords.yl-coords.yi,xi=coords.xi,yi=coords.yi;var rowOffset=0;var rowIndex=0;var lastRowIndex=0;if(this.options.layout==="grid"){var highWidth=this.children.reduce(function(out,el){out=Math.max(out,el.width);return out},0)}return function iterator(el,i){el.shrink=true;var last=self.getLast(i);if(!last){el.position.left=0;el.position.top=0}else{el.position.left=last.lpos.xl-xi;if(self.options.layout==="grid"){el.position.left+=highWidth-(last.lpos.xl-last.lpos.xi)}if(el.position.left+el.width<=width){el.position.top=rowOffset}else{rowOffset+=self.children.slice(rowIndex,i).reduce(function(out,el){if(!self.isRendered(el))return out;out=Math.max(out,el.lpos.yl-el.lpos.yi);return out},0);lastRowIndex=rowIndex;rowIndex=i;el.position.left=0;el.position.top=rowOffset}}if(self.options.layout==="inline"){var above=null;var abovea=Infinity;for(var j=lastRowIndex;j<rowIndex;j++){var l=self.children[j];if(!self.isRendered(l))continue;var abs=Math.abs(el.position.left-(l.lpos.xi-xi));if(abs<abovea){above=l;abovea=abs}}if(above){el.position.top=above.lpos.yl-yi}}if(el.position.top+el.height>height){}}};Layout.prototype.render=function(){this._emit("prerender");var coords=this._renderCoords();if(!coords){delete this.lpos;return}if(coords.xl-coords.xi<=0){coords.xl=Math.max(coords.xl,coords.xi);return}if(coords.yl-coords.yi<=0){coords.yl=Math.max(coords.yl,coords.yi);return}this.lpos=coords;if(this.border)coords.xi++,coords.xl--,coords.yi++,coords.yl--;if(this.tpadding){coords.xi+=this.padding.left,coords.xl-=this.padding.right;coords.yi+=this.padding.top,coords.yl-=this.padding.bottom}var iterator=this.renderer(coords);if(this.border)coords.xi--,coords.xl++,coords.yi--,coords.yl++;if(this.tpadding){coords.xi-=this.padding.left,coords.xl+=this.padding.right;coords.yi-=this.padding.top,coords.yl+=this.padding.bottom}this.children.forEach(function(el,i){if(el.screen._ci!==-1){el.index=el.screen._ci++}var rendered=iterator(el,i);if(rendered===false){delete el.lpos;return}el.render()});this._emit("render",[coords]);return coords};module.exports=Layout},{"./element":73,"./node":86}],79:[function(require,module,exports){var Node=require("./node");var Box=require("./box");function Line(options){if(!(this instanceof Node)){return new Line(options)}options=options||{};var orientation=options.orientation||"vertical";delete options.orientation;if(orientation==="vertical"){options.width=1}else{options.height=1}Box.call(this,options);this.ch=!options.type||options.type==="line"?orientation==="horizontal"?"─":"│":options.ch||" ";this.border={type:"bg",__proto__:this};this.style.border=this.style}Line.prototype.__proto__=Box.prototype;Line.prototype.type="line";module.exports=Line},{"./box":70,"./node":86}],80:[function(require,module,exports){var helpers=require("../helpers");var Node=require("./node");var Box=require("./box");function List(options){var self=this;if(!(this instanceof Node)){return new List(options)}options=options||{};options.ignoreKeys=true;options.scrollable=true;Box.call(this,options);this.value="";this.items=[];this.ritems=[];this.selected=0;this._isList=true;if(!this.style.selected){this.style.selected={};this.style.selected.bg=options.selectedBg;this.style.selected.fg=options.selectedFg;this.style.selected.bold=options.selectedBold;this.style.selected.underline=options.selectedUnderline;this.style.selected.blink=options.selectedBlink;this.style.selected.inverse=options.selectedInverse;this.style.selected.invisible=options.selectedInvisible}if(!this.style.item){this.style.item={};this.style.item.bg=options.itemBg;this.style.item.fg=options.itemFg;this.style.item.bold=options.itemBold;this.style.item.underline=options.itemUnderline;this.style.item.blink=options.itemBlink;this.style.item.inverse=options.itemInverse;this.style.item.invisible=options.itemInvisible}["bg","fg","bold","underline","blink","inverse","invisible"].forEach(function(name){if(self.style[name]!=null&&self.style.item[name]==null){self.style.item[name]=self.style[name]}});if(this.options.itemHoverBg){this.options.itemHoverEffects={bg:this.options.itemHoverBg}}if(this.options.itemHoverEffects){this.style.item.hover=this.options.itemHoverEffects}if(this.options.itemFocusEffects){this.style.item.focus=this.options.itemFocusEffects}this.interactive=options.interactive!==false;this.mouse=options.mouse||false;if(options.items){this.ritems=options.items;options.items.forEach(this.add.bind(this))}this.select(0);if(options.mouse){this.screen._listenMouse(this);this.on("element wheeldown",function(){self.select(self.selected+2);self.screen.render()});this.on("element wheelup",function(){self.select(self.selected-2);self.screen.render()})}if(options.keys){this.on("keypress",function(ch,key){if(key.name==="up"||options.vi&&key.name==="k"){self.up();self.screen.render();return}if(key.name==="down"||options.vi&&key.name==="j"){self.down();self.screen.render();return}if(key.name==="enter"||options.vi&&key.name==="l"&&!key.shift){self.enterSelected();return}if(key.name==="escape"||options.vi&&key.name==="q"){self.cancelSelected();return}if(options.vi&&key.name==="u"&&key.ctrl){self.move(-((self.height-self.iheight)/2)|0);self.screen.render();return}if(options.vi&&key.name==="d"&&key.ctrl){self.move((self.height-self.iheight)/2|0);self.screen.render();return}if(options.vi&&key.name==="b"&&key.ctrl){self.move(-(self.height-self.iheight));self.screen.render();return}if(options.vi&&key.name==="f"&&key.ctrl){self.move(self.height-self.iheight);self.screen.render();return}if(options.vi&&key.name==="h"&&key.shift){self.move(self.childBase-self.selected);self.screen.render();return}if(options.vi&&key.name==="m"&&key.shift){var visible=Math.min(self.height-self.iheight,self.items.length)/2|0;self.move(self.childBase+visible-self.selected);self.screen.render();return}if(options.vi&&key.name==="l"&&key.shift){self.down(self.childBase+Math.min(self.height-self.iheight,self.items.length)-self.selected);self.screen.render();return}if(options.vi&&key.name==="g"&&!key.shift){self.select(0);self.screen.render();return}if(options.vi&&key.name==="g"&&key.shift){self.select(self.items.length-1);self.screen.render();return}if(options.vi&&(key.ch==="/"||key.ch==="?")){if(typeof self.options.search!=="function"){return}return self.options.search(function(err,value){if(typeof err==="string"||typeof err==="function"||typeof err==="number"||err&&err.test){value=err;err=null}if(err||!value)return self.screen.render();self.select(self.fuzzyFind(value,key.ch==="?"));self.screen.render()})}})}this.on("resize",function(){var visible=self.height-self.iheight;if(visible>=self.selected+1){self.childBase=0;self.childOffset=self.selected}else{self.childBase=self.selected-visible+1;self.childOffset=visible-1}});this.on("adopt",function(el){if(!~self.items.indexOf(el)){el.fixed=true}});this.on("remove",function(el){self.removeItem(el)})}List.prototype.__proto__=Box.prototype;List.prototype.type="list";List.prototype.createItem=function(content){var self=this;var options={screen:this.screen,content:content,align:this.align||"left",top:0,left:0,right:this.scrollbar?1:0,tags:this.parseTags,height:1,hoverEffects:this.mouse?this.style.item.hover:null,focusEffects:this.mouse?this.style.item.focus:null,autoFocus:false};if(!this.screen.autoPadding){options.top=1;options.left=this.ileft;options.right=this.iright+(this.scrollbar?1:0)}if(this.shrink&&this.options.normalShrink){delete options.right;options.width="shrink"}["bg","fg","bold","underline","blink","inverse","invisible"].forEach(function(name){options[name]=function(){var attr=self.items[self.selected]===item&&self.interactive?self.style.selected[name]:self.style.item[name];if(typeof attr==="function")attr=attr(item);return attr}});if(this.style.transparent){options.transparent=true}var item=new Box(options);if(this.mouse){item.on("click",function(){self.focus();if(self.items[self.selected]===item){self.emit("action",item,self.selected);self.emit("select",item,self.selected);return}self.select(item);self.screen.render()})}this.emit("create item");return item};List.prototype.add=List.prototype.addItem=List.prototype.appendItem=function(content){content=typeof content==="string"?content:content.getContent();var item=this.createItem(content);item.position.top=this.items.length;if(!this.screen.autoPadding){item.position.top=this.itop+this.items.length}this.ritems.push(content);this.items.push(item);this.append(item);if(this.items.length===1){this.select(0)}this.emit("add item");return item};List.prototype.removeItem=function(child){var i=this.getItemIndex(child);if(~i&&this.items[i]){child=this.items.splice(i,1)[0];this.ritems.splice(i,1);this.remove(child);for(var j=i;j<this.items.length;j++){this.items[j].position.top--}if(i===this.selected){this.select(i-1)}}this.emit("remove item");return child};List.prototype.insertItem=function(child,content){content=typeof content==="string"?content:content.getContent();var i=this.getItemIndex(child);if(!~i)return;if(i>=this.items.length)return this.appendItem(content);var item=this.createItem(content);for(var j=i;j<this.items.length;j++){this.items[j].position.top++}item.position.top=i+(!this.screen.autoPadding?1:0);this.ritems.splice(i,0,content);this.items.splice(i,0,item);this.append(item);if(i===this.selected){this.select(i+1)}this.emit("insert item")};List.prototype.getItem=function(child){return this.items[this.getItemIndex(child)]};List.prototype.setItem=function(child,content){content=typeof content==="string"?content:content.getContent();var i=this.getItemIndex(child);if(!~i)return;this.items[i].setContent(content);this.ritems[i]=content};List.prototype.clearItems=function(){return this.setItems([])};List.prototype.setItems=function(items){var original=this.items.slice(),selected=this.selected,sel=this.ritems[this.selected],i=0;items=items.slice();this.select(0);for(;i<items.length;i++){if(this.items[i]){this.items[i].setContent(items[i])}else{this.add(items[i])}}for(;i<original.length;i++){this.remove(original[i])}this.ritems=items;sel=items.indexOf(sel);if(~sel){this.select(sel)}else if(items.length===original.length){this.select(selected)}else{this.select(Math.min(selected,items.length-1))}this.emit("set items")};List.prototype.pushItem=function(content){this.appendItem(content);return this.items.length};List.prototype.popItem=function(){return this.removeItem(this.items.length-1)};List.prototype.unshiftItem=function(content){this.insertItem(0,content);return this.items.length};List.prototype.shiftItem=function(){return this.removeItem(0)};List.prototype.spliceItem=function(child,n){var self=this;var i=this.getItemIndex(child);if(!~i)return;var items=Array.prototype.slice.call(arguments,2);var removed=[];while(n--){removed.push(this.removeItem(i))}items.forEach(function(item){self.insertItem(i++,item)});return removed};List.prototype.find=List.prototype.fuzzyFind=function(search,back){var start=this.selected+(back?-1:1),i;if(typeof search==="number")search+="";if(search&&search[0]==="/"&&search[search.length-1]==="/"){try{search=new RegExp(search.slice(1,-1))}catch(e){}}var test=typeof search==="string"?function(item){return!!~item.indexOf(search)}:search.test?search.test.bind(search):search;if(typeof test!=="function"){if(this.screen.options.debug){throw new Error("fuzzyFind(): `test` is not a function.")}return this.selected}if(!back){for(i=start;i<this.ritems.length;i++){if(test(helpers.cleanTags(this.ritems[i])))return i}for(i=0;i<start;i++){if(test(helpers.cleanTags(this.ritems[i])))return i}}else{for(i=start;i>=0;i--){if(test(helpers.cleanTags(this.ritems[i])))return i}for(i=this.ritems.length-1;i>start;i--){if(test(helpers.cleanTags(this.ritems[i])))return i}}return this.selected};List.prototype.getItemIndex=function(child){if(typeof child==="number"){return child}else if(typeof child==="string"){var i=this.ritems.indexOf(child);if(~i)return i;for(i=0;i<this.ritems.length;i++){if(helpers.cleanTags(this.ritems[i])===child){return i}}return-1}else{return this.items.indexOf(child)}};List.prototype.select=function(index){if(!this.interactive){return}if(!this.items.length){this.selected=0;this.value="";this.scrollTo(0);return}if(typeof index==="object"){index=this.items.indexOf(index)}if(index<0){index=0}else if(index>=this.items.length){index=this.items.length-1}if(this.selected===index&&this._listInitialized)return;this._listInitialized=true;this.selected=index;this.value=helpers.cleanTags(this.ritems[this.selected]);if(!this.parent)return;this.scrollTo(this.selected);this.emit("select item",this.items[this.selected],this.selected)};List.prototype.move=function(offset){this.select(this.selected+offset)};List.prototype.up=function(offset){this.move(-(offset||1))};List.prototype.down=function(offset){this.move(offset||1)};List.prototype.pick=function(label,callback){if(!callback){callback=label;label=null}if(!this.interactive){return callback()}var self=this;var focused=this.screen.focused;if(focused&&focused._done)focused._done("stop");this.screen.saveFocus();this.focus();this.show();this.select(0);if(label)this.setLabel(label);this.screen.render();this.once("action",function(el,selected){if(label)self.removeLabel();self.screen.restoreFocus();self.hide();self.screen.render();if(!el)return callback();return callback(null,helpers.cleanTags(self.ritems[selected]))})};List.prototype.enterSelected=function(i){if(i!=null)this.select(i);this.emit("action",this.items[this.selected],this.selected);this.emit("select",this.items[this.selected],this.selected)};List.prototype.cancelSelected=function(i){if(i!=null)this.select(i);this.emit("action");this.emit("cancel")};module.exports=List},{"../helpers":62,"./box":70,"./node":86}],81:[function(require,module,exports){var helpers=require("../helpers");var Node=require("./node");var Box=require("./box");function Listbar(options){var self=this;if(!(this instanceof Node)){return new Listbar(options)}options=options||{};this.items=[];this.ritems=[];this.commands=[];this.leftBase=0;this.leftOffset=0;this.mouse=options.mouse||false;Box.call(this,options);if(!this.style.selected){this.style.selected={}}if(!this.style.item){this.style.item={}}if(options.commands||options.items){this.setItems(options.commands||options.items)}if(options.keys){this.on("keypress",function(ch,key){if(key.name==="left"||options.vi&&key.name==="h"||key.shift&&key.name==="tab"){self.moveLeft();self.screen.render();if(key.name==="tab")return false;return}if(key.name==="right"||options.vi&&key.name==="l"||key.name==="tab"){self.moveRight();self.screen.render();if(key.name==="tab")return false;return}if(key.name==="enter"||options.vi&&key.name==="k"&&!key.shift){self.emit("action",self.items[self.selected],self.selected);self.emit("select",self.items[self.selected],self.selected);var item=self.items[self.selected];if(item._.cmd.callback){item._.cmd.callback()}self.screen.render();return}if(key.name==="escape"||options.vi&&key.name==="q"){self.emit("action");self.emit("cancel");return}})}if(options.autoCommandKeys){this.onScreenEvent("keypress",function(ch){if(/^[0-9]$/.test(ch)){var i=+ch-1;if(!~i)i=9;return self.selectTab(i)}})}this.on("focus",function(){self.select(self.selected)})}Listbar.prototype.__proto__=Box.prototype;Listbar.prototype.type="listbar";Listbar.prototype.__defineGetter__("selected",function(){return this.leftBase+this.leftOffset});Listbar.prototype.setItems=function(commands){var self=this;if(!Array.isArray(commands)){commands=Object.keys(commands).reduce(function(obj,key,i){var cmd=commands[key],cb;if(typeof cmd==="function"){cb=cmd;cmd={callback:cb}}if(cmd.text==null)cmd.text=key;if(cmd.prefix==null)cmd.prefix=++i+"";if(cmd.text==null&&cmd.callback){cmd.text=cmd.callback.name}obj.push(cmd);return obj},[])}this.items.forEach(function(el){el.detach()});this.items=[];this.ritems=[];this.commands=[];commands.forEach(function(cmd){self.add(cmd)});this.emit("set items")};Listbar.prototype.add=Listbar.prototype.addItem=Listbar.prototype.appendItem=function(item,callback){var self=this,prev=this.items[this.items.length-1],drawn,cmd,title,len;if(!this.parent){drawn=0}else{drawn=prev?prev.aleft+prev.width:0;if(!this.screen.autoPadding){drawn+=this.ileft}}if(typeof item==="object"){cmd=item;if(cmd.prefix==null)cmd.prefix=this.items.length+1+""}if(typeof item==="string"){cmd={prefix:this.items.length+1+"",text:item,callback:callback}}if(typeof item==="function"){cmd={prefix:this.items.length+1+"",text:item.name,callback:item}}if(cmd.keys&&cmd.keys[0]){cmd.prefix=cmd.keys[0]}var t=helpers.generateTags(this.style.prefix||{fg:"lightblack"});title=(cmd.prefix!=null?t.open+cmd.prefix+t.close+":":"")+cmd.text;len=((cmd.prefix!=null?cmd.prefix+":":"")+cmd.text).length;var options={screen:this.screen,top:0,left:drawn+1,height:1,content:title,width:len+2,align:"center",autoFocus:false,tags:true,mouse:true,style:helpers.merge({},this.style.item),noOverflow:true};if(!this.screen.autoPadding){options.top+=this.itop;options.left+=this.ileft}["bg","fg","bold","underline","blink","inverse","invisible"].forEach(function(name){options.style[name]=function(){var attr=self.items[self.selected]===el?self.style.selected[name]:self.style.item[name];if(typeof attr==="function")attr=attr(el);return attr}});var el=new Box(options);this._[cmd.text]=el;cmd.element=el;el._.cmd=cmd;this.ritems.push(cmd.text);this.items.push(el);this.commands.push(cmd);this.append(el);if(cmd.callback){if(cmd.keys){this.screen.key(cmd.keys,function(){self.emit("action",el,self.selected);self.emit("select",el,self.selected);if(el._.cmd.callback){el._.cmd.callback()}self.select(el);self.screen.render()})}}if(this.items.length===1){this.select(0)}if(this.mouse){el.on("click",function(){self.emit("action",el,self.selected);self.emit("select",el,self.selected);if(el._.cmd.callback){el._.cmd.callback()}self.select(el);self.screen.render()})}this.emit("add item")};Listbar.prototype.render=function(){var self=this,drawn=0;if(!this.screen.autoPadding){drawn+=this.ileft}this.items.forEach(function(el,i){if(i<self.leftBase){el.hide()}else{el.rleft=drawn+1;drawn+=el.width+2;el.show()}});return this._render()};Listbar.prototype.select=function(offset){if(typeof offset!=="number"){offset=this.items.indexOf(offset)}if(offset<0){offset=0}else if(offset>=this.items.length){offset=this.items.length-1}if(!this.parent){this.emit("select item",this.items[offset],offset);return}var lpos=this._getCoords();if(!lpos)return;var self=this,width=lpos.xl-lpos.xi-this.iwidth,drawn=0,visible=0,el;el=this.items[offset];if(!el)return;this.items.forEach(function(el,i){if(i<self.leftBase)return;var lpos=el._getCoords();if(!lpos)return;if(lpos.xl-lpos.xi<=0)return;drawn+=lpos.xl-lpos.xi+2;if(drawn<=width)visible++});var diff=offset-(this.leftBase+this.leftOffset);if(offset>this.leftBase+this.leftOffset){if(offset>this.leftBase+visible-1){this.leftOffset=0;this.leftBase=offset}else{this.leftOffset+=diff}}else if(offset<this.leftBase+this.leftOffset){diff=-diff;if(offset<this.leftBase){this.leftOffset=0;this.leftBase=offset}else{this.leftOffset-=diff}}this.emit("select item",el,offset)};Listbar.prototype.removeItem=function(child){var i=typeof child!=="number"?this.items.indexOf(child):child;if(~i&&this.items[i]){child=this.items.splice(i,1)[0];this.ritems.splice(i,1);this.commands.splice(i,1);this.remove(child);if(i===this.selected){this.select(i-1)}}this.emit("remove item")};Listbar.prototype.move=function(offset){this.select(this.selected+offset)};Listbar.prototype.moveLeft=function(offset){this.move(-(offset||1))};Listbar.prototype.moveRight=function(offset){this.move(offset||1)};Listbar.prototype.selectTab=function(index){var item=this.items[index];if(item){if(item._.cmd.callback){item._.cmd.callback()}this.select(index);this.screen.render()}this.emit("select tab",item,index)};module.exports=Listbar},{"../helpers":62,"./box":70,"./node":86}],82:[function(require,module,exports){var Node=require("./node");var Box=require("./box");var List=require("./list");var Table=require("./table");function ListTable(options){var self=this;if(!(this instanceof Node)){return new ListTable(options)}options=options||{};options.shrink=true;options.normalShrink=true;options.style=options.style||{};options.style.border=options.style.border||{};options.style.header=options.style.header||{};options.style.cell=options.style.cell||{};this.__align=options.align||"center";delete options.align;options.style.selected=options.style.cell.selected;options.style.item=options.style.cell;List.call(this,options);this._header=new Box({parent:this,left:this.screen.autoPadding?0:this.ileft,top:0,width:"shrink",height:1,style:options.style.header,tags:options.parseTags||options.tags});this.on("scroll",function(){self._header.setFront();self._header.rtop=self.childBase;if(!self.screen.autoPadding){self._header.rtop=self.childBase+(self.border?1:0)}});this.pad=options.pad!=null?options.pad:2;this.setData(options.rows||options.data);this.on("attach",function(){self.setData(self.rows)});this.on("resize",function(){var selected=self.selected;self.setData(self.rows);self.select(selected);self.screen.render()})}ListTable.prototype.__proto__=List.prototype;ListTable.prototype.type="list-table";ListTable.prototype._calculateMaxes=Table.prototype._calculateMaxes;ListTable.prototype.setRows=ListTable.prototype.setData=function(rows){var self=this,align=this.__align;if(this.visible&&this.lpos){this.clearPos()}this.clearItems();this.rows=rows||[];this._calculateMaxes();if(!this._maxes)return;this.addItem("");this.rows.forEach(function(row,i){var isHeader=i===0;var text="";row.forEach(function(cell,i){var width=self._maxes[i];var clen=self.strWidth(cell);if(i!==0){text+=" "}while(clen<width){if(align==="center"){cell=" "+cell+" ";clen+=2}else if(align==="left"){cell=cell+" ";clen+=1}else if(align==="right"){cell=" "+cell;clen+=1}}if(clen>width){if(align==="center"){cell=cell.substring(1);clen--}else if(align==="left"){cell=cell.slice(0,-1);clen--}else if(align==="right"){cell=cell.substring(1);clen--}}text+=cell});if(isHeader){self._header.setContent(text)}else{self.addItem(text)}});this._header.setFront();this.select(0)};ListTable.prototype._select=ListTable.prototype.select;ListTable.prototype.select=function(i){if(i===0){i=1}if(i<=this.childBase){this.setScroll(this.childBase-1)}return this._select(i)};ListTable.prototype.render=function(){var self=this;var coords=this._render();if(!coords)return;this._calculateMaxes();if(!this._maxes)return coords;var lines=this.screen.lines,xi=coords.xi,yi=coords.yi,rx,ry,i;var battr=this.sattr(this.style.border);var height=coords.yl-coords.yi-this.ibottom;if(!this.border||this.options.noCellBorders)return coords;ry=0;for(i=0;i<height+1;i++){if(!lines[yi+ry])break;rx=0;self._maxes.slice(0,-1).forEach(function(max){rx+=max;if(!lines[yi+ry][xi+rx+1])return;if(ry===0){rx++;lines[yi+ry][xi+rx][0]=battr;lines[yi+ry][xi+rx][1]="┬";if(!self.border.top){lines[yi+ry][xi+rx][1]="│"}lines[yi+ry].dirty=true}else if(ry===height){rx++;lines[yi+ry][xi+rx][0]=battr;lines[yi+ry][xi+rx][1]="┴";if(!self.border.bottom){lines[yi+ry][xi+rx][1]="│"}lines[yi+ry].dirty=true}else{rx++}});ry+=1}for(ry=1;ry<height;ry++){if(!lines[yi+ry])break;rx=0;self._maxes.slice(0,-1).forEach(function(max){rx+=max;if(!lines[yi+ry][xi+rx+1])return;if(self.options.fillCellBorders!==false){var lbg=lines[yi+ry][xi+rx][0]&511;rx++;lines[yi+ry][xi+rx][0]=battr&~511|lbg}else{rx++;lines[yi+ry][xi+rx][0]=battr}lines[yi+ry][xi+rx][1]="│";lines[yi+ry].dirty=true})}return coords};module.exports=ListTable},{"./box":70,"./list":80,"./node":86,"./table":96}],83:[function(require,module,exports){var Node=require("./node");var Box=require("./box");var Text=require("./text");function Loading(options){if(!(this instanceof Node)){return new Loading(options)}options=options||{};Box.call(this,options);this._.icon=new Text({parent:this,align:"center",top:2,left:1,right:1,height:1,content:"|"})}Loading.prototype.__proto__=Box.prototype;Loading.prototype.type="loading";Loading.prototype.load=function(text){var self=this;this.show();this.setContent(text);if(this._.timer){this.stop()}this.screen.lockKeys=true;this._.timer=setInterval(function(){if(self._.icon.content==="|"){self._.icon.setContent("/")}else if(self._.icon.content==="/"){self._.icon.setContent("-")}else if(self._.icon.content==="-"){self._.icon.setContent("\\")}else if(self._.icon.content==="\\"){self._.icon.setContent("|")}self.screen.render()},200)};Loading.prototype.stop=function(){this.screen.lockKeys=false;this.hide();if(this._.timer){clearInterval(this._.timer);delete this._.timer}this.screen.render()};module.exports=Loading},{"./box":70,"./node":86,"./text":98}],84:[function(require,module,exports){(function(process,global){var util=require("util");var nextTick=global.setImmediate||process.nextTick.bind(process);var Node=require("./node");var ScrollableText=require("./scrollabletext");function Log(options){var self=this;if(!(this instanceof Node)){return new Log(options)}options=options||{};ScrollableText.call(this,options);this.scrollback=options.scrollback!=null?options.scrollback:Infinity;this.scrollOnInput=options.scrollOnInput;this.on("set content",function(){if(!self._userScrolled||self.scrollOnInput){nextTick(function(){self.setScrollPerc(100);self._userScrolled=false;self.screen.render()})}})}Log.prototype.__proto__=ScrollableText.prototype;Log.prototype.type="log";Log.prototype.log=Log.prototype.add=function(){var args=Array.prototype.slice.call(arguments);if(typeof args[0]==="object"){args[0]=util.inspect(args[0],true,20,true)}var text=util.format.apply(util,args);this.emit("log",text);var ret=this.pushLine(text);if(this._clines.fake.length>this.scrollback){this.shiftLine(0,this.scrollback/3|0)}return ret};Log.prototype._scroll=Log.prototype.scroll;Log.prototype.scroll=function(offset,always){if(offset===0)return this._scroll(offset,always);this._userScrolled=true;var ret=this._scroll(offset,always);if(this.getScrollPerc()===100){this._userScrolled=false}return ret};module.exports=Log}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./node":86,"./scrollabletext":95,_process:30,util:57}],85:[function(require,module,exports){var Node=require("./node");var Box=require("./box");function Message(options){if(!(this instanceof Node)){return new Message(options)}options=options||{};options.tags=true;Box.call(this,options)}Message.prototype.__proto__=Box.prototype;Message.prototype.type="message";Message.prototype.log=Message.prototype.display=function(text,time,callback){var self=this;if(typeof time==="function"){callback=time;time=null}if(time==null)time=3;if(this.scrollable){this.screen.saveFocus();this.focus();this.scrollTo(0)}this.show();this.setContent(text);this.screen.render();if(time===Infinity||time===-1||time===0){var end=function(){if(end.done)return;end.done=true;if(self.scrollable){try{self.screen.restoreFocus()}catch(e){}}self.hide();self.screen.render();if(callback)callback()};setTimeout(function(){self.onScreenEvent("keypress",function fn(ch,key){if(key.name==="mouse")return;if(self.scrollable){if(key.name==="up"||self.options.vi&&key.name==="k"||(key.name==="down"||self.options.vi&&key.name==="j")||self.options.vi&&key.name==="u"&&key.ctrl||self.options.vi&&key.name==="d"&&key.ctrl||self.options.vi&&key.name==="b"&&key.ctrl||self.options.vi&&key.name==="f"&&key.ctrl||self.options.vi&&key.name==="g"&&!key.shift||self.options.vi&&key.name==="g"&&key.shift){return}}if(self.options.ignoreKeys&&~self.options.ignoreKeys.indexOf(key.name)){return}self.removeScreenEvent("keypress",fn);end()});if(!self.options.mouse)return;self.onScreenEvent("mouse",function fn(data){if(data.action==="mousemove")return;self.removeScreenEvent("mouse",fn);end()})},10);return}setTimeout(function(){self.hide();self.screen.render();if(callback)callback()},time*1e3)};Message.prototype.error=function(text,time,callback){return this.display("{red-fg}Error: "+text+"{/red-fg}",time,callback)};module.exports=Message},{"./box":70,"./node":86}],86:[function(require,module,exports){(function(process){var EventEmitter=require("../events").EventEmitter;function Node(options){var self=this;var Screen=require("./screen");if(!(this instanceof Node)){return new Node(options)}EventEmitter.call(this);options=options||{};this.options=options;this.screen=this.screen||options.screen;if(!this.screen){if(this.type==="screen"){this.screen=this}else if(Screen.total===1){this.screen=Screen.global}else if(options.parent){this.screen=options.parent;while(this.screen&&this.screen.type!=="screen"){this.screen=this.screen.parent}}else if(Screen.total){this.screen=Screen.instances[Screen.instances.length-1];process.nextTick(function(){if(!self.parent){throw new Error("Element ("+self.type+")"+" was not appended synchronously after the"+" screen's creation. Please set a `parent`"+" or `screen` option in the element's constructor"+" if you are going to use multiple screens and"+" append the element later.")}})}else{throw new Error("No active screen.")}}this.parent=options.parent||null;this.children=[];this.$=this._=this.data={};this.uid=Node.uid++;this.index=this.index!=null?this.index:-1;if(this.type!=="screen"){this.detached=true}if(this.parent){this.parent.append(this)}(options.children||[]).forEach(this.append.bind(this))}Node.uid=0;Node.prototype.__proto__=EventEmitter.prototype;Node.prototype.type="node";Node.prototype.insert=function(element,i){var self=this;if(element.screen&&element.screen!==this.screen){throw new Error("Cannot switch a node's screen.")}element.detach();element.parent=this;element.screen=this.screen;if(i===0){this.children.unshift(element)}else if(i===this.children.length){this.children.push(element)}else{this.children.splice(i,0,element)}element.emit("reparent",this);this.emit("adopt",element);(function emit(el){var n=el.detached!==self.detached;el.detached=self.detached;if(n)el.emit("attach");el.children.forEach(emit)})(element);if(!this.screen.focused){this.screen.focused=element}};Node.prototype.prepend=function(element){this.insert(element,0)};Node.prototype.append=function(element){this.insert(element,this.children.length)};Node.prototype.insertBefore=function(element,other){var i=this.children.indexOf(other);if(~i)this.insert(element,i)};Node.prototype.insertAfter=function(element,other){var i=this.children.indexOf(other);if(~i)this.insert(element,i+1)};Node.prototype.remove=function(element){if(element.parent!==this)return;var i=this.children.indexOf(element);if(!~i)return;element.clearPos();element.parent=null;this.children.splice(i,1);i=this.screen.clickable.indexOf(element);if(~i)this.screen.clickable.splice(i,1);i=this.screen.keyable.indexOf(element);if(~i)this.screen.keyable.splice(i,1);element.emit("reparent",null);this.emit("remove",element);(function emit(el){var n=el.detached!==true;el.detached=true;if(n)el.emit("detach");el.children.forEach(emit)})(element);if(this.screen.focused===element){this.screen.rewindFocus()}};Node.prototype.detach=function(){if(this.parent)this.parent.remove(this)};Node.prototype.free=function(){return};Node.prototype.destroy=function(){this.detach();this.forDescendants(function(el){el.free();el.destroyed=true;el.emit("destroy")},this)};Node.prototype.forDescendants=function(iter,s){if(s)iter(this);this.children.forEach(function emit(el){iter(el);el.children.forEach(emit)})};Node.prototype.forAncestors=function(iter,s){var el=this;if(s)iter(this);while(el=el.parent){iter(el)}};Node.prototype.collectDescendants=function(s){var out=[];this.forDescendants(function(el){out.push(el)},s);return out};Node.prototype.collectAncestors=function(s){var out=[];this.forAncestors(function(el){out.push(el)},s);return out};Node.prototype.emitDescendants=function(){var args=Array.prototype.slice(arguments),iter;if(typeof args[args.length-1]==="function"){iter=args.pop()}return this.forDescendants(function(el){if(iter)iter(el);el.emit.apply(el,args)},true)};Node.prototype.emitAncestors=function(){var args=Array.prototype.slice(arguments),iter;if(typeof args[args.length-1]==="function"){iter=args.pop()}return this.forAncestors(function(el){if(iter)iter(el);el.emit.apply(el,args)},true)};Node.prototype.hasDescendant=function(target){return function find(el){for(var i=0;i<el.children.length;i++){if(el.children[i]===target){return true}if(find(el.children[i])===true){return true}}return false}(this)};Node.prototype.hasAncestor=function(target){var el=this;while(el=el.parent){if(el===target)return true}return false};Node.prototype.get=function(name,value){if(this.data.hasOwnProperty(name)){return this.data[name]}return value};Node.prototype.set=function(name,value){return this.data[name]=value};module.exports=Node}).call(this,require("_process"))},{"../events":60,"./screen":93,_process:30}],87:[function(require,module,exports){(function(process){var fs=require("fs"),cp=require("child_process");var helpers=require("../helpers");var Node=require("./node");var Box=require("./box");function OverlayImage(options){var self=this;if(!(this instanceof Node)){return new OverlayImage(options)}options=options||{};Box.call(this,options);if(options.w3m){OverlayImage.w3mdisplay=options.w3m}if(OverlayImage.hasW3MDisplay==null){if(fs.existsSync(OverlayImage.w3mdisplay)){OverlayImage.hasW3MDisplay=true}else if(options.search!==false){var file=helpers.findFile("/usr","w3mimgdisplay")||helpers.findFile("/lib","w3mimgdisplay")||helpers.findFile("/bin","w3mimgdisplay");if(file){OverlayImage.hasW3MDisplay=true;OverlayImage.w3mdisplay=file}else{OverlayImage.hasW3MDisplay=false}}}this.on("hide",function(){self._lastFile=self.file;self.clearImage()});this.on("show",function(){if(!self._lastFile)return;self.setImage(self._lastFile)});this.on("detach",function(){self._lastFile=self.file;self.clearImage()});this.on("attach",function(){if(!self._lastFile)return;self.setImage(self._lastFile)});this.onScreenEvent("resize",function(){self._needsRatio=true});this.onScreenEvent("render",function(){self.screen.program.flush();if(!self._noImage){self.setImage(self.file)}});if(this.options.file||this.options.img){this.setImage(this.options.file||this.options.img)}}OverlayImage.prototype.__proto__=Box.prototype;OverlayImage.prototype.type="overlayimage";OverlayImage.w3mdisplay="/usr/lib/w3m/w3mimgdisplay";OverlayImage.prototype.spawn=function(file,args,opt,callback){var spawn=require("child_process").spawn,ps;opt=opt||{};ps=spawn(file,args,opt);ps.on("error",function(err){if(!callback)return;return callback(err)});ps.on("exit",function(code){if(!callback)return;if(code!==0)return callback(new Error("Exit Code: "+code));return callback(null,code===0)});return ps};OverlayImage.prototype.setImage=function(img,callback){var self=this;if(this._settingImage){this._queue=this._queue||[];this._queue.push([img,callback]);return}this._settingImage=true;var reset=function(){self._settingImage=false;self._queue=self._queue||[];var item=self._queue.shift();if(item){self.setImage(item[0],item[1])}};if(OverlayImage.hasW3MDisplay===false){reset();if(!callback)return;return callback(new Error("W3M Image Display not available."))}if(!img){reset();if(!callback)return;return callback(new Error("No image."))}this.file=img;return this.getPixelRatio(function(err,ratio){if(err){reset();if(!callback)return;return callback(err)}return self.renderImage(img,ratio,function(err,success){if(err){reset();if(!callback)return;return callback(err)}if(self.shrink||self.options.autofit){delete self.shrink;delete self.options.shrink;self.options.autofit=true;return self.imageSize(function(err,size){if(err){reset();if(!callback)return;return callback(err)}if(self._lastSize&&ratio.tw===self._lastSize.tw&&ratio.th===self._lastSize.th&&size.width===self._lastSize.width&&size.height===self._lastSize.height&&self.aleft===self._lastSize.aleft&&self.atop===self._lastSize.atop){reset();if(!callback)return;return callback(null,success)}self._lastSize={tw:ratio.tw,th:ratio.th,width:size.width,height:size.height,aleft:self.aleft,atop:self.atop};self.position.width=size.width/ratio.tw|0;self.position.height=size.height/ratio.th|0;self._noImage=true;self.screen.render();self._noImage=false;reset();return self.renderImage(img,ratio,callback)})}reset();if(!callback)return;return callback(null,success)})})};OverlayImage.prototype.renderImage=function(img,ratio,callback){var self=this;if(cp.execSync){callback=callback||function(err,result){return result};try{return callback(null,this.renderImageSync(img,ratio))}catch(e){return callback(e)}}if(OverlayImage.hasW3MDisplay===false){if(!callback)return;return callback(new Error("W3M Image Display not available."))}if(!ratio){if(!callback)return;return callback(new Error("No ratio."))}var _file=self.file;var _lastSize=self._lastSize;return self.clearImage(function(err){if(err)return callback(err);self.file=_file;self._lastSize=_lastSize;var opt={stdio:"pipe",env:process.env,cwd:process.env.HOME};var ps=self.spawn(OverlayImage.w3mdisplay,[],opt,function(err,success){if(!callback)return;return err?callback(err):callback(null,success)});var width=self.width*ratio.tw|0,height=self.height*ratio.th|0,aleft=self.aleft*ratio.tw|0,atop=self.atop*ratio.th|0;var input="0;1;"+aleft+";"+atop+";"+width+";"+height+";;;;;"+img+"\n4;\n3;\n";self._props={aleft:aleft,atop:atop,width:width,height:height};ps.stdin.write(input);ps.stdin.end()})};OverlayImage.prototype.clearImage=function(callback){if(cp.execSync){callback=callback||function(err,result){return result};try{return callback(null,this.clearImageSync())}catch(e){return callback(e)}}if(OverlayImage.hasW3MDisplay===false){if(!callback)return;return callback(new Error("W3M Image Display not available."))}if(!this._props){if(!callback)return;return callback(null)}var opt={stdio:"pipe",env:process.env,cwd:process.env.HOME};var ps=this.spawn(OverlayImage.w3mdisplay,[],opt,function(err,success){if(!callback)return;return err?callback(err):callback(null,success)});var width=this._props.width+2,height=this._props.height+2,aleft=this._props.aleft,atop=this._props.atop;if(this._drag){aleft-=10;atop-=10;width+=10;height+=10}var input="6;"+aleft+";"+atop+";"+width+";"+height+"\n4;\n3;\n";delete this.file;delete this._props;delete this._lastSize;ps.stdin.write(input);ps.stdin.end()};OverlayImage.prototype.imageSize=function(callback){var img=this.file;if(cp.execSync){callback=callback||function(err,result){return result};try{return callback(null,this.imageSizeSync())}catch(e){return callback(e)}}if(OverlayImage.hasW3MDisplay===false){if(!callback)return;return callback(new Error("W3M Image Display not available."))}if(!img){if(!callback)return;return callback(new Error("No image."))}var opt={stdio:"pipe",env:process.env,cwd:process.env.HOME};var ps=this.spawn(OverlayImage.w3mdisplay,[],opt);var buf="";ps.stdout.setEncoding("utf8");ps.stdout.on("data",function(data){buf+=data});ps.on("error",function(err){if(!callback)return;return callback(err)});ps.on("exit",function(){if(!callback)return;var size=buf.trim().split(/\s+/);return callback(null,{raw:buf.trim(),width:+size[0],height:+size[1]})});var input="5;"+img+"\n";ps.stdin.write(input);ps.stdin.end()};OverlayImage.prototype.termSize=function(callback){var self=this;if(cp.execSync){callback=callback||function(err,result){return result};try{return callback(null,this.termSizeSync())}catch(e){return callback(e)}}if(OverlayImage.hasW3MDisplay===false){if(!callback)return;return callback(new Error("W3M Image Display not available."))}var opt={stdio:"pipe",env:process.env,cwd:process.env.HOME};var ps=this.spawn(OverlayImage.w3mdisplay,["-test"],opt);var buf="";ps.stdout.setEncoding("utf8");ps.stdout.on("data",function(data){buf+=data});ps.on("error",function(err){if(!callback)return;return callback(err)});ps.on("exit",function(){if(!callback)return;if(!buf.trim()){return self.termSize(callback)}var size=buf.trim().split(/\s+/);return callback(null,{raw:buf.trim(),width:+size[0],height:+size[1]})});ps.stdin.end()};OverlayImage.prototype.getPixelRatio=function(callback){var self=this;if(cp.execSync){callback=callback||function(err,result){return result};try{return callback(null,this.getPixelRatioSync())}catch(e){return callback(e)}}if(this._ratio&&!this._needsRatio){return callback(null,this._ratio)}return this.termSize(function(err,dimensions){if(err)return callback(err);self._ratio={tw:dimensions.width/self.screen.width,th:dimensions.height/self.screen.height};self._needsRatio=false;return callback(null,self._ratio)})};OverlayImage.prototype.renderImageSync=function(img,ratio){if(OverlayImage.hasW3MDisplay===false){throw new Error("W3M Image Display not available.")}if(!ratio){throw new Error("No ratio.")}var _file=this.file;var _lastSize=this._lastSize;this.clearImageSync();this.file=_file;this._lastSize=_lastSize;var width=this.width*ratio.tw|0,height=this.height*ratio.th|0,aleft=this.aleft*ratio.tw|0,atop=this.atop*ratio.th|0;var input="0;1;"+aleft+";"+atop+";"+width+";"+height+";;;;;"+img+"\n4;\n3;\n";this._props={aleft:aleft,atop:atop,width:width,height:height};try{cp.execFileSync(OverlayImage.w3mdisplay,[],{env:process.env,encoding:"utf8",input:input,timeout:1e3})}catch(e){}return true};OverlayImage.prototype.clearImageSync=function(){if(OverlayImage.hasW3MDisplay===false){throw new Error("W3M Image Display not available.")}if(!this._props){return false}var width=this._props.width+2,height=this._props.height+2,aleft=this._props.aleft,atop=this._props.atop;if(this._drag){aleft-=10;atop-=10;width+=10;height+=10}var input="6;"+aleft+";"+atop+";"+width+";"+height+"\n4;\n3;\n";delete this.file;delete this._props;delete this._lastSize;try{cp.execFileSync(OverlayImage.w3mdisplay,[],{env:process.env,encoding:"utf8",input:input,timeout:1e3})}catch(e){}return true};OverlayImage.prototype.imageSizeSync=function(){var img=this.file;if(OverlayImage.hasW3MDisplay===false){throw new Error("W3M Image Display not available.")}if(!img){throw new Error("No image.")}var buf="";var input="5;"+img+"\n";try{buf=cp.execFileSync(OverlayImage.w3mdisplay,[],{env:process.env,encoding:"utf8",input:input,timeout:1e3})}catch(e){}var size=buf.trim().split(/\s+/);return{raw:buf.trim(),width:+size[0],height:+size[1]}};OverlayImage.prototype.termSizeSync=function(_,recurse){if(OverlayImage.hasW3MDisplay===false){throw new Error("W3M Image Display not available.")}var buf="";try{buf=cp.execFileSync(OverlayImage.w3mdisplay,["-test"],{env:process.env,encoding:"utf8",timeout:1e3})}catch(e){}if(!buf.trim()){recurse=recurse||0;if(++recurse===5){throw new Error("Term size not determined.")}return this.termSizeSync(_,recurse)}var size=buf.trim().split(/\s+/);return{raw:buf.trim(),width:+size[0],height:+size[1]}};OverlayImage.prototype.getPixelRatioSync=function(){if(this._ratio&&!this._needsRatio){return this._ratio}this._needsRatio=false;var dimensions=this.termSizeSync();this._ratio={tw:dimensions.width/this.screen.width,th:dimensions.height/this.screen.height};return this._ratio};OverlayImage.prototype.displayImage=function(callback){return this.screen.displayImage(this.file,callback)};module.exports=OverlayImage}).call(this,require("_process"))},{"../helpers":62,"./box":70,"./node":86,_process:30,child_process:1,fs:1}],88:[function(require,module,exports){var Node=require("./node");var Input=require("./input");function ProgressBar(options){var self=this;if(!(this instanceof Node)){return new ProgressBar(options)}options=options||{};Input.call(this,options);this.filled=options.filled||0;if(typeof this.filled==="string"){this.filled=+this.filled.slice(0,-1)}this.value=this.filled;this.pch=options.pch||" ";if(options.ch){this.pch=options.ch;this.ch=" "}if(options.bch){this.ch=options.bch}if(!this.style.bar){this.style.bar={};this.style.bar.fg=options.barFg;this.style.bar.bg=options.barBg}this.orientation=options.orientation||"horizontal";if(options.keys){this.on("keypress",function(ch,key){var back,forward;if(self.orientation==="horizontal"){back=["left","h"];forward=["right","l"]}else if(self.orientation==="vertical"){back=["down","j"];forward=["up","k"]}if(key.name===back[0]||options.vi&&key.name===back[1]){self.progress(-5);self.screen.render();return}if(key.name===forward[0]||options.vi&&key.name===forward[1]){self.progress(5);self.screen.render();return}})}if(options.mouse){this.on("click",function(data){var x,y,m,p;if(!self.lpos)return;if(self.orientation==="horizontal"){x=data.x-self.lpos.xi;m=self.lpos.xl-self.lpos.xi-self.iwidth;p=x/m*100|0}else if(self.orientation==="vertical"){y=data.y-self.lpos.yi;m=self.lpos.yl-self.lpos.yi-self.iheight;p=y/m*100|0}self.setProgress(p)})}}ProgressBar.prototype.__proto__=Input.prototype;ProgressBar.prototype.type="progress-bar";ProgressBar.prototype.render=function(){var ret=this._render();if(!ret)return;var xi=ret.xi,xl=ret.xl,yi=ret.yi,yl=ret.yl,dattr;if(this.border)xi++,yi++,xl--,yl--;if(this.orientation==="horizontal"){xl=xi+(xl-xi)*(this.filled/100)|0}else if(this.orientation==="vertical"){yi=yi+(yl-yi-((yl-yi)*(this.filled/100)|0))}dattr=this.sattr(this.style.bar);this.screen.fillRegion(dattr,this.pch,xi,xl,yi,yl);if(this.content){var line=this.screen.lines[yi];for(var i=0;i<this.content.length;i++){line[xi+i][1]=this.content[i]}line.dirty=true}return ret};ProgressBar.prototype.progress=function(filled){this.filled+=filled;if(this.filled<0)this.filled=0;else if(this.filled>100)this.filled=100;if(this.filled===100){this.emit("complete")}this.value=this.filled};ProgressBar.prototype.setProgress=function(filled){this.filled=0;this.progress(filled)};ProgressBar.prototype.reset=function(){this.emit("reset");this.filled=0;this.value=this.filled};module.exports=ProgressBar},{"./input":77,"./node":86}],89:[function(require,module,exports){var Node=require("./node");var Box=require("./box");var Button=require("./button");var Textbox=require("./textbox");function Prompt(options){if(!(this instanceof Node)){return new Prompt(options)}options=options||{};options.hidden=true;Box.call(this,options);this._.input=new Textbox({parent:this,top:3,height:1,left:2,right:2,bg:"black"});this._.okay=new Button({parent:this,top:5,height:1,left:2,width:6,content:"Okay",align:"center",bg:"black",hoverBg:"blue",autoFocus:false,mouse:true});this._.cancel=new Button({parent:this,top:5,height:1,shrink:true,left:10,width:8,content:"Cancel",align:"center",bg:"black",hoverBg:"blue",autoFocus:false,mouse:true})}Prompt.prototype.__proto__=Box.prototype;Prompt.prototype.type="prompt";Prompt.prototype.input=Prompt.prototype.setInput=Prompt.prototype.readInput=function(text,value,callback){var self=this;var okay,cancel;if(!callback){callback=value;value=""}this.show();this.setContent(" "+text);this._.input.value=value;this.screen.saveFocus();this._.okay.on("press",okay=function(){self._.input.submit()});this._.cancel.on("press",cancel=function(){self._.input.cancel()});this._.input.readInput(function(err,data){self.hide();self.screen.restoreFocus();self._.okay.removeListener("press",okay);self._.cancel.removeListener("press",cancel);return callback(err,data)});this.screen.render()};module.exports=Prompt},{"./box":70,"./button":71,"./node":86,"./textbox":100}],90:[function(require,module,exports){var Node=require("./node");var Box=require("./box");var Button=require("./button");function Question(options){if(!(this instanceof Node)){return new Question(options)}options=options||{};options.hidden=true;Box.call(this,options);this._.okay=new Button({screen:this.screen,parent:this,top:2,height:1,left:2,width:6,content:"Okay",align:"center",bg:"black",hoverBg:"blue",autoFocus:false,mouse:true});this._.cancel=new Button({screen:this.screen,parent:this,top:2,height:1,shrink:true,left:10,width:8,content:"Cancel",align:"center",bg:"black",hoverBg:"blue",autoFocus:false,mouse:true})}Question.prototype.__proto__=Box.prototype;Question.prototype.type="question";Question.prototype.ask=function(text,callback){var self=this;var press,okay,cancel;this.show();this.setContent(" "+text);this.onScreenEvent("keypress",press=function(ch,key){if(key.name==="mouse")return;if(key.name!=="enter"&&key.name!=="escape"&&key.name!=="q"&&key.name!=="y"&&key.name!=="n"){return}done(null,key.name==="enter"||key.name==="y")});this._.okay.on("press",okay=function(){done(null,true)});this._.cancel.on("press",cancel=function(){done(null,false)});this.screen.saveFocus();this.focus();function done(err,data){self.hide();self.screen.restoreFocus();self.removeScreenEvent("keypress",press);self._.okay.removeListener("press",okay);self._.cancel.removeListener("press",cancel);return callback(err,data)}this.screen.render()};module.exports=Question},{"./box":70,"./button":71,"./node":86}],91:[function(require,module,exports){var Node=require("./node");var Checkbox=require("./checkbox");function RadioButton(options){var self=this;if(!(this instanceof Node)){return new RadioButton(options)}options=options||{};Checkbox.call(this,options);this.on("check",function(){var el=self;while(el=el.parent){if(el.type==="radio-set"||el.type==="form")break}el=el||self.parent;el.forDescendants(function(el){if(el.type!=="radio-button"||el===self){return}el.uncheck()})})}RadioButton.prototype.__proto__=Checkbox.prototype;RadioButton.prototype.type="radio-button";RadioButton.prototype.render=function(){this.clearPos(true);this.setContent("("+(this.checked?"*":" ")+") "+this.text,true);return this._render()};RadioButton.prototype.toggle=RadioButton.prototype.check;module.exports=RadioButton},{"./checkbox":72,"./node":86}],92:[function(require,module,exports){var Node=require("./node");var Box=require("./box");function RadioSet(options){if(!(this instanceof Node)){return new RadioSet(options)}options=options||{};Box.call(this,options)}RadioSet.prototype.__proto__=Box.prototype;RadioSet.prototype.type="radio-set";module.exports=RadioSet},{"./box":70,"./node":86}],93:[function(require,module,exports){(function(process,global){var path=require("path"),fs=require("fs"),cp=require("child_process");var colors=require("../colors"),program=require("../program"),unicode=require("../unicode");var nextTick=global.setImmediate||process.nextTick.bind(process);var helpers=require("../helpers");var Node=require("./node");var Log=require("./log");var Element=require("./element");var Box=require("./box");function Screen(options){var self=this;if(!(this instanceof Node)){return new Screen(options)}Screen.bind(this);options=options||{};if(options.rsety&&options.listen){options={program:options}}this.program=options.program;if(!this.program){this.program=program({input:options.input,output:options.output,log:options.log,debug:options.debug,dump:options.dump,terminal:options.terminal||options.term,resizeTimeout:options.resizeTimeout,forceUnicode:options.forceUnicode,tput:true,buffer:true,zero:true})}else{this.program.setupTput();this.program.useBuffer=true;this.program.zero=true;this.program.options.resizeTimeout=options.resizeTimeout;if(options.forceUnicode!=null){this.program.tput.features.unicode=options.forceUnicode;this.program.tput.unicode=options.forceUnicode}}this.tput=this.program.tput;Node.call(this,options);this.autoPadding=options.autoPadding!==false;this.tabc=Array((options.tabSize||4)+1).join(" ");this.dockBorders=options.dockBorders;this.ignoreLocked=options.ignoreLocked||[];this._unicode=this.tput.unicode||this.tput.numbers.U8===1;this.fullUnicode=this.options.fullUnicode&&this._unicode;this.dattr=0<<18|511<<9|511;this.renders=0;this.position={left:this.left=this.aleft=this.rleft=0,right:this.right=this.aright=this.rright=0,top:this.top=this.atop=this.rtop=0,bottom:this.bottom=this.abottom=this.rbottom=0,get height(){return self.height},get width(){return self.width}};this.ileft=0;this.itop=0;this.iright=0;this.ibottom=0;this.iheight=0;this.iwidth=0;this.padding={left:0,top:0,right:0,bottom:0};this.hover=null;this.history=[];this.clickable=[];this.keyable=[];this.grabKeys=false;this.lockKeys=false;this.focused;this._buf="";this._ci=-1;if(options.title){this.title=options.title}options.cursor=options.cursor||{artificial:options.artificialCursor,shape:options.cursorShape,blink:options.cursorBlink,color:options.cursorColor};this.cursor={artificial:options.cursor.artificial||false,shape:options.cursor.shape||"block",blink:options.cursor.blink||false,color:options.cursor.color||null,_set:false,_state:1,_hidden:true};this.program.on("resize",function(){self.alloc();self.render();(function emit(el){el.emit("resize");el.children.forEach(emit)})(self)});this.program.on("focus",function(){self.emit("focus")});this.program.on("blur",function(){self.emit("blur")});this.program.on("warning",function(text){self.emit("warning",text)});this.on("newListener",function fn(type){if(type==="keypress"||type.indexOf("key ")===0||type==="mouse"){if(type==="keypress"||type.indexOf("key ")===0)self._listenKeys();if(type==="mouse")self._listenMouse()}if(type==="mouse"||type==="click"||type==="mouseover"||type==="mouseout"||type==="mousedown"||type==="mouseup"||type==="mousewheel"||type==="wheeldown"||type==="wheelup"||type==="mousemove"){self._listenMouse()}});this.setMaxListeners(Infinity);this.enter();this.postEnter()}Screen.global=null;Screen.total=0;Screen.instances=[];Screen.bind=function(screen){if(!Screen.global){Screen.global=screen}if(!~Screen.instances.indexOf(screen)){Screen.instances.push(screen);screen.index=Screen.total;Screen.total++}if(Screen._bound)return;Screen._bound=true;process.on("uncaughtException",Screen._exceptionHandler=function(err){if(process.listeners("uncaughtException").length>1){return}Screen.instances.slice().forEach(function(screen){screen.destroy()});err=err||new Error("Uncaught Exception.");console.error(err.stack?err.stack+"":err+"");nextTick(function(){process.exit(1)})});["SIGTERM","SIGINT","SIGQUIT"].forEach(function(signal){var name="_"+signal.toLowerCase()+"Handler";process.on(signal,Screen[name]=function(){if(process.listeners(signal).length>1){return}nextTick(function(){process.exit(0)})})});process.on("exit",Screen._exitHandler=function(){Screen.instances.slice().forEach(function(screen){screen.destroy()})})};Screen.prototype.__proto__=Node.prototype;Screen.prototype.type="screen";Screen.prototype.__defineGetter__("title",function(){return this.program.title});Screen.prototype.__defineSetter__("title",function(title){return this.program.title=title});Screen.prototype.__defineGetter__("terminal",function(){return this.program.terminal});Screen.prototype.__defineSetter__("terminal",function(terminal){this.setTerminal(terminal);return this.program.terminal});Screen.prototype.setTerminal=function(terminal){var entered=!!this.program.isAlt;if(entered){this._buf="";this.program._buf="";this.leave()}this.program.setTerminal(terminal);this.tput=this.program.tput;if(entered){this.enter()}};Screen.prototype.enter=function(){if(this.program.isAlt)return;if(!this.cursor._set){if(this.options.cursor.shape){this.cursorShape(this.cursor.shape,this.cursor.blink)}if(this.options.cursor.color){this.cursorColor(this.cursor.color)}}if(process.platform==="win32"){try{cp.execSync("cls",{stdio:"ignore",timeout:1e3})}catch(e){}}this.program.alternateBuffer();this.program.put.keypad_xmit();this.program.csr(0,this.height-1);this.program.hideCursor();this.program.cup(0,0);if(this.tput.strings.ena_acs){this.program._write(this.tput.enacs())}this.alloc()};Screen.prototype.leave=function(){if(!this.program.isAlt)return;this.program.put.keypad_local();if(this.program.scrollTop!==0||this.program.scrollBottom!==this.rows-1){this.program.csr(0,this.height-1)}this.program.showCursor();this.alloc();if(this._listenedMouse){this.program.disableMouse()}this.program.normalBuffer();if(this.cursor._set)this.cursorReset();this.program.flush();if(process.platform==="win32"){try{cp.execSync("cls",{stdio:"ignore",timeout:1e3})}catch(e){}}};Screen.prototype.postEnter=function(){var self=this;if(this.options.debug){this.debugLog=new Log({screen:this,parent:this,hidden:true,draggable:true,left:"center",top:"center",width:"30%",height:"30%",border:"line",label:" {bold}Debug Log{/bold} ",tags:true,keys:true,vi:true,mouse:true,scrollbar:{ch:" ",track:{bg:"yellow"},style:{inverse:true}}});this.debugLog.toggle=function(){if(self.debugLog.hidden){self.saveFocus();self.debugLog.show();self.debugLog.setFront();self.debugLog.focus()}else{self.debugLog.hide();self.restoreFocus()}self.render()};this.debugLog.key(["q","escape"],self.debugLog.toggle);this.key("f12",self.debugLog.toggle)}if(this.options.warnings){this.on("warning",function(text){var warning=new Box({screen:self,parent:self,left:"center",top:"center",width:"shrink",padding:1,height:"shrink",align:"center",valign:"middle",border:"line",label:" {red-fg}{bold}WARNING{/} ",content:"{bold}"+text+"{/bold}",tags:true});self.render();var timeout=setTimeout(function(){warning.destroy();self.render()},1500);if(timeout.unref){timeout.unref()}})}};Screen.prototype._destroy=Screen.prototype.destroy;Screen.prototype.destroy=function(){this.leave();var index=Screen.instances.indexOf(this);if(~index){Screen.instances.splice(index,1);Screen.total--;Screen.global=Screen.instances[0];if(Screen.total===0){Screen.global=null;process.removeListener("uncaughtException",Screen._exceptionHandler);process.removeListener("SIGTERM",Screen._sigtermHandler);process.removeListener("SIGINT",Screen._sigintHandler);process.removeListener("SIGQUIT",Screen._sigquitHandler);process.removeListener("exit",Screen._exitHandler);delete Screen._exceptionHandler;delete Screen._sigtermHandler;delete Screen._sigintHandler;delete Screen._sigquitHandler;delete Screen._exitHandler;delete Screen._bound}this.destroyed=true;this.emit("destroy");this._destroy()}this.program.destroy()};Screen.prototype.log=function(){return this.program.log.apply(this.program,arguments)};Screen.prototype.debug=function(){if(this.debugLog){this.debugLog.log.apply(this.debugLog,arguments)}return this.program.debug.apply(this.program,arguments)};Screen.prototype._listenMouse=function(el){var self=this;if(el&&!~this.clickable.indexOf(el)){el.clickable=true;this.clickable.push(el)}if(this._listenedMouse)return;this._listenedMouse=true;this.program.enableMouse();if(this.options.sendFocus){this.program.setMouse({sendFocus:true},true)}this.on("render",function(){self._needsClickableSort=true});this.program.on("mouse",function(data){if(self.lockKeys)return;if(self._needsClickableSort){self.clickable=helpers.hsort(self.clickable);self._needsClickableSort=false}var i=0,el,set,pos;for(;i<self.clickable.length;i++){el=self.clickable[i];if(el.detached||!el.visible){continue}pos=el.lpos;if(!pos)continue;if(data.x>=pos.xi&&data.x<pos.xl&&data.y>=pos.yi&&data.y<pos.yl){el.emit("mouse",data);if(data.action==="mousedown"){self.mouseDown=el}else if(data.action==="mouseup"){(self.mouseDown||el).emit("click",data);self.mouseDown=null}else if(data.action==="mousemove"){if(self.hover&&el.index>self.hover.index){set=false}if(self.hover!==el&&!set){if(self.hover){self.hover.emit("mouseout",data)}el.emit("mouseover",data);self.hover=el}set=true}el.emit(data.action,data);break}}if((data.action==="mousemove"||data.action==="mousedown"||data.action==="mouseup")&&self.hover&&!set){self.hover.emit("mouseout",data);self.hover=null}self.emit("mouse",data);self.emit(data.action,data)});this.on("element click",function(el){if(el.clickable===true&&el.options.autoFocus!==false){el.focus()}})};Screen.prototype.enableMouse=function(el){this._listenMouse(el)};Screen.prototype._listenKeys=function(el){var self=this;if(el&&!~this.keyable.indexOf(el)){el.keyable=true;this.keyable.push(el)}if(this._listenedKeys)return;this._listenedKeys=true;this.program.on("keypress",function(ch,key){if(self.lockKeys&&!~self.ignoreLocked.indexOf(key.full)){return}var focused=self.focused,grabKeys=self.grabKeys;if(!grabKeys||~self.ignoreLocked.indexOf(key.full)){self.emit("keypress",ch,key);self.emit("key "+key.full,ch,key)}if(self.grabKeys!==grabKeys||self.lockKeys){return}if(focused&&focused.keyable){focused.emit("keypress",ch,key);focused.emit("key "+key.full,ch,key)}})};Screen.prototype.enableKeys=function(el){this._listenKeys(el)};Screen.prototype.enableInput=function(el){this._listenMouse(el);this._listenKeys(el)};Screen.prototype._initHover=function(){var self=this;if(this._hoverText){return}this._hoverText=new Box({screen:this,left:0,top:0,tags:false,height:"shrink",width:"shrink",border:"line",style:{border:{fg:"default"},bg:"default",fg:"default"}});this.on("mousemove",function(data){if(self._hoverText.detached)return;self._hoverText.rleft=data.x+1;self._hoverText.rtop=data.y;self.render()});this.on("element mouseover",function(el,data){if(!el._hoverOptions)return;self._hoverText.parseTags=el.parseTags;self._hoverText.setContent(el._hoverOptions.text);self.append(self._hoverText);self._hoverText.rleft=data.x+1;self._hoverText.rtop=data.y;self.render()});this.on("element mouseout",function(){if(self._hoverText.detached)return;self._hoverText.detach();self.render()});this.on("element mouseup",function(el){if(!self._hoverText.getContent())return;if(!el._hoverOptions)return;self.append(self._hoverText);self.render()})};Screen.prototype.__defineGetter__("cols",function(){return this.program.cols});Screen.prototype.__defineGetter__("rows",function(){return this.program.rows});Screen.prototype.__defineGetter__("width",function(){return this.program.cols});Screen.prototype.__defineGetter__("height",function(){return this.program.rows});Screen.prototype.alloc=function(dirty){var x,y;this.lines=[];for(y=0;y<this.rows;y++){this.lines[y]=[];for(x=0;x<this.cols;x++){this.lines[y][x]=[this.dattr," "]}this.lines[y].dirty=!!dirty}this.olines=[];for(y=0;y<this.rows;y++){this.olines[y]=[];for(x=0;x<this.cols;x++){this.olines[y][x]=[this.dattr," "]}}this.program.clear()};Screen.prototype.realloc=function(){return this.alloc(true)};Screen.prototype.render=function(){var self=this;if(this.destroyed)return;this.emit("prerender");this._borderStops={};this._ci=0;this.children.forEach(function(el){el.index=self._ci++;el.render()});this._ci=-1;if(this.screen.dockBorders){this._dockBorders()}this.draw(0,this.lines.length-1);if(this.focused&&this.focused._updateCursor){this.focused._updateCursor(true)}this.renders++;this.emit("render")};Screen.prototype.blankLine=function(ch,dirty){var out=[];for(var x=0;x<this.cols;x++){out[x]=[this.dattr,ch||" "]}out.dirty=dirty;return out};Screen.prototype.insertLine=function(n,y,top,bottom){if(!this.tput.strings.change_scroll_region||!this.tput.strings.delete_line||!this.tput.strings.insert_line)return;this._buf+=this.tput.csr(top,bottom);this._buf+=this.tput.cup(y,0);this._buf+=this.tput.il(n);this._buf+=this.tput.csr(0,this.height-1);var j=bottom+1;while(n--){this.lines.splice(y,0,this.blankLine());this.lines.splice(j,1);this.olines.splice(y,0,this.blankLine());this.olines.splice(j,1)}};Screen.prototype.deleteLine=function(n,y,top,bottom){if(!this.tput.strings.change_scroll_region||!this.tput.strings.delete_line||!this.tput.strings.insert_line)return;this._buf+=this.tput.csr(top,bottom);this._buf+=this.tput.cup(y,0);this._buf+=this.tput.dl(n);this._buf+=this.tput.csr(0,this.height-1);var j=bottom+1;while(n--){this.lines.splice(j,0,this.blankLine());this.lines.splice(y,1);this.olines.splice(j,0,this.blankLine());this.olines.splice(y,1)}};Screen.prototype.insertLineNC=function(n,y,top,bottom){if(!this.tput.strings.change_scroll_region||!this.tput.strings.delete_line)return;this._buf+=this.tput.csr(top,bottom);this._buf+=this.tput.cup(top,0);this._buf+=this.tput.dl(n);this._buf+=this.tput.csr(0,this.height-1);var j=bottom+1;while(n--){this.lines.splice(j,0,this.blankLine());this.lines.splice(y,1);this.olines.splice(j,0,this.blankLine());this.olines.splice(y,1)}};Screen.prototype.deleteLineNC=function(n,y,top,bottom){if(!this.tput.strings.change_scroll_region||!this.tput.strings.delete_line)return;this._buf+=this.tput.csr(top,bottom);this._buf+=this.tput.cup(bottom,0);this._buf+=Array(n+1).join("\n");this._buf+=this.tput.csr(0,this.height-1);var j=bottom+1;while(n--){this.lines.splice(j,0,this.blankLine());this.lines.splice(y,1);this.olines.splice(j,0,this.blankLine());this.olines.splice(y,1)}};Screen.prototype.insertBottom=function(top,bottom){return this.deleteLine(1,top,top,bottom)};Screen.prototype.insertTop=function(top,bottom){return this.insertLine(1,top,top,bottom)};Screen.prototype.deleteBottom=function(top,bottom){return this.clearRegion(0,this.width,bottom,bottom)};Screen.prototype.deleteTop=function(top,bottom){return this.deleteLine(1,top,top,bottom)};Screen.prototype.cleanSides=function(el){var pos=el.lpos;if(!pos){return false}if(pos._cleanSides!=null){return pos._cleanSides}if(pos.xi<=0&&pos.xl>=this.width){return pos._cleanSides=true}if(this.options.fastCSR){if(pos.yi<0)return pos._cleanSides=false;if(pos.yl>this.height)return pos._cleanSides=false;if(this.width-(pos.xl-pos.xi)<40){return pos._cleanSides=true}return pos._cleanSides=false}if(!this.options.smartCSR){return false}var yi=pos.yi+el.itop,yl=pos.yl-el.ibottom,first,ch,x,y;if(pos.yi<0)return pos._cleanSides=false;if(pos.yl>this.height)return pos._cleanSides=false;if(pos.xi-1<0)return pos._cleanSides=true;if(pos.xl>this.width)return pos._cleanSides=true;for(x=pos.xi-1;x>=0;x--){if(!this.olines[yi])break;first=this.olines[yi][x];for(y=yi;y<yl;y++){if(!this.olines[y]||!this.olines[y][x])break;ch=this.olines[y][x];if(ch[0]!==first[0]||ch[1]!==first[1]){return pos._cleanSides=false}}}for(x=pos.xl;x<this.width;x++){if(!this.olines[yi])break;first=this.olines[yi][x];for(y=yi;y<yl;y++){if(!this.olines[y]||!this.olines[y][x])break;ch=this.olines[y][x];if(ch[0]!==first[0]||ch[1]!==first[1]){return pos._cleanSides=false}}}return pos._cleanSides=true};Screen.prototype._dockBorders=function(){var lines=this.lines,stops=this._borderStops,i,y,x,ch;stops=Object.keys(stops).map(function(k){return+k}).sort(function(a,b){return a-b});for(i=0;i<stops.length;i++){y=stops[i];if(!lines[y])continue;for(x=0;x<this.width;x++){ch=lines[y][x][1];if(angles[ch]){lines[y][x][1]=this._getAngle(lines,x,y);lines[y].dirty=true}}}};Screen.prototype._getAngle=function(lines,x,y){var angle=0,attr=lines[y][x][0],ch=lines[y][x][1];if(lines[y][x-1]&&langles[lines[y][x-1][1]]){if(!this.options.ignoreDockContrast){if(lines[y][x-1][0]!==attr)return ch}angle|=1<<3}if(lines[y-1]&&uangles[lines[y-1][x][1]]){if(!this.options.ignoreDockContrast){if(lines[y-1][x][0]!==attr)return ch}angle|=1<<2}if(lines[y][x+1]&&rangles[lines[y][x+1][1]]){if(!this.options.ignoreDockContrast){if(lines[y][x+1][0]!==attr)return ch}angle|=1<<1}if(lines[y+1]&&dangles[lines[y+1][x][1]]){if(!this.options.ignoreDockContrast){if(lines[y+1][x][0]!==attr)return ch}angle|=1<<0}return angleTable[angle]||ch};Screen.prototype.draw=function(start,end){var x,y,line,out,ch,data,attr,fg,bg,flags;var main="",pre,post;var clr,neq,xx;var lx=-1,ly=-1,o;var acs;if(this._buf){main+=this._buf;this._buf=""}for(y=start;y<=end;y++){line=this.lines[y];o=this.olines[y];if(!line.dirty&&!(this.cursor.artificial&&y===this.program.y)){continue}line.dirty=false;out="";attr=this.dattr;for(x=0;x<line.length;x++){data=line[x][0];ch=line[x][1];if(this.cursor.artificial&&!this.cursor._hidden&&this.cursor._state&&x===this.program.x&&y===this.program.y){var cattr=this._cursorAttr(this.cursor,data);if(cattr.ch)ch=cattr.ch;data=cattr.attr}if(this.options.useBCE&&ch===" "&&(this.tput.bools.back_color_erase||(data&511)===(this.dattr&511))&&(data>>18&8)===(this.dattr>>18&8)){clr=true;neq=false;for(xx=x;xx<line.length;xx++){if(line[xx][0]!==data||line[xx][1]!==" "){clr=false;break}if(line[xx][0]!==o[xx][0]||line[xx][1]!==o[xx][1]){neq=true}}if(clr&&neq){lx=-1,ly=-1;if(data!==attr){out+=this.codeAttr(data);attr=data}out+=this.tput.cup(y,x);out+=this.tput.el();for(xx=x;xx<line.length;xx++){o[xx][0]=data;o[xx][1]=" "}break}}if(data===o[x][0]&&ch===o[x][1]){if(lx===-1){lx=x;ly=y}continue}else if(lx!==-1){if(this.tput.strings.parm_right_cursor){out+=y===ly?this.tput.cuf(x-lx):this.tput.cup(y,x)}else{out+=this.tput.cup(y,x)}lx=-1,ly=-1}o[x][0]=data;o[x][1]=ch;if(data!==attr){if(attr!==this.dattr){out+="[m"}if(data!==this.dattr){out+="[";bg=data&511;fg=data>>9&511;flags=data>>18;if(flags&1){out+="1;"}if(flags&2){out+="4;"}if(flags&4){out+="5;"}if(flags&8){out+="7;"}if(flags&16){out+="8;"}if(bg!==511){bg=this._reduceColor(bg);if(bg<16){if(bg<8){bg+=40}else if(bg<16){bg-=8;bg+=100}out+=bg+";"}else{out+="48;5;"+bg+";"}}if(fg!==511){fg=this._reduceColor(fg);if(fg<16){if(fg<8){fg+=30}else if(fg<16){fg-=8;fg+=90}out+=fg+";"}else{out+="38;5;"+fg+";"}}if(out[out.length-1]===";")out=out.slice(0,-1);out+="m"}}if(this.fullUnicode){if(unicode.charWidth(line[x][1])===2){if(x===line.length-1||angles[line[x+1][1]]){ch=" ";o[x][1]="\0"}else{o[x][1]="\0";o[++x][1]="\0"}}}if(this.tput.strings.enter_alt_charset_mode&&!this.tput.brokenACS&&(this.tput.acscr[ch]||acs)){if(this.tput.acscr[ch]){if(acs){ch=this.tput.acscr[ch]}else{ch=this.tput.smacs()+this.tput.acscr[ch];acs=true}}else if(acs){ch=this.tput.rmacs()+ch;acs=false}}else{if(!this.tput.unicode&&this.tput.numbers.U8!==1&&ch>"~"){ch=this.tput.utoa[ch]||"?"}}out+=ch;attr=data}if(attr!==this.dattr){out+="[m"}if(out){main+=this.tput.cup(y,0)+out}}if(acs){main+=this.tput.rmacs();acs=false}if(main){pre="";post="";pre+=this.tput.sc();post+=this.tput.rc();if(!this.program.cursorHidden){pre+=this.tput.civis();post+=this.tput.cnorm()}this.program._write(pre+main+post)}};Screen.prototype._reduceColor=function(color){return colors.reduce(color,this.tput.colors)};Screen.prototype.attrCode=function(code,cur,def){var flags=cur>>18&511,fg=cur>>9&511,bg=cur&511,c,i;code=code.slice(2,-1).split(";");if(!code[0])code[0]="0";for(i=0;i<code.length;i++){c=+code[i]||0;switch(c){case 0:bg=def&511;fg=def>>9&511;flags=def>>18&511;break;case 1:flags|=1;break;case 22:flags=def>>18&511;break;case 4:flags|=2;break;case 24:flags=def>>18&511;break;case 5:flags|=4;break;case 25:flags=def>>18&511;break;case 7:flags|=8;break;case 27:flags=def>>18&511;break;case 8:flags|=16;break;case 28:flags=def>>18&511;break;case 39:fg=def>>9&511;break;case 49:bg=def&511;break;case 100:fg=def>>9&511;bg=def&511;break;default:if(c===48&&+code[i+1]===5){i+=2;bg=+code[i];break}else if(c===48&&+code[i+1]===2){i+=2;bg=colors.match(+code[i],+code[i+1],+code[i+2]);if(bg===-1)bg=def&511;i+=2;break}else if(c===38&&+code[i+1]===5){i+=2;fg=+code[i];break}else if(c===38&&+code[i+1]===2){i+=2;fg=colors.match(+code[i],+code[i+1],+code[i+2]);if(fg===-1)fg=def>>9&511;i+=2;break}if(c>=40&&c<=47){bg=c-40}else if(c>=100&&c<=107){bg=c-100;bg+=8}else if(c===49){bg=def&511}else if(c>=30&&c<=37){fg=c-30}else if(c>=90&&c<=97){fg=c-90;fg+=8}else if(c===39){fg=def>>9&511}else if(c===100){fg=def>>9&511;bg=def&511}break}}return flags<<18|fg<<9|bg};Screen.prototype.codeAttr=function(code){var flags=code>>18&511,fg=code>>9&511,bg=code&511,out="";if(flags&1){out+="1;"}if(flags&2){out+="4;"}if(flags&4){out+="5;"}if(flags&8){out+="7;"}if(flags&16){out+="8;"}if(bg!==511){bg=this._reduceColor(bg);if(bg<16){if(bg<8){bg+=40}else if(bg<16){bg-=8;bg+=100}out+=bg+";"}else{out+="48;5;"+bg+";"}}if(fg!==511){fg=this._reduceColor(fg);if(fg<16){if(fg<8){fg+=30}else if(fg<16){fg-=8;fg+=90}out+=fg+";"}else{out+="38;5;"+fg+";"}}if(out[out.length-1]===";")out=out.slice(0,-1);return"["+out+"m"};Screen.prototype.focusOffset=function(offset){var shown=this.keyable.filter(function(el){return!el.detached&&el.visible}).length;if(!shown||!offset){return}var i=this.keyable.indexOf(this.focused);if(!~i)return;if(offset>0){while(offset--){if(++i>this.keyable.length-1)i=0;if(this.keyable[i].detached||!this.keyable[i].visible)offset++}}else{offset=-offset;while(offset--){if(--i<0)i=this.keyable.length-1;if(this.keyable[i].detached||!this.keyable[i].visible)offset++}}return this.keyable[i].focus()};Screen.prototype.focusPrev=Screen.prototype.focusPrevious=function(){return this.focusOffset(-1)};Screen.prototype.focusNext=function(){return this.focusOffset(1)};Screen.prototype.focusPush=function(el){if(!el)return;var old=this.history[this.history.length-1];if(this.history.length===10){this.history.shift()}this.history.push(el);this._focus(el,old)};Screen.prototype.focusPop=function(){var old=this.history.pop();if(this.history.length){this._focus(this.history[this.history.length-1],old)}return old};Screen.prototype.saveFocus=function(){return this._savedFocus=this.focused};Screen.prototype.restoreFocus=function(){if(!this._savedFocus)return;this._savedFocus.focus();delete this._savedFocus;return this.focused};Screen.prototype.rewindFocus=function(){var old=this.history.pop(),el;while(this.history.length){el=this.history.pop();if(!el.detached&&el.visible){this.history.push(el);this._focus(el,old);return el}}if(old){old.emit("blur")}};Screen.prototype._focus=function(self,old){var el=self;while(el=el.parent){if(el.scrollable)break}if(el&&!el.detached){var visible=self.screen.height-el.atop-el.itop-el.abottom-el.ibottom;if(self.rtop<el.childBase){el.scrollTo(self.rtop);self.screen.render()}else if(self.rtop+self.height-self.ibottom>el.childBase+visible){el.scrollTo(self.rtop-(el.height-self.height)+el.itop,true);self.screen.render()}}if(old){old.emit("blur",self)}self.emit("focus",old)};Screen.prototype.__defineGetter__("focused",function(){return this.history[this.history.length-1]});Screen.prototype.__defineSetter__("focused",function(el){return this.focusPush(el)});Screen.prototype.clearRegion=function(xi,xl,yi,yl,override){return this.fillRegion(this.dattr," ",xi,xl,yi,yl,override)};Screen.prototype.fillRegion=function(attr,ch,xi,xl,yi,yl,override){var lines=this.lines,cell,xx;if(xi<0)xi=0;if(yi<0)yi=0;for(;yi<yl;yi++){if(!lines[yi])break;for(xx=xi;xx<xl;xx++){cell=lines[yi][xx];if(!cell)break;if(override||attr!==cell[0]||ch!==cell[1]){lines[yi][xx][0]=attr;lines[yi][xx][1]=ch;lines[yi].dirty=true}}}};Screen.prototype.key=function(){return this.program.key.apply(this,arguments)};Screen.prototype.onceKey=function(){return this.program.onceKey.apply(this,arguments)};Screen.prototype.unkey=Screen.prototype.removeKey=function(){return this.program.unkey.apply(this,arguments)};Screen.prototype.spawn=function(file,args,options){if(!Array.isArray(args)){options=args;args=[]}var screen=this,program=screen.program,spawn=require("child_process").spawn,mouse=program.mouseEnabled,ps;options=options||{};options.stdio=options.stdio||"inherit";program.lsaveCursor("spawn");program.normalBuffer();program.showCursor();if(mouse)program.disableMouse();var write=program.output.write;program.output.write=function(){};program.input.pause();if(program.input.setRawMode){program.input.setRawMode(false)}var resume=function(){if(resume.done)return;resume.done=true;if(program.input.setRawMode){program.input.setRawMode(true)}program.input.resume();program.output.write=write;program.alternateBuffer();if(mouse){program.enableMouse();if(screen.options.sendFocus){screen.program.setMouse({sendFocus:true},true)}}screen.alloc();screen.render();screen.program.lrestoreCursor("spawn",true)};ps=spawn(file,args,options);ps.on("error",resume);ps.on("exit",resume);return ps};Screen.prototype.exec=function(file,args,options,callback){var ps=this.spawn(file,args,options);ps.on("error",function(err){if(!callback)return;return callback(err,false)});ps.on("exit",function(code){if(!callback)return;return callback(null,code===0)});return ps};Screen.prototype.readEditor=function(options,callback){if(typeof options==="string"){options={editor:options}}if(!callback){callback=options;options=null}if(!callback){callback=function(){}}options=options||{};var self=this,editor=options.editor||process.env.EDITOR||"vi",name=options.name||process.title||"blessed",rnd=Math.random().toString(36).split(".").pop(),file="/tmp/"+name+"."+rnd,args=[file],opt;opt={stdio:"inherit",env:process.env,cwd:process.env.HOME};function writeFile(callback){if(!options.value)return callback();return fs.writeFile(file,options.value,callback)}return writeFile(function(err){if(err)return callback(err);return self.exec(editor,args,opt,function(err,success){if(err)return callback(err);return fs.readFile(file,"utf8",function(err,data){return fs.unlink(file,function(){if(!success)return callback(new Error("Unsuccessful."));if(err)return callback(err);return callback(null,data)})})})})};Screen.prototype.displayImage=function(file,callback){if(!file){if(!callback)return;return callback(new Error("No image."))}file=path.resolve(process.cwd(),file);if(!~file.indexOf("://")){file="file://"+file}var args=["w3m","-T","text/html"];var input="<title>press q to exit</title>"+'<img align="center" src="'+file+'">';var opt={stdio:["pipe",1,2],env:process.env,cwd:process.env.HOME};var ps=this.spawn(args[0],args.slice(1),opt);ps.on("error",function(err){if(!callback)return;return callback(err)});ps.on("exit",function(code){if(!callback)return;if(code!==0)return callback(new Error("Exit Code: "+code));return callback(null,code===0)});ps.stdin.write(input+"\n");ps.stdin.end()};Screen.prototype.setEffects=function(el,fel,over,out,effects,temp){if(!effects)return;var tmp={};if(temp)el[temp]=tmp;if(typeof el!=="function"){var _el=el;el=function(){return _el}}fel.on(over,function(){var element=el();Object.keys(effects).forEach(function(key){var val=effects[key];if(val!==null&&typeof val==="object"){tmp[key]=tmp[key]||{};Object.keys(val).forEach(function(k){var v=val[k];tmp[key][k]=element.style[key][k];element.style[key][k]=v});return}tmp[key]=element.style[key];element.style[key]=val});element.screen.render()});fel.on(out,function(){var element=el();Object.keys(effects).forEach(function(key){var val=effects[key];if(val!==null&&typeof val==="object"){tmp[key]=tmp[key]||{};Object.keys(val).forEach(function(k){if(tmp[key].hasOwnProperty(k)){element.style[key][k]=tmp[key][k]}});return}if(tmp.hasOwnProperty(key)){element.style[key]=tmp[key]}});element.screen.render()})};Screen.prototype.sigtstp=function(callback){var self=this;this.program.sigtstp(function(){self.alloc();self.render();self.program.lrestoreCursor("pause",true);if(callback)callback()})};Screen.prototype.copyToClipboard=function(text){return this.program.copyToClipboard(text)};Screen.prototype.cursorShape=function(shape,blink){var self=this;this.cursor.shape=shape||"block";this.cursor.blink=blink||false;this.cursor._set=true;if(this.cursor.artificial){if(!this.program.hideCursor_old){var hideCursor=this.program.hideCursor;this.program.hideCursor_old=this.program.hideCursor;this.program.hideCursor=function(){hideCursor.call(self.program);self.cursor._hidden=true;if(self.renders)self.render()}}if(!this.program.showCursor_old){var showCursor=this.program.showCursor;this.program.showCursor_old=this.program.showCursor;this.program.showCursor=function(){self.cursor._hidden=false;if(self.program._exiting)showCursor.call(self.program);if(self.renders)self.render()}}if(!this._cursorBlink){this._cursorBlink=setInterval(function(){if(!self.cursor.blink)return;self.cursor._state^=1;if(self.renders)self.render()},500);if(this._cursorBlink.unref){this._cursorBlink.unref()}}return true}return this.program.cursorShape(this.cursor.shape,this.cursor.blink)};Screen.prototype.cursorColor=function(color){this.cursor.color=color!=null?colors.convert(color):null;this.cursor._set=true;if(this.cursor.artificial){return true}return this.program.cursorColor(colors.ncolors[this.cursor.color])};Screen.prototype.cursorReset=Screen.prototype.resetCursor=function(){this.cursor.shape="block";this.cursor.blink=false;this.cursor.color=null;this.cursor._set=false;if(this.cursor.artificial){this.cursor.artificial=false;if(this.program.hideCursor_old){this.program.hideCursor=this.program.hideCursor_old;delete this.program.hideCursor_old}if(this.program.showCursor_old){this.program.showCursor=this.program.showCursor_old;delete this.program.showCursor_old}if(this._cursorBlink){clearInterval(this._cursorBlink);delete this._cursorBlink}return true}return this.program.cursorReset()};Screen.prototype._cursorAttr=function(cursor,dattr){var attr=dattr||this.dattr,cattr,ch;if(cursor.shape==="line"){attr&=~(511<<9);attr|=7<<9;ch="│"}else if(cursor.shape==="underline"){attr&=~(511<<9);attr|=7<<9;attr|=2<<18}else if(cursor.shape==="block"){attr&=~(511<<9);attr|=7<<9;attr|=8<<18}else if(typeof cursor.shape==="object"&&cursor.shape){cattr=Element.prototype.sattr.call(cursor,cursor.shape);if(cursor.shape.bold||cursor.shape.underline||cursor.shape.blink||cursor.shape.inverse||cursor.shape.invisible){attr&=~(511<<18);attr|=(cattr>>18&511)<<18}if(cursor.shape.fg){attr&=~(511<<9);attr|=(cattr>>9&511)<<9}if(cursor.shape.bg){attr&=~(511<<0);attr|=cattr&511}if(cursor.shape.ch){ch=cursor.shape.ch}}if(cursor.color!=null){attr&=~(511<<9);attr|=cursor.color<<9}return{ch:ch,attr:attr}};Screen.prototype.screenshot=function(xi,xl,yi,yl,term){if(xi==null)xi=0;if(xl==null)xl=this.cols;if(yi==null)yi=0;if(yl==null)yl=this.rows;if(xi<0)xi=0;if(yi<0)yi=0;var x,y,line,out,ch,data,attr;var sdattr=this.dattr;if(term){this.dattr=term.defAttr}var main="";for(y=yi;y<yl;y++){line=term?term.lines[y]:this.lines[y];if(!line)break;out="";attr=this.dattr;for(x=xi;x<xl;x++){if(!line[x])break;data=line[x][0];ch=line[x][1];if(data!==attr){if(attr!==this.dattr){out+="[m"}if(data!==this.dattr){var _data=data;if(term){if((_data>>9&511)===257)_data|=511<<9;if((_data&511)===256)_data|=511}out+=this.codeAttr(_data)}}if(this.fullUnicode){if(unicode.charWidth(line[x][1])===2){if(x===xl-1){ch=" "}else{x++}}}out+=ch;attr=data}if(attr!==this.dattr){out+="[m"}if(out){main+=(y>0?"\n":"")+out}}main=main.replace(/(?:\s*\x1b\[40m\s*\x1b\[m\s*)*$/,"")+"\n";if(term){this.dattr=sdattr}return main};Screen.prototype._getPos=function(){return this};var angles={"┘":true,"┐":true,"┌":true,"└":true,"┼":true,"├":true,"┤":true,"┴":true,"┬":true,"│":true,"─":true};var langles={"┌":true,"└":true,"┼":true,"├":true,"┴":true,"┬":true,"─":true};var uangles={"┐":true,"┌":true,"┼":true,"├":true,"┤":true,"┬":true,"│":true};var rangles={"┘":true,"┐":true,"┼":true,"┤":true,"┴":true,"┬":true,"─":true};var dangles={"┘":true,"└":true,"┼":true,"├":true,"┤":true,"┴":true,"│":true};var angleTable={"0000":"","0001":"│","0010":"─","0011":"┌","0100":"│","0101":"│","0110":"└","0111":"├",1000:"─",1001:"┐",1010:"─",1011:"┬",1100:"┘",1101:"┤",1110:"┴",1111:"┼"};Object.keys(angleTable).forEach(function(key){angleTable[parseInt(key,2)]=angleTable[key];delete angleTable[key]});module.exports=Screen}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../colors":59,"../helpers":62,"../program":64,"../unicode":66,"./box":70,"./element":73,"./log":84,"./node":86,_process:30,child_process:1,fs:1,path:28}],94:[function(require,module,exports){var Node=require("./node");var Box=require("./box");function ScrollableBox(options){var self=this;if(!(this instanceof Node)){return new ScrollableBox(options)}options=options||{};Box.call(this,options);if(options.scrollable===false){return this}this.scrollable=true;this.childOffset=0;this.childBase=0;this.baseLimit=options.baseLimit||Infinity;this.alwaysScroll=options.alwaysScroll;this.scrollbar=options.scrollbar;if(this.scrollbar){this.scrollbar.ch=this.scrollbar.ch||" ";this.style.scrollbar=this.style.scrollbar||this.scrollbar.style;if(!this.style.scrollbar){this.style.scrollbar={};this.style.scrollbar.fg=this.scrollbar.fg;this.style.scrollbar.bg=this.scrollbar.bg;this.style.scrollbar.bold=this.scrollbar.bold;this.style.scrollbar.underline=this.scrollbar.underline;this.style.scrollbar.inverse=this.scrollbar.inverse;this.style.scrollbar.invisible=this.scrollbar.invisible}if(this.track||this.scrollbar.track){this.track=this.scrollbar.track||this.track;this.style.track=this.style.scrollbar.track||this.style.track;this.track.ch=this.track.ch||" ";this.style.track=this.style.track||this.track.style;if(!this.style.track){this.style.track={};this.style.track.fg=this.track.fg;this.style.track.bg=this.track.bg;this.style.track.bold=this.track.bold;this.style.track.underline=this.track.underline;this.style.track.inverse=this.track.inverse;this.style.track.invisible=this.track.invisible}this.track.style=this.style.track}if(options.mouse){this.on("mousedown",function(data){if(self._scrollingBar){delete self.screen._dragging;delete self._drag;return}var x=data.x-self.aleft;var y=data.y-self.atop;if(x===self.width-self.iright-1){delete self.screen._dragging;delete self._drag;var perc=(y-self.itop)/(self.height-self.iheight);self.setScrollPerc(perc*100|0);self.screen.render();var smd,smu;self._scrollingBar=true;self.onScreenEvent("mousedown",smd=function(data){var y=data.y-self.atop;var perc=y/self.height;self.setScrollPerc(perc*100|0);self.screen.render()});self.onScreenEvent("mouseup",smu=function(){self._scrollingBar=false;self.removeScreenEvent("mousedown",smd);self.removeScreenEvent("mouseup",smu)})}})}}if(options.mouse){this.on("wheeldown",function(){self.scroll(self.height/2|0||1);self.screen.render()});this.on("wheelup",function(){self.scroll(-(self.height/2|0)||-1);self.screen.render()})}if(options.keys&&!options.ignoreKeys){this.on("keypress",function(ch,key){if(key.name==="up"||options.vi&&key.name==="k"){self.scroll(-1);self.screen.render();return}if(key.name==="down"||options.vi&&key.name==="j"){self.scroll(1);self.screen.render();return}if(options.vi&&key.name==="u"&&key.ctrl){self.scroll(-(self.height/2|0)||-1);self.screen.render();return}if(options.vi&&key.name==="d"&&key.ctrl){self.scroll(self.height/2|0||1);self.screen.render();return}if(options.vi&&key.name==="b"&&key.ctrl){self.scroll(-self.height||-1);self.screen.render();return}if(options.vi&&key.name==="f"&&key.ctrl){self.scroll(self.height||1);self.screen.render();return}if(options.vi&&key.name==="g"&&!key.shift){self.scrollTo(0);self.screen.render();return}if(options.vi&&key.name==="g"&&key.shift){self.scrollTo(self.getScrollHeight());self.screen.render();return}})}this.on("parsed content",function(){self._recalculateIndex()});self._recalculateIndex()}ScrollableBox.prototype.__proto__=Box.prototype;ScrollableBox.prototype.type="scrollable-box";ScrollableBox.prototype.__defineGetter__("reallyScrollable",function(){if(this.shrink)return this.scrollable;return this.getScrollHeight()>this.height});ScrollableBox.prototype._scrollBottom=function(){if(!this.scrollable)return 0;if(this._isList){return this.items?this.items.length:0}if(this.lpos&&this.lpos._scrollBottom){return this.lpos._scrollBottom}var bottom=this.children.reduce(function(current,el){if(!el.detached){var lpos=el._getCoords(false,true);if(lpos){return Math.max(current,el.rtop+(lpos.yl-lpos.yi))}}return Math.max(current,el.rtop+el.height)},0);if(this.lpos)this.lpos._scrollBottom=bottom;return bottom};ScrollableBox.prototype.setScroll=ScrollableBox.prototype.scrollTo=function(offset,always){this.scroll(0);return this.scroll(offset-(this.childBase+this.childOffset),always)};ScrollableBox.prototype.getScroll=function(){return this.childBase+this.childOffset};ScrollableBox.prototype.scroll=function(offset,always){if(!this.scrollable)return;if(this.detached)return;var visible=this.height-this.iheight,base=this.childBase,d,p,t,b,max,emax;if(this.alwaysScroll||always){this.childOffset=offset>0?visible-1+offset:offset}else{this.childOffset+=offset}if(this.childOffset>visible-1){d=this.childOffset-(visible-1);this.childOffset-=d;this.childBase+=d}else if(this.childOffset<0){d=this.childOffset;this.childOffset+=-d;this.childBase+=d}if(this.childBase<0){this.childBase=0}else if(this.childBase>this.baseLimit){this.childBase=this.baseLimit}if(this.childBase===base){return this.emit("scroll")}this.parseContent();max=this._clines.length-(this.height-this.iheight);if(max<0)max=0;emax=this._scrollBottom()-(this.height-this.iheight);if(emax<0)emax=0;this.childBase=Math.min(this.childBase,Math.max(emax,max));if(this.childBase<0){this.childBase=0}else if(this.childBase>this.baseLimit){this.childBase=this.baseLimit}p=this.lpos;if(p&&this.childBase!==base&&this.screen.cleanSides(this)){t=p.yi+this.itop;b=p.yl-this.ibottom-1;d=this.childBase-base;if(d>0&&d<visible){this.screen.deleteLine(d,t,t,b)}else if(d<0&&-d<visible){d=-d;this.screen.insertLine(d,t,t,b)}}return this.emit("scroll")};ScrollableBox.prototype._recalculateIndex=function(){var max,emax;if(this.detached||!this.scrollable){return 0}max=this._clines.length-(this.height-this.iheight);if(max<0)max=0;emax=this._scrollBottom()-(this.height-this.iheight);if(emax<0)emax=0;this.childBase=Math.min(this.childBase,Math.max(emax,max));if(this.childBase<0){this.childBase=0}else if(this.childBase>this.baseLimit){this.childBase=this.baseLimit}};ScrollableBox.prototype.resetScroll=function(){if(!this.scrollable)return;this.childOffset=0;this.childBase=0;return this.emit("scroll")};ScrollableBox.prototype.getScrollHeight=function(){return Math.max(this._clines.length,this._scrollBottom())};ScrollableBox.prototype.getScrollPerc=function(s){var pos=this.lpos||this._getCoords();if(!pos)return s?-1:0;var height=pos.yl-pos.yi-this.iheight,i=this.getScrollHeight(),p;if(height<i){if(this.alwaysScroll){p=this.childBase/(i-height)}else{p=(this.childBase+this.childOffset)/(i-1)}return p*100}return s?-1:0};ScrollableBox.prototype.setScrollPerc=function(i){var m=Math.max(this._clines.length,this._scrollBottom());return this.scrollTo(i/100*m|0)};module.exports=ScrollableBox},{"./box":70,"./node":86}],95:[function(require,module,exports){var Node=require("./node");var ScrollableBox=require("./scrollablebox");function ScrollableText(options){if(!(this instanceof Node)){return new ScrollableText(options)}options=options||{};options.alwaysScroll=true;ScrollableBox.call(this,options)}ScrollableText.prototype.__proto__=ScrollableBox.prototype;ScrollableText.prototype.type="scrollable-text";module.exports=ScrollableText},{"./node":86,"./scrollablebox":94}],96:[function(require,module,exports){var Node=require("./node");var Box=require("./box");function Table(options){var self=this;if(!(this instanceof Node)){return new Table(options)}options=options||{};options.shrink=true;options.style=options.style||{};options.style.border=options.style.border||{};options.style.header=options.style.header||{};options.style.cell=options.style.cell||{};options.align=options.align||"center";delete options.height;Box.call(this,options);this.pad=options.pad!=null?options.pad:2;this.setData(options.rows||options.data);this.on("attach",function(){self.setContent("");self.setData(self.rows)});this.on("resize",function(){self.setContent("");self.setData(self.rows);self.screen.render()})}Table.prototype.__proto__=Box.prototype;Table.prototype.type="table";Table.prototype._calculateMaxes=function(){var self=this;var maxes=[];if(this.detached)return;this.rows=this.rows||[];this.rows.forEach(function(row){row.forEach(function(cell,i){var clen=self.strWidth(cell);if(!maxes[i]||maxes[i]<clen){maxes[i]=clen}})});var total=maxes.reduce(function(total,max){return total+max},0);total+=maxes.length+1;if(this.width<total){delete this.position.width}if(this.position.width!=null){var missing=this.width-total;var w=missing/maxes.length|0;var wr=missing%maxes.length;maxes=maxes.map(function(max,i){if(i===maxes.length-1){return max+w+wr}return max+w})}else{maxes=maxes.map(function(max){return max+self.pad})}return this._maxes=maxes};Table.prototype.setRows=Table.prototype.setData=function(rows){var self=this,text="",align=this.align;this.rows=rows||[];this._calculateMaxes();if(!this._maxes)return;this.rows.forEach(function(row,i){var isFooter=i===self.rows.length-1;row.forEach(function(cell,i){var width=self._maxes[i];var clen=self.strWidth(cell);if(i!==0){text+=" "}while(clen<width){if(align==="center"){cell=" "+cell+" ";clen+=2}else if(align==="left"){cell=cell+" ";clen+=1}else if(align==="right"){cell=" "+cell;clen+=1}}if(clen>width){if(align==="center"){cell=cell.substring(1);clen--}else if(align==="left"){cell=cell.slice(0,-1);clen--}else if(align==="right"){cell=cell.substring(1);clen--}}text+=cell});if(!isFooter){text+="\n\n"}});delete this.align;this.setContent(text);this.align=align};Table.prototype.render=function(){var self=this;var coords=this._render();if(!coords)return;this._calculateMaxes();if(!this._maxes)return coords;var lines=this.screen.lines,xi=coords.xi,yi=coords.yi,rx,ry,i;var dattr=this.sattr(this.style),hattr=this.sattr(this.style.header),cattr=this.sattr(this.style.cell),battr=this.sattr(this.style.border);var width=coords.xl-coords.xi-this.iright,height=coords.yl-coords.yi-this.ibottom;for(var y=this.itop;y<height;y++){if(!lines[yi+y])break;for(var x=this.ileft;x<width;x++){if(!lines[yi+y][xi+x])break;if(lines[yi+y][xi+x][0]!==dattr)continue;if(y===this.itop){lines[yi+y][xi+x][0]=hattr}else{lines[yi+y][xi+x][0]=cattr}lines[yi+y].dirty=true}}if(!this.border||this.options.noCellBorders)return coords;ry=0;for(i=0;i<self.rows.length+1;i++){if(!lines[yi+ry])break;rx=0;self._maxes.forEach(function(max,i){rx+=max;if(i===0){if(!lines[yi+ry][xi+0])return;if(ry===0){lines[yi+ry][xi+0][0]=battr}else if(ry/2===self.rows.length){lines[yi+ry][xi+0][0]=battr}else{lines[yi+ry][xi+0][0]=battr;lines[yi+ry][xi+0][1]="├";if(!self.border.left){lines[yi+ry][xi+0][1]="─"}}lines[yi+ry].dirty=true}else if(i===self._maxes.length-1){if(!lines[yi+ry][xi+rx+1])return;if(ry===0){rx++;lines[yi+ry][xi+rx][0]=battr}else if(ry/2===self.rows.length){rx++;lines[yi+ry][xi+rx][0]=battr}else{rx++;lines[yi+ry][xi+rx][0]=battr;lines[yi+ry][xi+rx][1]="┤";if(!self.border.right){lines[yi+ry][xi+rx][1]="─"}}lines[yi+ry].dirty=true;return}if(!lines[yi+ry][xi+rx+1])return;if(ry===0){rx++;lines[yi+ry][xi+rx][0]=battr;lines[yi+ry][xi+rx][1]="┬";if(!self.border.top){lines[yi+ry][xi+rx][1]="│"}}else if(ry/2===self.rows.length){rx++;lines[yi+ry][xi+rx][0]=battr;lines[yi+ry][xi+rx][1]="┴";if(!self.border.bottom){lines[yi+ry][xi+rx][1]="│"}}else{if(self.options.fillCellBorders){var lbg=(ry<=2?hattr:cattr)&511;rx++;lines[yi+ry][xi+rx][0]=battr&~511|lbg}else{rx++;lines[yi+ry][xi+rx][0]=battr}lines[yi+ry][xi+rx][1]="┼"}lines[yi+ry].dirty=true});ry+=2}for(ry=1;ry<self.rows.length*2;ry++){if(!lines[yi+ry])break;rx=0;self._maxes.slice(0,-1).forEach(function(max){rx+=max;if(!lines[yi+ry][xi+rx+1])return;if(ry%2!==0){if(self.options.fillCellBorders){var lbg=(ry<=2?hattr:cattr)&511;rx++;lines[yi+ry][xi+rx][0]=battr&~511|lbg}else{rx++;lines[yi+ry][xi+rx][0]=battr}lines[yi+ry][xi+rx][1]="│";lines[yi+ry].dirty=true}else{rx++}});rx=1;self._maxes.forEach(function(max){while(max--){if(ry%2===0){if(!lines[yi+ry])break;if(!lines[yi+ry][xi+rx+1])break;if(self.options.fillCellBorders){var lbg=(ry<=2?hattr:cattr)&511;lines[yi+ry][xi+rx][0]=battr&~511|lbg}else{lines[yi+ry][xi+rx][0]=battr}lines[yi+ry][xi+rx][1]="─";lines[yi+ry].dirty=true}rx++}rx++})}return coords};module.exports=Table},{"./box":70,"./node":86}],97:[function(require,module,exports){(function(Buffer,process,global){var nextTick=global.setImmediate||process.nextTick.bind(process);var Node=require("./node");var Box=require("./box");function Terminal(options){if(!(this instanceof Node)){return new Terminal(options)}options=options||{};options.scrollable=false;Box.call(this,options);if(this.screen.program.tmux&&this.screen.program.tmuxVersion>=2){this.screen.program.enableMouse()}this.handler=options.handler;this.shell=options.shell||process.env.SHELL||"sh";this.args=options.args||[];this.cursor=this.options.cursor;this.cursorBlink=this.options.cursorBlink;this.screenKeys=this.options.screenKeys;this.style=this.style||{};this.style.bg=this.style.bg||"default";this.style.fg=this.style.fg||"default";this.termName=options.terminal||options.term||process.env.TERM||"xterm";this.bootstrap()}Terminal.prototype.__proto__=Box.prototype;Terminal.prototype.type="terminal";Terminal.prototype.bootstrap=function(){var self=this;var element={get document(){return element},navigator:{userAgent:"node.js"},get defaultView(){return element},get documentElement(){return element},createElement:function(){return element},get ownerDocument(){return element},addEventListener:function(){},removeEventListener:function(){},getElementsByTagName:function(){return[element]},getElementById:function(){return element},parentNode:null,offsetParent:null,appendChild:function(){},removeChild:function(){},setAttribute:function(){},getAttribute:function(){},style:{},focus:function(){},blur:function(){},console:console};element.parentNode=element;element.offsetParent=element;this.term=require("term.js")({termName:this.termName,cols:this.width-this.iwidth,rows:this.height-this.iheight,context:element,document:element,body:element,parent:element,cursorBlink:this.cursorBlink,screenKeys:this.screenKeys});this.term.refresh=function(){self.screen.render()};this.term.keyDown=function(){};this.term.keyPress=function(){};this.term.open(element);this.screen.program.input.on("data",this._onData=function(data){if(self.screen.focused===self&&!self._isMouse(data)){self.handler(data)}});this.onScreenEvent("mouse",function(data){if(self.screen.focused!==self)return;if(data.x<self.aleft+self.ileft)return;if(data.y<self.atop+self.itop)return;if(data.x>self.aleft-self.ileft+self.width)return;if(data.y>self.atop-self.itop+self.height)return;if(self.term.x10Mouse||self.term.vt200Mouse||self.term.normalMouse||self.term.mouseEvents||self.term.utfMouse||self.term.sgrMouse||self.term.urxvtMouse){}else{return}var b=data.raw[0],x=data.x-self.aleft,y=data.y-self.atop,s;if(self.term.urxvtMouse){if(self.screen.program.sgrMouse){b+=32}s="["+b+";"+(x+32)+";"+(y+32)+"M"}else if(self.term.sgrMouse){if(!self.screen.program.sgrMouse){b-=32}s="[<"+b+";"+x+";"+y+(data.action==="mousedown"?"M":"m")}else{if(self.screen.program.sgrMouse){b+=32}s="[M"+String.fromCharCode(b)+String.fromCharCode(x+32)+String.fromCharCode(y+32)}self.handler(s)});this.on("focus",function(){self.term.focus()});this.on("blur",function(){self.term.blur()});this.term.on("title",function(title){self.title=title;self.emit("title",title)});this.term.on("passthrough",function(data){self.screen.program.flush();self.screen.program._owrite(data)});this.on("resize",function(){nextTick(function(){self.term.resize(self.width-self.iwidth,self.height-self.iheight)})});this.once("render",function(){self.term.resize(self.width-self.iwidth,self.height-self.iheight)});this.on("destroy",function(){self.kill();self.screen.program.input.removeListener("data",self._onData)});if(this.handler){return}this.pty=require("pty.js").fork(this.shell,this.args,{name:this.termName,cols:this.width-this.iwidth,rows:this.height-this.iheight,cwd:process.env.HOME,env:this.options.env||process.env});this.on("resize",function(){nextTick(function(){try{self.pty.resize(self.width-self.iwidth,self.height-self.iheight)}catch(e){}})});this.handler=function(data){self.pty.write(data);self.screen.render()};this.pty.on("data",function(data){self.write(data);self.screen.render()});this.pty.on("exit",function(code){self.emit("exit",code||null)});this.onScreenEvent("keypress",function(){self.screen.render()});this.screen._listenKeys(this)};Terminal.prototype.write=function(data){return this.term.write(data)};Terminal.prototype.render=function(){var ret=this._render();if(!ret)return;this.dattr=this.sattr(this.style);var xi=ret.xi+this.ileft,xl=ret.xl-this.iright,yi=ret.yi+this.itop,yl=ret.yl-this.ibottom,cursor;var scrollback=this.term.lines.length-(yl-yi);for(var y=Math.max(yi,0);y<yl;y++){var line=this.screen.lines[y];if(!line||!this.term.lines[scrollback+y-yi])break;if(y===yi+this.term.y&&this.term.cursorState&&this.screen.focused===this&&(this.term.ydisp===this.term.ybase||this.term.selectMode)&&!this.term.cursorHidden){cursor=xi+this.term.x}else{cursor=-1}for(var x=Math.max(xi,0);x<xl;x++){if(!line[x]||!this.term.lines[scrollback+y-yi][x-xi])break;line[x][0]=this.term.lines[scrollback+y-yi][x-xi][0];if(x===cursor){if(this.cursor==="line"){line[x][0]=this.dattr;line[x][1]="│";continue}else if(this.cursor==="underline"){line[x][0]=this.dattr|2<<18}else if(this.cursor==="block"||!this.cursor){line[x][0]=this.dattr|8<<18}}line[x][1]=this.term.lines[scrollback+y-yi][x-xi][1];if((line[x][0]>>9&511)===257){line[x][0]&=~(511<<9);line[x][0]|=(this.dattr>>9&511)<<9}if((line[x][0]&511)===256){line[x][0]&=~511;line[x][0]|=this.dattr&511}}line.dirty=true}return ret};Terminal.prototype._isMouse=function(buf){var s=buf;if(Buffer.isBuffer(s)){if(s[0]>127&&s[1]===undefined){s[0]-=128;s=""+s.toString("utf-8")}else{s=s.toString("utf-8")}}return buf[0]===27&&buf[1]===91&&buf[2]===77||/^\x1b\[M([\x00\u0020-\uffff]{3})/.test(s)||/^\x1b\[(\d+;\d+;\d+)M/.test(s)||/^\x1b\[<(\d+;\d+;\d+)([mM])/.test(s)||/^\x1b\[<(\d+;\d+;\d+;\d+)&w/.test(s)||/^\x1b\[24([0135])~\[(\d+),(\d+)\]\r/.test(s)||/^\x1b\[(O|I)/.test(s)};Terminal.prototype.setScroll=Terminal.prototype.scrollTo=function(offset){this.term.ydisp=offset;return this.emit("scroll")};Terminal.prototype.getScroll=function(){return this.term.ydisp};Terminal.prototype.scroll=function(offset){this.term.scrollDisp(offset);return this.emit("scroll")};Terminal.prototype.resetScroll=function(){this.term.ydisp=0;this.term.ybase=0;return this.emit("scroll")};Terminal.prototype.getScrollHeight=function(){return this.term.rows-1};Terminal.prototype.getScrollPerc=function(){return this.term.ydisp/this.term.ybase*100};Terminal.prototype.setScrollPerc=function(i){return this.setScroll(i/100*this.term.ybase|0)};Terminal.prototype.screenshot=function(xi,xl,yi,yl){xi=0+(xi||0);if(xl!=null){xl=0+(xl||0)}else{xl=this.term.lines[0].length}yi=0+(yi||0);if(yl!=null){yl=0+(yl||0)}else{yl=this.term.lines.length}return this.screen.screenshot(xi,xl,yi,yl,this.term)};Terminal.prototype.kill=function(){if(this.pty){this.pty.destroy();this.pty.kill()}this.term.refresh=function(){};this.term.write("[H[J");if(this.term._blink){clearInterval(this.term._blink)}this.term.destroy()};module.exports=Terminal}).call(this,{isBuffer:require("../../../../../../.npm-prefix/lib/node_modules/browserify/node_modules/is-buffer/index.js")},require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../../../../../../.npm-prefix/lib/node_modules/browserify/node_modules/is-buffer/index.js":15,"./box":70,"./node":86,_process:30,"pty.js":106,"term.js":103}],98:[function(require,module,exports){var Node=require("./node");var Element=require("./element");function Text(options){if(!(this instanceof Node)){return new Text(options)}options=options||{};options.shrink=true;Element.call(this,options)}Text.prototype.__proto__=Element.prototype;Text.prototype.type="text";module.exports=Text},{"./element":73,"./node":86}],99:[function(require,module,exports){(function(process,global){var unicode=require("../unicode");var nextTick=global.setImmediate||process.nextTick.bind(process);var Node=require("./node");var Input=require("./input");function Textarea(options){var self=this;if(!(this instanceof Node)){return new Textarea(options)}options=options||{};options.scrollable=options.scrollable!==false;Input.call(this,options);this.screen._listenKeys(this);this.value=options.value||"";this.__updateCursor=this._updateCursor.bind(this);this.on("resize",this.__updateCursor);this.on("move",this.__updateCursor);if(options.inputOnFocus){this.on("focus",this.readInput.bind(this,null))}if(!options.inputOnFocus&&options.keys){this.on("keypress",function(ch,key){if(self._reading)return;if(key.name==="enter"||options.vi&&key.name==="i"){return self.readInput()}if(key.name==="e"){return self.readEditor()}})}if(options.mouse){this.on("click",function(data){if(self._reading)return;if(data.button!=="right")return;self.readEditor()})}}Textarea.prototype.__proto__=Input.prototype;Textarea.prototype.type="textarea";Textarea.prototype._updateCursor=function(get){if(this.screen.focused!==this){return}var lpos=get?this.lpos:this._getCoords();if(!lpos)return;var last=this._clines[this._clines.length-1],program=this.screen.program,line,cx,cy;if(last===""&&this.value[this.value.length-1]!=="\n"){last=this._clines[this._clines.length-2]||""}line=Math.min(this._clines.length-1-(this.childBase||0),lpos.yl-lpos.yi-this.iheight-1);line=Math.max(0,line);cy=lpos.yi+this.itop+line;cx=lpos.xi+this.ileft+this.strWidth(last);if(cy===program.y&&cx===program.x){return}if(cy===program.y){if(cx>program.x){program.cuf(cx-program.x)}else if(cx<program.x){program.cub(program.x-cx)}}else if(cx===program.x){if(cy>program.y){program.cud(cy-program.y)}else if(cy<program.y){program.cuu(program.y-cy)}}else{program.cup(cy,cx)}};Textarea.prototype.input=Textarea.prototype.setInput=Textarea.prototype.readInput=function(callback){var self=this,focused=this.screen.focused===this;if(this._reading)return;this._reading=true;this._callback=callback;if(!focused){this.screen.saveFocus();this.focus()}this.screen.grabKeys=true;this._updateCursor();this.screen.program.showCursor();this._done=function fn(err,value){if(!self._reading)return;if(fn.done)return;fn.done=true;self._reading=false;delete self._callback;delete self._done;self.removeListener("keypress",self.__listener);delete self.__listener;self.removeListener("blur",self.__done);delete self.__done;self.screen.program.hideCursor();self.screen.grabKeys=false;if(!focused){self.screen.restoreFocus()}if(self.options.inputOnFocus){self.screen.rewindFocus()}if(err==="stop")return;if(err){self.emit("error",err)}else if(value!=null){self.emit("submit",value)}else{self.emit("cancel",value)}self.emit("action",value);if(!callback)return;return err?callback(err):callback(null,value)};nextTick(function(){self.__listener=self._listener.bind(self);self.on("keypress",self.__listener)});this.__done=this._done.bind(this,null,null);this.on("blur",this.__done)};Textarea.prototype._listener=function(ch,key){var done=this._done,value=this.value;if(key.name==="return")return;if(key.name==="enter"){ch="\n"}if(key.name==="left"||key.name==="right"||key.name==="up"||key.name==="down"){}if(this.options.keys&&key.ctrl&&key.name==="e"){return this.readEditor()}if(key.name==="escape"){done(null,null)}else if(key.name==="backspace"){if(this.value.length){if(this.screen.fullUnicode){if(unicode.isSurrogate(this.value,this.value.length-2)){this.value=this.value.slice(0,-2)}else{this.value=this.value.slice(0,-1)}}else{this.value=this.value.slice(0,-1)}}}else if(ch){if(!/^[\x00-\x08\x0b-\x0c\x0e-\x1f\x7f]$/.test(ch)){this.value+=ch}}if(this.value!==value){this.screen.render()}};Textarea.prototype._typeScroll=function(){var height=this.height-this.iheight;if(this._clines.length-this.childBase>height){this.scroll(this._clines.length)}};Textarea.prototype.getValue=function(){return this.value};Textarea.prototype.setValue=function(value){if(value==null){value=this.value}if(this._value!==value){this.value=value;this._value=value;this.setContent(this.value);this._typeScroll();this._updateCursor()}};Textarea.prototype.clearInput=Textarea.prototype.clearValue=function(){return this.setValue("")};Textarea.prototype.submit=function(){if(!this.__listener)return;return this.__listener("",{name:"escape"})};Textarea.prototype.cancel=function(){if(!this.__listener)return;return this.__listener("",{name:"escape"})};Textarea.prototype.render=function(){this.setValue();return this._render()};Textarea.prototype.editor=Textarea.prototype.setEditor=Textarea.prototype.readEditor=function(callback){var self=this;if(this._reading){var _cb=this._callback,cb=callback;this._done("stop");callback=function(err,value){if(_cb)_cb(err,value);if(cb)cb(err,value)}}if(!callback){callback=function(){}}return this.screen.readEditor({value:this.value},function(err,value){if(err){if(err.message==="Unsuccessful."){self.screen.render();return self.readInput(callback)}self.screen.render();self.readInput(callback);return callback(err)}self.setValue(value);self.screen.render();return self.readInput(callback)})};module.exports=Textarea}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../unicode":66,"./input":77,"./node":86,_process:30}],100:[function(require,module,exports){var Node=require("./node");var Textarea=require("./textarea");function Textbox(options){if(!(this instanceof Node)){return new Textbox(options)}options=options||{};options.scrollable=false;Textarea.call(this,options);this.secret=options.secret;this.censor=options.censor}Textbox.prototype.__proto__=Textarea.prototype;Textbox.prototype.type="textbox";Textbox.prototype.__olistener=Textbox.prototype._listener;Textbox.prototype._listener=function(ch,key){if(key.name==="enter"){this._done(null,this.value);return}return this.__olistener(ch,key)};Textbox.prototype.setValue=function(value){var visible,val;if(value==null){value=this.value}if(this._value!==value){value=value.replace(/\n/g,"");this.value=value;this._value=value;if(this.secret){this.setContent("")}else if(this.censor){this.setContent(Array(this.value.length+1).join("*"))}else{visible=-(this.width-this.iwidth-1);val=this.value.replace(/\t/g,this.screen.tabc);this.setContent(val.slice(visible))}this._updateCursor()}};Textbox.prototype.submit=function(){if(!this.__listener)return;return this.__listener("\r",{name:"enter"})};module.exports=Textbox},{"./node":86,"./textarea":99}],101:[function(require,module,exports){(function(process){var cp=require("child_process");var Node=require("./node");var Box=require("./box");var Terminal=require("./terminal");function Video(options){var self=this,shell,args;if(!(this instanceof Node)){return new Video(options)}options=options||{};Box.call(this,options);if(this.exists("mplayer")){shell="mplayer";args=["-vo","caca","-quiet",options.file]}else if(this.exists("mpv")){shell="mpv";args=["--vo","caca","--really-quiet",options.file]}else{this.parseTags=true;this.setContent("{red-fg}{bold}Error:{/bold}"+" mplayer or mpv not installed.{/red-fg}");return this}var opts={parent:this,left:0,top:0,width:this.width-this.iwidth,height:this.height-this.iheight,shell:shell,args:args.slice()};this.now=Date.now()/1e3|0;this.start=opts.start||0;if(this.start){if(shell==="mplayer"){opts.args.unshift("-ss",this.start+"")}else if(shell==="mpv"){opts.args.unshift("--start",this.start+"")}}var DISPLAY=process.env.DISPLAY;delete process.env.DISPLAY;this.tty=new Terminal(opts);process.env.DISPLAY=DISPLAY;this.on("click",function(){self.tty.pty.write("p")});this.on("resize",function(){self.tty.destroy();var opts={parent:self,left:0,top:0,width:self.width-self.iwidth,height:self.height-self.iheight,shell:shell,args:args.slice()};var watched=(Date.now()/1e3|0)-self.now;self.now=Date.now()/1e3|0;self.start+=watched;if(shell==="mplayer"){opts.args.unshift("-ss",self.start+"")}else if(shell==="mpv"){opts.args.unshift("--start",self.start+"")}var DISPLAY=process.env.DISPLAY;delete process.env.DISPLAY;self.tty=new Terminal(opts);process.env.DISPLAY=DISPLAY;self.screen.render()})}Video.prototype.__proto__=Box.prototype;Video.prototype.type="video";Video.prototype.exists=function(program){try{return!!+cp.execSync("type "+program+" > /dev/null 2> /dev/null"+" && echo 1",{encoding:"utf8"}).trim()}catch(e){return false}};module.exports=Video}).call(this,require("_process"))},{"./box":70,"./node":86,"./terminal":97,_process:30,child_process:1}],102:[function(require,module,exports){(function(process,Buffer,setImmediate){var fs=require("fs"),util=require("util"),path=require("path"),zlib=require("zlib"),assert=require("assert"),cp=require("child_process"),exec=cp.execFileSync;function PNG(file,options){var buf,chunks,idat,pixels;if(!(this instanceof PNG)){return new PNG(file,options)}if(!file)throw new Error("no file");this.options=options||{};this.colors=options.colors||require("blessed/lib/colors");this.optimization=this.options.optimization||"mem";this.speed=this.options.speed||1;if(Buffer.isBuffer(file)){this.file=this.options.filename||null;buf=file}else{this.options.filename=file;this.file=path.resolve(process.cwd(),file);buf=fs.readFileSync(this.file)}this.format=buf.readUInt32BE(0)===2303741511?"png":buf.slice(0,3).toString("ascii")==="GIF"?"gif":buf.readUInt16BE(0)===65496?"jpg":path.extname(this.file).slice(1).toLowerCase()||"png";if(this.format!=="png"){try{return this.toPNG(buf)}catch(e){throw e}}chunks=this.parseRaw(buf);idat=this.parseChunks(chunks);pixels=this.parseLines(idat);this.bmp=this.createBitmap(pixels);this.cellmap=this.createCellmap(this.bmp);this.frames=this.compileFrames(this.frames)}PNG.prototype.parseRaw=function(buf){var chunks=[],index=0,i=0,buf,len,type,name,data,crc,check,critical,public_,conforming,copysafe,pos;this._debug(this.file);if(buf.readUInt32BE(0)!==2303741511||buf.readUInt32BE(4)!==218765834){throw new Error("bad header")}i+=8;while(i<buf.length){try{len=buf.readUInt32BE(i);i+=4;pos=i;type=buf.slice(i,i+4);name=type.toString("ascii");i+=4;data=buf.slice(i,i+len);i+=len;check=this.crc32(buf.slice(pos,i));crc=buf.readInt32BE(i);i+=4;critical=!!(~type[0]&32);public_=!!(~type[1]&32);conforming=!!(~type[2]&32);copysafe=!!(~type[3]&32);if(crc!==check){throw new Error(name+": bad crc")}}catch(e){if(this.options.debug)throw e;break}chunks.push({index:index++,id:name.toLowerCase(),len:len,pos:pos,end:i,type:type,name:name,data:data,crc:crc,check:check,raw:buf.slice(pos,i),flags:{critical:critical,public_:public_,conforming:conforming,copysafe:copysafe}})}return chunks};PNG.prototype.parseChunks=function(chunks){var i,chunk,name,data,p,idat,info;for(i=0;i<chunks.length;i++){chunk=chunks[i];name=chunk.id;data=chunk.data;info={};switch(name){case"ihdr":{this.width=info.width=data.readUInt32BE(0);this.height=info.height=data.readUInt32BE(4);this.bitDepth=info.bitDepth=data.readUInt8(8);this.colorType=info.colorType=data.readUInt8(9);this.compression=info.compression=data.readUInt8(10);this.filter=info.filter=data.readUInt8(11);this.interlace=info.interlace=data.readUInt8(12);switch(this.bitDepth){case 1:case 2:case 4:case 8:case 16:case 24:case 32:break;default:throw new Error("bad bit depth: "+this.bitDepth)}switch(this.colorType){case 0:case 2:case 3:case 4:case 6:break;default:throw new Error("bad color: "+this.colorType)}switch(this.compression){case 0:break;default:throw new Error("bad compression: "+this.compression)}switch(this.filter){case 0:case 1:case 2:case 3:case 4:break;default:throw new Error("bad filter: "+this.filter)}switch(this.interlace){case 0:case 1:break;default:throw new Error("bad interlace: "+this.interlace)}break}case"plte":{this.palette=info.palette=[];for(p=0;p<data.length;p+=3){this.palette.push({r:data[p+0],g:data[p+1],b:data[p+2],a:255})}break}case"idat":{this.size=this.size||0;this.size+=data.length;this.idat=this.idat||[];this.idat.push(data);info.size=data.length;break}case"iend":{this.end=true;break}case"trns":{this.alpha=info.alpha=Array.prototype.slice.call(data);if(this.palette){for(p=0;p<data.length;p++){if(!this.palette[p])break;this.palette[p].a=data[p]}}break}case"actl":{this.actl=info={};this.frames=[];this.actl.numFrames=data.readUInt32BE(0);this.actl.numPlays=data.readUInt32BE(4);break}case"fctl":{if(!this.idat){this.idat=[];this.frames.push({idat:true,fctl:info,fdat:this.idat})}else{this.frames.push({fctl:info,fdat:[]})}info.sequenceNumber=data.readUInt32BE(0);info.width=data.readUInt32BE(4);info.height=data.readUInt32BE(8);info.xOffset=data.readUInt32BE(12);info.yOffset=data.readUInt32BE(16);info.delayNum=data.readUInt16BE(20);info.delayDen=data.readUInt16BE(22);info.disposeOp=data.readUInt8(24);info.blendOp=data.readUInt8(25);break}case"fdat":{info.sequenceNumber=data.readUInt32BE(0);info.data=data.slice(4);this.frames[this.frames.length-1].fdat.push(info.data);break}}chunk.info=info}this._debug(chunks);if(this.frames){this.frames=this.frames.map(function(frame,i){frame.fdat=this.decompress(frame.fdat);if(!frame.fdat.length)throw new Error("no data");return frame},this)}idat=this.decompress(this.idat);if(!idat.length)throw new Error("no data");return idat};PNG.prototype.parseLines=function(data){var pixels=[],x,p,prior,line,filter,samples,pendingSamples,ch,shiftStart,i,toShift,sample;this.sampleDepth=this.colorType===0?1:this.colorType===2?3:this.colorType===3?1:this.colorType===4?2:this.colorType===6?4:1;this.bitsPerPixel=this.bitDepth*this.sampleDepth;this.bytesPerPixel=Math.ceil(this.bitsPerPixel/8);this.wastedBits=this.width*this.bitsPerPixel/8-(this.width*this.bitsPerPixel/8|0);this.byteWidth=Math.ceil(this.width*(this.bitsPerPixel/8));this.shiftStart=this.bitDepth+(8/this.bitDepth-this.bitDepth)-1|0;this.shiftMult=this.bitDepth>=8?0:this.bitDepth;this.mask=this.bitDepth===32?4294967295:(1<<this.bitDepth)-1;if(this.interlace===1){samples=this.sampleInterlacedLines(data);for(i=0;i<samples.length;i+=this.sampleDepth){pixels.push(samples.slice(i,i+this.sampleDepth))}return pixels}for(p=0;p<data.length;p+=this.byteWidth){prior=line||[];filter=data[p++];line=data.slice(p,p+this.byteWidth);line=this.unfilterLine(filter,line,prior);samples=this.sampleLine(line);for(i=0;i<samples.length;i+=this.sampleDepth){pixels.push(samples.slice(i,i+this.sampleDepth))}}return pixels};PNG.prototype.unfilterLine=function(filter,line,prior){for(var x=0;x<line.length;x++){if(filter===0){break}else if(filter===1){line[x]=this.filters.sub(x,line,prior,this.bytesPerPixel)}else if(filter===2){line[x]=this.filters.up(x,line,prior,this.bytesPerPixel)}else if(filter===3){line[x]=this.filters.average(x,line,prior,this.bytesPerPixel)}else if(filter===4){line[x]=this.filters.paeth(x,line,prior,this.bytesPerPixel)}}return line};PNG.prototype.sampleLine=function(line,width){var samples=[],x=0,pendingSamples,ch,i,sample,shiftStart,toShift;while(x<line.length){pendingSamples=this.sampleDepth;while(pendingSamples--){ch=line[x];if(this.bitDepth===16){ch=ch<<8|line[++x]}else if(this.bitDepth===24){ch=ch<<16|line[++x]<<8|line[++x]}else if(this.bitDepth===32){ch=ch<<24|line[++x]<<16|line[++x]<<8|line[++x]}else if(this.bitDepth>32){throw new Error("bitDepth "+this.bitDepth+" unsupported.")}shiftStart=this.shiftStart;toShift=shiftStart-(x===line.length-1?this.wastedBits:0);for(i=0;i<=toShift;i++){sample=ch>>this.shiftMult*shiftStart&this.mask;if(this.colorType!==3){if(this.bitDepth<8){sample*=255/this.mask;sample|=0}else if(this.bitDepth>8){sample=sample/this.mask*255|0}}samples.push(sample);shiftStart--}x++}}if(width!=null){samples=samples.slice(0,width*this.sampleDepth)}return samples};PNG.prototype.filters={sub:function Sub(x,line,prior,bpp){if(x<bpp)return line[x];return(line[x]+line[x-bpp])%256},up:function Up(x,line,prior,bpp){return(line[x]+(prior[x]||0))%256},average:function Average(x,line,prior,bpp){if(x<bpp)return Math.floor((prior[x]||0)/2);return(line[x]+Math.floor((line[x-bpp]+prior[x])/2))%256},paeth:function Paeth(x,line,prior,bpp){if(x<bpp)return prior[x]||0;return(line[x]+this._predictor(line[x-bpp],prior[x]||0,prior[x-bpp]||0))%256},_predictor:function PaethPredictor(a,b,c){var p=a+b-c,pa=Math.abs(p-a),pb=Math.abs(p-b),pc=Math.abs(p-c);if(pa<=pb&&pa<=pc)return a;if(pb<=pc)return b;return c}};PNG.prototype.sampleInterlacedLines=function(raw){var psize,vpr,samples,source_offset,i,pass,xstart,ystart,xstep,ystep,recon,ppr,row_size,y,filter_type,scanline,flat,offset,k,end_offset,skip,j,k,f;var adam7=[[0,0,8,8],[4,0,8,8],[0,4,4,8],[2,0,4,4],[0,2,2,4],[1,0,2,2],[0,1,1,2]];psize=this.bitDepth/8*this.sampleDepth;vpr=this.width*this.sampleDepth;samples=new Buffer(vpr*this.height);samples.fill(0);source_offset=0;for(i=0;i<adam7.length;i++){pass=adam7[i];xstart=pass[0];ystart=pass[1];xstep=pass[2];ystep=pass[3];if(xstart>=this.width)continue;recon=[];ppr=Math.ceil((this.width-xstart)/xstep);row_size=Math.ceil(psize*ppr);for(y=ystart;y<this.height;y+=ystep){filter_type=raw[source_offset];source_offset+=1;scanline=raw.slice(source_offset,source_offset+row_size);source_offset+=row_size;recon=this.unfilterLine(filter_type,scanline,recon);flat=this.sampleLine(recon,ppr);if(xstep===1){assert.equal(xstart,0);offset=y*vpr;for(k=offset,f=0;k<offset+vpr;k++,f++){samples[k]=flat[f]}}else{offset=y*vpr+xstart*this.sampleDepth;end_offset=(y+1)*vpr;skip=this.sampleDepth*xstep;for(j=0;j<this.sampleDepth;j++){for(k=offset+j,f=j;k<end_offset;k+=skip,f+=this.sampleDepth){samples[k]=flat[f]}}}}}return samples};PNG.prototype.createBitmap=function(pixels){var bmp=[],i;if(this.colorType===0){pixels=pixels.map(function(sample){return{r:sample[0],g:sample[0],b:sample[0],a:255}})}else if(this.colorType===2){pixels=pixels.map(function(sample){return{r:sample[0],g:sample[1],b:sample[2],a:255}})}else if(this.colorType===3){pixels=pixels.map(function(sample){if(!this.palette[sample[0]])throw new Error("bad palette index");return this.palette[sample[0]]},this)}else if(this.colorType===4){pixels=pixels.map(function(sample){return{r:sample[0],g:sample[0],b:sample[0],a:sample[1]}})}else if(this.colorType===6){pixels=pixels.map(function(sample){return{r:sample[0],g:sample[1],b:sample[2],a:sample[3]}})}for(i=0;i<pixels.length;i+=this.width){bmp.push(pixels.slice(i,i+this.width))}return bmp};PNG.prototype.createCellmap=function(bmp,options){var bmp=bmp||this.bmp,options=options||this.options,cellmap=[],scale=options.scale||.2,height=bmp.length,width=bmp[0].length,cmwidth=options.width,cmheight=options.height,line,x,y,xx,yy,scale,xs,ys;if(cmwidth){scale=cmwidth/width}else if(cmheight){scale=cmheight/height}if(!cmheight){cmheight=Math.round(height*scale)}if(!cmwidth){cmwidth=Math.round(width*scale)}ys=height/cmheight;xs=width/cmwidth;for(y=0;y<bmp.length;y+=ys){line=[];yy=Math.round(y);if(!bmp[yy])break;for(x=0;x<bmp[yy].length;x+=xs){xx=Math.round(x);if(!bmp[yy][xx])break;line.push(bmp[yy][xx])}cellmap.push(line)}return cellmap};PNG.prototype.renderANSI=function(bmp){var self=this,out="";bmp.forEach(function(line,y){line.forEach(function(pixel,x){var outch=self.getOutch(x,y,line,pixel);out+=self.pixelToSGR(pixel,outch)});out+="\n"});return out};PNG.prototype.renderContent=function(bmp,el){var self=this,out="";bmp.forEach(function(line,y){line.forEach(function(pixel,x){var outch=self.getOutch(x,y,line,pixel);out+=self.pixelToTags(pixel,outch)});out+="\n"});el.setContent(out);return out};PNG.prototype.renderScreen=function(bmp,screen,xi,xl,yi,yl){var self=this,lines=screen.lines,cellLines,y,yy,x,xx,alpha,attr,ch;cellLines=bmp.reduce(function(cellLines,line,y){var cellLine=[];line.forEach(function(pixel,x){var outch=self.getOutch(x,y,line,pixel),cell=self.pixelToCell(pixel,outch);cellLine.push(cell)});cellLines.push(cellLine);return cellLines},[]);for(y=yi;y<yl;y++){yy=y-yi;for(x=xi;x<xl;x++){xx=x-xi;if(lines[y]&&lines[y][x]&&cellLines[yy]&&cellLines[yy][xx]){alpha=cellLines[yy][xx].pop();if(alpha===0){continue}if(alpha<1){attr=cellLines[yy][xx][0];ch=cellLines[yy][xx][1];lines[y][x][0]=this.colors.blend(lines[y][x][0],attr,alpha);if(ch!==" ")lines[y][x][1]=ch;lines[y].dirty=true;continue}lines[y][x]=cellLines[yy][xx];lines[y].dirty=true}}}};PNG.prototype.renderElement=function(bmp,el){var xi=el.aleft+el.ileft,xl=el.aleft+el.width-el.iright,yi=el.atop+el.itop,yl=el.atop+el.height-el.ibottom;return this.renderScreen(bmp,el.screen,xi,xl,yi,yl)};PNG.prototype.pixelToSGR=function(pixel,ch){var bga=1,fga=.5,a=pixel.a/255,bg,fg;bg=this.colors.match(pixel.r*a*bga|0,pixel.g*a*bga|0,pixel.b*a*bga|0);if(ch&&this.options.ascii){fg=this.colors.match(pixel.r*a*fga|0,pixel.g*a*fga|0,pixel.b*a*fga|0);if(a===0){return"[38;5;"+fg+"m"+ch+"[m"}return"[38;5;"+fg+"m[48;5;"+bg+"m"+ch+"[m"}if(a===0)return" ";return"[48;5;"+bg+"m [m"};PNG.prototype.pixelToTags=function(pixel,ch){var bga=1,fga=.5,a=pixel.a/255,bg,fg;bg=this.colors.RGBtoHex(pixel.r*a*bga|0,pixel.g*a*bga|0,pixel.b*a*bga|0);if(ch&&this.options.ascii){fg=this.colors.RGBtoHex(pixel.r*a*fga|0,pixel.g*a*fga|0,pixel.b*a*fga|0);if(a===0){return"{"+fg+"-fg}"+ch+"{/}"}return"{"+fg+"-fg}{"+bg+"-bg}"+ch+"{/}"}if(a===0)return" ";return"{"+bg+"-bg} {/"+bg+"-bg}"};PNG.prototype.pixelToCell=function(pixel,ch){var bga=1,fga=.5,a=pixel.a/255,bg,fg;bg=this.colors.match(pixel.r*bga|0,pixel.g*bga|0,pixel.b*bga|0);if(ch&&this.options.ascii){fg=this.colors.match(pixel.r*fga|0,pixel.g*fga|0,pixel.b*fga|0)}else{fg=511;ch=null}return[0<<18|fg<<9|bg<<0,ch||" ",a]};PNG.prototype.getOutch=function(){var dchars="????8@8@#8@8##8#MKXWwz$&%x><\\/xo;+=|^-:i'.`,  `.        ";var luminance=function(pixel){var a=pixel.a/255,r=pixel.r*a,g=pixel.g*a,b=pixel.b*a,l=.2126*r+.7152*g+.0722*b;return l/255};return function(x,y,line,pixel){var lumi=luminance(pixel),outch=dchars[lumi*(dchars.length-1)|0];return outch}}();PNG.prototype.compileFrames=function(frames){return this.optimization==="mem"?this.compileFrames_lomem(frames):this.compileFrames_locpu(frames)};PNG.prototype.compileFrames_lomem=function(frames){if(!this.actl)return;return frames.map(function(frame,i){this.width=frame.fctl.width;this.height=frame.fctl.height;var pixels=frame._pixels||this.parseLines(frame.fdat),bmp=frame._bmp||this.createBitmap(pixels),fc=frame.fctl;return{actl:this.actl,fctl:frame.fctl,delay:fc.delayNum/(fc.delayDen||100)*1e3|0,bmp:bmp}},this)};PNG.prototype.compileFrames_locpu=function(frames){if(!this.actl)return;this._curBmp=null;this._lastBmp=null;return frames.map(function(frame,i){this.width=frame.fctl.width;this.height=frame.fctl.height;var pixels=frame._pixels||this.parseLines(frame.fdat),bmp=frame._bmp||this.createBitmap(pixels),renderBmp=this.renderFrame(bmp,frame,i),cellmap=this.createCellmap(renderBmp),fc=frame.fctl;return{actl:this.actl,fctl:frame.fctl,delay:fc.delayNum/(fc.delayDen||100)*1e3|0,bmp:renderBmp,cellmap:cellmap}},this)};PNG.prototype.renderFrame=function(bmp,frame,i){var first=this.frames[0],last=this.frames[i-1],fc=frame.fctl,xo=fc.xOffset,yo=fc.yOffset,lxo,lyo,x,y,line,p;if(!this._curBmp){this._curBmp=[];for(y=0;y<first.fctl.height;y++){line=[];for(x=0;x<first.fctl.width;x++){p=bmp[y][x];line.push({r:p.r,g:p.g,b:p.b,a:p.a})}this._curBmp.push(line)}}if(last&&last.fctl.disposeOp!==0){lxo=last.fctl.xOffset;lyo=last.fctl.yOffset;for(y=0;y<last.fctl.height;y++){for(x=0;x<last.fctl.width;x++){if(last.fctl.disposeOp===0){}else if(last.fctl.disposeOp===1){this._curBmp[lyo+y][lxo+x]={r:0,g:0,b:0,a:0}}else if(last.fctl.disposeOp===2){p=this._lastBmp[y][x];this._curBmp[lyo+y][lxo+x]={r:p.r,g:p.g,b:p.b,a:p.a}}}}}if(frame.fctl.disposeOp===2){this._lastBmp=[];for(y=0;y<frame.fctl.height;y++){line=[];for(x=0;x<frame.fctl.width;x++){p=this._curBmp[yo+y][xo+x];line.push({r:p.r,g:p.g,b:p.b,a:p.a})}this._lastBmp.push(line)}}else{this._lastBmp=null}for(y=0;y<frame.fctl.height;y++){for(x=0;x<frame.fctl.width;x++){p=bmp[y][x];if(fc.blendOp===0){this._curBmp[yo+y][xo+x]={r:p.r,g:p.g,b:p.b,a:p.a}}else if(fc.blendOp===1){if(p.a!==0){this._curBmp[yo+y][xo+x]={r:p.r,g:p.g,b:p.b,a:p.a}}}}}return this._curBmp};PNG.prototype._animate=function(callback){if(!this.frames){return callback(this.bmp,this.cellmap)}var self=this,numPlays=this.actl.numPlays||Infinity,running=0,i=-1;this._curBmp=null;this._lastBmp=null;var next_lomem=function(){if(!running)return;var frame=self.frames[++i];if(!frame){if(!--numPlays)return callback();i=-1;self._curBmp=null;self._lastBmp=null;return setImmediate(next)}var bmp=frame.bmp,renderBmp=self.renderFrame(bmp,frame,i),cellmap=self.createCellmap(renderBmp);callback(renderBmp,cellmap);return setTimeout(next,frame.delay/self.speed|0)};var next_locpu=function(){if(!running)return;var frame=self.frames[++i];if(!frame){if(!--numPlays)return callback();i=-1;return setImmediate(next)}callback(frame.bmp,frame.cellmap);return setTimeout(next,frame.delay/self.speed|0)};var next=this.optimization==="mem"?next_lomem:next_locpu;this._control=function(state){if(state===-1){i=-1;self._curBmp=null;self._lastBmp=null;running=0;callback(self.frames[0].bmp,self.frames[0].cellmap||self.createCellmap(self.frames[0].bmp));return}if(state===running)return;running=state;return next()};this._control(1)};PNG.prototype.play=function(callback){if(!this._control||callback){this.stop();return this._animate(callback)}this._control(1)};PNG.prototype.pause=function(){if(!this._control)return;this._control(0)};PNG.prototype.stop=function(){if(!this._control)return;this._control(-1)};PNG.prototype.toPNG=function(input){var options=this.options,file=this.file,format=this.format,buf,img,gif,i,control,disposeOp;if(format!=="gif"){buf=exec("convert",[format+":-","png:-"],{stdio:["pipe","pipe","ignore"],input:input});img=PNG(buf,options);img.file=file;return img}gif=GIF(input,options);this.width=gif.width;this.height=gif.height;this.frames=[];for(i=0;i<gif.images.length;i++){img=gif.images[i];control=img.control||gif;disposeOp=Math.max(0,(control.disposeMethod||0)-1);if(disposeOp>2)disposeOp=0;this.frames.push({fctl:{sequenceNumber:i,width:img.width,height:img.height,xOffset:img.left,yOffset:img.top,delayNum:control.delay,delayDen:100,disposeOp:disposeOp,blendOp:1},fdat:[],_pixels:[],_bmp:img.bmp})}this.bmp=this.frames[0]._bmp;this.cellmap=this.createCellmap(this.bmp);if(this.frames.length>1){this.actl={numFrames:gif.images.length,numPlays:gif.numPlays||0};this.frames=this.compileFrames(this.frames)}else{this.frames=undefined}return this};PNG.prototype.gifMagick=function(input){var options=this.options,file=this.file,format=this.format,buf,fmt,img,frames,frame,width,height,iwidth,twidth,i,lines,line,x,y;buf=exec("convert",[format+":-","-coalesce","+append","png:-"],{stdio:["pipe","pipe","ignore"],input:input});fmt='{"W":%W,"H":%H,"w":%w,"h":%h,"d":%T,"x":"%X","y":"%Y"},';frames=exec("identify",["-format",fmt,format+":-"],{encoding:"utf8",stdio:["pipe","pipe","ignore"],input:input});frames=JSON.parse("["+frames.trim().slice(0,-1)+"]");img=PNG(buf,options);img.file=file;Object.keys(img).forEach(function(key){this[key]=img[key]},this);width=frames[0].W;height=frames[0].H;iwidth=0;twidth=0;this.width=width;this.height=height;this.frames=[];for(i=0;i<frames.length;i++){frame=frames[i];frame.x=+frame.x;frame.y=+frame.y;iwidth=twidth;twidth+=width;lines=[];for(y=frame.y;y<height;y++){line=[];for(x=iwidth+frame.x;x<twidth;x++){line.push(img.bmp[y][x])}lines.push(line)}this.frames.push({fctl:{sequenceNumber:i,width:frame.w,height:frame.h,xOffset:frame.x,yOffset:frame.y,delayNum:frame.d,delayDen:100,disposeOp:0,blendOp:0},fdat:[],_pixels:[],_bmp:lines})}this.bmp=this.frames[0]._bmp;this.cellmap=this.createCellmap(this.bmp);if(this.frames.length>1){this.actl={numFrames:frames.length,numPlays:0};this.frames=this.compileFrames(this.frames)}else{this.frames=undefined}return this};PNG.prototype.decompress=function(buffers){return zlib.inflateSync(new Buffer(buffers.reduce(function(out,data){return out.concat(Array.prototype.slice.call(data))},[])))};PNG.prototype.crc32=function(){var crcTable=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];return function crc32(buf){var crc=-1;for(var i=0,len=buf.length;i<len;i++){crc=crcTable[(crc^buf[i])&255]^crc>>>8}return crc^-1}}();PNG.prototype._debug=function(){if(!this.options.log)return;return this.options.log.apply(null,arguments)};function GIF(file,options){var self=this;if(!(this instanceof GIF)){return new GIF(file,options)}var info={},p=0,buf,i,total,sig,desc,img,ext,label,size;if(!file)throw new Error("no file");options=options||{};this.options=options;this.pixelLimit=this.options.pixelLimit||7622550;this.totalPixels=0;if(Buffer.isBuffer(file)){buf=file;file=null}else{file=path.resolve(process.cwd(),file);buf=fs.readFileSync(file)}sig=buf.slice(0,6).toString("ascii");if(sig!=="GIF87a"&&sig!=="GIF89a"){throw new Error("bad header: "+sig)}this.width=buf.readUInt16LE(6);this.height=buf.readUInt16LE(8);this.flags=buf.readUInt8(10);this.gct=!!(this.flags&128);this.gctsize=(this.flags&7)+1;this.bgIndex=buf.readUInt8(11);this.aspect=buf.readUInt8(12);p+=13;if(this.gct){this.colors=[];total=1<<this.gctsize;for(i=0;i<total;i++,p+=3){this.colors.push([buf[p],buf[p+1],buf[p+2],255])}}this.images=[];this.extensions=[];try{while(p<buf.length){desc=buf.readUInt8(p);p+=1;if(desc===44){img={};img.left=buf.readUInt16LE(p);p+=2;img.top=buf.readUInt16LE(p);p+=2;img.width=buf.readUInt16LE(p);p+=2;img.height=buf.readUInt16LE(p);p+=2;img.flags=buf.readUInt8(p);p+=1;img.lct=!!(img.flags&128);img.ilace=!!(img.flags&64);img.lctsize=(img.flags&7)+1;if(img.lct){img.lcolors=[];total=1<<img.lctsize;for(i=0;i<total;i++,p+=3){img.lcolors.push([buf[p],buf[p+1],buf[p+2],255])}}img.codeSize=buf.readUInt8(p);p+=1;img.size=buf.readUInt8(p);p+=1;img.lzw=[buf.slice(p,p+img.size)];p+=img.size;while(buf[p]!==0){if(buf[p]===59&&p===buf.length-1){p--;break}size=buf.readUInt8(p);p+=1;img.lzw.push(buf.slice(p,p+size));p+=size}assert.equal(buf.readUInt8(p),0);p+=1;if(ext&&ext.label===249){img.control=ext}this.totalPixels+=img.width*img.height;this.images.push(img);if(this.totalPixels>=this.pixelLimit){break}}else if(desc===33){ext={};label=buf.readUInt8(p);p+=1;ext.label=label;if(label===249){size=buf.readUInt8(p);assert.equal(size,4);p+=1;ext.fields=buf.readUInt8(p);ext.disposeMethod=ext.fields>>2&7;ext.useTransparent=!!(ext.fields&1);p+=1;ext.delay=buf.readUInt16LE(p);p+=2;ext.transparentColor=buf.readUInt8(p);p+=1;while(buf[p]!==0){size=buf.readUInt8(p);p+=1;p+=size}assert.equal(buf.readUInt8(p),0);p+=1;this.delay=ext.delay;this.transparentColor=ext.transparentColor;this.disposeMethod=ext.disposeMethod;this.useTransparent=ext.useTransparent}else if(label===255){size=buf.readUInt8(p);p+=1;ext.id=buf.slice(p,p+8).toString("ascii");p+=8;ext.auth=buf.slice(p,p+3).toString("ascii");p+=3;ext.data=[];while(buf[p]!==0){size=buf.readUInt8(p);p+=1;ext.data.push(buf.slice(p,p+size));p+=size}ext.data=new Buffer(ext.data.reduce(function(out,data){return out.concat(Array.prototype.slice.call(data))},[]));if(ext.id==="ANIMEXTS"&&ext.auth==="1.0"){ext.id="NETSCAPE";ext.auth="2.0";ext.animexts=true}if(ext.id==="NETSCAPE"&&ext.auth==="2.0"){if(ext.data.readUInt8(0)===1){ext.numPlays=ext.data.readUInt16LE(1);this.numPlays=ext.numPlays}else if(ext.data.readUInt8(0)===2){this.minBuffer=ext.data}}if(ext.id==="XMP Data"&&ext.auth==="XMP"){ext.xmp=ext.data.toString("utf8");this.xmp=ext.xmp}if(ext.id==="ICCRGBG1"&&ext.auth==="012"){this.icc=ext.data}if(ext.id==="fractint"&&/^00[1-7]$/.test(ext.auth)){this.fractint=ext.data}assert.equal(buf.readUInt8(p),0);p+=1}else{ext.data=[];while(buf[p]!==0){size=buf.readUInt8(p);p+=1;ext.data.push(buf.slice(p,p+size));p+=size}assert.equal(buf.readUInt8(p),0);p+=1}this.extensions.push(ext)}else if(desc===59){break}else if(p===buf.length-1){break}else{throw new Error("unknown block")}}}catch(e){if(options.debug){throw e}}this.images=this.images.map(function(img,imageIndex){var control=img.control||this;img.lzw=new Buffer(img.lzw.reduce(function(out,data){return out.concat(Array.prototype.slice.call(data))},[]));try{img.data=this.decompress(img.lzw,img.codeSize)}catch(e){if(options.debug)throw e;return}var interlacing=[[0,8],[4,8],[2,4],[1,2],[0,0]];var table=img.lcolors||this.colors,row=0,col=0,ilp=0,p=0,b,idx,i,y,x,line,pixel;img.samples=[];for(;;){b=img.data[p++];if(b==null)break;idx=(row*img.width+col)*4;if(!table[b]){if(options.debug)throw new Error("bad samples");table[b]=[0,0,0,0]}img.samples[idx]=table[b][0];img.samples[idx+1]=table[b][1];img.samples[idx+2]=table[b][2];img.samples[idx+3]=table[b][3];if(control.useTransparent&&b===control.transparentColor){img.samples[idx+3]=0}if(++col>=img.width){col=0;if(img.ilace){row+=interlacing[ilp][1];if(row>=img.height){row=interlacing[++ilp][0]}}else{row++}}}img.pixels=[];for(i=0;i<img.samples.length;i+=4){img.pixels.push(img.samples.slice(i,i+4))}img.bmp=[];for(y=0,p=0;y<img.height;y++){line=[];for(x=0;x<img.width;x++){pixel=img.pixels[p++];if(!pixel){if(options.debug)throw new Error("no pixel");line.push({r:0,g:0,b:0,a:0});continue}line.push({r:pixel[0],g:pixel[1],b:pixel[2],a:pixel[3]})}img.bmp.push(line)}return img},this).filter(Boolean);if(!this.images.length){throw new Error("no image data or bad decompress")}}GIF.prototype.decompress=function(input,codeSize){var bitDepth=codeSize+1,CC=1<<codeSize,EOI=CC+1,stack=[],table=[],ntable=0,oldCode=null,buffer=0,nbuffer=0,p=0,buf=[],bits,read,ans,n,code,i,K,b,maxElem;for(;;){if(stack.length===0){bits=bitDepth;read=0;ans=0;while(read<bits){if(nbuffer===0){if(p>=input.length)return buf;buffer=input[p++];nbuffer=8}n=Math.min(bits-read,nbuffer);ans|=(buffer&(1<<n)-1)<<read;read+=n;nbuffer-=n;buffer>>=n}code=ans;if(code===EOI){break}if(code===CC){table=[];for(i=0;i<CC;++i){table[i]=[i,-1,i]}bitDepth=codeSize+1;maxElem=1<<bitDepth;ntable=CC+2;oldCode=null;continue}if(oldCode===null){oldCode=code;buf.push(table[code][0]);continue}if(code<ntable){for(i=code;i>=0;i=table[i][1]){stack.push(table[i][0])}table[ntable++]=[table[code][2],oldCode,table[oldCode][2]]}else{K=table[oldCode][2];table[ntable++]=[K,oldCode,K];for(i=code;i>=0;i=table[i][1]){stack.push(table[i][0])}}oldCode=code;if(ntable===maxElem){maxElem=1<<++bitDepth;if(bitDepth>12)bitDepth=12}}b=stack.pop();if(b==null)break;buf.push(b)}return buf};exports=PNG;exports.png=PNG;exports.gif=GIF;module.exports=exports}).call(this,require("_process"),require("buffer").Buffer,require("timers").setImmediate)},{_process:30,assert:2,"blessed/lib/colors":59,buffer:10,child_process:1,fs:1,path:28,timers:52,util:57,zlib:9}],103:[function(require,module,exports){module.exports=require("./lib/index.js")},{"./lib/index.js":104}],104:[function(require,module,exports){(function(Buffer,__dirname){function term(options){return new term.Terminal(options)}term.middleware=function(options){var url=require("url");options=options||{};options.path=options.path||"/term.js";return function(req,res,next){if(url.parse(req.url).pathname!==options.path){return next()}if(+new Date(req.headers["if-modified-since"])===term.last){res.statusCode=304;res.end();return}res.writeHead(200,{"Content-Type":"application/javascript; charset=utf-8","Content-Length":Buffer.byteLength(term.script),"Last-Modified":term.last});res.end(term.script)}};term.path=__dirname+"/../src/term.js";term.__defineGetter__("script",function(){if(term._script)return term._script;term.last=+new Date;return term._script=require("fs").readFileSync(term.path,"utf8")});term.__defineGetter__("Terminal",function(){if(term._Terminal)return term._Terminal;return term._Terminal=require("../src/term")});module.exports=term}).call(this,require("buffer").Buffer,"/node_modules/term.js/lib")},{"../src/term":105,buffer:10,fs:1,url:53}],105:[function(require,module,exports){(function(global){(function(){"use strict";var window=this,document=this.document;function EventEmitter(){this._events=this._events||{}}EventEmitter.prototype.addListener=function(type,listener){this._events[type]=this._events[type]||[];this._events[type].push(listener)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.removeListener=function(type,listener){if(!this._events[type])return;var obj=this._events[type],i=obj.length;while(i--){if(obj[i]===listener||obj[i].listener===listener){obj.splice(i,1);return}}};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function(type){if(this._events[type])delete this._events[type]};EventEmitter.prototype.once=function(type,listener){function on(){var args=Array.prototype.slice.call(arguments);this.removeListener(type,on);return listener.apply(this,args)}on.listener=listener;return this.on(type,on)};EventEmitter.prototype.emit=function(type){if(!this._events[type])return;var args=Array.prototype.slice.call(arguments,1),obj=this._events[type],l=obj.length,i=0;for(;i<l;i++){obj[i].apply(this,args)}};EventEmitter.prototype.listeners=function(type){return this._events[type]=this._events[type]||[]};function Stream(){EventEmitter.call(this)}inherits(Stream,EventEmitter);Stream.prototype.pipe=function(dest,options){var src=this,ondata,onerror,onend;function unbind(){src.removeListener("data",ondata);src.removeListener("error",onerror);src.removeListener("end",onend);dest.removeListener("error",onerror);dest.removeListener("close",unbind)}src.on("data",ondata=function(data){dest.write(data)});src.on("error",onerror=function(err){unbind();if(!this.listeners("error").length){throw err}});src.on("end",onend=function(){dest.end();unbind()});dest.on("error",onerror);dest.on("close",unbind);dest.emit("pipe",src);return dest};var normal=0,escaped=1,csi=2,osc=3,charset=4,dcs=5,ignore=6,UDK={type:"udk"};function Terminal(options){var self=this;if(!(this instanceof Terminal)){return new Terminal(arguments[0],arguments[1],arguments[2])}Stream.call(this);if(typeof options==="number"){options={cols:arguments[0],rows:arguments[1],handler:arguments[2]}}options=options||{};each(keys(Terminal.defaults),function(key){if(options[key]==null){options[key]=Terminal.options[key];if(Terminal[key]!==Terminal.defaults[key]){options[key]=Terminal[key]}}self[key]=options[key]});if(options.colors.length===8){options.colors=options.colors.concat(Terminal._colors.slice(8))}else if(options.colors.length===16){options.colors=options.colors.concat(Terminal._colors.slice(16))}else if(options.colors.length===10){options.colors=options.colors.slice(0,-2).concat(Terminal._colors.slice(8,-2),options.colors.slice(-2))}else if(options.colors.length===18){options.colors=options.colors.slice(0,-2).concat(Terminal._colors.slice(16,-2),options.colors.slice(-2))}this.colors=options.colors;this.options=options;this.parent=options.body||options.parent||(document?document.getElementsByTagName("body")[0]:null);this.cols=options.cols||options.geometry[0];this.rows=options.rows||options.geometry[1];this.setRawMode;this.isTTY=true;this.isRaw=true;this.columns=this.cols;this.rows=this.rows;if(options.handler){this.on("data",options.handler)}this.ybase=0;this.ydisp=0;this.x=0;this.y=0;this.cursorState=0;this.cursorHidden=false;this.convertEol;this.state=0;this.queue="";this.scrollTop=0;this.scrollBottom=this.rows-1;this.applicationKeypad=false;this.applicationCursor=false;this.originMode=false;this.insertMode=false;this.wraparoundMode=false;this.normal=null;this.prefixMode=false;this.selectMode=false;this.visualMode=false;this.searchMode=false;this.searchDown;this.entry="";this.entryPrefix="Search: ";this._real;this._selected;this._textarea;this.charset=null;this.gcharset=null;this.glevel=0;this.charsets=[null];this.decLocator;this.x10Mouse;this.vt200Mouse;this.vt300Mouse;this.normalMouse;this.mouseEvents;this.sendFocus;this.utfMouse;this.sgrMouse;this.urxvtMouse;this.element;this.children;this.refreshStart;this.refreshEnd;this.savedX;this.savedY;this.savedCols;this.readable=true;this.writable=true;this.defAttr=0<<18|257<<9|256<<0;this.curAttr=this.defAttr;this.params=[];this.currentParam=0;this.prefix="";this.postfix="";this.lines=[];var i=this.rows;while(i--){this.lines.push(this.blankLine())}this.tabs;this.setupStops()}inherits(Terminal,Stream);Terminal.tangoColors=["#2e3436","#cc0000","#4e9a06","#c4a000","#3465a4","#75507b","#06989a","#d3d7cf","#555753","#ef2929","#8ae234","#fce94f","#729fcf","#ad7fa8","#34e2e2","#eeeeec"];Terminal.xtermColors=["#000000","#cd0000","#00cd00","#cdcd00","#0000ee","#cd00cd","#00cdcd","#e5e5e5","#7f7f7f","#ff0000","#00ff00","#ffff00","#5c5cff","#ff00ff","#00ffff","#ffffff"];Terminal.colors=function(){var colors=Terminal.tangoColors.slice(),r=[0,95,135,175,215,255],i;i=0;for(;i<216;i++){out(r[i/36%6|0],r[i/6%6|0],r[i%6])}i=0;for(;i<24;i++){r=8+i*10;out(r,r,r)}function out(r,g,b){colors.push("#"+hex(r)+hex(g)+hex(b))}function hex(c){c=c.toString(16);return c.length<2?"0"+c:c}return colors}();Terminal.colors[256]="#000000";Terminal.colors[257]="#f0f0f0";Terminal._colors=Terminal.colors.slice();Terminal.vcolors=function(){var out=[],colors=Terminal.colors,i=0,color;for(;i<256;i++){color=parseInt(colors[i].substring(1),16);out.push([color>>16&255,color>>8&255,color&255])}return out}();Terminal.defaults={colors:Terminal.colors,convertEol:false,termName:"xterm",geometry:[80,24],cursorBlink:true,visualBell:false,popOnBell:false,scrollback:1e3,screenKeys:false,debug:false,useStyle:false};Terminal.options={};each(keys(Terminal.defaults),function(key){Terminal[key]=Terminal.defaults[key];Terminal.options[key]=Terminal.defaults[key]});Terminal.focus=null;Terminal.prototype.focus=function(){if(Terminal.focus===this)return;if(Terminal.focus){Terminal.focus.blur()}if(this.sendFocus)this.send("[I");this.showCursor();Terminal.focus=this};Terminal.prototype.blur=function(){if(Terminal.focus!==this)return;this.cursorState=0;this.refresh(this.y,this.y);if(this.sendFocus)this.send("[O");Terminal.focus=null};Terminal.prototype.initGlobal=function(){var document=this.document;Terminal._boundDocs=Terminal._boundDocs||[];if(~indexOf(Terminal._boundDocs,document)){return}Terminal._boundDocs.push(document);Terminal.bindPaste(document);Terminal.bindKeys(document);Terminal.bindCopy(document);if(this.isMobile){this.fixMobile(document)}if(this.useStyle){Terminal.insertStyle(document,this.colors[256],this.colors[257])}};Terminal.bindPaste=function(document){var window=document.defaultView;on(window,"paste",function(ev){var term=Terminal.focus;if(!term)return;if(ev.clipboardData){term.send(ev.clipboardData.getData("text/plain"))}else if(term.context.clipboardData){term.send(term.context.clipboardData.getData("Text"))}term.element.contentEditable="inherit";return cancel(ev)})};Terminal.bindKeys=function(document){on(document,"keydown",function(ev){if(!Terminal.focus)return;var target=ev.target||ev.srcElement;if(!target)return;if(target===Terminal.focus.element||target===Terminal.focus.context||target===Terminal.focus.document||target===Terminal.focus.body||target===Terminal._textarea||target===Terminal.focus.parent){return Terminal.focus.keyDown(ev)}},true);on(document,"keypress",function(ev){if(!Terminal.focus)return;var target=ev.target||ev.srcElement;if(!target)return;if(target===Terminal.focus.element||target===Terminal.focus.context||target===Terminal.focus.document||target===Terminal.focus.body||target===Terminal._textarea||target===Terminal.focus.parent){return Terminal.focus.keyPress(ev)}},true);on(document,"mousedown",function(ev){if(!Terminal.focus)return;var el=ev.target||ev.srcElement;if(!el)return;do{if(el===Terminal.focus.element)return}while(el=el.parentNode);Terminal.focus.blur()})};Terminal.bindCopy=function(document){var window=document.defaultView;on(window,"copy",function(ev){var term=Terminal.focus;if(!term)return;if(!term._selected)return;var textarea=term.getCopyTextarea();var text=term.grabText(term._selected.x1,term._selected.x2,term._selected.y1,term._selected.y2);term.emit("copy",text);textarea.focus();textarea.textContent=text;textarea.value=text;textarea.setSelectionRange(0,text.length);setTimeout(function(){term.element.focus();term.focus()},1)})};Terminal.prototype.fixMobile=function(document){var self=this;var textarea=document.createElement("textarea");textarea.style.position="absolute";textarea.style.left="-32000px";textarea.style.top="-32000px";textarea.style.width="0px";textarea.style.height="0px";textarea.style.opacity="0";textarea.style.backgroundColor="transparent";textarea.style.borderStyle="none";textarea.style.outlineStyle="none";textarea.autocapitalize="none";textarea.autocorrect="off";document.getElementsByTagName("body")[0].appendChild(textarea);Terminal._textarea=textarea;setTimeout(function(){textarea.focus()},1e3);if(this.isAndroid){on(textarea,"change",function(){var value=textarea.textContent||textarea.value;textarea.value="";textarea.textContent="";self.send(value+"\r")})}};Terminal.insertStyle=function(document,bg,fg){var style=document.getElementById("term-style");if(style)return;var head=document.getElementsByTagName("head")[0];if(!head)return;var style=document.createElement("style");style.id="term-style";style.innerHTML=""+".terminal {\n"+"  float: left;\n"+"  border: "+bg+" solid 5px;\n"+'  font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;\n'+"  font-size: 11px;\n"+"  color: "+fg+";\n"+"  background: "+bg+";\n"+"}\n"+"\n"+".terminal-cursor {\n"+"  color: "+bg+";\n"+"  background: "+fg+";\n"+"}\n";head.insertBefore(style,head.firstChild)};Terminal.prototype.open=function(parent){var self=this,i=0,div;this.parent=parent||this.parent;if(!this.parent){throw new Error("Terminal requires a parent element.")}this.context=this.parent.ownerDocument.defaultView;this.document=this.parent.ownerDocument;this.body=this.document.getElementsByTagName("body")[0];if(this.context.navigator&&this.context.navigator.userAgent){this.isMac=!!~this.context.navigator.userAgent.indexOf("Mac");this.isIpad=!!~this.context.navigator.userAgent.indexOf("iPad");this.isIphone=!!~this.context.navigator.userAgent.indexOf("iPhone");this.isAndroid=!!~this.context.navigator.userAgent.indexOf("Android");this.isMobile=this.isIpad||this.isIphone||this.isAndroid;this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE")}this.element=this.document.createElement("div");this.element.className="terminal";this.element.style.outline="none";this.element.setAttribute("tabindex",0);this.element.setAttribute("spellcheck","false");this.element.style.backgroundColor=this.colors[256];this.element.style.color=this.colors[257];this.children=[];for(;i<this.rows;i++){div=this.document.createElement("div");this.element.appendChild(div);this.children.push(div)}this.parent.appendChild(this.element);this.refresh(0,this.rows-1);if(!("useEvents"in this.options)||this.options.useEvents){this.initGlobal()}if(!("useFocus"in this.options)||this.options.useFocus){this.focus();this.startBlink();on(this.element,"focus",function(){self.focus();if(self.isMobile){Terminal._textarea.focus()}});on(this.element,"mousedown",function(){self.focus()});on(this.element,"mousedown",function(ev){var button=ev.button!=null?+ev.button:ev.which!=null?ev.which-1:null;if(self.isMSIE){button=button===1?0:button===4?1:button}if(button!==2)return;self.element.contentEditable="true";setTimeout(function(){self.element.contentEditable="inherit"},1)},true)}if(!("useMouse"in this.options)||this.options.useMouse){this.bindMouse()}if(!("useFocus"in this.options)||this.options.useFocus){setTimeout(function(){self.element.focus()},100)}if(Terminal.brokenBold==null){Terminal.brokenBold=isBoldBroken(this.document)}this.emit("open")};Terminal.prototype.setRawMode=function(value){this.isRaw=!!value};Terminal.prototype.bindMouse=function(){var el=this.element,self=this,pressed=32;var wheelEvent="onmousewheel"in this.context?"mousewheel":"DOMMouseScroll";function sendButton(ev){var button,pos;button=getButton(ev);pos=getCoords(ev);if(!pos)return;sendEvent(button,pos);switch(ev.type){case"mousedown":pressed=button;break;case"mouseup":pressed=32;break;case wheelEvent:break}}function sendMove(ev){var button=pressed,pos;pos=getCoords(ev);if(!pos)return;button+=32;sendEvent(button,pos)}function encode(data,ch){if(!self.utfMouse){if(ch===255)return data.push(0);if(ch>127)ch=127;data.push(ch)}else{if(ch===2047)return data.push(0);if(ch<127){data.push(ch)}else{if(ch>2047)ch=2047;data.push(192|ch>>6);data.push(128|ch&63)}}}function sendEvent(button,pos){if(self.vt300Mouse){button&=3;pos.x-=32;pos.y-=32;var data="[24";if(button===0)data+="1";else if(button===1)data+="3";else if(button===2)data+="5";else if(button===3)return;else data+="0";data+="~["+pos.x+","+pos.y+"]\r";self.send(data);return}if(self.decLocator){button&=3;pos.x-=32;pos.y-=32;if(button===0)button=2;else if(button===1)button=4;else if(button===2)button=6;else if(button===3)button=3;self.send("["+button+";"+(button===3?4:0)+";"+pos.y+";"+pos.x+";"+(pos.page||0)+"&w");return}if(self.urxvtMouse){pos.x-=32;pos.y-=32;pos.x++;pos.y++;self.send("["+button+";"+pos.x+";"+pos.y+"M");return}if(self.sgrMouse){pos.x-=32;pos.y-=32;self.send("[<"+((button&3)===3?button&~3:button)+";"+pos.x+";"+pos.y+((button&3)===3?"m":"M"));return}var data=[];encode(data,button);encode(data,pos.x);encode(data,pos.y);self.send("[M"+String.fromCharCode.apply(String,data))}function getButton(ev){var button,shift,meta,ctrl,mod;switch(ev.type){case"mousedown":button=ev.button!=null?+ev.button:ev.which!=null?ev.which-1:null;if(self.isMSIE){button=button===1?0:button===4?1:button}break;case"mouseup":button=3;break;case"DOMMouseScroll":button=ev.detail<0?64:65;break;case"mousewheel":button=ev.wheelDeltaY>0?64:65;break}shift=ev.shiftKey?4:0;meta=ev.metaKey?8:0;ctrl=ev.ctrlKey?16:0;mod=shift|meta|ctrl;if(self.vt200Mouse){mod&=ctrl}else if(!self.normalMouse){mod=0}button=32+(mod<<2)+button;return button}function getCoords(ev){var x,y,w,h,el;if(ev.pageX==null)return;x=ev.pageX;y=ev.pageY;el=self.element;while(el&&el!==self.document.documentElement){x-=el.offsetLeft;y-=el.offsetTop;el="offsetParent"in el?el.offsetParent:el.parentNode}w=self.element.clientWidth;h=self.element.clientHeight;x=Math.round(x/w*self.cols);y=Math.round(y/h*self.rows);if(x<0)x=0;if(x>self.cols)x=self.cols;if(y<0)y=0;if(y>self.rows)y=self.rows;x+=32;y+=32;return{x:x,y:y,type:ev.type===wheelEvent?"mousewheel":ev.type}}on(el,"mousedown",function(ev){if(!self.mouseEvents)return;sendButton(ev);self.focus();if(self.normalMouse)on(self.document,"mousemove",sendMove);if(!self.x10Mouse){on(self.document,"mouseup",function up(ev){sendButton(ev);if(self.normalMouse)off(self.document,"mousemove",sendMove);off(self.document,"mouseup",up);return cancel(ev)})}return cancel(ev)});on(el,wheelEvent,function(ev){if(!self.mouseEvents)return;if(self.x10Mouse||self.vt300Mouse||self.decLocator)return;sendButton(ev);return cancel(ev)});on(el,wheelEvent,function(ev){if(self.mouseEvents)return;if(self.applicationKeypad)return;if(ev.type==="DOMMouseScroll"){self.scrollDisp(ev.detail<0?-5:5)}else{self.scrollDisp(ev.wheelDeltaY>0?-5:5)}return cancel(ev)})};Terminal.prototype.close=Terminal.prototype.destroySoon=Terminal.prototype.destroy=function(){if(this.destroyed){return}if(this._blink){clearInterval(this._blink);delete this._blink}this.readable=false;this.writable=false;this.destroyed=true;this._events={};this.handler=function(){};this.write=function(){};this.end=function(){};if(this.element.parentNode){this.element.parentNode.removeChild(this.element)}this.emit("end");this.emit("close");this.emit("finish");this.emit("destroy")};Terminal.prototype.refresh=function(start,end){var x,y,i,line,out,ch,width,data,attr,bg,fg,flags,row,parent;if(end-start>=this.rows/2){parent=this.element.parentNode;if(parent)parent.removeChild(this.element)}width=this.cols;y=start;if(end>=this.lines.length){this.log("`end` is too large. Most likely a bad CSR.");end=this.lines.length-1}for(;y<=end;y++){row=y+this.ydisp;line=this.lines[row];out="";if(y===this.y&&this.cursorState&&(this.ydisp===this.ybase||this.selectMode)&&!this.cursorHidden){x=this.x}else{x=-1}attr=this.defAttr;i=0;for(;i<width;i++){data=line[i][0];ch=line[i][1];if(i===x)data=-1;if(data!==attr){if(attr!==this.defAttr){out+="</span>"}if(data!==this.defAttr){if(data===-1){out+='<span class="reverse-video terminal-cursor">'}else{out+='<span style="';bg=data&511;fg=data>>9&511;flags=data>>18;if(flags&1){if(!Terminal.brokenBold){out+="font-weight:bold;"}if(fg<8)fg+=8}if(flags&2){out+="text-decoration:underline;"}if(flags&4){if(flags&2){out=out.slice(0,-1);out+=" blink;"}else{out+="text-decoration:blink;"}}if(flags&8){bg=data>>9&511;fg=data&511;if(flags&1&&fg<8)fg+=8}if(flags&16){out+="visibility:hidden;"}if(bg!==256){out+="background-color:"+this.colors[bg]+";"}if(fg!==257){out+="color:"+this.colors[fg]+";"}out+='">'}}}switch(ch){case"&":out+="&amp;";break;case"<":out+="&lt;";break;case">":out+="&gt;";break;default:if(ch<=" "){out+="&nbsp;"}else{if(isWide(ch))i++;out+=ch}break}attr=data}if(attr!==this.defAttr){out+="</span>"}this.children[y].innerHTML=out}if(parent)parent.appendChild(this.element)};Terminal.prototype._cursorBlink=function(){if(Terminal.focus!==this)return;this.cursorState^=1;this.refresh(this.y,this.y)};Terminal.prototype.showCursor=function(){if(!this.cursorState){this.cursorState=1;this.refresh(this.y,this.y)}else{}};Terminal.prototype.startBlink=function(){if(!this.cursorBlink)return;var self=this;this._blinker=function(){self._cursorBlink()};this._blink=setInterval(this._blinker,500)};Terminal.prototype.refreshBlink=function(){if(!this.cursorBlink||!this._blink)return;clearInterval(this._blink);this._blink=setInterval(this._blinker,500)};Terminal.prototype.scroll=function(){var row;if(++this.ybase===this.scrollback){this.ybase=this.ybase/2|0;this.lines=this.lines.slice(-(this.ybase+this.rows)+1)}this.ydisp=this.ybase;row=this.ybase+this.rows-1;row-=this.rows-1-this.scrollBottom;if(row===this.lines.length){this.lines.push(this.blankLine())}else{this.lines.splice(row,0,this.blankLine())}if(this.scrollTop!==0){if(this.ybase!==0){this.ybase--;this.ydisp=this.ybase}this.lines.splice(this.ybase+this.scrollTop,1)}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};Terminal.prototype.scrollDisp=function(disp){this.ydisp+=disp;if(this.ydisp>this.ybase){this.ydisp=this.ybase}else if(this.ydisp<0){this.ydisp=0}this.refresh(0,this.rows-1)};Terminal.prototype.write=function(data){var l=data.length,i=0,j,cs,ch;this.refreshStart=this.y;this.refreshEnd=this.y;if(this.ybase!==this.ydisp){this.ydisp=this.ybase;this.maxRange()}for(;i<l;i++,this.lch=ch){ch=data[i];switch(this.state){case normal:switch(ch){case"":this.bell();break;case"\n":case"\v":case"\f":if(this.convertEol){this.x=0}this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}break;case"\r":this.x=0;break;case"\b":if(this.x>0){this.x--}break;case"\t":this.x=this.nextStop();break;case"":this.setgLevel(1);break;case"":this.setgLevel(0);break;case"":this.state=escaped;break;default:if(ch>=" "){if(this.charset&&this.charset[ch]){ch=this.charset[ch]}if(this.x>=this.cols){this.x=0;this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}}this.lines[this.y+this.ybase][this.x]=[this.curAttr,ch];this.x++;this.updateRange(this.y);if(isWide(ch)){j=this.y+this.ybase;if(this.cols<2||this.x>=this.cols){this.lines[j][this.x-1]=[this.curAttr," "];break}this.lines[j][this.x]=[this.curAttr," "];this.x++}}break}break;case escaped:switch(ch){case"[":this.params=[];this.currentParam=0;this.state=csi;break;case"]":this.params=[];this.currentParam=0;this.state=osc;break;case"P":this.params=[];this.prefix="";this.currentParam="";this.state=dcs;break;case"_":this.state=ignore;break;case"^":this.state=ignore;break;case"c":this.reset();break;case"E":this.x=0;case"D":this.index();break;case"M":this.reverseIndex();break;case"%":this.setgLevel(0);this.setgCharset(0,Terminal.charsets.US);this.state=normal;i++;break;case"(":case")":case"*":case"+":case"-":case".":switch(ch){case"(":this.gcharset=0;break;case")":this.gcharset=1;break;case"*":this.gcharset=2;break;case"+":this.gcharset=3;break;case"-":this.gcharset=1;break;case".":this.gcharset=2;break}this.state=charset;break;case"/":this.gcharset=3;this.state=charset;i--;break;case"N":break;case"O":break;case"n":this.setgLevel(2);break;case"o":this.setgLevel(3);break;case"|":this.setgLevel(3);break;case"}":this.setgLevel(2);break;case"~":this.setgLevel(1);break;case"7":this.saveCursor();this.state=normal;break;case"8":this.restoreCursor();this.state=normal;break;case"#":this.state=normal;i++;break;case"H":this.tabSet();break;case"=":this.log("Serial port requested application keypad.");this.applicationKeypad=true;this.state=normal;break;case">":this.log("Switching back to normal keypad.");this.applicationKeypad=false;this.state=normal;break;default:this.state=normal;this.error("Unknown ESC control: %s.",ch);break}break;case charset:switch(ch){case"0":cs=Terminal.charsets.SCLD;break;case"A":cs=Terminal.charsets.UK;break;case"B":cs=Terminal.charsets.US;break;case"4":cs=Terminal.charsets.Dutch;break;case"C":case"5":cs=Terminal.charsets.Finnish;break;case"R":cs=Terminal.charsets.French;break;case"Q":cs=Terminal.charsets.FrenchCanadian;break;case"K":cs=Terminal.charsets.German;break;case"Y":cs=Terminal.charsets.Italian;break;case"E":case"6":cs=Terminal.charsets.NorwegianDanish;break;case"Z":cs=Terminal.charsets.Spanish;break;case"H":case"7":cs=Terminal.charsets.Swedish;break;case"=":cs=Terminal.charsets.Swiss;break;case"/":cs=Terminal.charsets.ISOLatin;i++;break;default:cs=Terminal.charsets.US;break}this.setgCharset(this.gcharset,cs);this.gcharset=null;this.state=normal;break;case osc:if(this.lch===""&&ch==="\\"||ch===""){if(this.lch===""){if(typeof this.currentParam==="string"){this.currentParam=this.currentParam.slice(0,-1)}else if(typeof this.currentParam=="number"){this.currentParam=(this.currentParam-("".charCodeAt(0)-48))/10}}this.params.push(this.currentParam);switch(this.params[0]){case 0:case 1:case 2:if(this.params[1]){this.title=this.params[1];this.handleTitle(this.title)}break;case 3:break;case 4:case 5:break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:break;case 46:break;case 50:break;case 51:break;case 52:break;case 104:case 105:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:break}this.params=[];this.currentParam=0;this.state=normal}else{if(!this.params.length){if(ch>="0"&&ch<="9"){this.currentParam=this.currentParam*10+ch.charCodeAt(0)-48}else if(ch===";"){this.params.push(this.currentParam);this.currentParam=""}}else{this.currentParam+=ch}}break;case csi:if(ch==="?"||ch===">"||ch==="!"){this.prefix=ch;break}if(ch>="0"&&ch<="9"){this.currentParam=this.currentParam*10+ch.charCodeAt(0)-48;break}if(ch==="$"||ch==='"'||ch===" "||ch==="'"){this.postfix=ch;break}this.params.push(this.currentParam);this.currentParam=0;if(ch===";")break;this.state=normal;switch(ch){case"A":this.cursorUp(this.params);break;case"B":this.cursorDown(this.params);break;case"C":this.cursorForward(this.params);break;case"D":this.cursorBackward(this.params);break;case"H":this.cursorPos(this.params);break;case"J":this.eraseInDisplay(this.params);break;case"K":this.eraseInLine(this.params);break;case"m":if(!this.prefix){this.charAttributes(this.params)}break;case"n":if(!this.prefix){this.deviceStatus(this.params)}break;case"@":this.insertChars(this.params);break;case"E":this.cursorNextLine(this.params);break;case"F":this.cursorPrecedingLine(this.params);break;case"G":this.cursorCharAbsolute(this.params);break;case"L":this.insertLines(this.params);break;case"M":this.deleteLines(this.params);break;case"P":this.deleteChars(this.params);break;case"X":this.eraseChars(this.params);break;case"`":this.charPosAbsolute(this.params);break;case"a":this.HPositionRelative(this.params);break;case"c":this.sendDeviceAttributes(this.params);break;case"d":this.linePosAbsolute(this.params);break;case"e":this.VPositionRelative(this.params);break;case"f":this.HVPosition(this.params);break;case"h":this.setMode(this.params);break;case"l":this.resetMode(this.params);break;case"r":this.setScrollRegion(this.params);break;case"s":this.saveCursor(this.params);break;case"u":this.restoreCursor(this.params);break;case"I":this.cursorForwardTab(this.params);break;case"S":this.scrollUp(this.params);break;case"T":if(this.params.length<2&&!this.prefix){this.scrollDown(this.params)}break;case"Z":this.cursorBackwardTab(this.params);break;case"b":this.repeatPrecedingCharacter(this.params);break;case"g":this.tabClear(this.params);break;case"p":switch(this.prefix){case"!":this.softReset(this.params);break}break;default:this.error("Unknown CSI code: %s.",ch);break}this.prefix="";this.postfix="";break;case dcs:if(this.lch===""&&ch==="\\"||ch===""){if(this.prefix==="tmux;"){if(ch===""){this.currentParam+=ch;continue}}if(this.lch===""){if(typeof this.currentParam==="string"){this.currentParam=this.currentParam.slice(0,-1)}else if(typeof this.currentParam=="number"){this.currentParam=(this.currentParam-("".charCodeAt(0)-48))/10}}this.params.push(this.currentParam);var pt=this.params[this.params.length-1];switch(this.prefix){case UDK:this.emit("udk",{clearAll:this.params[0]===0,eraseBelow:this.params[0]===1,lockKeys:this.params[1]===0,dontLockKeys:this.params[1]===1,keyList:(this.params[2]+"").split(";").map(function(part){part=part.split("/");return{keyCode:part[0],hexKeyValue:part[1]}})});break;case"$q":var valid=0;switch(pt){case'"q':pt='0"q';valid=1;break;case'"p':pt='61;0"p';valid=1;break;case"r":pt=""+(this.scrollTop+1)+";"+(this.scrollBottom+1)+"r";valid=1;break;case"m":valid=0;break;default:this.error("Unknown DCS Pt: %s.",pt);valid=0;break}this.send("P"+valid+"$r"+pt+"\\");break;case"+p":this.emit("set terminfo",{name:this.params[0]});break;case"+q":var valid=false;this.send("P"+ +valid+"+r"+pt+"\\");break;case"tmux;":this.emit("passthrough",pt);break;default:this.error("Unknown DCS prefix: %s.",pt);break}this.currentParam=0;this.prefix="";this.state=normal}else{this.currentParam+=ch;if(!this.prefix){if(/^\d*;\d*\|/.test(this.currentParam)){this.prefix=UDK;this.params=this.currentParam.split(/[;|]/).map(function(n){if(!n.length)return 0;return+n}).slice(0,-1);this.currentParam=""}else if(/^[$+][a-zA-Z]/.test(this.currentParam)||/^\w+;\x1b/.test(this.currentParam)){this.prefix=this.currentParam;this.currentParam=""}}}break;case ignore:if(this.lch===""&&ch==="\\"||ch===""){this.state=normal}break}}this.updateRange(this.y);this.refresh(this.refreshStart,this.refreshEnd);return true};Terminal.prototype.writeln=function(data){return this.write(data+"\r\n")};Terminal.prototype.end=function(data){var ret=true;if(data){ret=this.write(data)}this.destroySoon();return ret};Terminal.prototype.resume=function(){};Terminal.prototype.pause=function(){};Terminal.prototype.keyDown=function(ev){var self=this,key;switch(ev.keyCode){case 8:if(ev.altKey){key="";break}if(ev.shiftKey){key="\b";break}key="";break;case 9:if(ev.shiftKey){key="[Z";break}key="\t";break;case 13:key="\r";break;case 27:key="";break;case 37:if(this.applicationCursor){key="OD";break}if(ev.ctrlKey){key="[5D";break}key="[D";break;case 39:if(this.applicationCursor){key="OC";break}if(ev.ctrlKey){key="[5C";break}key="[C";break;case 38:if(this.applicationCursor){key="OA";break}if(ev.ctrlKey){this.scrollDisp(-1);return cancel(ev)}else{key="[A"}break;case 40:if(this.applicationCursor){key="OB";break}if(ev.ctrlKey){this.scrollDisp(1);return cancel(ev)}else{key="[B"}break;case 46:key="[3~";break;case 45:key="[2~";break;case 36:if(this.applicationKeypad){key="OH";break}key="OH";break;case 35:if(this.applicationKeypad){key="OF";break}key="OF";break;case 33:if(ev.shiftKey){this.scrollDisp(-(this.rows-1));return cancel(ev)}else{key="[5~"}break;case 34:if(ev.shiftKey){this.scrollDisp(this.rows-1);return cancel(ev)}else{key="[6~"}break;case 112:key="OP";break;case 113:key="OQ";break;case 114:key="OR";break;case 115:key="OS";break;case 116:key="[15~";break;case 117:key="[17~";break;case 118:key="[18~";break;case 119:key="[19~";break;case 120:key="[20~";break;case 121:key="[21~";break;case 122:key="[23~";break;case 123:key="[24~";break;default:if(ev.ctrlKey){if(ev.keyCode>=65&&ev.keyCode<=90){if(this.screenKeys){if(!this.prefixMode&&!this.selectMode&&ev.keyCode===65){this.enterPrefix();return cancel(ev)}}if(this.prefixMode&&ev.keyCode===86){this.leavePrefix();return}if((this.prefixMode||this.selectMode)&&ev.keyCode===67){if(this.visualMode){setTimeout(function(){self.leaveVisual()},1)}return}key=String.fromCharCode(ev.keyCode-64)}else if(ev.keyCode===32){key=String.fromCharCode(0)}else if(ev.keyCode>=51&&ev.keyCode<=55){key=String.fromCharCode(ev.keyCode-51+27)}else if(ev.keyCode===56){key=String.fromCharCode(127)}else if(ev.keyCode===219){key=String.fromCharCode(27)}else if(ev.keyCode===221){key=String.fromCharCode(29)}}else if(ev.altKey){if(ev.keyCode>=65&&ev.keyCode<=90){key=""+String.fromCharCode(ev.keyCode+32)}else if(ev.keyCode===192){key="`"}else if(ev.keyCode>=48&&ev.keyCode<=57){key=""+(ev.keyCode-48)}}break}if(!key)return true;if(this.prefixMode){this.leavePrefix();return cancel(ev)}if(this.selectMode){this.keySelect(ev,key);return cancel(ev)}this.emit("keydown",ev);this.emit("key",key,ev);this.showCursor();this.handler(key);return cancel(ev)};Terminal.prototype.setgLevel=function(g){this.glevel=g;this.charset=this.charsets[g]};Terminal.prototype.setgCharset=function(g,charset){this.charsets[g]=charset;if(this.glevel===g){this.charset=charset}};Terminal.prototype.keyPress=function(ev){var key;cancel(ev);if(ev.charCode){key=ev.charCode}else if(ev.which==null){key=ev.keyCode}else if(ev.which!==0&&ev.charCode!==0){key=ev.which}else{return false}if(!key||ev.ctrlKey||ev.altKey||ev.metaKey)return false;key=String.fromCharCode(key);if(this.prefixMode){this.leavePrefix();this.keyPrefix(ev,key);return false}if(this.selectMode){this.keySelect(ev,key);return false}this.emit("keypress",key,ev);this.emit("key",key,ev);this.showCursor();this.handler(key);return false};Terminal.prototype.send=function(data){var self=this;if(!this.queue){setTimeout(function(){self.handler(self.queue);self.queue=""},1)}this.queue+=data};Terminal.prototype.bell=function(){this.emit("bell");if(!this.visualBell)return;var self=this;this.element.style.borderColor="white";setTimeout(function(){self.element.style.borderColor=""},10);if(this.popOnBell)this.focus()};Terminal.prototype.log=function(){if(!this.debug)return;if(!this.context.console||!this.context.console.log)return;var args=Array.prototype.slice.call(arguments);this.context.console.log.apply(this.context.console,args)};Terminal.prototype.error=function(){if(!this.debug)return;if(!this.context.console||!this.context.console.error)return;var args=Array.prototype.slice.call(arguments);this.context.console.error.apply(this.context.console,args)};Terminal.prototype.resize=function(x,y){var line,el,i,j,ch;if(x<1)x=1;if(y<1)y=1;j=this.cols;if(j<x){ch=[this.defAttr," "];i=this.lines.length;while(i--){while(this.lines[i].length<x){this.lines[i].push(ch)}}}else if(j>x){i=this.lines.length;while(i--){while(this.lines[i].length>x){this.lines[i].pop()}}}this.setupStops(j);this.cols=x;this.columns=x;j=this.rows;if(j<y){el=this.element;while(j++<y){if(this.lines.length<y+this.ybase){this.lines.push(this.blankLine())}if(this.children.length<y){line=this.document.createElement("div");el.appendChild(line);this.children.push(line)}}}else if(j>y){while(j-- >y){if(this.lines.length>y+this.ybase){this.lines.pop()}if(this.children.length>y){el=this.children.pop();if(!el)continue;el.parentNode.removeChild(el)}}}this.rows=y;if(this.y>=y)this.y=y-1;if(this.x>=x)this.x=x-1;this.scrollTop=0;this.scrollBottom=y-1;this.refresh(0,this.rows-1);this.normal=null;this.emit("resize")};Terminal.prototype.updateRange=function(y){if(y<this.refreshStart)this.refreshStart=y;if(y>this.refreshEnd)this.refreshEnd=y};Terminal.prototype.maxRange=function(){this.refreshStart=0;this.refreshEnd=this.rows-1};Terminal.prototype.setupStops=function(i){if(i!=null){if(!this.tabs[i]){i=this.prevStop(i)}}else{this.tabs={};i=0}for(;i<this.cols;i+=8){this.tabs[i]=true}};Terminal.prototype.prevStop=function(x){if(x==null)x=this.x;while(!this.tabs[--x]&&x>0);return x>=this.cols?this.cols-1:x<0?0:x};Terminal.prototype.nextStop=function(x){if(x==null)x=this.x;while(!this.tabs[++x]&&x<this.cols);return x>=this.cols?this.cols-1:x<0?0:x};Terminal.prototype.eraseAttr=function(){return this.defAttr&~511|this.curAttr&511};Terminal.prototype.eraseRight=function(x,y){var line=this.lines[this.ybase+y],ch=[this.eraseAttr()," "];for(;x<this.cols;x++){line[x]=ch}this.updateRange(y)};Terminal.prototype.eraseLeft=function(x,y){var line=this.lines[this.ybase+y],ch=[this.eraseAttr()," "];x++;while(x--)line[x]=ch;this.updateRange(y)};Terminal.prototype.eraseLine=function(y){this.eraseRight(0,y)};Terminal.prototype.blankLine=function(cur){var attr=cur?this.eraseAttr():this.defAttr;var ch=[attr," "],line=[],i=0;for(;i<this.cols;i++){line[i]=ch}return line};Terminal.prototype.ch=function(cur){return cur?[this.eraseAttr()," "]:[this.defAttr," "]};Terminal.prototype.is=function(term){var name=this.termName;return(name+"").indexOf(term)===0};Terminal.prototype.handler=function(data){this.emit("data",data)};Terminal.prototype.handleTitle=function(title){this.emit("title",title)};Terminal.prototype.index=function(){this.y++;if(this.y>this.scrollBottom){this.y--;this.scroll()}this.state=normal};Terminal.prototype.reverseIndex=function(){var j;this.y--;if(this.y<this.scrollTop){this.y++;this.lines.splice(this.y+this.ybase,0,this.blankLine(true));j=this.rows-1-this.scrollBottom;this.lines.splice(this.rows-1+this.ybase-j+1,1);this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)}this.state=normal};Terminal.prototype.reset=function(){this.options.rows=this.rows;this.options.cols=this.cols;Terminal.call(this,this.options);this.refresh(0,this.rows-1)};Terminal.prototype.tabSet=function(){this.tabs[this.x]=true;this.state=normal};Terminal.prototype.cursorUp=function(params){var param=params[0];if(param<1)param=1;this.y-=param;if(this.y<0)this.y=0};Terminal.prototype.cursorDown=function(params){var param=params[0];if(param<1)param=1;this.y+=param;if(this.y>=this.rows){this.y=this.rows-1}};Terminal.prototype.cursorForward=function(params){var param=params[0];if(param<1)param=1;this.x+=param;if(this.x>=this.cols){this.x=this.cols-1}};Terminal.prototype.cursorBackward=function(params){var param=params[0];if(param<1)param=1;this.x-=param;if(this.x<0)this.x=0};Terminal.prototype.cursorPos=function(params){var row,col;row=params[0]-1;if(params.length>=2){col=params[1]-1}else{col=0}if(row<0){row=0}else if(row>=this.rows){row=this.rows-1}if(col<0){col=0}else if(col>=this.cols){col=this.cols-1}this.x=col;this.y=row};Terminal.prototype.eraseInDisplay=function(params){var j;switch(params[0]){case 0:this.eraseRight(this.x,this.y);j=this.y+1;for(;j<this.rows;j++){this.eraseLine(j)}break;case 1:this.eraseLeft(this.x,this.y);j=this.y;while(j--){this.eraseLine(j)}break;case 2:j=this.rows;while(j--)this.eraseLine(j);break;case 3:;break}};Terminal.prototype.eraseInLine=function(params){switch(params[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);break;case 2:this.eraseLine(this.y);break}};Terminal.prototype.charAttributes=function(params){if(params.length===1&&params[0]===0){this.curAttr=this.defAttr;return}var l=params.length,i=0,flags=this.curAttr>>18,fg=this.curAttr>>9&511,bg=this.curAttr&511,p;for(;i<l;i++){p=params[i];if(p>=30&&p<=37){fg=p-30}else if(p>=40&&p<=47){bg=p-40}else if(p>=90&&p<=97){p+=8;fg=p-90}else if(p>=100&&p<=107){p+=8;bg=p-100}else if(p===0){flags=this.defAttr>>18;fg=this.defAttr>>9&511;bg=this.defAttr&511}else if(p===1){flags|=1}else if(p===4){flags|=2}else if(p===5){flags|=4}else if(p===7){flags|=8}else if(p===8){flags|=16}else if(p===22){flags&=~1}else if(p===24){flags&=~2}else if(p===25){flags&=~4}else if(p===27){flags&=~8}else if(p===28){flags&=~16}else if(p===39){fg=this.defAttr>>9&511}else if(p===49){bg=this.defAttr&511}else if(p===38){if(params[i+1]===2){i+=2;fg=matchColor(params[i]&255,params[i+1]&255,params[i+2]&255);if(fg===-1)fg=511;i+=2}else if(params[i+1]===5){i+=2;p=params[i]&255;fg=p}}else if(p===48){if(params[i+1]===2){i+=2;bg=matchColor(params[i]&255,params[i+1]&255,params[i+2]&255);if(bg===-1)bg=511;i+=2}else if(params[i+1]===5){i+=2;p=params[i]&255;bg=p}}else if(p===100){fg=this.defAttr>>9&511;bg=this.defAttr&511}else{this.error("Unknown SGR attribute: %d.",p)}}this.curAttr=flags<<18|fg<<9|bg};Terminal.prototype.deviceStatus=function(params){if(!this.prefix){switch(params[0]){case 5:this.send("[0n");break;case 6:this.send("["+(this.y+1)+";"+(this.x+1)+"R");break}}else if(this.prefix==="?"){switch(params[0]){case 6:this.send("[?"+(this.y+1)+";"+(this.x+1)+"R");break;case 15:break;case 25:break;case 26:break;case 53:break}}};Terminal.prototype.insertChars=function(params){var param,row,j,ch;param=params[0];if(param<1)param=1;row=this.y+this.ybase;j=this.x;ch=[this.eraseAttr()," "];while(param--&&j<this.cols){this.lines[row].splice(j++,0,ch);this.lines[row].pop()}};Terminal.prototype.cursorNextLine=function(params){var param=params[0];if(param<1)param=1;this.y+=param;if(this.y>=this.rows){this.y=this.rows-1}this.x=0};Terminal.prototype.cursorPrecedingLine=function(params){var param=params[0];if(param<1)param=1;this.y-=param;if(this.y<0)this.y=0;this.x=0};Terminal.prototype.cursorCharAbsolute=function(params){var param=params[0];if(param<1)param=1;this.x=param-1};Terminal.prototype.insertLines=function(params){var param,row,j;param=params[0];if(param<1)param=1;row=this.y+this.ybase;j=this.rows-1-this.scrollBottom;j=this.rows-1+this.ybase-j+1;while(param--){this.lines.splice(row,0,this.blankLine(true));this.lines.splice(j,1)}this.updateRange(this.y);this.updateRange(this.scrollBottom)};Terminal.prototype.deleteLines=function(params){var param,row,j;param=params[0];if(param<1)param=1;row=this.y+this.ybase;j=this.rows-1-this.scrollBottom;j=this.rows-1+this.ybase-j;while(param--){this.lines.splice(j+1,0,this.blankLine(true));this.lines.splice(row,1)}this.updateRange(this.y);this.updateRange(this.scrollBottom)};Terminal.prototype.deleteChars=function(params){var param,row,ch;param=params[0];if(param<1)param=1;row=this.y+this.ybase;ch=[this.eraseAttr()," "];while(param--){this.lines[row].splice(this.x,1);this.lines[row].push(ch)}};Terminal.prototype.eraseChars=function(params){var param,row,j,ch;param=params[0];if(param<1)param=1;row=this.y+this.ybase;j=this.x;ch=[this.eraseAttr()," "];while(param--&&j<this.cols){this.lines[row][j++]=ch}};Terminal.prototype.charPosAbsolute=function(params){var param=params[0];if(param<1)param=1;this.x=param-1;if(this.x>=this.cols){this.x=this.cols-1}};Terminal.prototype.HPositionRelative=function(params){var param=params[0];if(param<1)param=1;this.x+=param;if(this.x>=this.cols){this.x=this.cols-1}};Terminal.prototype.sendDeviceAttributes=function(params){if(params[0]>0)return;if(!this.prefix){if(this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")){this.send("[?1;2c")}else if(this.is("linux")){this.send("[?6c")}}else if(this.prefix===">"){if(this.is("xterm")){this.send("[>0;276;0c")}else if(this.is("rxvt-unicode")){this.send("[>85;95;0c")}else if(this.is("linux")){this.send(params[0]+"c")}else if(this.is("screen")){this.send("[>83;40003;0c")}}};Terminal.prototype.linePosAbsolute=function(params){var param=params[0];if(param<1)param=1;this.y=param-1;if(this.y>=this.rows){this.y=this.rows-1}};Terminal.prototype.VPositionRelative=function(params){var param=params[0];if(param<1)param=1;this.y+=param;if(this.y>=this.rows){this.y=this.rows-1}};Terminal.prototype.HVPosition=function(params){if(params[0]<1)params[0]=1;if(params[1]<1)params[1]=1;this.y=params[0]-1;if(this.y>=this.rows){this.y=this.rows-1}this.x=params[1]-1;if(this.x>=this.cols){this.x=this.cols-1}};Terminal.prototype.setMode=function(params){if(typeof params==="object"){var l=params.length,i=0;for(;i<l;i++){this.setMode(params[i])}return}if(!this.prefix){switch(params){case 4:this.insertMode=true;break;case 20:break}}else if(this.prefix==="?"){switch(params){case 1:this.applicationCursor=true;break;case 2:this.setgCharset(0,Terminal.charsets.US);this.setgCharset(1,Terminal.charsets.US);this.setgCharset(2,Terminal.charsets.US);this.setgCharset(3,Terminal.charsets.US);break;case 3:this.savedCols=this.cols;this.resize(132,this.rows);break;case 6:this.originMode=true;break;case 7:this.wraparoundMode=true;break;case 12:break;case 66:this.log("Serial port requested application keypad.");this.applicationKeypad=true;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=params===9;this.vt200Mouse=params===1e3;this.normalMouse=params>1e3;this.mouseEvents=true;this.element.style.cursor="default";this.log("Binding to mouse events.");break;case 1004:this.sendFocus=true;break;case 1005:this.utfMouse=true;break;case 1006:this.sgrMouse=true;break;case 1015:this.urxvtMouse=true;break;case 25:this.cursorHidden=false;break;case 1049:;case 47:case 1047:if(!this.normal){var normal={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs};this.reset();this.normal=normal;this.showCursor()}break}}};Terminal.prototype.resetMode=function(params){if(typeof params==="object"){var l=params.length,i=0;for(;i<l;i++){this.resetMode(params[i])}return}if(!this.prefix){switch(params){case 4:this.insertMode=false;break;case 20:break}}else if(this.prefix==="?"){switch(params){case 1:this.applicationCursor=false;break;case 3:if(this.cols===132&&this.savedCols){this.resize(this.savedCols,this.rows)}delete this.savedCols;break;case 6:this.originMode=false;break;case 7:this.wraparoundMode=false;break;case 12:break;case 66:this.log("Switching back to normal keypad.");this.applicationKeypad=false;break;case 9:case 1e3:case 1002:case 1003:this.x10Mouse=false;this.vt200Mouse=false;this.normalMouse=false;this.mouseEvents=false;this.element.style.cursor="";break;case 1004:this.sendFocus=false;break;case 1005:this.utfMouse=false;break;case 1006:this.sgrMouse=false;break;case 1015:this.urxvtMouse=false;break;case 25:this.cursorHidden=true;break;case 1049:;case 47:case 1047:if(this.normal){this.lines=this.normal.lines;this.ybase=this.normal.ybase;this.ydisp=this.normal.ydisp;this.x=this.normal.x;this.y=this.normal.y;this.scrollTop=this.normal.scrollTop;this.scrollBottom=this.normal.scrollBottom;this.tabs=this.normal.tabs;this.normal=null;this.refresh(0,this.rows-1);this.showCursor()}break}}};Terminal.prototype.setScrollRegion=function(params){if(this.prefix)return;this.scrollTop=(params[0]||1)-1;this.scrollBottom=(params[1]||this.rows)-1;this.x=0;this.y=0};Terminal.prototype.saveCursor=function(params){this.savedX=this.x;this.savedY=this.y};Terminal.prototype.restoreCursor=function(params){this.x=this.savedX||0;this.y=this.savedY||0};Terminal.prototype.cursorForwardTab=function(params){var param=params[0]||1;while(param--){this.x=this.nextStop()}};Terminal.prototype.scrollUp=function(params){var param=params[0]||1;while(param--){this.lines.splice(this.ybase+this.scrollTop,1);this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine())}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};Terminal.prototype.scrollDown=function(params){var param=params[0]||1;while(param--){this.lines.splice(this.ybase+this.scrollBottom,1);this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine())}this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};Terminal.prototype.initMouseTracking=function(params){};Terminal.prototype.resetTitleModes=function(params){};Terminal.prototype.cursorBackwardTab=function(params){var param=params[0]||1;while(param--){this.x=this.prevStop()}};Terminal.prototype.repeatPrecedingCharacter=function(params){var param=params[0]||1,line=this.lines[this.ybase+this.y],ch=line[this.x-1]||[this.defAttr," "];while(param--)line[this.x++]=ch};Terminal.prototype.tabClear=function(params){var param=params[0];if(param<=0){delete this.tabs[this.x]}else if(param===3){this.tabs={}}};Terminal.prototype.mediaCopy=function(params){};Terminal.prototype.setResources=function(params){};Terminal.prototype.disableModifiers=function(params){};Terminal.prototype.setPointerMode=function(params){};Terminal.prototype.softReset=function(params){this.cursorHidden=false;this.insertMode=false;this.originMode=false;this.wraparoundMode=false;this.applicationKeypad=false;this.applicationCursor=false;this.scrollTop=0;this.scrollBottom=this.rows-1;this.curAttr=this.defAttr;this.x=this.y=0;this.charset=null;this.glevel=0;this.charsets=[null]};Terminal.prototype.requestAnsiMode=function(params){};Terminal.prototype.requestPrivateMode=function(params){};Terminal.prototype.setConformanceLevel=function(params){};Terminal.prototype.loadLEDs=function(params){};Terminal.prototype.setCursorStyle=function(params){};Terminal.prototype.setCharProtectionAttr=function(params){};Terminal.prototype.restorePrivateValues=function(params){};Terminal.prototype.setAttrInRectangle=function(params){var t=params[0],l=params[1],b=params[2],r=params[3],attr=params[4];var line,i;for(;t<b+1;t++){line=this.lines[this.ybase+t];for(i=l;i<r;i++){line[i]=[attr,line[i][1]]}}this.updateRange(params[0]);this.updateRange(params[2])};Terminal.prototype.savePrivateValues=function(params){};Terminal.prototype.manipulateWindow=function(params){};Terminal.prototype.reverseAttrInRectangle=function(params){};Terminal.prototype.setTitleModeFeature=function(params){};Terminal.prototype.setWarningBellVolume=function(params){};Terminal.prototype.setMarginBellVolume=function(params){};Terminal.prototype.copyRectangle=function(params){};Terminal.prototype.enableFilterRectangle=function(params){};Terminal.prototype.requestParameters=function(params){};Terminal.prototype.selectChangeExtent=function(params){};Terminal.prototype.fillRectangle=function(params){var ch=params[0],t=params[1],l=params[2],b=params[3],r=params[4];var line,i;for(;t<b+1;t++){line=this.lines[this.ybase+t];for(i=l;i<r;i++){line[i]=[line[i][0],String.fromCharCode(ch)]}}this.updateRange(params[1]);this.updateRange(params[3])};Terminal.prototype.enableLocatorReporting=function(params){var val=params[0]>0};Terminal.prototype.eraseRectangle=function(params){var t=params[0],l=params[1],b=params[2],r=params[3];var line,i,ch;ch=[this.eraseAttr()," "];for(;t<b+1;t++){line=this.lines[this.ybase+t];for(i=l;i<r;i++){line[i]=ch}}this.updateRange(params[0]);this.updateRange(params[2])};Terminal.prototype.setLocatorEvents=function(params){};Terminal.prototype.selectiveEraseRectangle=function(params){};Terminal.prototype.requestLocatorPosition=function(params){};Terminal.prototype.insertColumns=function(){var param=params[0],l=this.ybase+this.rows,ch=[this.eraseAttr()," "],i;while(param--){for(i=this.ybase;i<l;i++){this.lines[i].splice(this.x+1,0,ch);this.lines[i].pop()}}this.maxRange()};Terminal.prototype.deleteColumns=function(){var param=params[0],l=this.ybase+this.rows,ch=[this.eraseAttr()," "],i;while(param--){for(i=this.ybase;i<l;i++){this.lines[i].splice(this.x,1);this.lines[i].push(ch)}}this.maxRange()};Terminal.prototype.enterPrefix=function(){this.prefixMode=true};Terminal.prototype.leavePrefix=function(){this.prefixMode=false};Terminal.prototype.enterSelect=function(){this._real={x:this.x,y:this.y,ydisp:this.ydisp,ybase:this.ybase,cursorHidden:this.cursorHidden,lines:this.copyBuffer(this.lines),write:this.write};this.write=function(){};this.selectMode=true;this.visualMode=false;this.cursorHidden=false;this.refresh(this.y,this.y)};Terminal.prototype.leaveSelect=function(){this.x=this._real.x;this.y=this._real.y;this.ydisp=this._real.ydisp;this.ybase=this._real.ybase;this.cursorHidden=this._real.cursorHidden;this.lines=this._real.lines;this.write=this._real.write;delete this._real;this.selectMode=false;this.visualMode=false;this.refresh(0,this.rows-1)};Terminal.prototype.enterVisual=function(){this._real.preVisual=this.copyBuffer(this.lines);this.selectText(this.x,this.x,this.ydisp+this.y,this.ydisp+this.y);this.visualMode=true};Terminal.prototype.leaveVisual=function(){this.lines=this._real.preVisual;delete this._real.preVisual;delete this._selected;this.visualMode=false;this.refresh(0,this.rows-1)};Terminal.prototype.enterSearch=function(down){this.entry="";this.searchMode=true;this.searchDown=down;this._real.preSearch=this.copyBuffer(this.lines);this._real.preSearchX=this.x;this._real.preSearchY=this.y;var bottom=this.ydisp+this.rows-1;for(var i=0;i<this.entryPrefix.length;i++){this.lines[bottom][i]=[this.defAttr&~511|4,this.entryPrefix[i]]}this.y=this.rows-1;this.x=this.entryPrefix.length;this.refresh(this.rows-1,this.rows-1)};Terminal.prototype.leaveSearch=function(){this.searchMode=false;if(this._real.preSearch){this.lines=this._real.preSearch;this.x=this._real.preSearchX;this.y=this._real.preSearchY;delete this._real.preSearch;delete this._real.preSearchX;delete this._real.preSearchY}this.refresh(this.rows-1,this.rows-1)};Terminal.prototype.copyBuffer=function(lines){var lines=lines||this.lines,out=[];for(var y=0;y<lines.length;y++){out[y]=[];for(var x=0;x<lines[y].length;x++){out[y][x]=[lines[y][x][0],lines[y][x][1]]}}return out};Terminal.prototype.getCopyTextarea=function(text){var textarea=this._copyTextarea,document=this.document;if(!textarea){textarea=document.createElement("textarea");textarea.style.position="absolute";textarea.style.left="-32000px";textarea.style.top="-32000px";textarea.style.width="0px";textarea.style.height="0px";textarea.style.opacity="0";textarea.style.backgroundColor="transparent";textarea.style.borderStyle="none";textarea.style.outlineStyle="none";document.getElementsByTagName("body")[0].appendChild(textarea);this._copyTextarea=textarea}return textarea};Terminal.prototype.copyText=function(text){var self=this,textarea=this.getCopyTextarea();this.emit("copy",text);textarea.focus();textarea.textContent=text;textarea.value=text;textarea.setSelectionRange(0,text.length);setTimeout(function(){self.element.focus();self.focus()},1)};Terminal.prototype.selectText=function(x1,x2,y1,y2){var ox1,ox2,oy1,oy2,tmp,x,y,xl,attr;if(this._selected){ox1=this._selected.x1;ox2=this._selected.x2;oy1=this._selected.y1;oy2=this._selected.y2;if(oy2<oy1){tmp=ox2;ox2=ox1;ox1=tmp;tmp=oy2;oy2=oy1;oy1=tmp}if(ox2<ox1&&oy1===oy2){tmp=ox2;ox2=ox1;ox1=tmp}for(y=oy1;y<=oy2;y++){x=0;xl=this.cols-1;if(y===oy1){x=ox1}if(y===oy2){xl=ox2}for(;x<=xl;x++){if(this.lines[y][x].old!=null){attr=this.lines[y][x].old;delete this.lines[y][x].old;this.lines[y][x]=[attr,this.lines[y][x][1]]}}}y1=this._selected.y1;x1=this._selected.x1}y1=Math.max(y1,0);y1=Math.min(y1,this.ydisp+this.rows-1);y2=Math.max(y2,0);y2=Math.min(y2,this.ydisp+this.rows-1);this._selected={x1:x1,x2:x2,y1:y1,y2:y2};if(y2<y1){tmp=x2;x2=x1;x1=tmp;tmp=y2;y2=y1;y1=tmp}if(x2<x1&&y1===y2){tmp=x2;x2=x1;x1=tmp}for(y=y1;y<=y2;y++){x=0;xl=this.cols-1;if(y===y1){x=x1}if(y===y2){xl=x2}for(;x<=xl;x++){attr=this.lines[y][x][0];this.lines[y][x]=[attr&~511|(511<<9|4),this.lines[y][x][1]];this.lines[y][x].old=attr}}y1=y1-this.ydisp;y2=y2-this.ydisp;y1=Math.max(y1,0);y1=Math.min(y1,this.rows-1);y2=Math.max(y2,0);y2=Math.min(y2,this.rows-1);this.refresh(0,this.rows-1)};Terminal.prototype.grabText=function(x1,x2,y1,y2){var out="",buf="",ch,x,y,xl,tmp;if(y2<y1){tmp=x2;x2=x1;x1=tmp;tmp=y2;y2=y1;y1=tmp}if(x2<x1&&y1===y2){tmp=x2;x2=x1;x1=tmp}for(y=y1;y<=y2;y++){x=0;xl=this.cols-1;if(y===y1){x=x1}if(y===y2){xl=x2}for(;x<=xl;x++){ch=this.lines[y][x][1];if(ch===" "){buf+=ch;continue}if(buf){out+=buf;buf=""}out+=ch;if(isWide(ch))x++}buf="";out+="\n"}for(x=x2,y=y2;x<this.cols;x++){if(this.lines[y][x][1]!==" "){out=out.slice(0,-1);break}}return out};Terminal.prototype.keyPrefix=function(ev,key){if(key==="k"||key==="&"){this.destroy()}else if(key==="p"||key==="]"){this.emit("request paste")}else if(key==="c"){this.emit("request create")}else if(key>="0"&&key<="9"){key=+key-1;if(!~key)key=9;this.emit("request term",key)}else if(key==="n"){this.emit("request term next")}else if(key==="P"){this.emit("request term previous")}else if(key===":"){this.emit("request command mode")}else if(key==="["){this.enterSelect()}};Terminal.prototype.keySelect=function(ev,key){this.showCursor();if(this.searchMode||key==="n"||key==="N"){return this.keySearch(ev,key)}if(key===""){var y=this.ydisp+this.y;if(this.ydisp===this.ybase){this.y=Math.min(this.y+(this.rows-1)/2|0,this.rows-1);this.refresh(0,this.rows-1)}else{this.scrollDisp((this.rows-1)/2|0)}if(this.visualMode){this.selectText(this.x,this.x,y,this.ydisp+this.y)}return}if(key===""){var y=this.ydisp+this.y;if(this.ydisp===0){this.y=Math.max(this.y-(this.rows-1)/2|0,0);this.refresh(0,this.rows-1)}else{this.scrollDisp(-(this.rows-1)/2|0)}if(this.visualMode){this.selectText(this.x,this.x,y,this.ydisp+this.y)}return}if(key===""){var y=this.ydisp+this.y;this.scrollDisp(this.rows-1);if(this.visualMode){this.selectText(this.x,this.x,y,this.ydisp+this.y)}return}if(key===""){var y=this.ydisp+this.y;this.scrollDisp(-(this.rows-1));if(this.visualMode){this.selectText(this.x,this.x,y,this.ydisp+this.y)}return}if(key==="k"||key==="[A"){var y=this.ydisp+this.y;this.y--;if(this.y<0){this.y=0;this.scrollDisp(-1)}if(this.visualMode){this.selectText(this.x,this.x,y,this.ydisp+this.y)}else{this.refresh(this.y,this.y+1)}return}if(key==="j"||key==="[B"){var y=this.ydisp+this.y;this.y++;if(this.y>=this.rows){this.y=this.rows-1;this.scrollDisp(1)}if(this.visualMode){this.selectText(this.x,this.x,y,this.ydisp+this.y)}else{this.refresh(this.y-1,this.y)}return}if(key==="h"||key==="[D"){var x=this.x;this.x--;if(this.x<0){this.x=0}if(this.visualMode){this.selectText(x,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(key==="l"||key==="[C"){var x=this.x;this.x++;if(this.x>=this.cols){this.x=this.cols-1}if(this.visualMode){this.selectText(x,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(key==="v"||key===" "){if(!this.visualMode){this.enterVisual()}else{this.leaveVisual()}return}if(key==="y"){if(this.visualMode){var text=this.grabText(this._selected.x1,this._selected.x2,this._selected.y1,this._selected.y2);this.copyText(text);this.leaveVisual()}return}if(key==="q"||key===""){if(this.visualMode){this.leaveVisual()}else{this.leaveSelect()}return}if(key==="w"||key==="W"){var ox=this.x;var oy=this.y;var oyd=this.ydisp;var x=this.x;var y=this.y;var yb=this.ydisp;var saw_space=false;for(;;){var line=this.lines[yb+y];while(x<this.cols){if(line[x][1]<=" "){saw_space=true}else if(saw_space){break}x++}if(x>=this.cols)x=this.cols-1;if(x===this.cols-1&&line[x][1]<=" "){x=0;if(++y>=this.rows){y--;if(++yb>this.ybase){yb=this.ybase;x=this.x;break}}continue}break}this.x=x,this.y=y;this.scrollDisp(-this.ydisp+yb);if(this.visualMode){this.selectText(ox,this.x,oy+oyd,this.ydisp+this.y)}return}if(key==="b"||key==="B"){var ox=this.x;var oy=this.y;var oyd=this.ydisp;var x=this.x;var y=this.y;var yb=this.ydisp;for(;;){var line=this.lines[yb+y];var saw_space=x>0&&line[x][1]>" "&&line[x-1][1]>" ";while(x>=0){if(line[x][1]<=" "){if(saw_space&&(x+1<this.cols&&line[x+1][1]>" ")){x++;break}else{saw_space=true}}x--}if(x<0)x=0;if(x===0&&(line[x][1]<=" "||!saw_space)){x=this.cols-1;if(--y<0){y++;if(--yb<0){yb++;x=0;break}}continue}break}this.x=x,this.y=y;this.scrollDisp(-this.ydisp+yb);if(this.visualMode){this.selectText(ox,this.x,oy+oyd,this.ydisp+this.y)}return}if(key==="e"||key==="E"){var x=this.x+1;var y=this.y;var yb=this.ydisp;if(x>=this.cols)x--;for(;;){var line=this.lines[yb+y];while(x<this.cols){if(line[x][1]<=" "){x++}else{break}}while(x<this.cols){if(line[x][1]<=" "){if(x-1>=0&&line[x-1][1]>" "){x--;break}}x++}if(x>=this.cols)x=this.cols-1;if(x===this.cols-1&&line[x][1]<=" "){x=0;if(++y>=this.rows){y--;if(++yb>this.ybase){yb=this.ybase;break}}continue}break}this.x=x,this.y=y;this.scrollDisp(-this.ydisp+yb);if(this.visualMode){this.selectText(ox,this.x,oy+oyd,this.ydisp+this.y)}return}if(key==="^"||key==="0"){var ox=this.x;if(key==="0"){this.x=0}else if(key==="^"){var line=this.lines[this.ydisp+this.y];var x=0;while(x<this.cols){if(line[x][1]>" "){break}x++}if(x>=this.cols)x=this.cols-1;this.x=x}if(this.visualMode){this.selectText(ox,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(key==="$"){var ox=this.x;var line=this.lines[this.ydisp+this.y];var x=this.cols-1;while(x>=0){if(line[x][1]>" "){if(this.visualMode&&x<this.cols-1)x++;break}x--}if(x<0)x=0;this.x=x;if(this.visualMode){this.selectText(ox,this.x,this.ydisp+this.y,this.ydisp+this.y)}else{this.refresh(this.y,this.y)}return}if(key==="g"||key==="G"){var ox=this.x;var oy=this.y;var oyd=this.ydisp;if(key==="g"){this.x=0,this.y=0;this.scrollDisp(-this.ydisp)}else if(key==="G"){this.x=0,this.y=this.rows-1;this.scrollDisp(this.ybase)}if(this.visualMode){this.selectText(ox,this.x,oy+oyd,this.ydisp+this.y)}return}if(key==="H"||key==="M"||key==="L"){var ox=this.x;var oy=this.y;if(key==="H"){this.x=0,this.y=0}else if(key==="M"){this.x=0,this.y=this.rows/2|0}else if(key==="L"){this.x=0,this.y=this.rows-1}if(this.visualMode){this.selectText(ox,this.x,this.ydisp+oy,this.ydisp+this.y)}else{this.refresh(oy,oy);this.refresh(this.y,this.y)}return}if(key==="{"||key==="}"){var ox=this.x;var oy=this.y;var oyd=this.ydisp;var line;var saw_full=false;var found=false;var first_is_space=-1;var y=this.y+(key==="{"?-1:1);var yb=this.ydisp;var i;if(key==="{"){if(y<0){y++;if(yb>0)yb--}}else if(key==="}"){if(y>=this.rows){y--;if(yb<this.ybase)yb++}}for(;;){line=this.lines[yb+y];for(i=0;i<this.cols;i++){if(line[i][1]>" "){if(first_is_space===-1){first_is_space=0}saw_full=true;break}else if(i===this.cols-1){if(first_is_space===-1){first_is_space=1}else if(first_is_space===0){found=true}else if(first_is_space===1){if(saw_full)found=true}break}}if(found)break;if(key==="{"){y--;if(y<0){y++;if(yb>0)yb--;else break}}else if(key==="}"){y++;if(y>=this.rows){y--;if(yb<this.ybase)yb++;else break}}}if(!found){if(key==="{"){y=0;yb=0}else if(key==="}"){y=this.rows-1;yb=this.ybase}}this.x=0,this.y=y;this.scrollDisp(-this.ydisp+yb);if(this.visualMode){this.selectText(ox,this.x,oy+oyd,this.ydisp+this.y)}return}if(key==="/"||key==="?"){if(!this.visualMode){this.enterSearch(key==="/")}return}return false};Terminal.prototype.keySearch=function(ev,key){if(key===""){this.leaveSearch();return}if(key==="\r"||!this.searchMode&&(key==="n"||key==="N")){this.leaveSearch();var entry=this.entry;if(!entry){this.refresh(0,this.rows-1);return}var ox=this.x;var oy=this.y;var oyd=this.ydisp;var line;var found=false;var wrapped=false;var x=this.x+1;var y=this.ydisp+this.y;var yb,i;var up=key==="N"?this.searchDown:!this.searchDown;for(;;){line=this.lines[y];while(x<this.cols){for(i=0;i<entry.length;i++){if(x+i>=this.cols)break;if(line[x+i][1]!==entry[i]){break}else if(line[x+i][1]===entry[i]&&i===entry.length-1){found=true;break}}if(found)break;x+=i+1}if(found)break;x=0;if(!up){y++;if(y>this.ybase+this.rows-1){if(wrapped)break;wrapped=true;y=0}}else{y--;if(y<0){if(wrapped)break;wrapped=true;y=this.ybase+this.rows-1}}}if(found){if(y-this.ybase<0){yb=y;y=0;if(yb>this.ybase){y=yb-this.ybase;yb=this.ybase}}else{yb=this.ybase;y-=this.ybase}this.x=x,this.y=y;this.scrollDisp(-this.ydisp+yb);if(this.visualMode){this.selectText(ox,this.x,oy+oyd,this.ydisp+this.y)}return}this.refresh(0,this.rows-1);return}if(key==="\b"||key===""){if(this.entry.length===0)return;var bottom=this.ydisp+this.rows-1;this.entry=this.entry.slice(0,-1);var i=this.entryPrefix.length+this.entry.length;this.lines[bottom][i]=[this.lines[bottom][i][0]," "];this.x--;this.refresh(this.rows-1,this.rows-1);this.refresh(this.y,this.y);return}if(key.length===1&&key>=" "&&key<="~"){var bottom=this.ydisp+this.rows-1;this.entry+=key;var i=this.entryPrefix.length+this.entry.length-1;this.lines[bottom][i]=[this.defAttr&~511|4,key];this.x++;this.refresh(this.rows-1,this.rows-1);this.refresh(this.y,this.y);return}return false};Terminal.charsets={};Terminal.charsets.SCLD={"`":"◆",a:"▒",b:"\t",c:"\f",d:"\r",e:"\n",f:"°",g:"±",h:"␤",i:"\v",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"};Terminal.charsets.UK=null;Terminal.charsets.US=null;Terminal.charsets.Dutch=null;Terminal.charsets.Finnish=null;Terminal.charsets.French=null;Terminal.charsets.FrenchCanadian=null;Terminal.charsets.German=null;Terminal.charsets.Italian=null;Terminal.charsets.NorwegianDanish=null;Terminal.charsets.Spanish=null;Terminal.charsets.Swedish=null;Terminal.charsets.Swiss=null;Terminal.charsets.ISOLatin=null;function on(el,type,handler,capture){el.addEventListener(type,handler,capture||false)}function off(el,type,handler,capture){el.removeEventListener(type,handler,capture||false)}function cancel(ev){if(ev.preventDefault)ev.preventDefault();ev.returnValue=false;if(ev.stopPropagation)ev.stopPropagation();ev.cancelBubble=true;return false}function inherits(child,parent){function f(){this.constructor=child}f.prototype=parent.prototype;child.prototype=new f}function isBoldBroken(document){var body=document.getElementsByTagName("body")[0];var terminal=document.createElement("div");terminal.className="terminal";var line=document.createElement("div");var el=document.createElement("span");el.innerHTML="hello world";line.appendChild(el);terminal.appendChild(line);body.appendChild(terminal);var w1=el.scrollWidth;el.style.fontWeight="bold";var w2=el.scrollWidth;body.removeChild(terminal);return w1!==w2}var String=this.String;var setTimeout=this.setTimeout;var setInterval=this.setInterval;function indexOf(obj,el){var i=obj.length;while(i--){if(obj[i]===el)return i}return-1}function isWide(ch){if(ch<="＀")return false;return ch>="！"&&ch<="ﾾ"||ch>="ￂ"&&ch<="ￇ"||ch>="ￊ"&&ch<="ￏ"||ch>="ￒ"&&ch<="ￗ"||ch>="ￚ"&&ch<="ￜ"||ch>="￠"&&ch<="￦"||ch>="￨"&&ch<="￮"}function matchColor(r1,g1,b1){var hash=r1<<16|g1<<8|b1;if(matchColor._cache[hash]!=null){return matchColor._cache[hash]}var ldiff=Infinity,li=-1,i=0,c,r2,g2,b2,diff;for(;i<Terminal.vcolors.length;i++){c=Terminal.vcolors[i];r2=c[0];g2=c[1];b2=c[2];diff=matchColor.distance(r1,g1,b1,r2,g2,b2);if(diff===0){li=i;break}if(diff<ldiff){ldiff=diff;li=i}}return matchColor._cache[hash]=li}matchColor._cache={};matchColor.distance=function(r1,g1,b1,r2,g2,b2){return Math.pow(30*(r1-r2),2)+Math.pow(59*(g1-g2),2)+Math.pow(11*(b1-b2),2)};function each(obj,iter,con){if(obj.forEach)return obj.forEach(iter,con);for(var i=0;i<obj.length;i++){iter.call(con,obj[i],i,obj)}}function keys(obj){if(Object.keys)return Object.keys(obj);var key,keys=[];for(key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){keys.push(key)}}return keys}Terminal.EventEmitter=EventEmitter;Terminal.Stream=Stream;Terminal.inherits=inherits;Terminal.on=on;Terminal.off=off;Terminal.cancel=cancel;if(typeof module!=="undefined"){module.exports=Terminal}else{this.Terminal=Terminal}}).call(function(){return this||(typeof window!=="undefined"?window:global)}())}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],106:[function(require,module,exports){(function(process){var os=process.platform==="win32"?"_win":"";module.exports=require("./lib/pty"+os+".js")}).call(this,require("_process"))},{_process:30}],blessed:[function(require,module,exports){function blessed(){return blessed.program.apply(null,arguments)}blessed.program=blessed.Program=require("./program");blessed.tput=blessed.Tput=require("./tput");blessed.widget=require("./widget");blessed.colors=require("./colors");blessed.unicode=require("./unicode");blessed.helpers=require("./helpers");blessed.helpers.sprintf=blessed.tput.sprintf;blessed.helpers.tryRead=blessed.tput.tryRead;blessed.helpers.merge(blessed,blessed.helpers);blessed.helpers.merge(blessed,blessed.widget);module.exports=blessed},{"./colors":59,"./helpers":62,"./program":64,"./tput":65,"./unicode":66,"./widget":67}]},{},[]);